<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>La planete francophone de PostgreSQL</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="Planet/2.0 +http://www.planetplanet.org">

<link rel="stylesheet" href="planet.css" type="text/css">

  <style type="text/css" media="screen">
  @import url(http://planete.postgresql.fr/theme/style.css);
  </style>

<link rel="alternate" href="http://planete.postgresql.fr/atom.xml" title="" type="application/atom+xml">
</head>

<body>
<div id="top">
  <div id="pgHeader">
    <span id="pgHeaderLogoLeft">
      <a href="/" title="PostgreSQL"><img src="http://planete.postgresql.fr/theme/img/hdr_left.png" width="230" height="80" alt="PostgreSQL" /></a>
    </span>
    <span id="pgHeaderLogoRight">
      <a href="/" title="La base de donnees la plus sophistiquee au monde."><img src="http://planete.postgresql.fr/theme/img/hdr_right.png" width="210" height="80" alt="La base de donnees la plus sophistiquee au monde." /></a>
    </span>

  </div>
</div>

<div class="pgTopNav">
  <div class="pgTopNavLeft"> 
    <img src="http://planete.postgresql.fr/theme/img/nav_lft.png" width="7" height="23" alt="" />
  </div>
  <div class="pgTopNavRight">
    <img src="http://planete.postgresql.fr/theme/img/nav_rgt.png" width="7" height="23" alt="" />
  </div>
  <ul class="pgTopNavList">
    <li><a href="http://www.postgresql.fr/" title="Accueil">Accueil</a></li>
    <li><a href="http://blog.postgresql.fr/" title="Lire les actualités">Actualités</a></li>
    <li><a href="http://docs.postgresql.fr/" title="Lire la documentation officielle">Documentation</a></li>
    <li><a href="http://forums.postgresql.fr/" title="Pour poser des questions">Forums</a></li>
    <li><a href="http://asso.postgresql.fr/" title="La vie de l'association">Association</a></li>
    <li><a href="http://www.postgresql.fr/devel:accueil" title="Informations pour les développeurs/traducteurs">Développeurs</a></li>
    <li><a href="http://planete.postgresql.fr" title="La planète francophone sur PostgreSQL">Planète</a></li>
    <li><a href="http://support.postgresql.fr" title="Support sur PostgreSQL">Support</a></li>
  </ul>

</div>
<div id="wrapper">

<div id="pgContent">
  <div id="contenu">

<h1>La planete francophone de PostgreSQL</h1>

<div class="daygroup">
<h2>vendredi 26 mai 2017</h2>

<div class="channelgroup">







<h3><a href="http://pgphil.ovh" title="pgphil.ovh">Philippe Florent</a></h3>


<div class="entrygroup" id="http://pgphil.ovh/46c87006-670e-446e-aa0e-84eab971c2bc">
<h4><a href="http://pgphil.ovh/hash_index_10_beta_02.php">Indexation HASH - partie 2</a></h4>
<div class="entry">
<div class="content">
Retour en grâce des index hash avec PostgreSQL 10 mais attention aux excès d'enthousiasme</div>







<p class="date">
<a href="http://pgphil.ovh/hash_index_10_beta_02.php">vendredi 26 mai 2017 à 20h30</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mercredi 24 mai 2017</h2>

<div class="channelgroup">







<h3><a href="http://pgphil.ovh" title="pgphil.ovh">Philippe Florent</a></h3>


<div class="entrygroup" id="http://pgphil.ovh/4cf36cda-34fa-4c6b-b10b-07956c75ea6e">
<h4><a href="http://pgphil.ovh/partition_brin_index_10_beta_02.php">Partitionnement avec PostgreSQL 10</a></h4>
<div class="entry">
<div class="content">
Partitionnement et sous-partitionnement combinés avec indexation BRIN et parallélisme : un cocktail efficace</div>







<p class="date">
<a href="http://pgphil.ovh/partition_brin_index_10_beta_02.php">mercredi 24 mai 2017 à 21h30</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi 23 mai 2017</h2>

<div class="channelgroup">







<h3><a href="http://www.loxodata.com/post/" title="Blog Loxodata">Loxodata</a></h3>


<div class="entrygroup" id="http://www.loxodata.com/post/monitoring-with-pg/" lang="fr-FR">
<h4><a href="http://www.loxodata.com/post/monitoring-with-pg/">Monitoring avec Postgres</a></h4>
<div class="entry">
<div class="content">
<p>Voici un rapide retour sur la solution de Steve Simpson pour le monitoring d&rsquo;infrastructures complexes donné le jour du PGDAY Paris, le 23 mars dernier.
Les slides sont disponibles <a href="https://www.slideshare.net/StevenSimpson30/infrastructure-monitoring-with-postgres">sur slideshare</a>.</p>

<p><strong>Le contexte</strong>&nbsp;: une infrastructure complexe avec de gros volumes de données et de charges (Multi-tenant massively parallel workload).</p>

<p><strong>La problématique</strong>&nbsp;: comment monitorer tout cela ?</p>

<p><strong>Deux réponses possibles</strong></p>

<p>La première&nbsp;: ELK (Elastic Search - Logstash - Kibana) associé à InfluxDB + Grafana + SQLite  avec en sus Kafka, MySQL et Zookeeper. Et tout cela fait beaucoup d&rsquo;outils à mettre en place comme vous pouvez-le voir ci-dessous&nbsp;:
<img src="http://www.loxodata.com/images/post/monitoring-2017/avant.png" alt="Un monitoring classique (illustration tirée des slides de Steven Simpson)" /></p>

<p>Ou alors&hellip; <strong>Simplement PostgreSQL</strong>&nbsp;! (+Grafana)
<img src="http://www.loxodata.com/images/post/monitoring-2017/apres.png" alt="La simplification du monitoring avec PostgreSQL (illustration tirée des slides de Steven Simpson)" /></p>

<p>Steve commence par passer en revue les outils existants, avec leur entrée sur le marché.
Les besoins sont listés un à un, les fonctionnalités employées une à une et ce, pour chacune des briques de l&rsquo;infrastructure.
L&rsquo;intégralité des outils employés au départ est remplacée par <strong>PostgreSQL</strong> (et Grafana pour la partie graphique).</p>

<h2 id="prenons-les-choses-dans-l-ordre">Prenons les choses dans l&rsquo;ordre</h2>

<p>Il est en effet possible de faire absorber à PostgreSQL un gros volume d&rsquo;information avec des structures de schema dénormalisées comportant des champs de type JSON et JSONB qui permettent une grande flexibilité de contenu.</p>

<p>Les différentes métriques sont stockées de cette façon ainsi que la liste des métriques elle même.</p>

<p>Les possibilités du language SQL dans PostgreSQL sont mises à contribution (fonctions TIME_ROUND, AVG, BETWEEN, @&gt;&hellip;), de même que les index GIN (sur les champs JSONB).</p>

<p>Les fonctions utilisateur sont par la suite employées sur des parties de schéma normalisées pour diminuer la redondance des informations, organiser les données et les métriques brutes absorbées.</p>

<h2 id="la-pertinence-des-élements-à-observer">La pertinence des élements à observer</h2>

<p>Pour grapher les données, une granularité minimale est nécessaire pour obtenir une représentation pertinente.
Le filtrage/échantillonage et la renormalisation du schéma permettent de faciliter le requêtage et de diminuer la quantité de données en transit.</p>

<p>Pour les résumés (aggregats de données), ce sont encore les fonctions internes (TIME_ROUND, LEAST, GREATEST&hellip;) qui sont mises à profit ainsi que les triggers mais également les vues (jointures).<br />
Ces résumés permettent d&rsquo;obtenir un état général toutes les 5 minutes.
Ce jeu de données utilisé est donc faible et l&rsquo;impact sur les performances est encore une fois limité par une utilisation judicieuse des points forts du SGBD.</p>

<h2 id="une-image-vaut-mieux-qu-un-long-discours">Une image vaut mieux qu&rsquo;un long discours</h2>

<p>La conférence est accompagnée de graphiques comparatifs de performance sur les temps de requêtages.
L&rsquo;orateur nous donne des exemples de requêtes, fonctions, triggers qui nous permettent de nous rendre compte de ce qu&rsquo;il a fallu mettre en place en terme de language SQL.</p>

<p>Les insertions de données dans les différents régimes (dénormalisé, normalisé, résumé) sont comparées.
<img src="http://www.loxodata.com/images/post/monitoring-2017/digestion.png" alt="Insertion des données de monitoring dans PostgreSQL (illustration tirée des slides de Steven Simpson)" /></p>

<p>On s&rsquo;aperçoit que les 600ms, 1750ms et 3300ms nécessaires pour absorber 45 millions de lignes (le monitoring d&rsquo;une journée) sont des performances très intéressantes.
Ce qui fait de PostgreSQL un sérieux challenger dans la liste des outils en compétition sur le marché des solutions de monitoring.</p>

<p>L&rsquo;orateur nous propose les évolutions qu&rsquo;il entrevoit pour son système. Notamment des résumés sur 30 minutes avec des requêtes plus larges.
Du partitionnement par jour pour faciliter l&rsquo;ingestion et la suppression régulière sur la durée.
Un processing par lignes en batch avec des intervales. Et une ingestion asynchrone de l&rsquo;ingestion des transactions.</p>

<p>Steve nous explique qu&rsquo;il cherche à historiser sur 6 mois avec des espaces disques inférieur au Terabyte. Une autre contrainte imposée est de n&rsquo;avoir que 100ms de requête.</p>

<h2 id="tirer-au-mieux-partie-des-fonctionnalités-présentes">Tirer au mieux partie des fonctionnalités présentes</h2>

<p>Mais ça n&rsquo;est pas tout, les autres fonctionnalités utilisées incluent la recherche dans les logs (type rsyslog) en stockage clé/valeur sur des champs JSONB (index GIN) avec FULL TEXT SEARCH (ts_query/ts_vector).</p>

<p>Pour finir, il utilise le parsing de log avec les REGEX contre une liste de patterns (stockés en tables pour plus de flexibilité).
Les informations ainsi extraites sont insérées dans une table de logs avec un champ JSONB.
Au vu des performances lors de l&rsquo;ingestion de données pour les différents types de champs, Steve propose d&rsquo;utiliser PostgreSQL pour le queuing également.</p>

<p>Tous les outils cités au début de la conférence sont finalement remplacés.
Les informations brutes absorbées, puis ordonnées ne nécessite maintenant plus qu&rsquo;une interface ergonomique pour être exploitées.
Grafana est alors utilisé pour cette partie. Pour Steve, PostgreSQL est une boite à outils de données persistantes qui, de surcroit, utilise en natif du SQL.</p>

<p>Les utilisateurs de <strong>PostgreSQL</strong> ne cesseront jamais de m&rsquo;étonner. Tant de flexibilité et de fonctionnalités&nbsp;!</p></div>







<p class="date">
<a href="http://www.loxodata.com/post/monitoring-with-pg/">par contact@loxodata.com (Loxodata) le mardi 23 mai 2017 à 15h30</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi 18 mai 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:9c7c51e53fdc089b515d5e20f615e40e" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/05/19/Nouvelles-hebdomadaires-de-PostgreSQL-7-mai-2017">Nouvelles hebdomadaires de PostgreSQL - 7 mai 2017</a></h4>
<div class="entry">
<div class="content">
<p>Le PGDay Austin 2017 aura lieu le samedi 26 ao&ucirc;t. L'appel &agrave; conf&eacute;renciers s'&eacute;teint le 4 juin&nbsp;: <a target="_blank" href="https://pgdayaustin2017.postgresql.us">https://pgdayaustin2017.postgresql.us</a></p>
<p>[ndt: MeetUp à Nantes le mardi 20 juin&nbsp;: <a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/</a>]</p>
<p>[ndt: MeetUp à Paris le jeudi 29 juin&nbsp;: <a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/</a>]</p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pglogical 2.0, un syst&egrave;me de r&eacute;plication bas&eacute; sur les WAL logiques, pour PostgreSQL&nbsp;: <a target="_blank" href="https://2ndquadrant.com/en/about/news/announcing-release-pglogical-20/">https://2ndquadrant.com/en/about/news/announcing-release-pglogical-20/</a></li>
<li>psqlODBC 09.06.0300&nbsp;: <a target="_blank" href="https://odbc.postgresql.org/docs/release.html">https://odbc.postgresql.org/docs/release.html</a></li>
<li>pg_chameleon 1.0, un outil pour r&eacute;pliquer de MySQL vers PostgreSQL&nbsp;: <a target="_blank" href="https://pypi.python.org/pypi/pg_chameleon">https://pypi.python.org/pypi/pg_chameleon</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en mai</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-05/">http://archives.postgresql.org/pgsql-jobs/2017-05/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Le PGDay 2017 argentin sera tenu &agrave; Santa Fe le 9 juin 2017. L'appel &agrave; conf&eacute;renciers est lanc&eacute;&nbsp;: <a target="_blank" href="http://www.pgday.com.ar">http://www.pgday.com.ar</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>[ndt: MeetUp à Lyon le 28 juin&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
<li>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 30 mai&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></li>
<li>Le PGDay UK 2017 aura lieu &agrave; Londres le 4 juillet 2017&nbsp;: <a target="_blank" href="http://www.pgconf.uk">http://www.pgconf.uk</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170507211724.GA31062@fetter.org">http://www.postgresql.org/message-id/20170507211724.GA31062@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Robert Haas pushed:</p>
<ul>
<li>Fire per-statement triggers on partitioned tables. Even though no actual tuples are ever inserted into a partitioned table (the actual tuples are in the partitions, not the partitioned table itself), we still need to have a ResultRelInfo for the partitioned table, or per-statement triggers won't get fired. Amit Langote, per a report from Rajkumar Raghuwanshi. Reviewed by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAKcux6%3DwYospCRY2J4XEFuVy0L41S%3Dfic7rmkbsU-GXhhSbmBg%40mail.gmail.com">http://postgr.es/m/CAKcux6%3DwYospCRY2J4XEFuVy0L41S%3Dfic7rmkbsU-GXhhSbmBg%40mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e180c8aa8caf5c55a273d4a8e6092e77ff3cff10">https://git.postgresql.org/pg/commitdiff/e180c8aa8caf5c55a273d4a8e6092e77ff3cff10</a></li>
<li>libpq: Fix inadvertent change in .pgpass lookup behavior. Commit 274bb2b3857cc987cfa21d14775cae9b0dababa5 caused password file lookups to use the hostaddr in preference to the host, but that was not intended and the documented behavior is the opposite. Report and patch by Kyotaro Horiguchi. Discussion: <a target="_blank" href="http://postgr.es/m/20170428.165432.60857995.horiguchi.kyotaro@lab.ntt.co.jp">http://postgr.es/m/20170428.165432.60857995.horiguchi.kyotaro@lab.ntt.co.jp</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/bdac9836d3b910c5fd592aaeaac3c2e2e1defcad">https://git.postgresql.org/pg/commitdiff/bdac9836d3b910c5fd592aaeaac3c2e2e1defcad</a></li>
<li>Fix typos in comments. Etsuro Fujita Discussion: <a target="_blank" href="http://postgr.es/m/00e88999-684d-d79a-70e4-908c937a0126@lab.ntt.co.jp">http://postgr.es/m/00e88999-684d-d79a-70e4-908c937a0126@lab.ntt.co.jp</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/0d1e1f0ea45c15170c2d2ae0f0c448bc2d2b72d9">https://git.postgresql.org/pg/commitdiff/0d1e1f0ea45c15170c2d2ae0f0c448bc2d2b72d9</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Fix logical replication launcher wake up and reset. After the logical replication launcher was told to wake up at commit (for example, by a CREATE SUBSCRIPTION command), the flag to wake up was not reset, so it would be woken up at every following commit as well. So fix that by resetting the flag. Also, we don't need to wake up anything if the transaction was rolled back. Just reset the flag in that case. Author: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; Reported-by: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/9414e41ea703ea5fcc288bcf7dc000e53306896b">https://git.postgresql.org/pg/commitdiff/9414e41ea703ea5fcc288bcf7dc000e53306896b</a></li>
<li>Don't wake up logical replication launcher unnecessarily. In CREATE SUBSCRIPTION, only wake up the launcher when the subscription is enabled. Author: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a99448ab4515aaadc17647e53633f418893f5adf">https://git.postgresql.org/pg/commitdiff/a99448ab4515aaadc17647e53633f418893f5adf</a></li>
<li>doc: Update ALTER SEQUENCE claims about changes being nontransactional. Clarify that all changes except RESTART are transactional (since 1753b1b027035029c2a2a1649065762fafbf63f3). Reported-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a35ac7c4e3ccf93876b4652d94a418fc82e0eda3">https://git.postgresql.org/pg/commitdiff/a35ac7c4e3ccf93876b4652d94a418fc82e0eda3</a></li>
<li>Avoid unnecessary catalog updates in ALTER SEQUENCE. ALTER SEQUENCE can do nontransactional changes to the sequence (RESTART clause) and transactional updates to the pg_sequence catalog (most other clauses). When just calling RESTART, the code would still needlessly do a catalog update without any changes. This would entangle that operation in the concurrency issues of a catalog update (causing either locking or concurrency errors, depending on how that issue is to be resolved). Fix by keeping track during options parsing whether a catalog update is needed, and skip it if not. Reported-by: Jason Petersen &lt;jason@citusdata.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/3d092fe5409b98272ddd6e623b657308a3c5f004">https://git.postgresql.org/pg/commitdiff/3d092fe5409b98272ddd6e623b657308a3c5f004</a></li>
<li>doc: Add missing markup. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/460c89f46c1fdf11baa8e76e6d04e1ff87d7e008">https://git.postgresql.org/pg/commitdiff/460c89f46c1fdf11baa8e76e6d04e1ff87d7e008</a></li>
<li>doc: Improve order in ALTER PUBLICATION/SUBSCRIPTION ref pages. Move the OWNER and RENAME clauses to the end, so the interesting functionality is listed first. This is more typical on nearby reference pages, whereas the previous order was the order in which the clauses were added. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e9500240661c03750923e6f539bfa2d75cfaa32a">https://git.postgresql.org/pg/commitdiff/e9500240661c03750923e6f539bfa2d75cfaa32a</a></li>
<li>Fix cursor_to_xml in tableforest false mode. It only produced &lt;row&gt; elements but no wrapping &lt;table&gt; element. By contrast, cursor_to_xmlschema produced a schema that is now correct but did not previously match the XML data produced by cursor_to_xml. In passing, also fix a minor misunderstanding about moving cursors in the tests related to this. Reported-by: filip@jirsak.org Based-on-patch-by: Thomas Munro &lt;thomas.munro@enterprisedb.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/0de791ed760614991e7cb8a78fddd6874ea6919d">https://git.postgresql.org/pg/commitdiff/0de791ed760614991e7cb8a78fddd6874ea6919d</a></li>
<li>Prevent panic during shutdown checkpoint. When the checkpointer writes the shutdown checkpoint, it checks afterwards whether any WAL has been written since it started and throws a PANIC if so. At that point, only walsenders are still active, so one might think this could not happen, but walsenders can also generate WAL, for instance in BASE_BACKUP and certain variants of CREATE_REPLICATION_SLOT. So they can trigger this panic if such a command is run while the shutdown checkpoint is being written. To fix this, divide the walsender shutdown into two phases. First, the postmaster sends a SIGUSR2 signal to all walsenders. The walsenders then put themselves into the "stopping" state. In this state, they reject any new commands. (For simplicity, we reject all new commands, so that in the future we do not have to track meticulously which commands might generate WAL.) The checkpointer waits for all walsenders to reach this state before proceeding with the shutdown checkpoint. After the shutdown checkpoint is done, the postmaster sends SIGINT (previously unused) to the walsenders. This triggers the existing shutdown behavior of sending out the shutdown checkpoint record and then terminating. Author: Michael Paquier &lt;michael.paquier@gmail.com&gt; Reported-by: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/086221cf6b1727c2baed4703c582f657b7c5350e">https://git.postgresql.org/pg/commitdiff/086221cf6b1727c2baed4703c582f657b7c5350e</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Allow vcregress.pl to run an arbitrary TAP test set. Currently only provision for running the bin checks in a single step is provided for. Now these tests can be run individually, as well as tests in other locations (e.g. src.test/recover). Also provide for suppressing unnecessary temp installs by setting the NO_TEMP_INSTALL environment variable just as the Makefiles do. Backpatch to 9.4. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/fed6df486dca1b9e53d3f560031b9a236c99f4bb">https://git.postgresql.org/pg/commitdiff/fed6df486dca1b9e53d3f560031b9a236c99f4bb</a></li>
<li>Fix perl thinko in commit fed6df486dca. Report and fix from Vaishnavi Prabakaran Backpatch to 9.4 like original. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/9a0d2008c3fe82c9d62a81e87cd0c4de1be09e0f">https://git.postgresql.org/pg/commitdiff/9a0d2008c3fe82c9d62a81e87cd0c4de1be09e0f</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Update time zone data files to tzdata release 2017b. DST law changes in Chile, Haiti, and Mongolia. Historical corrections for Ecuador, Kazakhstan, Liberia, and Spain. The IANA crew continue their campaign to replace invented time zone abbrevations with numeric GMT offsets. This update changes numerous zones in South America, the Pacific and Indian oceans, and some Asian and Middle Eastern zones. I kept these abbreviations in the tznames/ data files, however, so that we will still accept them for input. (We may want to start trimming those files someday, but I think we should wait for the upstream dust to settle before deciding what to do.) In passing, add MESZ (Mitteleuropaeische Sommerzeit) to the tznames lists; since we accept MEZ (Mitteleuropaeische Zeit) it seems rather strange not to take the other one. And fix some incorrect, or at least obsolete, comments that certain abbreviations are not traceable to the IANA data. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/74a20d0ab7c99b3efcf5dc7aac741e3b2f952a34">https://git.postgresql.org/pg/commitdiff/74a20d0ab7c99b3efcf5dc7aac741e3b2f952a34</a></li>
<li>Fix mis-optimization of semijoins with more than one LHS relation. The inner-unique patch (commit 9c7f5229a) supposed that if we're considering a JOIN_UNIQUE_INNER join path, we can always set inner_unique for the join, because the inner path produced by create_unique_path should be unique relative to the outer relation. However, that's true only if we're considering joining to the whole outer relation --- otherwise we may be applying only some of the join quals, and so the inner path might be non-unique from the perspective of this join. Adjust the test to only believe that we can set inner_unique if we have the whole semijoin LHS on the outer side. There is more that can be done in this area, but this commit is only intended to provide the minimal fix needed to get correct plans. Per report from Teodor Sigaev. Thanks to David Rowley for preliminary investigation. Discussion: <a target="_blank" href="https://postgr.es/m/f994fc98-389f-4a46-d1bc-c42e05cb43ed@sigaev.ru">https://postgr.es/m/f994fc98-389f-4a46-d1bc-c42e05cb43ed@sigaev.ru</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/2057a58d1629ebffce694e3cef7f714571a88dd7">https://git.postgresql.org/pg/commitdiff/2057a58d1629ebffce694e3cef7f714571a88dd7</a></li>
<li>Reduce semijoins with unique inner relations to plain inner joins. If the inner relation can be proven unique, that is it can have no more than one matching row for any row of the outer query, then we might as well implement the semijoin as a plain inner join, allowing substantially more freedom to the planner. This is a form of outer join strength reduction, but it can't be implemented in reduce_outer_joins() because we don't have enough info about the individual relations at that stage. Instead do it much like remove_useless_joins(): once we've built base relations, we can make another pass over the SpecialJoinInfo list and get rid of any entries representing reducible semijoins. This is essentially a followon to the inner-unique patch (commit 9c7f5229a) and makes use of the proof machinery that that patch created. We need only minor refactoring of innerrel_is_unique's API to support this usage. Per performance complaint from Teodor Sigaev. Discussion: <a target="_blank" href="https://postgr.es/m/f994fc98-389f-4a46-d1bc-c42e05cb43ed@sigaev.ru">https://postgr.es/m/f994fc98-389f-4a46-d1bc-c42e05cb43ed@sigaev.ru</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/92a43e4857d9682b93c9f755f453cc8fd7c66c81">https://git.postgresql.org/pg/commitdiff/92a43e4857d9682b93c9f755f453cc8fd7c66c81</a></li>
<li>Improve function header comment for create_singleton_array(). Mentioning the caller is neither future-proof nor an adequate substitute for giving an API specification. Per gripe from Neha Khatri, though I changed the patch around some. Discussion: <a target="_blank" href="https://postgr.es/m/CAFO0U+_fS5SRhzq6uPG+4fbERhoA9N2+nPrtvaC9mmeWivxbsA@mail.gmail.com">https://postgr.es/m/CAFO0U+_fS5SRhzq6uPG+4fbERhoA9N2+nPrtvaC9mmeWivxbsA@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/54affb41e79cf4bec00bb5e00eb12a1715b9e278">https://git.postgresql.org/pg/commitdiff/54affb41e79cf4bec00bb5e00eb12a1715b9e278</a></li>
<li>Ensure commands in extension scripts see the results of preceding DDL. Due to a missing CommandCounterIncrement() call, parsing of a non-utility command in an extension script would not see the effects of the immediately preceding DDL command, unless that command's execution ends with CommandCounterIncrement() internally ... which some do but many don't. Report by Philippe Beaudoin, diagnosis by Julien Rouhaud. Rather remarkably, this bug has evaded detection since extensions were invented, so back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/2cf7941e-4e41-7714-3de8-37b1a8f74dff@free.fr">https://postgr.es/m/2cf7941e-4e41-7714-3de8-37b1a8f74dff@free.fr</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/9209e07605afe0349660447f20d83ef165cdd0ae">https://git.postgresql.org/pg/commitdiff/9209e07605afe0349660447f20d83ef165cdd0ae</a></li>
<li>Remove create_singleton_array(), hard-coding the case in its sole caller. create_singleton_array() was not really as useful as we perhaps thought when we added it. It had never accreted more than one call site, and is only saving a dozen lines of code at that one, which is considerably less bulk than the function itself. Moreover, because of its insistence on using the caller's fn_extra cache space, it's arguably a coding hazard. text_to_array_internal() does not currently use fn_extra in any other way, but if it did it would be subtly broken, since the conflicting fn_extra uses could be needed within a single query, in the seldom-tested case that the field separator varies during the query. The same objection seems likely to apply to any other potential caller. The replacement code is a bit uglier, because it hardwires knowledge of the storage parameters of type TEXT, but it's not like we haven't got dozens or hundreds of other places that do the same. Uglier seems like a good tradeoff for smaller, faster, and safer. Per discussion with Neha Khatri. Discussion: <a target="_blank" href="https://postgr.es/m/CAFO0U+_fS5SRhzq6uPG+4fbERhoA9N2+nPrtvaC9mmeWivxbsA@mail.gmail.com">https://postgr.es/m/CAFO0U+_fS5SRhzq6uPG+4fbERhoA9N2+nPrtvaC9mmeWivxbsA@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/23c6eb03360d270051bf7dcb289ecb0cd114d29f">https://git.postgresql.org/pg/commitdiff/23c6eb03360d270051bf7dcb289ecb0cd114d29f</a></li>
<li>Remove useless and rather expensive stanza in matview regression test. This removes a test case added by commit b69ec7cc9, which was intended to exercise a corner case involving the rule used at that time that materialized views were unpopulated iff they had physical size zero. We got rid of that rule very shortly later, in commit 1d6c72a55, but kept the test case. However, because the case now asks what VACUUM will do to a zero-sized physical file, it would be pretty surprising if the answer were ever anything but "nothing" ... and if things were indeed that broken, surely we'd find it out from other tests. Since the test involves a table that's fairly large by regression-test standards (100K rows), it's quite slow to run. Dropping it should save some buildfarm cycles, so let's do that. Discussion: <a target="_blank" href="https://postgr.es/m/32386.1493831320@sss.pgh.pa.us">https://postgr.es/m/32386.1493831320@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/4dd4104342068e542e865e5b0486e14600746221">https://git.postgresql.org/pg/commitdiff/4dd4104342068e542e865e5b0486e14600746221</a></li>
<li>Fix pfree-of-already-freed-tuple when rescanning a GiST index-only scan. GiST's getNextNearest() function attempts to pfree the previously-returned tuple if any (that is, scan-&gt;xs_hitup in HEAD, or scan-&gt;xs_itup in older branches). However, if we are rescanning a plan node after ending a previous scan early, those tuple pointers could be pointing to garbage, because they would be pointing into the scan's pageDataCxt or queueCxt which has been reset. In a debug build this reliably results in a crash, although I think it might sometimes accidentally fail to fail in production builds. To fix, clear the pointer field anyplace we reset a context it might be pointing into. This may be overkill --- I think probably only the queueCxt case is involved in this bug, so that resetting in gistrescan() would be sufficient --- but dangling pointers are generally bad news, so let's avoid them. Another plausible answer might be to just not bother with the pfree in getNextNearest(). The reconstructed tuples would go away anyway in the context resets, and I'm far from convinced that freeing them a bit earlier really saves anything meaningful. I'll stick with the original logic in this patch, but if we find more problems in the same area we should consider that approach. Per bug #14641 from Denis Smirnov. Back-patch to 9.5 where this logic was introduced. Discussion: <a target="_blank" href="https://postgr.es/m/20170504072034.24366.57688@wrigleys.postgresql.org">https://postgr.es/m/20170504072034.24366.57688@wrigleys.postgresql.org</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/3f074845a8c190b365e68e39e39017ff70330f2a">https://git.postgresql.org/pg/commitdiff/3f074845a8c190b365e68e39e39017ff70330f2a</a></li>
<li>Suppress compiler warning about unportable pointer value. Setting a pointer value to "0xdeadbeef" draws a warning from some compilers, and for good reason. Be less cute and just set it to NULL. In passing make some other cosmetic adjustments nearby. Discussion: <a target="_blank" href="https://postgr.es/m/CAJrrPGdW3EkU-CRobvVKYf3fJuBdgWyuGeAbNzAQ4yBh+bfb_Q@mail.gmail.com">https://postgr.es/m/CAJrrPGdW3EkU-CRobvVKYf3fJuBdgWyuGeAbNzAQ4yBh+bfb_Q@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/b3a47cdfd692079e36d2055d7d93759e083263ca">https://git.postgresql.org/pg/commitdiff/b3a47cdfd692079e36d2055d7d93759e083263ca</a></li>
<li>First-draft release notes for 9.6.3. As usual, the release notes for other branches will be made by cutting these down, but put them up for community review first. Note there are some entries that really only apply to pre-9.6 branches. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/54dbd4dc78b045ffcc046b9a43681770c3992dd4">https://git.postgresql.org/pg/commitdiff/54dbd4dc78b045ffcc046b9a43681770c3992dd4</a></li>
<li>Document current_role. This system function has been there a very long time, but somehow escaped being listed in func.sgml. Fabien Coelho and Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/alpine.DEB.2.20.1705061027580.3896@lancre">https://postgr.es/m/alpine.DEB.2.20.1705061027580.3896@lancre</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a9c6d704354bfe91bc389742cb5d331ae4e93831">https://git.postgresql.org/pg/commitdiff/a9c6d704354bfe91bc389742cb5d331ae4e93831</a></li>
<li>Second pass on 9.6.3 release notes. Improve description of logical decoding snapshot issues, per suggestion from Petr Jelinek. Mention possible need to re-sync logical replicas as a post-upgrade task. Minor copy-editing for some other items. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/334b82cd56a65e09154d9f930d35a761a9c5cfab">https://git.postgresql.org/pg/commitdiff/334b82cd56a65e09154d9f930d35a761a9c5cfab</a></li>
<li>Restore fullname[] contents before falling through in pg_open_tzfile(). Fix oversight in commit af2c5aa88: if the shortcut open() doesn't work, we need to reset fullname[] to be just the name of the toplevel tzdata directory before we fall through into the pre-existing code. This failed to be exposed in my (tgl's) testing because the fall-through path is actually never taken under normal circumstances. David Rowley, per report from Amit Kapila Discussion: <a target="_blank" href="https://postgr.es/m/CAA4eK1LC7CaNhRAQ__C3ht1JVrPzaAXXhEJRnR5L6bfYHiLmWw@mail.gmail.com">https://postgr.es/m/CAA4eK1LC7CaNhRAQ__C3ht1JVrPzaAXXhEJRnR5L6bfYHiLmWw@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/5788a5670e4a58049b8adc82c4fef97a2c3be327">https://git.postgresql.org/pg/commitdiff/5788a5670e4a58049b8adc82c4fef97a2c3be327</a></li>
<li>Install the "posixrules" timezone link in MSVC builds. Somehow, we'd missed ever doing this. The consequences aren't too severe: basically, the timezone library would fall back on its hardwired notion of the DST transition dates to use for a POSIX-style zone name, rather than obeying US/Eastern which is the intended behavior. The net effect would only be to obey current US DST law further back than it ought to apply; so it's not real surprising that nobody noticed. David Rowley, per report from Amit Kapila Discussion: <a target="_blank" href="https://postgr.es/m/CAA4eK1LC7CaNhRAQ__C3ht1JVrPzaAXXhEJRnR5L6bfYHiLmWw@mail.gmail.com">https://postgr.es/m/CAA4eK1LC7CaNhRAQ__C3ht1JVrPzaAXXhEJRnR5L6bfYHiLmWw@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/d4e59c5521c244e809c3d68df51fb79543578e41">https://git.postgresql.org/pg/commitdiff/d4e59c5521c244e809c3d68df51fb79543578e41</a></li>
<li>Guard against null t-&gt;tm_zone in strftime.c. The upstream IANA code does not guard against null TM_ZONE pointers in this function, but in our code there is such a check in the other pre-existing use of t-&gt;tm_zone. We do have some places that set pg_tm.tm_zone to NULL. I'm not entirely sure it's possible to reach strftime with such a value, but I'm not sure it isn't either, so be safe. Per Coverity complaint. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a54d5875fe0bc19d05236b85e1e1bf0af9fa2902">https://git.postgresql.org/pg/commitdiff/a54d5875fe0bc19d05236b85e1e1bf0af9fa2902</a></li>
<li>Improve performance of timezone loading, especially pg_timezone_names view. tzparse() would attempt to load the "posixrules" timezone database file on each call. That might seem like it would only be an issue when selecting a POSIX-style zone name rather than a zone defined in the timezone database, but it turns out that each zone definition file contains a POSIX-style zone string and tzload() will call tzparse() to parse that. Thus, when scanning the whole timezone file tree as we do in the pg_timezone_names view, "posixrules" was read repetitively for each zone definition file. Fix that by caching the file on first use within any given process. (We cache other zone definitions for the life of the process, so there seems little reason not to cache this one as well.) This probably won't help much in processes that never run pg_timezone_names, but even one additional SET of the timezone GUC would come out ahead. An even worse problem for pg_timezone_names is that pg_open_tzfile() has an inefficient way of identifying the canonical case of a zone name: it basically re-descends the directory tree to the zone file. That's not awful for an individual "SET timezone" operation, but it's pretty horrid when we're inspecting every zone in the database. And it's pointless too because we already know the canonical spelling, having just read it from the filesystem. Fix by teaching pg_open_tzfile() to avoid the directory search if it's not asked for the canonical name, and backfilling the proper result in pg_tzenumerate_next(). In combination these changes seem to make the pg_timezone_names view about 3x faster to read, for me. Since a scan of pg_timezone_names has up to now been one of the slowest queries in the regression tests, this should help some little bit for buildfarm cycle times. Back-patch to all supported branches, not so much because it's likely that users will care much about the view's performance as because tracking changes in the upstream IANA timezone code is really painful if we don't keep all the branches in sync. Discussion: <a target="_blank" href="https://postgr.es/m/27962.1493671706@sss.pgh.pa.us">https://postgr.es/m/27962.1493671706@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/af2c5aa88d38573724e40fa029499b4db20b0eb2">https://git.postgresql.org/pg/commitdiff/af2c5aa88d38573724e40fa029499b4db20b0eb2</a></li>
<li>Third pass on 9.6.3 release notes. Add updates for recent commits. In passing, credit Etsuro Fujita for his work on the postgres_fdw query cancel feature in 9.6; I seem to have missed that in the original drafting of the 9.6 notes. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/86713deecda4ddbf8e339ec48fafa4d8080f6079">https://git.postgresql.org/pg/commitdiff/86713deecda4ddbf8e339ec48fafa4d8080f6079</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Change hot_standby default value to 'on'. This goes together with the changes made to enable replication on the sending side by default (wal_level, max_wal_senders etc) by making the receiving stadby node also enable it by default. Huong Dangminh <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/34fc61673829f0cb63811fb63cc3c510fc2aadfc">https://git.postgresql.org/pg/commitdiff/34fc61673829f0cb63811fb63cc3c510fc2aadfc</a></li>
<li>Build pgoutput.dll in MSVC build. Without this, logical replication obviously does not work on Windows MauMau, with clean.bet additions from me per note from Michael Paquier <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/28d1c8ccc87128f9b0b937eae277473027c36b7e">https://git.postgresql.org/pg/commitdiff/28d1c8ccc87128f9b0b937eae277473027c36b7e</a></li>
<li>Fix wording in pg_upgrade docs. Author: Daniel Gustafsson <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/499ae5f5db99c84035e9951fd30e428adf0f40d2">https://git.postgresql.org/pg/commitdiff/499ae5f5db99c84035e9951fd30e428adf0f40d2</a></li>
</ul>
<p>&Aacute;lvaro Herrera pushed:</p>
<ul>
<li>extstats: change output functions to emit valid JSON. Manipulating extended statistics is more convenient as JSON than the current ad-hoc format, so let's change before it's too late. Discussion: <a target="_blank" href="https://postgr.es/m/20170420193828.k3fliiock5hdnehn@alvherre.pgsql">https://postgr.es/m/20170420193828.k3fliiock5hdnehn@alvherre.pgsql</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/93bbeec6a21b76612d77176a8054b41277135684">https://git.postgresql.org/pg/commitdiff/93bbeec6a21b76612d77176a8054b41277135684</a></li>
<li>Add pg_dump tests for CREATE STATISTICS. CREATE STATISTICS pg_dump support code was not covered at all by previous tests. Discussion: <a target="_blank" href="https://postgr.es/m/20170503172746.rwftidszir67sgk7@alvherre.pgsql">https://postgr.es/m/20170503172746.rwftidszir67sgk7@alvherre.pgsql</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a93077ef467138235c3f05e3ba36dfcabe3d0898">https://git.postgresql.org/pg/commitdiff/a93077ef467138235c3f05e3ba36dfcabe3d0898</a></li>
<li>pg_dump/t/002: append terminating semicolon to SQL commands. It's easy to overlook the need for one, and its lack is annoying for the next developer wanting to create a new test. Rather than expect every individual command to add the semicolon, just append one automatically. Discussion: <a target="_blank" href="http://postgr.es/m/20170503172746.rwftidszir67sgk7@alvherre.pgsql">http://postgr.es/m/20170503172746.rwftidszir67sgk7@alvherre.pgsql</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/698923d6588ee15a386d26c45e5f25ee1a68cc34">https://git.postgresql.org/pg/commitdiff/698923d6588ee15a386d26c45e5f25ee1a68cc34</a></li>
<li>Credit Claudio as main author of feature. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/c22b59edd26fb69661188b040ea3e8776a533685">https://git.postgresql.org/pg/commitdiff/c22b59edd26fb69661188b040ea3e8776a533685</a></li>
<li>Allow MSVC to build with Tcl 8.6. Commit eaba54c20c5 added support for Tcl 8.6 for configure-supported platforms after verifying that pltcl works without further changes, but the MSVC tooling wasn't updated accordingly. Update MSVC to match, restructuring the code to avoid duplicating the logic for every Tcl version supported. Backpatch to all live branches, like eaba54c20c5. In 9.4 and previous, change the patch to use backslashes rather than forward, as in the rest of the file. Reported by Paresh More, who also tested the patch I provided. Discussion: <a target="_blank" href="https://postgr.es/m/CAAgiCNGVw3ssBtSi3ZNstrz5k00ax=UV+_ZEHUeW_LMSGL2sew@mail.gmail.com">https://postgr.es/m/CAAgiCNGVw3ssBtSi3ZNstrz5k00ax=UV+_ZEHUeW_LMSGL2sew@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/14722c69f924810ecf11769e8b9788b3f82d2a0e">https://git.postgresql.org/pg/commitdiff/14722c69f924810ecf11769e8b9788b3f82d2a0e</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Add PQencryptPasswordConn function to libpq, use it in psql and createuser. The new function supports creating SCRAM verifiers, in addition to md5 hashes. The algorithm is chosen based on password_encryption, by default. This fixes the issue reported by Jeff Janes, that there was previously no way to create a SCRAM verifier with "\password". Michael Paquier and me Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAMkU%3D1wfBgFPbfAMYZQE78p%3DVhZX7nN86aWkp0QcCp%3D%2BKxZ%3Dbg%40mail.gmail.com">https://www.postgresql.org/message-id/CAMkU%3D1wfBgFPbfAMYZQE78p%3DVhZX7nN86aWkp0QcCp%3D%2BKxZ%3Dbg%40mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/8f8b9be51fd788bb11276df89606bc653163524e">https://git.postgresql.org/pg/commitdiff/8f8b9be51fd788bb11276df89606bc653163524e</a></li>
<li>Fix PQencryptPasswordConn to work with older server versions. password_encryption was a boolean before version 10, so cope with "on" and "off". Also, change the behavior with "plain", to treat it the same as "md5". We're discussing removing the password_encryption='plain' option from the server altogether, which will make this the only reasonable choice, but even if we kept it, it seems best to never send the password in cleartext. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/20bf7b2b0afcb53608ec37005ee7f831132925d2">https://git.postgresql.org/pg/commitdiff/20bf7b2b0afcb53608ec37005ee7f831132925d2</a></li>
<li>Make SCRAM salts and nonces longer. The salt is stored base64-encoded. With the old 10 bytes raw length, it was always padded to 16 bytes after encoding. We might as well use 12 raw bytes for the salt, and it's still encoded into 16 bytes. Similarly for the random nonces, use a raw length that's divisible by 3, so that there's no padding after base64 encoding. Make the nonces longer while we're at it. 10 bytes was probably enough to prevent replay attacks, but there's no reason to be skimpy here. Per suggestion from &Aacute;lvaro Hern&aacute;ndez Tortosa. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/df8c6e27-4d8e-5281-96e5-131a4e638fc8@8kdata.com">https://www.postgresql.org/message-id/df8c6e27-4d8e-5281-96e5-131a4e638fc8@8kdata.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/0557a5dc2cf845639d384801b6861ebbd35dc7ee">https://git.postgresql.org/pg/commitdiff/0557a5dc2cf845639d384801b6861ebbd35dc7ee</a></li>
<li>Misc cleanup of SCRAM code. * Remove is_scram_verifier() function. It was unused. * Fix sanitize_char() function, used in error messages on protocol violations, to print bytes &gt;= 0x7F correctly. * Change spelling of scram_MockSalt() function to be more consistent with the surroundings. * Change a few more references to "server proof" to "server signature" that I missed in commit d981074c24. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e6e9c4da3a55450b120ad7e3d0be426255850914">https://git.postgresql.org/pg/commitdiff/e6e9c4da3a55450b120ad7e3d0be426255850914</a></li>
<li>Don't use SCRAM-specific "e=invalid-proof" on invalid password. Instead, send the same FATAL message as with other password-based authentication mechanisms. This gives a more user-friendly message: psql: FATAL: password authentication failed for user "test" instead of: psql: error received from server in SASL exchange: invalid-proof Even before this patch, the server sent that FATAL message, after the SCRAM-specific "e=invalid-proof" message. But libpq would stop at the SCRAM error message, and not process the ErrorResponse that would come after that. We could've taught libpq to check for an ErrorResponse after failed authentication, but it's simpler to modify the server to send only the ErrorResponse. The SCRAM specification allows for aborting the authentication at any point, using an application-defined error mechanism, like PostgreSQL's ErrorResponse. Using the e=invalid-proof message is optional. Reported by Jeff Janes. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAMkU%3D1w3jQ53M1OeNfN8Cxd9O%2BA_9VONJivTbYoYRRdRsLT6vA@mail.gmail.com">https://www.postgresql.org/message-id/CAMkU%3D1w3jQ53M1OeNfN8Cxd9O%2BA_9VONJivTbYoYRRdRsLT6vA@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/344a113079888c9b9a81ffa3c3a7d95666347119">https://git.postgresql.org/pg/commitdiff/344a113079888c9b9a81ffa3c3a7d95666347119</a></li>
<li>Fix memory leaks if random salt generation fails. In the backend, this is just to silence coverity warnings, but in the frontend, it's a genuine leak, even if extremely rare. Spotted by Coverity, patch by Michael Paquier. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/0186ded5460c4868db8c5f98ab17287c15fedd7e">https://git.postgresql.org/pg/commitdiff/0186ded5460c4868db8c5f98ab17287c15fedd7e</a></li>
</ul>
<p>Bruce Momjian pushed:</p>
<ul>
<li>doc: PG 10 release note updates for psql, GiST, and markup. Reported-by: Andrew Borodin, Fabien COELHO, Dagfinn Ilmari Manns&aring;ker <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/4f45beba7aea007cbae68eaea5d04d4cab7e4f62">https://git.postgresql.org/pg/commitdiff/4f45beba7aea007cbae68eaea5d04d4cab7e4f62</a></li>
<li>doc: update PG 10 release notes. Mention vacuum verbose includes oldest xmin, BRIN index usage estimation, and multi-column statistics. Reported-by: Masahiko Sawada, Alvaro Herrera <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/5469e44ffc2077cb8371686497022cb5afd1af87">https://git.postgresql.org/pg/commitdiff/5469e44ffc2077cb8371686497022cb5afd1af87</a></li>
<li>doc PG 10: adjustments to BRIN, WAL, JSON, XML items, syntax. Reported-by: Alvaro Herrera <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/628462bda908873688ce738a191b470ab769d604">https://git.postgresql.org/pg/commitdiff/628462bda908873688ce738a191b470ab769d604</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Change the way pg_dump retrieves partitioning info. This gets rid of the code that issued separate queries to retrieve the partitioning parent-child relationship, parent partition key, and child partition bound information. With this patch, the information is retrieved instead using the queries issued from getTables() and getInherits(), which is both more efficient than the previous approach and doesn't require any new code. Since the partitioning parent-child relationship is now retrieved with the same old code that handles inheritance, partition attributes receive a proper flagInhAttrs() treatment (that it didn't receive before), which is needed so that the inherited NOT NULL constraints are not emitted if we already emitted it for the parent. Also, fix a bug in pg_dump's --binary-upgrade code, which caused pg_dump to emit invalid command to attach a partition to its parent. Author: Amit Langote, with some additional changes by me. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/44c528810a1eca52a7888ed74c08353d45331b00">https://git.postgresql.org/pg/commitdiff/44c528810a1eca52a7888ed74c08353d45331b00</a></li>
<li>RLS: Fix ALL vs. SELECT+UPDATE policy usage. When we add the SELECT-privilege based policies to the RLS with check options (such as for an UPDATE statement, or when we have INSERT ... RETURNING), we need to be sure and use the 'USING' case if the policy is actually an 'ALL' policy (which could have both a USING clause and an independent WITH CHECK clause). This could result in policies acting differently when built using ALL (when the ALL had both USING and WITH CHECK clauses) and when building the policies independently as SELECT and UPDATE policies. Fix this by adding an explicit boolean to add_with_check_options() to indicate when the USING policy should be used, even if the policy has both USING and WITH CHECK policies on it. Reported by: Rod Taylor Back-patch to 9.5 where RLS was introduced. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/aa5d3c0b3fb906dfa910b0ca6f75ab701b2f1c09">https://git.postgresql.org/pg/commitdiff/aa5d3c0b3fb906dfa910b0ca6f75ab701b2f1c09</a></li>
<li>pg_dump: Don't leak memory in buildDefaultACLCommands(). buildDefaultACLCommands() didn't destroy the string buffer created in certain cases, leading to a memory leak. Fix by destroying the buffer before returning from the function. Spotted by Coverity. Author: Michael Paquier Back-patch to 9.6 where buildDefaultACLCommands() was added. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/09f842181943b6e83b0779f2e872ff0180b66883">https://git.postgresql.org/pg/commitdiff/09f842181943b6e83b0779f2e872ff0180b66883</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Fix off-by-one possibly leading to skipped XLOG_RUNNING_XACTS records. Since 6ef2eba3f57f1 ("Skip checkpoints, archiving on idle systems."), GetLastImportantRecPtr() is used to avoid performing superfluous checkpoints, xlog switches, running-xact records when the system is idle. Unfortunately the check concerning running-xact records had a off-by-one error, leading to such records being potentially skipped when only a single record has been inserted since the last running-xact record. An alternative approach would have been to change GetLastImportantRecPtr()'s definition to point to the end of records, but that would make the checkpoint code more complicated. Author: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/20170505012447.wsrympaxnfis6ojt@alap3.anarazel.de">https://postgr.es/m/20170505012447.wsrympaxnfis6ojt@alap3.anarazel.de</a> Backpatch: no, code only present in master <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e6c44eef55cda493c759e926cecceb92186159b8">https://git.postgresql.org/pg/commitdiff/e6c44eef55cda493c759e926cecceb92186159b8</a></li>
<li>Fix duplicated words in comment. Reported-By: Peter Geoghegan Discussion: <a target="_blank" href="https://postgr.es/m/CAH2-Wzn3rY2N0gTWndaApD113T+O8L6oz8cm7_F3P8y4awdoOg@mail.gmail.com">https://postgr.es/m/CAH2-Wzn3rY2N0gTWndaApD113T+O8L6oz8cm7_F3P8y4awdoOg@mail.gmail.com</a> Backpatch: no, only present in master <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/b58c433ef90be2f9752cd54561c07dae87e3819c">https://git.postgresql.org/pg/commitdiff/b58c433ef90be2f9752cd54561c07dae87e3819c</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Amit Langote sent in two revisions of a patch to clarify statement trigger behavior with inheritance.</p>
<p>Andres Freund sent in a patch to fix initial logical decoding snapshat race condition.</p>
<p>Peter Eisentraut sent in a patch to pg_ctl which makes failure to complete operation a nonzero exit and remove unnecessary pg_is_in_recovery calls in tests.</p>
<p>Amit Langote sent in two revisions of a patch to emit "correct" range partition constraint expression.</p>
<p>David Rowley sent in a patch to renames all wal_location functions to wal_lsn, renames all system view columns to use "lsn" instead of "location", renames function parameters to use "lsn" instead of "location", renames function parameters "wal_position" to "lsn", changes documentation to reflect the aforementioned changes, fixes a bug where docs claimed return type of pg_logical_slot_peek_changes.location was text, when it was pg_lsn, and change some places in the func.sgml where it was referring to the lsn as a "position" rather than "location".</p>
<p>Amit Khandekar sent in another revision of a patch to enable UPDATEs of partition keys in declaratively partitioned tables.</p>
<p>Pavel St&#283;hule sent in a patch to add a \gdesc option to psql.</p>
<p>Peter Eisentraut sent in a patch to rename transaction log to write-ahead log.</p>
<p>Haribabu Kommi sent in a patch to ensure that pg_basebackup treats STDOUT correctly on Windows.</p>
<p>Rahila Syed sent in two more revisions of a patch to add support for default partitions in declaratively partitioned tables.</p>
<p>Petr Jel&iacute;nek sent in a patch to fix statistics reporting in logical replication workers.</p>
<p>Thomas Munro sent in a patch to allow transition tables in AFTER triggers in one relation only.</p>
<p>Amul Sul sent in another revision of a patch to implement declarative hash partitioning.</p>
<p>Marina Polyakova sent in two revisions of a patch to create the infrastructure for precalculating stable functions.</p>
<p>&Aacute;lvaro Herrera sent in two more revisions of a patch to add a WITH clause to CREATE STATISTICS.</p>
<p>Stas Kelvich sent in another revision of a patch to trim some logical replication ApplyContext bloat.</p>
<p>Robert Haas sent in two revisions of a patch to improve PostgreSQL FDW abort behavior.</p>
<p>Magnus Hagander sent in a patch to add pg_move_replication_slot().</p>
<p>Nikita Glukhov sent in a patch to fix freeing of dangling IndexScanDesc.xs_hitup in GiST.</p>
<p>Andres Freund sent in another revision of a patch to fix an off-by-one around GetLastImportantRecPtr.</p>
<p>David Rowley sent in a patch to implement parallel nextpage batching.</p>
<p>Thomas Munro sent in a patch to fix named tuplestore rescan.</p>
<p>Heikki Linnakangas sent in a patch to remove support for password_encryption='off' / 'plain'.</p>
<p>Dmitriy Sarafannikov sent in a patch to implement a new type of snapshot that accepts any non-vacuumable tuples.</p>
<p>Petr Jel&iacute;nek sent in a patch to rework the options for logical replication.</p>
<p>Alexander Korotkov sent in another revision of a patch to implement incremental sort.</p>
<p>Petr Jel&iacute;nek sent in a patch to check connection info in ALTER SUBSCRIPTION.</p>
<p>David Rowley sent in a doc patch to caution about CTE changes in the future, when the now-mandatory optimization fence may go away.</p>
<p>Stephen Frost sent in a patch to fix ALL RLS policy using check.</p>
<p>Petr Jel&iacute;nek sent in a patch to remove the NODROP SLOT option from DROP SUBSCRIPTION.</p>
<p>David Rowley sent in a patch to use atomics for heap_parallelscan_nextpage().</p>
<p>Bruce Momjian sent in another revision of a patch to update the release notes for PostgreSQL 10.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/05/19/Nouvelles-hebdomadaires-de-PostgreSQL-7-mai-2017">par chl le jeudi 18 mai 2017 à 22h40</a>
</p>
</div>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://www.loxodata.com/post/" title="Blog Loxodata">Loxodata</a></h3>


<div class="entrygroup" id="http://www.loxodata.com/post/postgresql-10-beta/" lang="fr-FR">
<h4><a href="http://www.loxodata.com/post/postgresql-10-beta/">PostgreSQL 10 en bêta</a></h4>
<div class="entry">
<div class="content">
<h2 id="publication-de-postgresql-10-bêta-1">Publication de PostgreSQL 10 Bêta 1</h2>

<p>Le PostgreSQL Global Development Group annonce aujourd&rsquo;hui la première bêta de la version 10 de PostgreSQL.  Cette version contient une pré-version de toutes les fonctionnalités disponibles dans la version finale. Quelques modifications peuvent encore intervenir.</p>

<p>Les utilisateurs peuvent désormais tester leurs applications avec cette version en prévision de la version finale.</p>

<h2 id="principales-fonctionnalités-de-la-version-10">Principales fonctionnalités de la version 10</h2>

<p>La nouvelle version contient de nombreuses fonctionnalités nouvelles. Ces fonctionnalités faciliteront les extensions internes (scale up) et externes (scale out) des infrastructures PostgreSQL :</p>

<ul>
<li>Réplication logique : Option intégrée pour la réplication de tables spécifiques ou la migration ;</li>
<li>Partitionnement de table natif : partitionnement par liste ou intervalle comme objets natifs ;</li>
<li>Parallélisme de requête additionnel : inclusion des parcours d&rsquo;index, bitmap et merge joins ;</li>
<li>Quorum Commit pour la réplication synchrone : s&rsquo;assurer contre la perte de plusieurs nœuds.</li>
</ul>

<p>Cette version inclut également 3 améliorations concernant les connexions à PostgreSQL, que nous demandons aux auteurs de connecteurs de supporter, et aux utilisateurs de tester :</p>

<ul>
<li>Authentification SCRAM, pour des accès par mot de passe plus sûrs ;</li>
<li>&ldquo;Failover&rdquo; multi-hôtes, connexion au premier nœud disponible dans une liste d&rsquo;hôtes ;</li>
<li>Paramètre target_session_attrs, pour permettre au client de demander un hôte en lecture/écriture.</li>
</ul>

<h2 id="fonctionnalités-complémentaires">Fonctionnalités complémentaires</h2>

<p>De nombreuses autres fonctionnalités et améliorations ont été ajoutées à PostgreSQL 10. En fonction des utilisateurs, elles peuvent paraître plus ou moins importantes que les précédentes. Mais elles doivent toutes être testées.</p>

<p>Citons :</p>

<ul>
<li>Index Hash résistants aux crash, et réplicables ;</li>
<li>Statistiques multi-colonnes corrélées ;</li>
<li>Nouveaux rôles de &ldquo;monitoring&rdquo; pour les octrois de permissions ;</li>
<li>Temps d&rsquo;attente de verrou dans pg_stat_activity ;</li>
<li>expression de requête XMLTABLE ;</li>
<li>Politiques restrictives pour Row Level Security ;</li>
<li>Support Full Text Search pour JSON et JSONB;</li>
<li>Support de la compression support pour pg_receivewal ;</li>
<li>Support des collations ICU ;</li>
<li>Push Down Aggregates pour les serveurs externes ;</li>
<li>Transition Tables dans l&rsquo;exécution des triggers.</li>
</ul>

<p>De plus, les développeurs ont contribué à l&rsquo;amélioration des performances de la fonction SUM(), de la conversion d&rsquo;encodage de caractères, de l&rsquo;évaluation d&rsquo;expression, des grouping sets, et des jointures sur des colonnes uniques.</p>

<p>Les requêtes analytiques sur des forts volumes de données devraient être 40% plus rapides. Testez et vérifiez par vous-même, et dites-nous ce qu&rsquo;il en est.</p>

<p>la liste complète des fonctionnalités nouvelles ou modifiées est dans les notes de révision :
<a href="https://www.postgresql.org/docs/devel/static/release-10.html">https://www.postgresql.org/docs/devel/static/release-10.html</a></p>

<h2 id="tests-de-compatibilité-et-recherche-de-bogues">Tests de compatibilité et recherche de bogues</h2>

<p>Nous comptons sur vous pour tester cette version dans vos cas d&rsquo;usage. Cela permettra de découvrir d&rsquo;éventuels bogues ou régression avant la sortie de la PostgreSQL 10.
S&rsquo;agissant d&rsquo;une version bêta, il est possible qu&rsquo;interviennent des modifications dans le comportement des bases, les détails fonctionnels, et les API.</p>

<p>Vos tests et vos retours nous aideront à finaliser ces nouvelles fonctionnalités. De la qualité des tests utilisateurs dépend la date de publication de la version finale.</p>

<p>Enfin, la version 10 contient de nombreuses modifications incompatibles avec les versions majeures qui précédent. En particulier le renommage de &ldquo;xlog&rdquo; en &ldquo;wal&rdquo; et la modification de la numérotation des versions.</p>

<p>Nous encourageons les utilisateurs à tester leurs applications, scripts, et plateformes rapidement.</p>

<p>Les <a href="https://www.postgresql.org/docs/devel/static/release-10.html">notes de version</a> et <a href="https://wiki.postgresql.org/wiki/New_in_postgres_10">page de nouveautés</a> présentent les détails de cette version.</p>

<h2 id="agenda">Agenda</h2>

<p>Il s&rsquo;agit de la première version bêta pour la version 10. Le projet PostgreSQL publiera d&rsquo;autres bêta, si nécessaire, puis une ou plusieurs release candidates, jusqu&rsquo;à la version finale, fin 2017. Pour plus d&rsquo;informations et des suggestions sur la manière de tester les bêta, on peut se référer à la page Beta Testing : <a href="https://www.postgresql.org/developer/beta">https://www.postgresql.org/developer/beta</a>.</p>

<p>La documentation complête et les notes de version sont disponibles en ligne, et installées avec PostgreSQL.</p>

<h2 id="liens">Liens</h2>

<ul>
<li>Page de téléchargement : <a href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a></li>
<li>Information sur les tests des bêta : <a href="https://www.postgresql.org/developer/beta">https://www.postgresql.org/developer/beta</a></li>
<li>Note de version de la 10 bêta : <a href="https://www.postgresql.org/docs/devel/static/release-10.html">https://www.postgresql.org/docs/devel/static/release-10.html</a></li>
<li>Quoi de neuf dans 10 : <a href="https://wiki.postgresql.org/wiki/New_in_postgres_10">https://wiki.postgresql.org/wiki/New_in_postgres_10</a></li>
<li>Les problèmes ouverts : <a href="https://wiki.postgresql.org/wiki/PostgreSQL_10_Open_Items">https://wiki.postgresql.org/wiki/PostgreSQL_10_Open_Items</a></li>
</ul></div>







<p class="date">
<a href="http://www.loxodata.com/post/postgresql-10-beta/">par contact@loxodata.com (Loxodata) le jeudi 18 mai 2017 à 15h26</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>samedi  6 mai 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:1eca32755b5efed852f42412c14a7942" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/05/06/Nouvelles-hebdomadaires-de-PostgreSQL-30-avril-2017">Nouvelles hebdomadaires de PostgreSQL - 30 avril 2017</a></h4>
<div class="entry">
<div class="content">
<p>Ubuntu Zesty (17.04) et Debian stretch (9) sont maintenant prises en charge par apt.postgresql.org&nbsp;: <a target="_blank" href="https://wiki.postgresql.org/wiki/Apt">https://wiki.postgresql.org/wiki/Apt</a></p>
<p>[ndt: MeetUp à Lyon le 28 juin&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pgpool-II 3.6.3, 3.5.7, 3.4.11, 3.3.15, 3.2.20 et pgpoolAdmin 3.6.1 ont &eacute;t&eacute; publi&eacute;s&nbsp;: <a target="_blank" href="http://pgpool.net/mediawiki/index.php/Downloads">http://pgpool.net/mediawiki/index.php/Downloads</a></li>
<li>pg_repack 1.4, une extension de nettoyage/compactage&nbsp;: <a target="_blank" href="http://reorg.github.io/pg_repack/1.4/">http://reorg.github.io/pg_repack/1.4/</a></li>
<li>PGroonga 1.2.0, une plate-forme de recherche plein texte pour toutes langues&nbsp;: <a target="_blank" href="http://groonga.org/en/blog/2017/04/29/pgroonga-1.2.0.html">http://groonga.org/en/blog/2017/04/29/pgroonga-1.2.0.html</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en avril</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-04/">http://archives.postgresql.org/pgsql-jobs/2017-04/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Le PGDay 2017 argentin sera tenu &agrave; Santa Fe le 9 juin 2017. L'appel &agrave; conf&eacute;renciers est lanc&eacute;&nbsp;: <a target="_blank" href="http://www.pgday.com.ar">http://www.pgday.com.ar</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
<li>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 30 mai&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></li>
<li>Le PGDay UK 2017 aura lieu &agrave; Londres le 4 juillet 2017&nbsp;: <a target="_blank" href="http://www.pgconf.uk">http://www.pgconf.uk</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170430221936.GA9169@fetter.org">http://www.postgresql.org/message-id/20170430221936.GA9169@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>Code review for commands/statscmds.c. Fix machine-dependent sorting of column numbers. (Odd behavior would only materialize for column numbers above 255, but that's certainly legal.) Fix poor choice of SQLSTATE for some errors, and improve error message wording. (Notably, "is not a scalar type" is a totally misleading way to explain "does not have a default btree opclass".) Avoid taking AccessExclusiveLock on the associated relation during DROP STATISTICS. That's neither necessary nor desirable, and it could easily have put us into situations where DROP fails (compare commit 68ea2b7f9). Adjust/improve comments. David Rowley and Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/CAKJS1f-GmCfPvBbAEaM5xoVOaYdVgVN1gicALSoYQ77z-+vLbw@mail.gmail.com">https://postgr.es/m/CAKJS1f-GmCfPvBbAEaM5xoVOaYdVgVN1gicALSoYQ77z-+vLbw@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/4b34624daadd9837cd65f20419f832b295c67ecb">https://git.postgresql.org/pg/commitdiff/4b34624daadd9837cd65f20419f832b295c67ecb</a></li>
<li>Fix postmaster's handling of fork failure for a bgworker process. This corner case didn't behave nicely at all: the postmaster would (partially) update its state as though the process had started successfully, and be quite confused thereafter. Fix it to act like the worker had crashed, instead. In passing, refactor so that do_start_bgworker contains all the state-change logic for bgworker launch, rather than just some of it. Back-patch as far as 9.4. 9.3 contains similar logic, but it's just enough different that I don't feel comfortable applying the patch without more study; and the use of bgworkers in 9.3 was so small that it doesn't seem worth the extra work. transam/parallel.c is still entirely unprepared for the possibility of bgworker startup failure, but that seems like material for a separate patch. Discussion: <a target="_blank" href="https://postgr.es/m/4905.1492813727@sss.pgh.pa.us">https://postgr.es/m/4905.1492813727@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/4fe04244b584749351657e99f3e6e1436e9b65a8">https://git.postgresql.org/pg/commitdiff/4fe04244b584749351657e99f3e6e1436e9b65a8</a></li>
<li>Run the postmaster's signal handlers without SA_RESTART. The postmaster keeps signals blocked everywhere except while waiting for something to happen in ServerLoop(). The code expects that the select(2) will be cancelled with EINTR if an interrupt occurs; without that, followup actions that should be performed by ServerLoop() itself will be delayed. However, some platforms interpret the SA_RESTART signal flag as meaning that they should restart rather than cancel the select(2). Worse yet, some of them restart it with the original timeout delay, meaning that a steady stream of signal interrupts can prevent ServerLoop() from iterating at all if there are no incoming connection requests. Observable symptoms of this, on an affected platform such as HPUX 10, include extremely slow parallel query startup (possibly as much as 30 seconds) and failure to update timestamps on the postmaster's sockets and lockfiles when no new connections arrive for a long time. We can fix this by running the postmaster's signal handlers without SA_RESTART. That would be quite a scary change if the range of code where signals are accepted weren't so tiny, but as it is, it seems safe enough. (Note that postmaster children do, and must, reset all the handlers before unblocking signals; so this change should not affect any child process.) There is talk of rewriting the postmaster to use a WaitEventSet and not do signal response work in signal handlers, at which point it might be appropriate to revert this patch. But that's not happening before v11 at the earliest. Back-patch to 9.6. The problem exists much further back, but the worst symptom arises only in connection with parallel query, so it does not seem worth taking any portability risks in older branches. Discussion: <a target="_blank" href="https://postgr.es/m/9205.1492833041@sss.pgh.pa.us">https://postgr.es/m/9205.1492833041@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/8939020853e63da6b4f5a63f023b02776a441b5d">https://git.postgresql.org/pg/commitdiff/8939020853e63da6b4f5a63f023b02776a441b5d</a></li>
<li>Use pselect(2) not select(2), if available, to wait in postmaster's loop. Traditionally we've unblocked signals, called select(2), and then blocked signals again. The code expects that the select() will be cancelled with EINTR if an interrupt occurs; but there's a race condition, which is that an already-pending signal will be delivered as soon as we unblock, and then when we reach select() there will be nothing preventing it from waiting. This can result in a long delay before we perform any action that ServerLoop was supposed to have taken in response to the signal. As with the somewhat-similar symptoms fixed by commit 893902085, the main practical problem is slow launching of parallel workers. The window for trouble is usually pretty short, corresponding to one iteration of ServerLoop; but it's not negligible. To fix, use pselect(2) in place of select(2) where available, as that's designed to solve exactly this problem. Where not available, we continue to use the old way, and are no worse off than before. pselect(2) has been required by POSIX since about 2001, so most modern platforms should have it. A bigger portability issue is that some implementations are said to be non-atomic, ie pselect() isn't really any different from unblock/select/reblock. Still, we're no worse off than before on such a platform. There is talk of rewriting the postmaster to use a WaitEventSet and not do signal response work in signal handlers, at which point this could be reverted, since we'd be using a self-pipe to solve the race condition. But that's not happening before v11 at the earliest. Back-patch to 9.6. The problem exists much further back, but the worst symptom arises only in connection with parallel query, so it does not seem worth taking any portability risks in older branches. Discussion: <a target="_blank" href="https://postgr.es/m/9205.1492833041@sss.pgh.pa.us">https://postgr.es/m/9205.1492833041@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/81069a9efc5a374dd39874a161f456f0fb3afba4">https://git.postgresql.org/pg/commitdiff/81069a9efc5a374dd39874a161f456f0fb3afba4</a></li>
<li>Revert "Use pselect(2) not select(2), if available, to wait in postmaster's loop.". This reverts commit 81069a9efc5a374dd39874a161f456f0fb3afba4. Buildfarm results suggest that some platforms have versions of pselect(2) that are not merely non-atomic, but flat out non-functional. Revert the use-pselect patch to confirm this diagnosis (and exclude the no-SA_RESTART patch as the source of trouble). If it's so, we should probably look into blacklisting specific platforms that have broken pselect. Discussion: <a target="_blank" href="https://postgr.es/m/9696.1493072081@sss.pgh.pa.us">https://postgr.es/m/9696.1493072081@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/64925603c972aa3a9f1d4c42686dba67f1a7e9d0">https://git.postgresql.org/pg/commitdiff/64925603c972aa3a9f1d4c42686dba67f1a7e9d0</a></li>
<li>Silence compiler warning induced by commit de4389712. Smarter compilers can see that "slot" can't be used uninitialized, but some popular ones cannot. Noted by Jeff Janes. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/49da00677dc25d83be44372918e21a405863ace2">https://git.postgresql.org/pg/commitdiff/49da00677dc25d83be44372918e21a405863ace2</a></li>
<li>Allow multiple bgworkers to be launched per postmaster iteration. Previously, maybe_start_bgworker() would launch at most one bgworker process per call, on the grounds that the postmaster might otherwise neglect its other duties for too long. However, that seems overly conservative, especially since bad effects only become obvious when many hundreds of bgworkers need to be launched at once. On the other side of the coin is that the existing logic could result in substantial delay of bgworker launches, because ServerLoop isn't guaranteed to iterate immediately after a signal arrives. (My attempt to fix that by using pselect(2) encountered too many portability question marks, and in any case could not help on platforms without pselect().) One could also question the wisdom of using an O(N^2) processing method if the system is intended to support so many bgworkers. As a compromise, allow that function to launch up to 100 bgworkers per call (and in consequence, rename it to maybe_start_bgworkers). This will allow any normal parallel-query request for workers to be satisfied immediately during sigusr1_handler, avoiding the question of whether ServerLoop will be able to launch more promptly. There is talk of rewriting the postmaster to use a WaitEventSet to avoid the signal-response-delay problem, but I'd argue that this change should be kept even after that happens (if it ever does). Backpatch to 9.6 where parallel query was added. The issue exists before that, but previous uses of bgworkers typically aren't as sensitive to how quickly they get launched. Discussion: <a target="_blank" href="https://postgr.es/m/4707.1493221358@sss.pgh.pa.us">https://postgr.es/m/4707.1493221358@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/aa1351f1eec4adae39be59ce9a21410f9dd42118">https://git.postgresql.org/pg/commitdiff/aa1351f1eec4adae39be59ce9a21410f9dd42118</a></li>
<li>Make latch.c more paranoid about child-process cases. Although the postmaster doesn't currently create a self-pipe or any latches, there's discussion of it doing so in future. It's also conceivable that a shared_preload_libraries extension would try to create such a thing in the postmaster process today. In that case the self-pipe FDs would be inherited by forked child processes. latch.c was entirely unprepared for such a case and could suffer an assertion failure, or worse try to use the inherited pipe if somebody called WaitLatch without having called InitializeLatchSupport in that process. Make it keep track of whether InitializeLatchSupport has been called in the *current* process, and do the right thing if state has been inherited from a parent. Apply FD_CLOEXEC to file descriptors created in latch.c (the self-pipe, as well as epoll event sets). This ensures that child processes spawned in backends, the archiver, etc cannot accidentally or intentionally mess with these FDs. It also ensures that we end up with the right state for the self-pipe in EXEC_BACKEND processes, which otherwise wouldn't know to close the postmaster's self-pipe FDs. Back-patch to 9.6, mainly to keep latch.c looking similar in all branches it exists in. Discussion: <a target="_blank" href="https://postgr.es/m/8322.1493240739@sss.pgh.pa.us">https://postgr.es/m/8322.1493240739@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/fa31b6f4e9696f3c9777bf4ec2faea822826ce9f">https://git.postgresql.org/pg/commitdiff/fa31b6f4e9696f3c9777bf4ec2faea822826ce9f</a></li>
<li>Cope with glibc too old to have epoll_create1(). Commit fa31b6f4e supposed that we didn't have to worry about that anymore, but it seems that RHEL5 is like that, and that's still a supported platform. Put back the prior coding under an #ifdef, adding an explicit fcntl() to retain the desired CLOEXEC property. Discussion: <a target="_blank" href="https://postgr.es/m/12307.1493325329@sss.pgh.pa.us">https://postgr.es/m/12307.1493325329@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/82ebbeb0abfe40fe5f19a6fcdffc7484fd3a35b0">https://git.postgresql.org/pg/commitdiff/82ebbeb0abfe40fe5f19a6fcdffc7484fd3a35b0</a></li>
<li>Avoid slow shutdown of pg_basebackup. pg_basebackup's child process did not pay any attention to the pipe from its parent while waiting for input from the source server. If no server data was arriving, it would only wake up and check the pipe every standby_message_timeout or so. This creates a problem since the parent process might determine and send the desired stop position only after the server has reached end-of-WAL and stopped sending data. In the src/test/recovery regression tests, the timing is repeatably such that it takes nearly 10 seconds for the child process to realize that it should shut down. It's not clear how often that would happen in real-world cases, but it sure seems like a bug --- and if the user turns off standby_message_timeout or sets it very large, the delay could be a lot worse. To fix, expand the StreamCtl API to allow the pipe input FD to be passed down to the low-level wait routine, and watch both sockets when sleeping. (Note: AFAICS this issue doesn't affect the Windows port, since it doesn't rely on a pipe to transfer the stop position to the child thread.) Discussion: <a target="_blank" href="https://postgr.es/m/6456.1493263884@sss.pgh.pa.us">https://postgr.es/m/6456.1493263884@sss.pgh.pa.us</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/7834d20b57a4320308c3f8262fabf898f89e6a71">https://git.postgresql.org/pg/commitdiff/7834d20b57a4320308c3f8262fabf898f89e6a71</a></li>
<li>Micro-optimize some slower queries in the opr_sanity regression test. Convert the binary_coercible() and physically_coercible() functions from SQL to plpgsql. It's not that plpgsql is inherently better at doing queries; if you simply convert the previous single SQL query into one RETURN expression, it's no faster. The problem with the existing code is that it fools the plancache into deciding that it's worth re-planning the query every time, since constant-folding with a concrete value for $2 allows elimination of at least one sub-SELECT. In reality that's using the planner to do the equivalent of a few runtime boolean tests, causing the function to run much slower than it should. Splitting the AND/OR logic into separate plpgsql statements allows each if-expression to acquire a static plan. Also, get rid of some uses of obj_description() in favor of explicitly joining to pg_description, allowing the joins to be optimized better. (Someday we might improve the SQL-function-inlining logic enough that this happens automatically, but today is not that day.) Together, these changes reduce the runtime of the opr_sanity regression test by about a factor of two on one of my slower machines. They don't seem to help as much on a fast machine, but this should at least benefit the buildfarm. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/c23844212d768b0423859437ca8189b89fd85250">https://git.postgresql.org/pg/commitdiff/c23844212d768b0423859437ca8189b89fd85250</a></li>
<li>Fix possible null pointer dereference or invalid warning message. Thinko in commit de4389712: this warning message references the wrong "LogicalRepWorker *" variable. This would often result in a core dump, but if it didn't, the message would show the wrong subscription OID. In passing, adjust the message text to format a subscription OID similarly to how that's done elsewhere in the function; and fix grammatical issues in some nearby messages. Per Coverity testing. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/12d11432b4db8a2ae665287e05f0f6868d35545e">https://git.postgresql.org/pg/commitdiff/12d11432b4db8a2ae665287e05f0f6868d35545e</a></li>
<li>Sync our copy of the timezone library with IANA release tzcode2017b. zic no longer mishandles some transitions in January 2038 when it attempts to work around Qt bug 53071. This fixes a bug affecting Pacific/Tongatapu that was introduced in zic 2016e. localtime.c now contains a workaround, useful when loading a file generated by a buggy zic. There are assorted cosmetic changes as well, notably relocation of a bunch of #defines. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e18b2c480da478f62781e06488cda56fe1b4e919">https://git.postgresql.org/pg/commitdiff/e18b2c480da478f62781e06488cda56fe1b4e919</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Get rid of extern declarations of non-existent functions. Those extern declartions were mistakenly added by commit 7c4f52409. Author: Petr Jelinek <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/cbc2270e3fcfae0831e4aa22f797f1dcac483d46">https://git.postgresql.org/pg/commitdiff/cbc2270e3fcfae0831e4aa22f797f1dcac483d46</a></li>
<li>Update copyright in recently added files. This commit also fixes copyright line missed by the automated script. Author: Masahiko Sawada <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/7cc14ae9d8a46a6fac002cb5d7ef385fc6ccdeb4">https://git.postgresql.org/pg/commitdiff/7cc14ae9d8a46a6fac002cb5d7ef385fc6ccdeb4</a></li>
<li>Set the priorities of all quorum synchronous standbys to 1. In quorum-based synchronous replication, all the standbys listed in synchronous_standby_names equally have chances to be chosen as synchronous standbys. So they should have the same priority. However, previously, quorum standbys whose names appear earlier in the list were given higher priority values though the difference of those priority values didn't affect the selection of synchronous standbys. Users could see those "meaningless" priority values in pg_stat_replication and this was confusing. This commit gives all the quorum synchronous standbys the same highest priority, i.e., 1, in order to remove such confusion. Author: Fujii Masao Reviewed-by: Masahiko Sawada, Kyotaro Horiguchi Discussion: <a target="_blank" href="http://postgr.es/m/CAHGQGwEKOw=SmPLxJzkBsH6wwDBgOnVz46QjHbtsiZ-d-2RGUg@mail.gmail.com">http://postgr.es/m/CAHGQGwEKOw=SmPLxJzkBsH6wwDBgOnVz46QjHbtsiZ-d-2RGUg@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/346199dcab4cfb2c023373fb3d859583b59810d7">https://git.postgresql.org/pg/commitdiff/346199dcab4cfb2c023373fb3d859583b59810d7</a></li>
<li>Fix typo in comment. Author: Masahiko Sawada <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/1f8b060121d654fbb08702752f63d251f5ce8088">https://git.postgresql.org/pg/commitdiff/1f8b060121d654fbb08702752f63d251f5ce8088</a></li>
<li>Fix bug so logical rep launcher saves correctly time of last startup of worker. Previously the logical replication launcher stored the last timestamp when it started the worker, in the local variable "last_start_time", in order to check whether wal_retrive_retry_interval elapsed since the last startup of worker. If it has elapsed, the launcher sees pg_subscription and starts new worker if necessary. This is for limitting the startup of worker to once a wal_retrieve_retry_interval. The bug was that the variable "last_start_time" was defined and always initialized with 0 at the beginning of the launcher's main loop. So even if it's set to the last timestamp in later phase of the loop, it's always reset to 0. Therefore the launcher could not check correctly whether wal_retrieve_retry_interval elapsed since the last startup. This patch moves the variable "last_start_time" outside the main loop so that it will not be reset. Reviewed-by: Petr Jelinek Discussion: <a target="_blank" href="http://postgr.es/m/CAHGQGwGJrPO++XM4mFENAwpy1eGXKsGdguYv43GUgLgU-x8nTQ@mail.gmail.com">http://postgr.es/m/CAHGQGwGJrPO++XM4mFENAwpy1eGXKsGdguYv43GUgLgU-x8nTQ@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/9f11fcec6624511ca85c1a6b049201be1fed6ef4">https://git.postgresql.org/pg/commitdiff/9f11fcec6624511ca85c1a6b049201be1fed6ef4</a></li>
</ul>
<p>Bruce Momjian pushed:</p>
<ul>
<li>doc: update release doc markup instructions. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/66fade8a0447093e6bd5a39ee6fec38790479664">https://git.postgresql.org/pg/commitdiff/66fade8a0447093e6bd5a39ee6fec38790479664</a></li>
<li>doc: first draft of Postgres 10 release notes. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/1d8573ed5569c014b9fd32e42248e58c7c28386d">https://git.postgresql.org/pg/commitdiff/1d8573ed5569c014b9fd32e42248e58c7c28386d</a></li>
<li>doc: fix attribution of sequence item, order incompatibilities. Reported-by: Andreas Karlsson <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a0d932b39da7d7445dfc8da1e9979dd5cf4ea0a1">https://git.postgresql.org/pg/commitdiff/a0d932b39da7d7445dfc8da1e9979dd5cf4ea0a1</a></li>
<li>doc: several minor PG 10 doc adjustments. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/bba375eb9df037c73af3743521f2b44e6fdf8c3b">https://git.postgresql.org/pg/commitdiff/bba375eb9df037c73af3743521f2b44e6fdf8c3b</a></li>
<li>doc: PG 10 fixes. Reported-by: Takayuki Tsunakawa <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/6e033c6a9639078501ac1830676ae062ee8a4aca">https://git.postgresql.org/pg/commitdiff/6e033c6a9639078501ac1830676ae062ee8a4aca</a></li>
<li>doc: merge PG 10 release SysV item. Reported-by: Takayuki Tsunakawa <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/419a055454dd234b78925e605582caf0def51ecb">https://git.postgresql.org/pg/commitdiff/419a055454dd234b78925e605582caf0def51ecb</a></li>
<li>doc: fix PG 10 release note doc markup. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/d103e6718bfe4a1f50eb25b94db2cf9f84c69766">https://git.postgresql.org/pg/commitdiff/d103e6718bfe4a1f50eb25b94db2cf9f84c69766</a></li>
<li>doc: add Rafia Sabih to PG 10 release note item. Reported-by: Amit Kapila <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/b007b1af20c3b276d5804b11dc3e471c8045480b">https://git.postgresql.org/pg/commitdiff/b007b1af20c3b276d5804b11dc3e471c8045480b</a></li>
<li>doc: move hash performance item into index section. The requirement to rebuild pg_upgrade-ed hash indexes was kept in the incompatibilities section. Reported-by: Amit Kapila <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/cef5dbbf2b8d8a5e7b536bcbf6d9066588c6173b">https://git.postgresql.org/pg/commitdiff/cef5dbbf2b8d8a5e7b536bcbf6d9066588c6173b</a></li>
<li>doc: move hash info to new section and split out growth item. Reported-by: Amit Kapila <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/45e3d8ae2b1d16f6e6453089424e9c3346fa35f8">https://git.postgresql.org/pg/commitdiff/45e3d8ae2b1d16f6e6453089424e9c3346fa35f8</a></li>
<li>doc: PG 10 release note updates. Reported-by: David Rowley, Amit Langote, Ashutosh Bapat <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/64f0f7cfc75d92910cadb07dbcce3844eec79c36">https://git.postgresql.org/pg/commitdiff/64f0f7cfc75d92910cadb07dbcce3844eec79c36</a></li>
<li>doc: PG 10 release notes updates. Reported-by: Michael Paquier, Felix Gerzaguet <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/cdd5bcad5ea6a2409e38e5c6e11e9901dae2d946">https://git.postgresql.org/pg/commitdiff/cdd5bcad5ea6a2409e38e5c6e11e9901dae2d946</a></li>
<li>doc: properly indent SGML tags in PG 10 release notes. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/bf368fbee2a9ff1139b9331f025986ba68b8922a">https://git.postgresql.org/pg/commitdiff/bf368fbee2a9ff1139b9331f025986ba68b8922a</a></li>
<li>doc PG10: add commit 090010f2e and adjust EXPLAIN SUMMARY item. Reported-by: Tels, Andres Freund <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/3640cf5e1c8a0ae6ac55bf6384de0521dc77facf">https://git.postgresql.org/pg/commitdiff/3640cf5e1c8a0ae6ac55bf6384de0521dc77facf</a></li>
<li>doc: add PG 10 doc item about VACUUM truncation, 7e26e02ee. Reported-by: Andres Freund <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/3d7741194a4688adea8404ab0a7bb57bac20232b">https://git.postgresql.org/pg/commitdiff/3d7741194a4688adea8404ab0a7bb57bac20232b</a></li>
<li>doc: update PG 10 item about referencing many relations. Reported-by: Tom Lane <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/ef0ba572b6e163328a2292bf9d6de7c919bd7cdd">https://git.postgresql.org/pg/commitdiff/ef0ba572b6e163328a2292bf9d6de7c919bd7cdd</a></li>
<li>doc PG10: update EXPLAIN SUMMARY item. Reported-by: Tels <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/5f2b48d1dd17156c2021f9fa7c85d5c550bc2c6a">https://git.postgresql.org/pg/commitdiff/5f2b48d1dd17156c2021f9fa7c85d5c550bc2c6a</a></li>
<li>doc PG10: add Rafia Sabih to parallel index scan item. Reported-by: Amit Kapila <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/309191f66a947c5b63dd348a13aafa52b5847f94">https://git.postgresql.org/pg/commitdiff/309191f66a947c5b63dd348a13aafa52b5847f94</a></li>
<li>doc PG10: add commit for transition table item. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/fda4fec578505a624e4c0f0244816ae5bc10a3d1">https://git.postgresql.org/pg/commitdiff/fda4fec578505a624e4c0f0244816ae5bc10a3d1</a></li>
<li>doc PG10rel: adjust hash index commits and add parallel subquery. Reported-by: Amit Kapila <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/f8ab08ad0e411139060bf943fa9931f7fbe97cde">https://git.postgresql.org/pg/commitdiff/f8ab08ad0e411139060bf943fa9931f7fbe97cde</a></li>
<li>doc: PG10 release note typo fix. Reported-by: daniel.westermann <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a311d2a04f849f76d33b59995097999a311a4c62">https://git.postgresql.org/pg/commitdiff/a311d2a04f849f76d33b59995097999a311a4c62</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>postgres_fdw: Fix join push down with extensions. Objects in an extension are shippable to a foreign server if the extension is part of the foreign server definition's shippable extensions list. But this was not properly considered in some cases when checking whether a join condition can be pushed to a foreign server and the join condition uses an object from a shippable extension. So the join would never be pushed down in those cases. So, the list of extensions needs to be made available in fpinfo of the relation being considered to be pushed down before any expressions are assessed for being shippable. Fix foreign_join_ok() to do that for a join relation. The code to save FDW options in fpinfo is scattered at multiple places. Bring all of that together into functions apply_server_options(), apply_table_options(), and merge_fdw_options(). David Rowley and Ashutosh Bapat, per report from David Rowley <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/332bec1e6096679b04ec9717beb44a858495260f">https://git.postgresql.org/pg/commitdiff/332bec1e6096679b04ec9717beb44a858495260f</a></li>
<li>Wake up launcher when enabling a subscription. Otherwise one would have to wait up to DEFAULT_NAPTIME_PER_CYCLE until the subscription worker is considered for starting. There is a small race condition: If one enables a subscription right after disabling it, the launcher might not have registered the stopping when receiving the wakeup signal for the re-enabling. The start will then not happen right away but after the full cycle time. Author: Kyotaro HORIGUCHI &lt;horiguchi.kyotaro@lab.ntt.co.jp&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/a3f17b9c315512e9c116dbc243056aad8b372e18">https://git.postgresql.org/pg/commitdiff/a3f17b9c315512e9c116dbc243056aad8b372e18</a></li>
<li>Fix various concurrency issues in logical replication worker launching. The code was originally written with assumption that launcher is the only process starting the worker. However that hasn't been true since commit 7c4f52409 which failed to modify the worker management code adequately. This patch adds an in_use field to the LogicalRepWorker struct to indicate whether the worker slot is being used and uses proper locking everywhere this flag is set or read. However if the parent process dies while the new worker is starting and the new worker fails to attach to shared memory, this flag would never get cleared. We solve this rare corner case by adding a sort of garbage collector for in_use slots. This uses another field in the LogicalRepWorker struct named launch_time that contains the time when the worker was started. If any request to start a new worker does not find free slot, we'll check for workers that were supposed to start but took too long to actually do so, and reuse their slot. In passing also fix possible race conditions when stopping a worker that hasn't finished starting yet. Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; Reported-by: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/de4389712206d2686e09ad8d6dd112dc4b6c6d42">https://git.postgresql.org/pg/commitdiff/de4389712206d2686e09ad8d6dd112dc4b6c6d42</a></li>
<li>doc: ALTER SUBSCRIPTION documentation fixes. WITH is optional for REFRESH PUBLICATION. Also, remove a spurious bracket and fix a punctuation. Author: Euler Taveira &lt;euler@timbira.com.br&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e315346d839ef27f9d5f2584f44de09f08573df2">https://git.postgresql.org/pg/commitdiff/e315346d839ef27f9d5f2584f44de09f08573df2</a></li>
<li>Fix query that gets remote relation info. Publisher relation can be incorrectly chosen, if there are more than one relation in different schemas with the same name. Author: Euler Taveira &lt;euler@timbira.com.br&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/61ecc90be624e699164a8d3efb291e267b711142">https://git.postgresql.org/pg/commitdiff/61ecc90be624e699164a8d3efb291e267b711142</a></li>
<li>Spelling fixes in code comments. Author: Euler Taveira &lt;euler@timbira.com.br&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e495c1683f2c243f6769b34a009cf9c28526b555">https://git.postgresql.org/pg/commitdiff/e495c1683f2c243f6769b34a009cf9c28526b555</a></li>
<li>Fix typo in comment. Author: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/6c9bd27aece5efd0ccef668828a44f59bd2c7a44">https://git.postgresql.org/pg/commitdiff/6c9bd27aece5efd0ccef668828a44f59bd2c7a44</a></li>
<li>Wait between tablesync worker restarts. Before restarting a tablesync worker for the same relation, wait wal_retrieve_retry_interval (currently 5s by default). This avoids restarting failing workers in a tight loop. We keep the last start times in a hash table last_start_times that is separate from the table_states list, because that list is cleared out on syscache invalidation, which happens whenever a table finishes syncing. The hash table is kept until all tables have finished syncing. A future project might be to unify these two and keep everything in one data structure, but for now this is a less invasive change to accomplish the original purpose. For the test suite, set wal_retrieve_retry_interval to its minimum value, to not increase the test suite run time. Reviewed-by: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; Reported-by: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e3cf708016ca6045dc1cd5a0768cfecf17caf3d1">https://git.postgresql.org/pg/commitdiff/e3cf708016ca6045dc1cd5a0768cfecf17caf3d1</a></li>
<li>psql: Support identity columns in sequence display. Where the footer for an owned serial sequence would say "Owned by", put something analogous for a sequence belonging to an identity column. Reported-by: Vitaly Burovoy &lt;vitaly.burovoy@gmail.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/e4fddfd49241dc8dfda354993bad8d5518df1873">https://git.postgresql.org/pg/commitdiff/e4fddfd49241dc8dfda354993bad8d5518df1873</a></li>
<li>doc: Fix typo in 9.6 release notes. Author: Huong Dangminh &lt;huo-dangminh@ys.jp.nec.com&gt; <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/bc920bee296ec4c1e8cd1598c71f21d80a59d351">https://git.postgresql.org/pg/commitdiff/bc920bee296ec4c1e8cd1598c71f21d80a59d351</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Adjust outdated comment. Commit 5dfc198146b49ce7ecc8a1fc9d5e171fb75f6ba5 removed the only existing caller of hash_freeze, but left behind a comment indicating that hash_freeze was still used. Adjust. Kyotaro Horiguchi Discussion: <a target="_blank" href="http://postgr.es/m/20170424.165541.230634914.horiguchi.kyotaro@lab.ntt.co.jp">http://postgr.es/m/20170424.165541.230634914.horiguchi.kyotaro@lab.ntt.co.jp</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/914ae8d3cbbe480f8002a38deef4a5319970d2f4">https://git.postgresql.org/pg/commitdiff/914ae8d3cbbe480f8002a38deef4a5319970d2f4</a></li>
<li>In load_relcache_init_file, initialize rd_pdcxt. Oversight noted by Gao Zeng Qi. Discussion: <a target="_blank" href="http://postgr.es/m/CAFmBtr1N3-SbepJbnGpaYp=jw-FvWMnYY7-bTtRgvjvbyB8YJA@mail.gmail.com">http://postgr.es/m/CAFmBtr1N3-SbepJbnGpaYp=jw-FvWMnYY7-bTtRgvjvbyB8YJA@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/5e1ccd48442dbdbe812c95cd70cc1d3c1c960c4c">https://git.postgresql.org/pg/commitdiff/5e1ccd48442dbdbe812c95cd70cc1d3c1c960c4c</a></li>
<li>Speed up dropping tables with many partitions. We need to lock the parent, but we don't need a relcache entry for it. Gao Zeng Qi, reviewed by Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/CAFmBtr0ukqJjRJEhPWL5wt4rNMrJUUxggVAGXPR3SyYh3E+HDQ@mail.gmail.com">http://postgr.es/m/CAFmBtr0ukqJjRJEhPWL5wt4rNMrJUUxggVAGXPR3SyYh3E+HDQ@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/c1e0e7e1d790bf18c913e6a452dea811e858b554">https://git.postgresql.org/pg/commitdiff/c1e0e7e1d790bf18c913e6a452dea811e858b554</a></li>
<li>Fix crash when partitioned column specified twice. Amit Langote, reviewed by Beena Emerson Discussion: <a target="_blank" href="http://postgr.es/m/6ed23d3d-c09d-4cbc-3628-0a8a32f750f4@lab.ntt.co.jp">http://postgr.es/m/6ed23d3d-c09d-4cbc-3628-0a8a32f750f4@lab.ntt.co.jp</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/504c2205abc7de67386f9c95630f38ee15626f07">https://git.postgresql.org/pg/commitdiff/504c2205abc7de67386f9c95630f38ee15626f07</a></li>
<li>Fix VALIDATE CONSTRAINT to consider NO INHERIT attribute. Currently, trying to validate a NO INHERIT constraint on the parent will search for the constraint in child tables (where it is not supposed to exist), wrongly causing a "constraint does not exist" error. Amit Langote, per a report from Hans Buschmann. Discussion: <a target="_blank" href="http://postgr.es/m/20170421184012.24362.19@wrigleys.postgresql.org">http://postgr.es/m/20170421184012.24362.19@wrigleys.postgresql.org</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/6a4dda44e02bfd5148c13b00d8f81045a2e17f2c">https://git.postgresql.org/pg/commitdiff/6a4dda44e02bfd5148c13b00d8f81045a2e17f2c</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Allow ALTER TABLE ONLY on partitioned tables. There is no need to forbid ALTER TABLE ONLY on partitioned tables, when no partitions exist yet. This can be handy for users who are building up their partitioned table independently and will create actual partitions later. In addition, this is how pg_dump likes to operate in certain instances. Author: Amit Langote, with some error message word-smithing by me <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/9139aa19423b736470f669e566f8ef6a7f19b801">https://git.postgresql.org/pg/commitdiff/9139aa19423b736470f669e566f8ef6a7f19b801</a></li>
<li>pg_get_partkeydef: return NULL for non-partitions. Our general rule for pg_get_X(oid) functions is to simply return NULL when passed an invalid or inappropriate OID. Teach pg_get_partkeydef to do this also, making it easier for users to use this function when querying against tables with both partitions and non-partitions (such as pg_class). As a concrete example, this makes pg_dump's life a little easier. Author: Amit Langote <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/0c76c2463e8ab4cfd633ad8de259050e3f28b78f">https://git.postgresql.org/pg/commitdiff/0c76c2463e8ab4cfd633ad8de259050e3f28b78f</a></li>
<li>Remove unnecessairly duplicated gram.y productions. Declarative partitioning duplicated the TypedTableElement productions, evidently to remove the need to specify WITH OPTIONS when creating partitions. Instead, simply make WITH OPTIONS optional in the TypedTableElement production and remove all of the duplicate PartitionElement-related productions. This change simplifies the syntax and makes WITH OPTIONS optional when adding defaults, constraints or storage parameters to columns when creating either typed tables or partitions. Also update pg_dump to no longer include WITH OPTIONS, since it's not necessary, and update the documentation to reflect that WITH OPTIONS is now optional. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/b9a3ef55b253d885081c2d0e9dc45802cab71c7b">https://git.postgresql.org/pg/commitdiff/b9a3ef55b253d885081c2d0e9dc45802cab71c7b</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Additional tests for subtransactions in recovery. Tests for normal and prepared transactions Author: Nikhil Sontakke, placed in new test file by me <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/0352c15e5ab4f70c3ab2ac1d48d9f38a5dd11786">https://git.postgresql.org/pg/commitdiff/0352c15e5ab4f70c3ab2ac1d48d9f38a5dd11786</a></li>
<li>Rework handling of subtransactions in 2PC recovery. The bug fixed by 0874d4f3e183757ba15a4b3f3bf563e0393dd9c2 caused us to question and rework the handling of subtransactions in 2PC during and at end of recovery. Patch adds checks and tests to ensure no further bugs. This effectively removes the temporary measure put in place by 546c13e11b29a5408b9d6a6e3cca301380b47f7f. Author: Simon Riggs Reviewed-by: Tom Lane, Michael Paquier Discussion: <a target="_blank" href="http://postgr.es/m/CANP8+j+vvXmruL_i2buvdhMeVv5TQu0Hm2+C5N+kdVwHJuor8w@mail.gmail.com">http://postgr.es/m/CANP8+j+vvXmruL_i2buvdhMeVv5TQu0Hm2+C5N+kdVwHJuor8w@mail.gmail.com</a> <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/49e928154978da2a5976628588fc545b726ad84a">https://git.postgresql.org/pg/commitdiff/49e928154978da2a5976628588fc545b726ad84a</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Preserve required !catalog tuples while computing initial decoding snapshot. The logical decoding machinery already preserved all the required catalog tuples, which is sufficient in the course of normal logical decoding, but did not guarantee that non-catalog tuples were preserved during computation of the initial snapshot when creating a slot over the replication protocol. This could cause a corrupted initial snapshot being exported. The time window for issues is usually not terribly large, but on a busy server it's perfectly possible to it hit it. Ongoing decoding is not affected by this bug. To avoid increased overhead for the SQL API, only retain additional tuples when a logical slot is being created over the replication protocol. To do so this commit changes the signature of CreateInitDecodingContext(), but it seems unlikely that it's being used in an extension, so that's probably ok. In a drive-by fix, fix handling of ReplicationSlotsComputeRequiredXmin's already_locked argument, which should only apply to ProcArrayLock, not ReplicationSlotControlLock. Reported-By: Erik Rijkers Analyzed-By: Petr Jelinek Author: Petr Jelinek, heavily editorialized by Andres Freund Reviewed-By: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/9a897b86-46e1-9915-ee4c-da02e4ff6a95@2ndquadrant.com">https://postgr.es/m/9a897b86-46e1-9915-ee4c-da02e4ff6a95@2ndquadrant.com</a> Backport: 9.4, where logical decoding was introduced. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/2bef06d51646058c6bb480fcdbffb1f0cc914fed">https://git.postgresql.org/pg/commitdiff/2bef06d51646058c6bb480fcdbffb1f0cc914fed</a></li>
<li>Don't use on-disk snapshots for exported logical decoding snapshot. Logical decoding stores historical snapshots on disk, so that logical decoding can restart without having to reconstruct a snapshot from scratch (for which the resources are not guaranteed to be present anymore). These serialized snapshots were also used when creating a new slot via the walsender interface, which can export a "full" snapshot (i.e. one that can read all tables, not just catalog ones). The problem is that the serialized snapshots are only useful for catalogs and not for normal user tables. Thus the use of such a serialized snapshot could result in an inconsistent snapshot being exported, which could lead to queries returning wrong data. This would only happen if logical slots are created while another logical slot already exists. Author: Petr Jelinek Reviewed-By: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/f37e975c-908f-858e-707f-058d3b1eb214@2ndquadrant.com">https://postgr.es/m/f37e975c-908f-858e-707f-058d3b1eb214@2ndquadrant.com</a> Backport: 9.4, where logical decoding was introduced. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/56e19d938dd1457ae078304df1b9903509a0a2bf">https://git.postgresql.org/pg/commitdiff/56e19d938dd1457ae078304df1b9903509a0a2bf</a></li>
<li>Don't build full initial logical decoding snapshot if NOEXPORT_SNAPSHOT. Earlier commits (56e19d938dd14 and 2bef06d5164) make it cheaper to create a logical slot if not exporting the initial snapshot. If NOEXPORT_SNAPSHOT is specified, we can skip the overhead, not just when creating a slot via sql (which can't export snapshots). As NOEXPORT_SNAPSHOT has only recently been introduced, this shouldn't be backpatched. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/ab9c43381ef7a7333086107847413e0b593854d0">https://git.postgresql.org/pg/commitdiff/ab9c43381ef7a7333086107847413e0b593854d0</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Misc SCRAM code cleanups. * Move computation of SaltedPassword to a separate function from scram_ClientOrServerKey(). This saves a lot of cycles in libpq, by computing SaltedPassword only once per authentication. (Computing SaltedPassword is expensive by design.) * Split scram_ClientOrServerKey() into two functions. Improves readability, by making the calling code less verbose. * Rename "server proof" to "server signature", to better match the nomenclature used in RFC 5802. * Rename SCRAM_SALT_LEN to SCRAM_DEFAULT_SALT_LEN, to make it more clear that the salt can be of any length, and the constant only specifies how long a salt we use when we generate a new verifier. Also rename SCRAM_ITERATIONS_DEFAULT to SCRAM_DEFAULT_ITERATIONS, for consistency. These things caught my eye while working on other upcoming changes. <a target="_blank" href="https://git.postgresql.org/pg/commitdiff/d981074c24d2f1e4f44bc6d80e967e523ce64f50">https://git.postgresql.org/pg/commitdiff/d981074c24d2f1e4f44bc6d80e967e523ce64f50</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Andrew Dunstan sent in a patch to fix TAP tests on the MSYS build system.</p>
<p>Jan Mich&#65533;lek sent in another revision of a patch to add mediawiki and rst formats for tables in psql.</p>
<p>Haribabu Kommi sent in a patch to add build support for Visual Studio 2017.</p>
<p>Andrew Dunstan sent in two revisions of a patch to add vcregress support for single TAP test.</p>
<p>Micha&#65533;l Paquier sent in two revisions of a patch to fix an issue with logical replication and PANIC during shutdown checkpoint in publisher.</p>
<p>Surafel Temesgen sent in a patch to add DELETE and UPDATE with LIMIT and ORDER BY.</p>
<p>Daniel Gustafsson sent in two more revisions of a patch to help debug TAP test failures.</p>
<p>Andres Freund sent in a POC patch to unify the SQL and replication grammars.</p>
<p>Fabien COELHO sent in two more revisions of a patch to fix pgbench TAP tests.</p>
<p>Rahila Syed sent in another revision of a patch to enable creating a default partition for declaratively partitioned tables.</p>
<p>Ashutosh Bapat sent in another revision of a patch to speed up partition-wise JOIN between declaratively partitioned tables.</p>
<p>Thomas Munro sent in a patch to allow creating transition tables for triggers on foreign tables and views.</p>
<p>Thomas Munro sent in another revision of a patch to implement [[parallel] shared] hash.</p>
<p>Amit Langote sent in a patch to fix VALIDATE CONSTRAINT to consider NO INHERIT attribute.</p>
<p>Tom Lane sent in a patch to fix the inefficient shutdown of pg_basebackup.</p>
<p>Alexander Korotkov sent in another revision of a patch to implement incremental sort.</p>
<p>Antonin Houska sent in two revisions of a patch to enable partition-wise aggregation/grouping.</p>
<p>Konstantin Knizhnik sent in two more revisions of a patch to auto-prepare queries similar to previous queries.</p>
<p>Amit Langote sent in two revisions of a patch to fire per-statement triggers of partitioned tables.</p>
<p>Dagfinn Ilmari Manns&#65533;ker sent in a patch to fix some release note links.</p>
<p>Kyotaro HORIGUCHI sent in a patch to fix a bug where PQhost may return socket dir for network connection.</p>
<p>Antonin Houska sent in another revision of a patch to do aggregate push-down.</p>
<p>Tom Lane sent in two revisions of a patch to fix a bug in conversion from EXISTS to an inner join.</p>
<p>Kyotaro HORIGUCHI sent in a patch to fix a behavior change in .pgpass.</p>
<p>Petr Jel&#65533;nek sent in another revision of a patch to add support for time based lag tracking to logical replication.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/05/06/Nouvelles-hebdomadaires-de-PostgreSQL-30-avril-2017">par chl le samedi  6 mai 2017 à 19h06</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>lundi 17 avril 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:b5631284e82951e51c4898e8cb473f47" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/04/17/Nouvelles-hebdomadaires-de-PostgreSQL-16-avril-2017">Nouvelles hebdomadaires de PostgreSQL - 16 avril 2017</a></h4>
<div class="entry">
<div class="content">
<p>Le PGDay 2017 argentin sera tenu &agrave; Santa Fe le 9 juin 2017. L'appel &agrave; conf&eacute;renciers est lanc&eacute;&nbsp;: <a target="_blank" href="http://www.pgday.com.ar">http://www.pgday.com.ar</a></p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pg_partman v3.0.1, un syst&egrave;me de gestion pour le partitionnement des tables&nbsp;: <a target="_blank" href="https://github.com/keithf4/pg_partman">https://github.com/keithf4/pg_partman</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en avril</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-04/">http://archives.postgresql.org/pgsql-jobs/2017-04/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup à Lyon le mercredi 26 avril : <a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
<li>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 30 mai&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></li>
<li>Le PGDay UK 2017 aura lieu &agrave; Londres le 4 juillet 2017. L'appel &agrave; conf&eacute;renciers s'&eacute;teint le 20 avril&nbsp;: <a target="_blank" href="http://www.pgconf.uk">http://www.pgconf.uk</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170416230354.GA24896@fetter.org">http://www.postgresql.org/message-id/20170416230354.GA24896@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Joe Conway pushed:</p>
<ul>
<li>Add partitioned table support to sepgsql. The new partitioned table capability added a new relkind, namely RELKIND_PARTITIONED_TABLE. Update sepgsql to treat this new relkind exactly the same way it does RELKIND_RELATION. In addition, add regression test coverage for partitioned tables. Issue raised by Stephen Frost and initial patch by Mike Palmiotto. Review by Tom Lane and Robert Haas, and editorializing by me. Discussion: <a target="_blank" href="https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com">https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/25542d77dd549940468d1a932809feb9959d717d">http://git.postgresql.org/pg/commitdiff/25542d77dd549940468d1a932809feb9959d717d</a></li>
<li>Make sepgsql regression tests robust vs. collation differences. In commit 25542d77, regression test coverage was added to sepgsql for partitioned tables. Unfortunately it was not robust in the face of collation differences, per the buildfarm. Force "C" collation in order to fix that. Discussion: <a target="_blank" href="https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com">https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/86fa9b2d1b74cf7e3402c7653f7515b075eacc7b">http://git.postgresql.org/pg/commitdiff/86fa9b2d1b74cf7e3402c7653f7515b075eacc7b</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Document the "replication" option in StartupMessage. It is documented in the Streaming Replication Protocol section, but was missing from the list of options in StartupMessage description. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6c4ad8b7bf420a6f598e4b45560cffc40ded0875">http://git.postgresql.org/pg/commitdiff/6c4ad8b7bf420a6f598e4b45560cffc40ded0875</a></li>
<li>Fix indentation. Oops, I forgot to "git add" this to previous commit. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9cf5c31964315181e475fc37a5e9ad2204fe3484">http://git.postgresql.org/pg/commitdiff/9cf5c31964315181e475fc37a5e9ad2204fe3484</a></li>
<li>Minor cleanup of backend SCRAM code. Free each SASL message after sending it. It's not a lot of wasted memory, and it's short-lived, but the authentication code in general tries to pfree() stuff, so let's follow the example. Adding the pfree() revealed a little bug in build_server_first_message(). It attempts to keeps a copy of the sent message, but it was missing a pstrdup(), so the pointer started to dangle, after adding the pfree() into CheckSCRAMAuth(). Reword comments and debug messages slightly, while we're at it. Reviewed by Michael Paquier. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/6490b975-5ee1-6280-ac1d-af975b19fb9a@iki.fi">https://www.postgresql.org/message-id/6490b975-5ee1-6280-ac1d-af975b19fb9a@iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/00707fa58275e370dc445fa7e1130085aa04f37b">http://git.postgresql.org/pg/commitdiff/00707fa58275e370dc445fa7e1130085aa04f37b</a></li>
<li>Improve the SASL authentication protocol. This contains some protocol changes to SASL authentiation (which is new in v10): * For future-proofing, in the AuthenticationSASL message that begins SASL authentication, provide a list of SASL mechanisms that the server supports, for the client to choose from. Currently, it's always just SCRAM-SHA-256. * Add a separate authentication message type for the final server-&gt;client SASL message, which the client doesn't need to respond to. This makes it unambiguous whether the client is supposed to send a response or not. The SASL mechanism should know that anyway, but better to be explicit. Also, in the server, support clients that don't send an Initial Client response in the first SASLInitialResponse message. The server is supposed to first send an empty request in that case, to which the client will respond with the data that usually comes in the Initial Client Response. libpq uses the Initial Client Response field and doesn't need this, and I would assume any other sensible implementation to use Initial Client Response, too, but let's follow the SASL spec. Improve the documentation on SASL authentication in protocol. Add a section describing the SASL message flow, and some details on our SCRAM-SHA-256 implementation. Document the different kinds of PasswordMessages that the frontend sends in different phases of SASL authentication, as well as GSS/SSPI authentication as separate message formats. Even though they're all 'p' messages, and the exact format depends on the context, describing them as separate message formats makes the documentation more clear. Reviewed by Michael Paquier and &Aacute;lvaro Hern&aacute;ndez Tortosa. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqS-aFg0iM3AQOJwKDv_0WkAedRjs1W2X8EixSz+sKBXCQ@mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqS-aFg0iM3AQOJwKDv_0WkAedRjs1W2X8EixSz+sKBXCQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4f3b87ab780b95c2cc8a591259baefaff4852037">http://git.postgresql.org/pg/commitdiff/4f3b87ab780b95c2cc8a591259baefaff4852037</a></li>
<li>Refactor libpq authentication request processing. Move the responsibility of reading the data from the authentication request message from PQconnectPoll() to pg_fe_sendauth(). This way, PQconnectPoll() doesn't need to know about all the different authentication request types, and we don't need the extra fields in the pg_conn struct to pass the data from PQconnectPoll() to pg_fe_sendauth() anymore. Reviewed by Michael Paquier. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/6490b975-5ee1-6280-ac1d-af975b19fb9a%40iki.fi">https://www.postgresql.org/message-id/6490b975-5ee1-6280-ac1d-af975b19fb9a%40iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/61bf96cab06390fec66405d3caad789f4417f25a">http://git.postgresql.org/pg/commitdiff/61bf96cab06390fec66405d3caad789f4417f25a</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Move isolationtester's is-blocked query into C code for speed. Commit 4deb41381 modified isolationtester's query to see whether a session is blocked to also check for waits occurring in GetSafeSnapshot. However, it did that in a way that enormously increased the query's runtime under CLOBBER_CACHE_ALWAYS, causing the buildfarm members that use that to run about four times slower than before, and in some cases fail entirely. To fix, push the entire logic into a dedicated backend function. This should actually reduce the CLOBBER_CACHE_ALWAYS runtime from what it was previously, though I've not checked that. In passing, expose a SQL function to check for safe-snapshot blockage, comparable to pg_blocking_pids. This is more or less free given the infrastructure built to solve the other problem, so we might as well. Thomas Munro Discussion: <a target="_blank" href="https://postgr.es/m/20170407165749.pstcakbc637opkax@alap3.anarazel.de">https://postgr.es/m/20170407165749.pstcakbc637opkax@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/511540dadf1166d80b864f63979178f324844060">http://git.postgresql.org/pg/commitdiff/511540dadf1166d80b864f63979178f324844060</a></li>
<li>Improve castNode notation by introducing list-extraction-specific variants. This extends the castNode() notation introduced by commit 5bcab1114 to provide, in one step, extraction of a list cell's pointer and coercion to a concrete node type. For example, "lfirst_node(Foo, lc)" is the same as "castNode(Foo, lfirst(lc))". Almost half of the uses of castNode that have appeared so far include a list extraction call, so this is pretty widely useful, and it saves a few more keystrokes compared to the old way. As with the previous patch, back-patch the addition of these macros to pg_list.h, so that the notation will be available when back-patching. Patch by me, after an idea of Andrew Gierth's. Discussion: <a target="_blank" href="https://postgr.es/m/14197.1491841216@sss.pgh.pa.us">https://postgr.es/m/14197.1491841216@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8f0530f58061b185dc385df42e62d78a18d4ae3e">http://git.postgresql.org/pg/commitdiff/8f0530f58061b185dc385df42e62d78a18d4ae3e</a></li>
<li>Fix pgbench's --progress-timestamp option to print Unix-epoch timestamps. As a consequence of commit 1d63f7d2d, on platforms with CLOCK_MONOTONIC, you got some random timescale or other instead of standard Unix timestamps as expected. I'd attempted to fix pgbench for that change in commits 74baa1e3b and 67a875355, but missed this place. Fix in the same way as those previous commits, ie, just eat the cost of an extra gettimeofday(); one extra syscall per progress report isn't worth sweating over. Per report from Jeff Janes. In passing, use snprintf not sprintf for this purpose. I don't think there's any chance of actual buffer overrun, but it just looks safer. Discussion: <a target="_blank" href="https://postgr.es/m/CAMkU=1zrQaPwBN+NcBd3pWCb=vWaiL=mmWfJjDJjh-a7eVr-Og@mail.gmail.com">https://postgr.es/m/CAMkU=1zrQaPwBN+NcBd3pWCb=vWaiL=mmWfJjDJjh-a7eVr-Og@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/feffa0e0795a5a99324890a6dd548ba162ec104c">http://git.postgresql.org/pg/commitdiff/feffa0e0795a5a99324890a6dd548ba162ec104c</a></li>
<li>Handle restriction clause lists more uniformly in postgres_fdw. Clauses in the lists retained by postgres_fdw during planning were sometimes bare boolean clauses, sometimes RestrictInfos, and sometimes a mixture of the two in the same list. The comment about that situation didn't come close to telling the full truth, either. Aside from being confusing, this had a couple of bad practical consequences: * waste of planning cycles due to inability to cache per-clause selectivity and cost estimates; * sometimes, RestrictInfos would sneak into the fdw_private list of a finished Plan node, causing failures if, for example, we tried to ship the Plan tree to a parallel worker. (It may well be that it's a bug in the parallel-query logic that we would ever try to ship such a plan to a parallel worker, but in any case this deserves to be cleaned up.) To fix, rearrange so that clause lists in PgFdwRelationInfo are always lists of RestrictInfos, and then strip the RestrictInfos at the last minute when making a Plan node. In passing do a bit of refactoring and comment cleanup in postgresGetForeignPlan and foreign_join_ok. Although the messiness here dates back at least to 9.6, there's no evidence that it causes anything worse than wasted planning cycles in 9.6, so no back-patch for now. Per fuzz testing by Andreas Seltenreich. Tom Lane and Ashutosh Bapat Discussion: <a target="_blank" href="https://postgr.es/m/87tw5x4vcu.fsf@credativ.de">https://postgr.es/m/87tw5x4vcu.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/28b047875554b29837cded70a19384dae107c61a">http://git.postgresql.org/pg/commitdiff/28b047875554b29837cded70a19384dae107c61a</a></li>
<li>Simplify handling of remote-qual pass-forward in postgres_fdw. Commit 0bf3ae88a encountered a need to pass the finally chosen remote qual conditions forward from postgresGetForeignPlan to postgresPlanDirectModify. It solved that by sticking them into the plan node's fdw_private list, which in hindsight was a pretty bad idea. In the first place, there's no use for those qual trees either in EXPLAIN or execution; indeed they could never safely be used for any post-planning purposes, because they would not get processed by setrefs.c. So they're just dead weight to carry around in the finished plan tree, plus being an attractive nuisance for somebody who might get the idea that they could be used that way. Secondly, because those qual trees (sometimes) contained RestrictInfos, they created a plan-transmission hazard for parallel query, which is how come we noticed a problem. We dealt with that symptom in commit 28b047875, but really a more straightforward and more efficient fix is to pass the data through in a new field of struct PgFdwRelationInfo. So do it that way. (There's no need to revert 28b047875, as it has sufficient reason to live anyway.) Per fuzz testing by Andreas Seltenreich. Discussion: <a target="_blank" href="https://postgr.es/m/87tw5x4vcu.fsf@credativ.de">https://postgr.es/m/87tw5x4vcu.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/88e902b769e180a232013e265ff9fd582dde125b">http://git.postgresql.org/pg/commitdiff/88e902b769e180a232013e265ff9fd582dde125b</a></li>
<li>Remove bogus redefinition of _MSC_VER. Commit a4777f355 was a shade too mechanical: we don't want to override MSVC's own definition of _MSC_VER, as that breaks tests on its numerical value. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/587d62d8562d658a2a9be60bc4574b6f9e592cb1">http://git.postgresql.org/pg/commitdiff/587d62d8562d658a2a9be60bc4574b6f9e592cb1</a></li>
<li>Mark finished Plan nodes with parallel_safe flags. We'd managed to avoid doing this so far, but it seems pretty obvious that it would be forced on us some day, and this is much the cleanest way of approaching the open problem that parallel-unsafe subplans are being transmitted to parallel workers. Anyway there's no space cost due to alignment considerations, and the time cost is pretty minimal since we're just copying the flag from the corresponding Path node. (At least in most cases ... some of the klugier spots in createplan.c have to work a bit harder.) In principle we could perhaps get rid of SubPlan.parallel_safe, but I thought it better to keep that in case there are reasons to consider a SubPlan unsafe even when its child plan is parallel-safe. This patch doesn't actually do anything with the new flags, but I thought I'd commit it separately anyway. Note: although this touches outfuncs/readfuncs, there's no need for a catversion bump because Plan trees aren't stored on disk. Discussion: <a target="_blank" href="https://postgr.es/m/87tw5x4vcu.fsf@credativ.de">https://postgr.es/m/87tw5x4vcu.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/003d80f3dfadd57c6aac8480436ff53ee2c978bd">http://git.postgresql.org/pg/commitdiff/003d80f3dfadd57c6aac8480436ff53ee2c978bd</a></li>
<li>Avoid transferring parallel-unsafe subplans to parallel workers. Commit 5e6d8d2bb allowed parallel workers to execute parallel-safe subplans, but it transmitted the query's entire list of subplans to the worker(s). Since execMain.c blindly does ExecInitNode and later ExecEndNode on every list element, this resulted in parallel-unsafe plan nodes nonetheless getting started up and shut down in parallel workers. That seems mostly harmless as far as core plan node types go (but maybe not so much for Gather?). But it resulted in postgres_fdw opening and then closing extra remote connections, and it's likely that other non-parallel-safe FDWs or custom scan providers would have worse reactions. To fix, just make ExecSerializePlan replace parallel-unsafe subplans with NULLs in the cut-down plan tree that it transmits to workers. This relies on ExecInitNode and ExecEndNode to do nothing on NULL input, but they do anyway. If anything else is touching the dropped subplans in a parallel worker, that would be a bug to be fixed. (This thus provides a strong guarantee that we won't try to do something with a parallel-unsafe subplan in a worker.) This is, I think, the last fix directly occasioned by Andreas Seltenreich's bug report of a few days ago. Tom Lane and Amit Kapila Discussion: <a target="_blank" href="https://postgr.es/m/87tw5x4vcu.fsf@credativ.de">https://postgr.es/m/87tw5x4vcu.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/16ebab68862bb5d3595b8c8df083f650d9d7cd20">http://git.postgresql.org/pg/commitdiff/16ebab68862bb5d3595b8c8df083f650d9d7cd20</a></li>
<li>Speed up hash_index regression test. Commit f5ab0a14e made this test take substantially longer than it used to. With a bit more care, we can get the runtime back down while achieving the same, or even a bit better, code coverage. Mithun Cy Discussion: <a target="_blank" href="https://postgr.es/m/CAD__Ouh-qaEb+rD7Uy-4g3xQYOrhPzHs-a_TrFAjiQ5azAW5+w@mail.gmail.com">https://postgr.es/m/CAD__Ouh-qaEb+rD7Uy-4g3xQYOrhPzHs-a_TrFAjiQ5azAW5+w@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4a8bc39b08aa83694f22ea56a8626e91e28a0227">http://git.postgresql.org/pg/commitdiff/4a8bc39b08aa83694f22ea56a8626e91e28a0227</a></li>
<li>Move bootstrap-time lookup of regproc OIDs into genbki.pl. Formerly, the bootstrap backend looked up the OIDs corresponding to names in regproc catalog entries using brute-force searches of pg_proc. It was somewhat remarkable that that worked at all, since it was used while populating other pretty-fundamental catalogs like pg_operator. And it was also quite slow, and getting slower as pg_proc gets bigger. This patch moves the lookup work into genbki.pl, so that the values in postgres.bki for regproc columns are always numeric OIDs, an option that regprocin() already supported. Perl isn't the world's speediest language, so this about doubles the time needed to run genbki.pl (from 0.3 to 0.6 sec on my machine). But we only do that at most once per build. The time needed to run initdb drops significantly --- on my machine, initdb --no-sync goes from 1.8 to 1.3 seconds. So this is a small net win even for just one initdb per build, and it becomes quite a nice win for test sequences requiring many initdb runs. Strip out the now-dead code for brute-force catalog searching in regprocin. We'd also cargo-culted similar logic into regoperin and some (not all) of the other reg*in functions. That is all dead code too since we currently have no need to load such values during bootstrap. I removed it all, reasoning that if we ever need such functionality it'd be much better to do it in a similar way to this patch. There might be some simplifications possible in the backend now that regprocin doesn't require doing catalog reads so early in bootstrap. I've not looked into that, though. Andreas Karlsson, with some small adjustments by me Discussion: <a target="_blank" href="https://postgr.es/m/30896.1492006367@sss.pgh.pa.us">https://postgr.es/m/30896.1492006367@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5e39f06cfe65acbecedf42a660f577c3fca47bcc">http://git.postgresql.org/pg/commitdiff/5e39f06cfe65acbecedf42a660f577c3fca47bcc</a></li>
<li>Fix regexport.c to behave sanely with lookaround constraints. regexport.c thought it could just ignore LACON arcs, but the correct behavior is to treat them as satisfiable while consuming zero input (rather reminiscently of commit 9f1e642d5). Otherwise, the emitted simplified-NFA representation may contain no paths leading from initial to final state, which unsurprisingly confuses pg_trgm, as seen in bug #14623 from Jeff Janes. Since regexport's output representation has no concept of an arc that consumes zero input, recurse internally to find the next normal arc(s) after any LACON transitions. We'd be forced into changing that representation if a LACON could be the last arc reaching the final state, but fortunately the regex library never builds NFAs with such a configuration, so there always is a next normal arc. Back-patch to 9.3 where this logic was introduced. Discussion: <a target="_blank" href="https://postgr.es/m/20170413180503.25948.94871@wrigleys.postgresql.org">https://postgr.es/m/20170413180503.25948.94871@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6cfaffc0ddc73dab6857c094f98b28761898cc6d">http://git.postgresql.org/pg/commitdiff/6cfaffc0ddc73dab6857c094f98b28761898cc6d</a></li>
<li>Further fix pg_trgm's extraction of trigrams from regular expressions. Commit 9e43e8714 turns out to have been insufficient: not only is it necessary to track tentative parent links while considering a set of arc removals, but it's necessary to track tentative flag additions as well. This is because we always merge arc target states into arc source states; therefore, when considering a merge of the final state with some other, it is the other state that will acquire a new TSTATE_FIN bit. If there's another arc for the same color trigram that would cause merging of that state with the initial state, we failed to recognize the problem. The test cases for the prior commit evidently only exercised situations where a tentative merge with the initial state occurs before one with the final state. If it goes the other way around, we'll happily merge the initial and final states, either producing a broken final graph that would never match anything, or triggering the Assert added by the prior commit. It's tempting to consider switching the merge direction when the merge involves the final state, but I lack the time to analyze that idea in detail. Instead just keep track of the flag changes that would result from proposed merges, in the same way that the prior commit tracked proposed parent links. Along the way, add some more debugging support, because I'm not entirely confident that this is the last bug here. And tweak matters so that the transformed.dot file uses small integers rather than pointer values to identify states; that makes it more readable if you're just eyeballing it rather than fooling with Graphviz. And rename a couple of identically named struct fields to reduce confusion. Per report from Corey Csuhta. Add a test case based on his example. (Note: this case does not trigger the bug under 9.3, apparently because its different measurement of costs causes it to stop merging states before it hits the failure. I spent some time trying to find a variant that would fail in 9.3, without success; but I'm sure such cases exist.) Like the previous patch, back-patch to 9.3 where this code was added. Report: <a target="_blank" href="https://postgr.es/m/E2B01A4B-4530-406B-8D17-2F67CF9A16BA@csuhta.com">https://postgr.es/m/E2B01A4B-4530-406B-8D17-2F67CF9A16BA@csuhta.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1dffabed49054a81b6005a363ab2da4aee0aab9e">http://git.postgresql.org/pg/commitdiff/1dffabed49054a81b6005a363ab2da4aee0aab9e</a></li>
<li>Use one transaction while reading postgres.bki, not one per line. AFAICT, the only actual benefit of closing a bootstrap transaction is to reclaim transient memory. We can do that a lot more cheaply by just doing a MemoryContextReset on a suitable context. This gets the runtime of the "bootstrap" phase of initdb down to the point where, at least by eyeball, it's quite negligible compared to the rest of the phases. Per discussion with Andres Freund. Discussion: <a target="_blank" href="https://postgr.es/m/9244.1492106743@sss.pgh.pa.us">https://postgr.es/m/9244.1492106743@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/85a0781334a204c15c9c6ea9d3e6c75334c2beb6">http://git.postgresql.org/pg/commitdiff/85a0781334a204c15c9c6ea9d3e6c75334c2beb6</a></li>
<li>Avoid passing function pointers across process boundaries. We'd already recognized that we can't pass function pointers across process boundaries for functions in loadable modules, since a shared library could get loaded at different addresses in different processes. But actually the practice doesn't work for functions in the core backend either, if we're using EXEC_BACKEND. This is the cause of recent failures on buildfarm member culicidae. Switch to passing a string function name in all cases. Something like this needs to be back-patched into 9.6, but let's see if the buildfarm likes it first. Petr Jelinek, with a bunch of basically-cosmetic adjustments by me Discussion: <a target="_blank" href="https://postgr.es/m/548f9c1d-eafa-e3fa-9da8-f0cc2f654e60@2ndquadrant.com">https://postgr.es/m/548f9c1d-eafa-e3fa-9da8-f0cc2f654e60@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/32470825d36d99a81347ee36c181d609c952c061">http://git.postgresql.org/pg/commitdiff/32470825d36d99a81347ee36c181d609c952c061</a></li>
<li>More cleanup of manipulations of hash indexes' hasho_flag field. Not much point in defining test macros for the flag bits if we don't use 'em. Amit Kapila <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/083dc95a14c05bdaeec3015508ca1d16fc7483b5">http://git.postgresql.org/pg/commitdiff/083dc95a14c05bdaeec3015508ca1d16fc7483b5</a></li>
<li>Clean up manipulations of hash indexes' hasho_flag field. Standardize on testing a hash index page's type by doing (opaque-&gt;hasho_flag &amp; LH_PAGE_TYPE) == LH_xxx_PAGE. Various places were taking shortcuts like opaque-&gt;hasho_flag &amp; LH_BUCKET_PAGE which while not actually wrong, is still bad practice because it encourages use of opaque-&gt;hasho_flag &amp; LH_UNUSED_PAGE which *is* wrong (LH_UNUSED_PAGE == 0, so the above is constant false). hash_xlog.c's hash_mask() contained such an incorrect test. This also ensures that we mask out the additional flag bits that hasho_flag has accreted since 9.6. pgstattuple's pgstat_hash_page(), for one, was failing to do that and was thus actively broken. Also fix assorted comments that hadn't been updated to reflect the extended usage of hasho_flag, and fix some macros that were testing just "(hasho_flag &amp; bit)" to use the less dangerous, project-approved form "((hasho_flag &amp; bit) != 0)". Coverity found the bug in hash_mask(); I noted the one in pgstat_hash_page() through code reading. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2040bb4a0b50ef0434a1a723f00d040ab4f1c06f">http://git.postgresql.org/pg/commitdiff/2040bb4a0b50ef0434a1a723f00d040ab4f1c06f</a></li>
<li>Fix erroneous cross-reference in comment. Seems to have been introduced in commit c219d9b0a. I think there indeed was a "tupbasics.h" in some early drafts of that refactoring, but it didn't survive into the committed version. Amit Kapila <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bfba563bc5d80263637a3cfba6a572c20949defe">http://git.postgresql.org/pg/commitdiff/bfba563bc5d80263637a3cfba6a572c20949defe</a></li>
<li>Provide a way to control SysV shmem attach address in EXEC_BACKEND builds. In standard non-Windows builds, there's no particular reason to care what address the kernel chooses to map the shared memory segment at. However, when building with EXEC_BACKEND, there's a risk that the chosen address won't be available in all child processes. Linux with ASLR enabled (which it is by default) seems particularly at risk because it puts shmem segments into the same area where it maps shared libraries. We can work around that by specifying a mapping address that's outside the range where shared libraries could get mapped. On x86_64 Linux, 0x7e0000000000 seems to work well. This is only meant for testing/debugging purposes, so it doesn't seem necessary to go as far as providing a GUC (or any user-visible documentation, though we might change that later). Instead, it's just controlled by setting an environment variable PG_SHMEM_ADDR to the desired attach address. Back-patch to all supported branches, since the point here is to remove intermittent buildfarm failures on EXEC_BACKEND animals. Owners of affected animals will need to add a suitable setting of PG_SHMEM_ADDR to their build_env configuration. Discussion: <a target="_blank" href="https://postgr.es/m/7036.1492231361@sss.pgh.pa.us">https://postgr.es/m/7036.1492231361@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a74740fbd3bb89cd626f6e98417847f696e60bd8">http://git.postgresql.org/pg/commitdiff/a74740fbd3bb89cd626f6e98417847f696e60bd8</a></li>
<li>Sync addRangeTableEntryForENR() with its peer functions. addRangeTableEntryForENR had a check for pstate != NULL, which Coverity pointed out was rather useless since it'd already dereferenced pstate before that. More to the point, we'd established policy in commit bc93ac12c that we'd require non-NULL pstate for all addRangeTableEntryFor* functions; this test was evidently copied-and-pasted from some older version of one of those functions. Make it look more like the others. In passing, make an elog message look more like the rest of the code, too. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a1888b59b511b42290a6fcfa87e35323d128c4f6">http://git.postgresql.org/pg/commitdiff/a1888b59b511b42290a6fcfa87e35323d128c4f6</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Fix whitespace. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/244f1c89070c1a661623bf1eaddf1307f8f598a3">http://git.postgresql.org/pg/commitdiff/244f1c89070c1a661623bf1eaddf1307f8f598a3</a></li>
<li>Support configuration reload in logical replication workers. Author: Michael Paquier &lt;michael.paquier@gmail.com&gt; Reviewed-by: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; Reported-by: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/26ad194cb0a6b955e155d44fb52a74212ce85759">http://git.postgresql.org/pg/commitdiff/26ad194cb0a6b955e155d44fb52a74212ce85759</a></li>
<li>Fix typo in comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/56dd8e85c40fef3e3c2c10afa186ee30416ec507">http://git.postgresql.org/pg/commitdiff/56dd8e85c40fef3e3c2c10afa186ee30416ec507</a></li>
<li>Use weaker locks when updating pg_subscription_rel. The previously used ShareRowExclusiveLock, while technically probably more correct, led to deadlocks during seemingly unrelated operations and thus a poor experience. Use RowExclusiveLock, like for most similar catalog operations. In some care cases, the user might see an error from DDL commands. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/flat/13592.1490851519%40sss.pgh.pa.us">https://www.postgresql.org/message-id/flat/13592.1490851519%40sss.pgh.pa.us</a> Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/521fd4795e3ec3d0b263b62e5eb58e1557be9c86">http://git.postgresql.org/pg/commitdiff/521fd4795e3ec3d0b263b62e5eb58e1557be9c86</a></li>
<li>Remove some tabs in SQL code in C string literals. This is not handled uniformly throughout the code, but at least nearby code can be consistent. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/35b5f7b608fa1ae12d07cd475c382c5f1341648d">http://git.postgresql.org/pg/commitdiff/35b5f7b608fa1ae12d07cd475c382c5f1341648d</a></li>
<li>doc: Tweak CSS. Tweak CSS a bit to match latest similar changes to web site style. Also move some CSS out of the HTML to the stylesheet so that the web site stylesheet can override it. This should ensure that notes and such are back to being centered. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f6f9f8a24cdf1bc8a714c65dc45fd67fef59217a">http://git.postgresql.org/pg/commitdiff/f6f9f8a24cdf1bc8a714c65dc45fd67fef59217a</a></li>
<li>pg_dump: Dump subscriptions by default. Dump subscriptions if the current user is a superuser, otherwise write a warning and skip them. Remove the pg_dump option --include-subscriptions. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/e4fbfad5-c6ac-fd50-6777-18c84b34eb2f@2ndquadrant.com">https://www.postgresql.org/message-id/e4fbfad5-c6ac-fd50-6777-18c84b34eb2f@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c31671f9b5f6eee9b6726baad2db1795c94839d1">http://git.postgresql.org/pg/commitdiff/c31671f9b5f6eee9b6726baad2db1795c94839d1</a></li>
<li>pg_dump: Always dump subscriptions NOCONNECT. This removes the pg_dump option --no-subscription-connect and makes it the default. Dumping a subscription so that it activates right away when restored is not very useful, because the state of the publication server is unclear. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/e4fbfad5-c6ac-fd50-6777-18c84b34eb2f@2ndquadrant.com">https://www.postgresql.org/message-id/e4fbfad5-c6ac-fd50-6777-18c84b34eb2f@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a9254e675bde7dc2d976d207450c559d914c0dd6">http://git.postgresql.org/pg/commitdiff/a9254e675bde7dc2d976d207450c559d914c0dd6</a></li>
<li>pg_dumpall: Allow --no-role-passwords and --binary-upgrade together. This was introduced as part of the patch to add --no-role-passwords, but while it's an unusual combination, there is no actual reason to prevent it. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff46f2a0534560367ba748ac9d859a2cf05ce3fc">http://git.postgresql.org/pg/commitdiff/ff46f2a0534560367ba748ac9d859a2cf05ce3fc</a></li>
<li>Make header self-contained. Add necessary include files for things used in the header. (signal.h needed for sig_atomic_t.) <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d04eac1148a491177cf107fbedc678bcc68b4e31">http://git.postgresql.org/pg/commitdiff/d04eac1148a491177cf107fbedc678bcc68b4e31</a></li>
<li>pg_dump: Dump comments and security labels for publication and subscriptions. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cf615fbaa9893af42ba0f58a02dd52107bde0048">http://git.postgresql.org/pg/commitdiff/cf615fbaa9893af42ba0f58a02dd52107bde0048</a></li>
<li>Remove trailing spaces in some output. Author: Alexander Law &lt;exclusion@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/674677c705f11464857e6dfd0a0d6104656d9c4a">http://git.postgresql.org/pg/commitdiff/674677c705f11464857e6dfd0a0d6104656d9c4a</a></li>
<li>Remove useless trailing spaces in queries in C strings. Author: Alexander Law &lt;exclusion@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0c22327f269eb3bec25327b0e620bdca082e4628">http://git.postgresql.org/pg/commitdiff/0c22327f269eb3bec25327b0e620bdca082e4628</a></li>
<li>Remove pstrdup of TextDatumGetCString. The result of TextDatumGetCString is already palloc'ed. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/25371a72b95aab43b0a3547ead4d3286c1128351">http://git.postgresql.org/pg/commitdiff/25371a72b95aab43b0a3547ead4d3286c1128351</a></li>
<li>Add option to modify sync commit per subscription. This also changes default behaviour of subscription workers to synchronous_commit = off. Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/887227a1cc861d87ca0f175cf8bd1447554090eb">http://git.postgresql.org/pg/commitdiff/887227a1cc861d87ca0f175cf8bd1447554090eb</a></li>
<li>Fix typo in comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6e5f9a6dc0a9e417544692db56d2c80a64dd83c7">http://git.postgresql.org/pg/commitdiff/6e5f9a6dc0a9e417544692db56d2c80a64dd83c7</a></li>
<li>Catversion bump. for commit 887227a1cc861d87ca0f175cf8bd1447554090eb <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/67c2def11d49de05aacd959ecdffc6736f52efee">http://git.postgresql.org/pg/commitdiff/67c2def11d49de05aacd959ecdffc6736f52efee</a></li>
<li>Report statistics in logical replication workers. Author: Stas Kelvich &lt;s.kelvich@postgrespro.ru&gt; Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; Reported-by: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/139eb9673cb84c76f493af7e68301ae204199746">http://git.postgresql.org/pg/commitdiff/139eb9673cb84c76f493af7e68301ae204199746</a></li>
<li>doc: Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5a617ab3e691aec56725960e6d28c98c8af6ddaa">http://git.postgresql.org/pg/commitdiff/5a617ab3e691aec56725960e6d28c98c8af6ddaa</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Fix reporting of violations in ExecConstraints, again. We decided in f1b4c771ea74f42447dccaed42ffcdcccf3aa694 to pass the original slot to ExecConstraints(), but that breaks when there are BEFORE ROW triggers involved. So we need to do reverse-map the tuples back to the original descriptor instead, as Amit originally proposed. Amit Langote, reviewed by Ashutosh Bapat. One overlooked comment fixed by me. Discussion: <a target="_blank" href="http://postgr.es/m/b3a17254-6849-e542-2353-bde4e880b6a4@lab.ntt.co.jp">http://postgr.es/m/b3a17254-6849-e542-2353-bde4e880b6a4@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c0a8ae7be392aa09dd7e148ff662013e8e148893">http://git.postgresql.org/pg/commitdiff/c0a8ae7be392aa09dd7e148ff662013e8e148893</a></li>
<li>Fix possibile deadlock when dropping partitions. heap_drop_with_catalog and RangeVarCallbackForDropRelation should lock the parent before locking the target relation. Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/29588799-a8ce-b0a2-3dae-f39ff6d35922@lab.ntt.co.jp">http://postgr.es/m/29588799-a8ce-b0a2-3dae-f39ff6d35922@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/258cef12540fa1cb244881a0f019cefd698c809e">http://git.postgresql.org/pg/commitdiff/258cef12540fa1cb244881a0f019cefd698c809e</a></li>
<li>Fix failure when a shared tidbitmap has only one page. Commit 98e6e89040a0534ca26914c66cae9dd49ef62ad9 made inadequate provision for the case of a single-page shared tidbitmap. It allocate space for a shared PagetableEntry, but failed to initialize it. Report by Thomas Munro. Patch by Dilip Kumar, with some comment changes by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAEepm=19Cmnfbi-j2Bw-a6yGPeHE1OVhKvvKz9bRBTJGKfGHMA@mail.gmail.com">http://postgr.es/m/CAEepm=19Cmnfbi-j2Bw-a6yGPeHE1OVhKvvKz9bRBTJGKfGHMA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4c3b59abf4c476843bca23de7fb66d647627f30e">http://git.postgresql.org/pg/commitdiff/4c3b59abf4c476843bca23de7fb66d647627f30e</a></li>
<li>Fix confusion of max_parallel_workers mechanism following crash. Commit b460f5d6693103076dc554aa7cbb96e1e53074f9 failed to contemplate the possibilit that a parallel worker registered before a crash would be unregistered only after the crash; if that happened, we'd end up with parallel_terminate_count &gt; parallel_register_count and the system would refuse to launch any more parallel workers. The easiest way to fix that seems to be to forget BGW_NEVER_RESTART workers in ResetBackgroundWorkerCrashTimes() rather than leaving them around to be cleaned up after the conclusion of the restart, so that they go away before rather than after shared memory is reset. To make sure that this fix is water-tight, don't allow parallel workers to be anything other than BGW_NEVER_RESTART, so that after recovering from a crash, 0 is guaranteed to be the correct starting value for parallel_register_count. The core code wouldn't do this anyway, but somebody might try to do it in extension code. Report by Thomas Vondra. Patch by me, reviewed by Kuntal Ghosh. Discussion: <a target="_blank" href="http://postgr.es/m/CAGz5QC+AVEVS+3rBKRq83AxkJLMZ1peMt4nnrQwczxOrmo3CNw@mail.gmail.com">http://postgr.es/m/CAGz5QC+AVEVS+3rBKRq83AxkJLMZ1peMt4nnrQwczxOrmo3CNw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8ff518699f19dd0a5076f5090bac8400b8233f7f">http://git.postgresql.org/pg/commitdiff/8ff518699f19dd0a5076f5090bac8400b8233f7f</a></li>
<li>Add an Assert() to max_parallel_workers enforcement. To prevent future bugs along the lines of the one corrected by commit 8ff518699f19dd0a5076f5090bac8400b8233f7f, or find any that remain in the current code, add an Assert() that the difference between parallel_register_count and parallel_terminate_count is in a sane range. Kuntal Ghosh, with considerable tidying-up by me, per a suggestion from Neha Khatri. Reviewed by Tomas Vondra. Discussion: <a target="_blank" href="http://postgr.es/m/CAFO0U+-E8yzchwVnvn5BeRDPgX2z9vZUxQ8dxx9c0XFGBC7N1Q@mail.gmail.com">http://postgr.es/m/CAFO0U+-E8yzchwVnvn5BeRDPgX2z9vZUxQ8dxx9c0XFGBC7N1Q@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6599c9ac3340b6cd3d86a0a7f866b80a009fecab">http://git.postgresql.org/pg/commitdiff/6599c9ac3340b6cd3d86a0a7f866b80a009fecab</a></li>
<li>Allow a rule on partitioned table to be renamed. Commit f0e44751d7175fa3394da2c8f85e3ceb3cdbfe63 should have updated this code, but did not. Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/52d9c443-ec78-5c8a-7a77-0f34aad12b82@lab.ntt.co.jp">http://postgr.es/m/52d9c443-ec78-5c8a-7a77-0f34aad12b82@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/02af7857e5694b13c21401d1982ac21d31e27dee">http://git.postgresql.org/pg/commitdiff/02af7857e5694b13c21401d1982ac21d31e27dee</a></li>
<li>Code review for c94e6942cefe7d20c5feed856e27f672734b1e2b. validateCheckConstraint() shouldn't try to access the storage for a partitioned table, because it no longer has any. Creating a _RETURN table on a partitioned table shouldn't be allowed, both because there's no value in it and because trying to do so would involve a validation scan against its nonexistent storage. Amit Langote, reviewed by Tom Lane. Regression test outputs updated to pass by me. Discussion: <a target="_blank" href="http://postgr.es/m/e5c3cbd3-1551-d6f8-c9e2-51777d632fd2@lab.ntt.co.jp">http://postgr.es/m/e5c3cbd3-1551-d6f8-c9e2-51777d632fd2@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1d5fede4a900d135745c1fa5a70dcfe0b3359e3d">http://git.postgresql.org/pg/commitdiff/1d5fede4a900d135745c1fa5a70dcfe0b3359e3d</a></li>
<li>Fix pgstattuple's handling of unused hash pages. Hash indexes can contain both pages which are all-zeroes (i.e. PageIsNew()) and pages which have been initialized but currently aren't used. The latter category can happen either when a page has been reserved but not yet used or when it is used for a time and then freed. pgstattuple was only prepared to deal with the pages that are actually-zeroes, which it called zero_pages. Rename the column to unused_pages (extension version 1.5 is as-yet-unreleased) and make it count both kinds of unused pages. Along the way, slightly tidy up the way we test for pages of various types. Robert Haas and Ashutosh Sharma, reviewed by Amit Kapila Discussion: <a target="_blank" href="http://postgr.es/m/CAE9k0PkTtKFB3YndOyQMjwuHx+-FtUP1ynK8E-nHtetoow3NtQ@mail.gmail.com">http://postgr.es/m/CAE9k0PkTtKFB3YndOyQMjwuHx+-FtUP1ynK8E-nHtetoow3NtQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9cc27566c1a8d659c15b9eea2413dcc07a7a42c9">http://git.postgresql.org/pg/commitdiff/9cc27566c1a8d659c15b9eea2413dcc07a7a42c9</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Fix initialization of dsa.c free area counter. The backend local copy of dsa_area_control-&gt;freed_segment_counter was not properly initialized / maintained. This could, if unlucky, lead to keeping attached to a segment for too long. Found via valgrind bleat on buildfarm animal skink. Author: Thomas Munro Discussion: <a target="_blank" href="https://postgr.es/m/20170407164935.obsf2jipjfos5zei@alap3.anarazel.de">https://postgr.es/m/20170407164935.obsf2jipjfos5zei@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c45b1d2283c6631b990de25098ea389a1b96277a">http://git.postgresql.org/pg/commitdiff/c45b1d2283c6631b990de25098ea389a1b96277a</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Run most pg_dump and pg_dumpall tests with --no-sync. Commit 96a7128b made pg_dump and pg_dumpall sync their output by default. However, there's no great need for that in testing, and it could impose a performance penalty, so we add the --no-sync flag to most of the test cases. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3820c63da8d0e59e2bd4476e91968f03be5dd041">http://git.postgresql.org/pg/commitdiff/3820c63da8d0e59e2bd4476e91968f03be5dd041</a></li>
<li>Downcase "Wincrypt.h". This is consistent with how we refer to other Windows include files, and prevents a failure when cross-compiling on a system with case sensitive file names. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0eba6be1b8d37fa368a45795ba350d46cc86df54">http://git.postgresql.org/pg/commitdiff/0eba6be1b8d37fa368a45795ba350d46cc86df54</a></li>
<li>Make sure to run one initdb TAP test with no TZ set. That way we make sure that initdb's time zone setting code is exercised. This doesn't add an extra test, it just alters an existing test. Discussion: &lt;<a target="_blank" href="https://postgr.es/m/5807.1492229253@sss.pgh.pa.us%3E">https://postgr.es/m/5807.1492229253@sss.pgh.pa.us&gt;</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/033b969edde62c84ee15b53972ee638150a28c90">http://git.postgresql.org/pg/commitdiff/033b969edde62c84ee15b53972ee638150a28c90</a></li>
</ul>
<p>Michael Meskes pushed:</p>
<ul>
<li>Document that bytea is best represented as char * in C for ecpg. Patch by Kato, Sho &lt;kato-sho@jp.fujitsu.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a6940bdcb9ef87a54459deac5699a61cfdbc696c">http://git.postgresql.org/pg/commitdiff/a6940bdcb9ef87a54459deac5699a61cfdbc696c</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Remove support for bcc and msvc standalone libpq builds. This removes the support for building just libpq using Borland C++ or Visual C++. This has not worked properly for years, and given the number of complaints it's clearly not worth the maintenance burden. Building libpq using the standard MSVC build system is of course still supported, along with mingw. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6da56f3f84d430671d5edd8f9336bd744c089e31">http://git.postgresql.org/pg/commitdiff/6da56f3f84d430671d5edd8f9336bd744c089e31</a></li>
<li>Remove symbol WIN32_ONLY_COMPILER. This used to mean "Visual C++ except in those parts where Borland C++ was supported where it meant one of those". Now that we don't support Borland C++ anymore, simplify by using _MSC_VER which is the normal way to detect Visual C++. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a4777f35565b80ae10605d6d417e5d173156f7da">http://git.postgresql.org/pg/commitdiff/a4777f35565b80ae10605d6d417e5d173156f7da</a></li>
<li>Fix reversed check of return value from sync. While at it also update the comments in walmethods.h to make it less likely for mistakes like this to appear in the future (thanks to Tom for improvements to the comments). And finally, in passing change the return type of walmethod.getlasterror to being const, also per suggestion from Tom. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b935eb7da37254a18c48acc7b07517c8dfbb2339">http://git.postgresql.org/pg/commitdiff/b935eb7da37254a18c48acc7b07517c8dfbb2339</a></li>
</ul>
<p>Bruce Momjian pushed:</p>
<ul>
<li>docs: Improve window function docs. Specifically, the behavior of general-purpose and statistical aggregates as window functions was not clearly documented, and terms were inconsistently used. Also add docs about the difference between cume_dist and percent_rank, rather than just the formulas. Discussion: 20170406214918.GA5757@momjian.us <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1c1a4726eba5bb8c0772db8a8efe0315d71887fb">http://git.postgresql.org/pg/commitdiff/1c1a4726eba5bb8c0772db8a8efe0315d71887fb</a></li>
<li>doc: clearify pg_upgrade default copy behavior. Reported-by: Marek &lt;marek.cvoren@gmail.com&gt; Discussion: 20170328110253.2695.62609@wrigleys.postgresql.org <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e298b8dbb3220a0d5e073e0ad6a8afd35042c2a">http://git.postgresql.org/pg/commitdiff/1e298b8dbb3220a0d5e073e0ad6a8afd35042c2a</a></li>
<li>git_changelog: improve instructions for finding branch commits. Specifically, use '--summary' with 'git show'. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/854854019a282b6e74f586a3ee8c88c791193d32">http://git.postgresql.org/pg/commitdiff/854854019a282b6e74f586a3ee8c88c791193d32</a></li>
<li>git_changelog: improve comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e1c86a55762c81ffbcf3985f7eb711026d40824f">http://git.postgresql.org/pg/commitdiff/e1c86a55762c81ffbcf3985f7eb711026d40824f</a></li>
<li>docs: update major release instructions. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/06fc54cd4355caf8e271ffc864885ccaa879159e">http://git.postgresql.org/pg/commitdiff/06fc54cd4355caf8e271ffc864885ccaa879159e</a></li>
<li>doc: add missing sect1 close tag. Fixes commit 4f3b87ab780b95c2cc8a591259baefaff4852037 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/885fea5a34b036983379688d707b2a20735ebe4a">http://git.postgresql.org/pg/commitdiff/885fea5a34b036983379688d707b2a20735ebe4a</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Add max_sync_workers_per_subscription to postgresql.conf.sample. This commit also does * add REPLICATION_SUBSCRIBERS into config_group * mark max_logical_replication_workers and max_sync_workers_per_subscription as REPLICATION_SUBSCRIBERS parameters * move those parameters into "Subscribers" section in postgresql.conf.sample Author: Masahiko Sawada, Petr Jelinek and me Reported-by: Masahiko Sawada Discussion: <a target="_blank" href="http://postgr.es/m/CAD21AoAonSCoa=v=87ZO3vhfUZA1k_E2XRNHTt=xioWGUa+0ug@mail.gmail.com">http://postgr.es/m/CAD21AoAonSCoa=v=87ZO3vhfUZA1k_E2XRNHTt=xioWGUa+0ug@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff7bce174390ae063c122ab04020bd4ee070d6ad">http://git.postgresql.org/pg/commitdiff/ff7bce174390ae063c122ab04020bd4ee070d6ad</a></li>
<li>Improve tab-completion of DDL for publication and subscription. Author: Masahiko Sawada Discussion: <a target="_blank" href="http://postgr.es/m/CAD21AoC32YgtateNqTFXzTJmHHe6hXs4cpJTND3n-Ts8f-aMqw@mail.gmail.com">http://postgr.es/m/CAD21AoC32YgtateNqTFXzTJmHHe6hXs4cpJTND3n-Ts8f-aMqw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c525f740661104e3d8578a133ed6b4a8cd7028ac">http://git.postgresql.org/pg/commitdiff/c525f740661104e3d8578a133ed6b4a8cd7028ac</a></li>
<li>Improve documentations for ALTER PUBLICATION and ALTER SUBSCRIPTION. Discussion: <a target="_blank" href="http://postgr.es/m/CAD21AoC32YgtateNqTFXzTJmHHe6hXs4cpJTND3n-Ts8f-aMqw@mail.gmail.com">http://postgr.es/m/CAD21AoC32YgtateNqTFXzTJmHHe6hXs4cpJTND3n-Ts8f-aMqw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a6e7d591d0129bc7f1f186cb40a6ebd7963956ab">http://git.postgresql.org/pg/commitdiff/a6e7d591d0129bc7f1f186cb40a6ebd7963956ab</a></li>
<li>Move pg_stat_progress_vacuum to the table of Dynamic Statistics Views in doc. Previously the description about pg_stat_progress_vacuum was in the table of "Collected Statistics Views" in the doc. But since it repors dynamic information, i.e., the current progress of VACUUM, its description should be in the table of "Dynamic Statistics Views". Back-patch to 9.6 where pg_stat_progress_vacuum was added. Author: Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/7ab51b59-8d4d-6193-c60a-b75f222efb12@lab.ntt.co.jp">http://postgr.es/m/7ab51b59-8d4d-6193-c60a-b75f222efb12@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7a3e8d7b503c25e009b9f591554617a2434c72eb">http://git.postgresql.org/pg/commitdiff/7a3e8d7b503c25e009b9f591554617a2434c72eb</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Mention pg_index changes also cause relcache invalidation. Amit Langote, additional line by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2c2ecddcffba979ce3457bce3655136b6230a127">http://git.postgresql.org/pg/commitdiff/2c2ecddcffba979ce3457bce3655136b6230a127</a></li>
</ul>
<p>&Aacute;lvaro Herrera pushed:</p>
<ul>
<li>Remove pg_stats_ext view. It was created as equivalent of pg_stats, but since the code underlying pg_statistic_ext is more convenient than the one for pg_statistic, pg_stats_ext is no longer useful. Author: David Rowley Reviewed-by: Tomas Vondra Discussion: <a target="_blank" href="https://postgr.es/m/CAKJS1f9zAkPUf9nQrqpFBAsrOHvb5eYa2FVNsmCJy1wegcO_TQ@mail.gmail.com">https://postgr.es/m/CAKJS1f9zAkPUf9nQrqpFBAsrOHvb5eYa2FVNsmCJy1wegcO_TQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3d5facfd9ab66c819ed583b2614b0560405a6aa2">http://git.postgresql.org/pg/commitdiff/3d5facfd9ab66c819ed583b2614b0560405a6aa2</a></li>
<li>Catversion bump forgotten in previous commit. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/27bcc372b1b323f2d6e0958a05a66b119cfdda38">http://git.postgresql.org/pg/commitdiff/27bcc372b1b323f2d6e0958a05a66b119cfdda38</a></li>
<li>Fix XMLTABLE synopsis, add XMLNAMESPACES example. Add a missing comma in the synopsis after the XMLNAMESPACES clause. Also, add an example illustrating the use of that clause. Author: Arjen Nienhuis and Pavel St&#283;hule <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/73c1748d833617c6ba19750236f8e09beedb132a">http://git.postgresql.org/pg/commitdiff/73c1748d833617c6ba19750236f8e09beedb132a</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Micha&euml;l Paquier sent in another revision of a patch to use base64-based encoding for stored and server keys in SCRAM verifiers, move the routine to build SCRAM verifier into src/common/, refactor frontend-side random number generation, extend PQencryptPassword with a hashing method, and extend psql's \password and createuser to handle SCRAM.</p>
<p>Micha&euml;l Paquier sent in a patch to change pg_hba.conf to refer to SASL, the thing being implemented, instead of SCRAM, one implementation of it.</p>
<p>Ildar Musin sent in a patch to factor out some repetitive code in RI triggers.</p>
<p>Peter Eisentraut sent in two revisions of a patch to fix some warnings generated by gcc7.</p>
<p>David Rowley sent in a patch to allow extended stats on foreign and partitioned tables.</p>
<p>Peter Eisentraut and Bruce Momjian traded patches to fix an issue around HTML rendering in the new documentation toolchain.</p>
<p>Jeff Davis sent in two more revisions of a patch to implement range merge joins.</p>
<p>Alexander Kuzmenkov sent in a patch to implement an index-only count(*) for indexes supporting bitmap scans.</p>
<p>Craig Ringer and Mithun Cy traded patches to make TAP tests run faster.</p>
<p>Kyotaro HORIGUCHI sent in two more revisions of a patch to fix wal_level_minimal.</p>
<p>Amit Langote sent in three more revisions of a patch to fix how pg_dump emits partition attributes.</p>
<p>Masahiko Sawada sent in another revision of a patch to make pg_stat_replication.sync priority report NULL if in quorum-based sync replication, and a different one to change the comments and documentation.</p>
<p>Takayuki Tsunakawa sent in another revision of a patch to make huge pages work on Windows.</p>
<p>Craig Ringer sent in a patch to fix undefined var warnings in PostgresNode with timeout.</p>
<p>Dmitry Ivanov sent in a patch to fix an issue with the custom scan API.</p>
<p>Ashutosh Bapat sent in three more revisions of a patch to fix reporting of violation in ExecConstraints.</p>
<p>Thomas Munro sent in another revision of a patch to implement [[Parallel] Shared] Hash.</p>
<p>Yorick Peterse sent in another revision of a patch to document hot standby config order mentioning all standby servers.</p>
<p>Micha&euml;l Paquier sent in another revision of a patch to reimplement pg_upgrade's test as a TAP test.</p>
<p>Pierre Ducroquet sent in a patch to check the results of atoi in pg_basebackup argument parsing.</p>
<p>Amit Langote sent in a patch to ensure that duplicate addition to publication is a no-op.</p>
<p>Petr Jel&iacute;nek sent in another revision of a patch to set range table for CopyFrom in tablesync.</p>
<p>Petr Jel&iacute;nek sent in another revision of a patch to reserve global xmin for create slot snasphot export, ensure that on-disk snapshots are not used for snapshot export in logical decoding, prevent snapshot builder xmin from going backwards, fix xl_running_xacts usage in snapshot builder, and skip unnecessary snapshot builds.</p>
<p>Amit Langote sent in a patch to fix a typo in partition.c.</p>
<p>Jeff Janes and Pavan Deolasee traded patches to fix an issue that manifested as PANIC in pg_commit_ts slru after crashes.</p>
<p>Masahiko Sawada sent in a patch to fix a comment typo in xlogutils.c.</p>
<p>Jeff Janes sent in a patch to fix an issue that manifested as failed recovery with the new faster 2PC code.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/04/17/Nouvelles-hebdomadaires-de-PostgreSQL-16-avril-2017">par chl le lundi 17 avril 2017 à 21h06</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi 13 avril 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:9ffa913464a5fdf9394efff534448b37" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/04/14/Nouvelles-hebdomadaires-de-PostgreSQL-9-avril-2017">Nouvelles hebdomadaires de PostgreSQL - 9 avril 2017</a></h4>
<div class="entry">
<div class="content">
<p>[ndt: Meetup à Lyon le mercredi 26 avril : <a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</p>
<h2>Offres d'emplois autour de PostgreSQL en avril</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-04/">http://archives.postgresql.org/pgsql-jobs/2017-04/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
<li>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 30 mai&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></li>
<li>Le PGDay UK 2017 aura lieu &agrave; Londres le 4 juillet 2017. L'appel &agrave; conf&eacute;renciers s'&eacute;teint le 20 avril&nbsp;: <a target="_blank" href="http://www.pgconf.uk">http://www.pgconf.uk</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170409231442.GA4338@fetter.org">http://www.postgresql.org/message-id/20170409231442.GA4338@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>Document psql's behavior of recalling the previously executed query. Various psql slash commands that normally act on the current query buffer will automatically recall and re-use the most recently executed SQL command instead, if the current query buffer is empty. Although this behavior is ancient (dating apparently to commit 77a472993), it was documented nowhere in the psql reference page. For that matter, we'd never bothered to define the concept of "current query buffer" explicitly. Fix that. Do some wordsmithing on relevant command descriptions to improve clarity and consistency. Discussion: <a target="_blank" href="https://postgr.es/m/9b4ea968-753f-4b5f-b46c-d7d3bf7c8f90@manitou-mail.org">https://postgr.es/m/9b4ea968-753f-4b5f-b46c-d7d3bf7c8f90@manitou-mail.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/68dba97a4dea5c5c915e31978a475107c17c458d">http://git.postgresql.org/pg/commitdiff/68dba97a4dea5c5c915e31978a475107c17c458d</a></li>
<li>Doc: clarify behavior of OT_WHOLE_LINE and OT_FILEPIPE psql slash commands. This is another bit of ancient behavior that was documented poorly (in a couple of cases) or not at all (in several others). Discussion: <a target="_blank" href="https://postgr.es/m/9b4ea968-753f-4b5f-b46c-d7d3bf7c8f90@manitou-mail.org">https://postgr.es/m/9b4ea968-753f-4b5f-b46c-d7d3bf7c8f90@manitou-mail.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ffac5998b4c18920f86d80f1bddbde9ebcf0a314">http://git.postgresql.org/pg/commitdiff/ffac5998b4c18920f86d80f1bddbde9ebcf0a314</a></li>
<li>Remove reinvention of stringify macro. We already have CppAsString2, there's no need for the MSVC support to re-invent a macro to do that (and especially not to inject it in as ugly a way as this). Discussion: <a target="_blank" href="https://postgr.es/m/CADkLM=c+hm2rc0tkKgC-ZgrLttHT2KkfppE+BC-=i-xj+7V-TQ@mail.gmail.com">https://postgr.es/m/CADkLM=c+hm2rc0tkKgC-ZgrLttHT2KkfppE+BC-=i-xj+7V-TQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd6baed78150e107eb858dbd53ddf900dd429f50">http://git.postgresql.org/pg/commitdiff/cd6baed78150e107eb858dbd53ddf900dd429f50</a></li>
<li>Fix integer-overflow problems in interval comparison. When using integer timestamps, the interval-comparison functions tried to compute the overall magnitude of an interval as an int64 number of microseconds. As reported by Frazer McLean, this overflows for intervals exceeding about 296000 years, which is bad since we nominally allow intervals many times larger than that. That results in wrong comparison results, and possibly in corrupted btree indexes for columns containing such large interval values. To fix, compute the magnitude as int128 instead. Although some compilers have native support for int128 calculations, many don't, so create our own support functions that can do 128-bit addition and multiplication if the compiler support isn't there. These support functions are designed with an eye to allowing the int128 code paths in numeric.c to be rewritten for use on all platforms, although this patch doesn't do that, or even provide all the int128 primitives that will be needed for it. Back-patch as far as 9.4. Earlier releases did not guard against overflow of interval values at all (commit 146604ec4 fixed that), so it seems not very exciting to worry about overly-large intervals for them. Before 9.6, we did not assume that unreferenced "static inline" functions would not draw compiler warnings, so omit functions not directly referenced by timestamp.c, the only present consumer of int128.h. (We could have omitted these functions in HEAD too, but since they were written and debugged on the way to the present patch, and they look likely to be needed by numeric.c, let's keep them in HEAD.) I did not bother to try to prevent such warnings in a --disable-integer-datetimes build, though. Before 9.5, configure will never define HAVE_INT128, so the part of int128.h that exploits a native int128 implementation is dead code in the 9.4 branch. I didn't bother to remove it, thinking that keeping the file looking similar in different branches is more useful. In HEAD only, add a simple test harness for int128.h in src/tools/. In back branches, this does not change the float-timestamps code path. That's not subject to the same kind of overflow risk, since it computes the interval magnitude as float8. (No doubt, when this code was originally written, overflow was disregarded for exactly that reason.) There is a precision hazard instead :-(, but we'll avert our eyes from that question, since no complaints have been reported and that code's deprecated anyway. Kyotaro Horiguchi and Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/1490104629.422698.918452336.26FA96B7@webmail.messagingengine.com">https://postgr.es/m/1490104629.422698.918452336.26FA96B7@webmail.messagingengine.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/df1a699e5ba3232f373790b2c9485ddf720c4a70">http://git.postgresql.org/pg/commitdiff/df1a699e5ba3232f373790b2c9485ddf720c4a70</a></li>
<li>Clean up psql/describe.c's messy query for extended stats. Remove unnecessary casts, safely schema-qualify the ones that remain, lose an unnecessary level of sub-SELECT, reformat for tidiness. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/20c95f27e736837b4af6bef998cb9408d1ad902e">http://git.postgresql.org/pg/commitdiff/20c95f27e736837b4af6bef998cb9408d1ad902e</a></li>
<li>Clean up after insufficiently-researched optimization of tuple conversions. tupconvert.c's functions formerly considered that an explicit tuple conversion was necessary if the input and output tupdescs contained different type OIDs. The point of that was to make sure that a composite datum resulting from the conversion would contain the destination rowtype OID in its composite-datum header. However, commit 3838074f8 entirely misunderstood what that check was for, thinking that it had something to do with presence or absence of an OID column within the tuple. Removal of the check broke the no-op conversion path in ExecEvalConvertRowtype, as reported by Ashutosh Bapat. It turns out that of the dozen or so call sites for tupconvert.c functions, ExecEvalConvertRowtype is the only one that cares about the composite-datum header fields in the output tuple. In all the rest, we'd much rather avoid an unnecessary conversion whenever the tuples are physically compatible. Moreover, the comments in tupconvert.c only promise physical compatibility not a metadata match. So, let's accept the removal of the guarantee about the output tuple's rowtype marking, recognizing that this is a API change that could conceivably break third-party callers of tupconvert.c. (So, let's remember to mention it in the v10 release notes.) However, commit 3838074f8 did have a bit of a point here, in that two tuples mustn't be considered physically compatible if one has HEAP_HASOID set and the other doesn't. (Some of the callers of tupconvert.c might not really care about that, but we can't assume it in general.) The previous check accidentally covered that issue, because no RECORD types ever have OIDs, while if two tupdescs have the same named composite type OID then, a fortiori, they have the same tdhasoid setting. If we're removing the type OID match check then we'd better include tdhasoid match as part of the physical compatibility check. Without that hack in tupconvert.c, we need ExecEvalConvertRowtype to take responsibility for inserting the correct rowtype OID label whenever tupconvert.c decides it need not do anything. This is easily done with heap_copy_tuple_as_datum, which will be considerably faster than a tuple disassembly and reassembly anyway; so from a performance standpoint this change is a win all around compared to what happened in earlier branches. It just means a couple more lines of code in ExecEvalConvertRowtype. Ashutosh Bapat and Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/CAFjFpRfvHABV6+oVvGcshF8rHn+1LfRUhj7Jz1CDZ4gPUwehBg@mail.gmail.com">https://postgr.es/m/CAFjFpRfvHABV6+oVvGcshF8rHn+1LfRUhj7Jz1CDZ4gPUwehBg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3f902354b08ac788600f0ae54fcbfc1d4e3ea765">http://git.postgresql.org/pg/commitdiff/3f902354b08ac788600f0ae54fcbfc1d4e3ea765</a></li>
<li>Fix planner error (or assert trap) with nested set operations. As reported by Sean Johnston in bug #14614, since 9.6 the planner can fail due to trying to look up the referent of a Var with varno 0. This happens because we generate such Vars in generate_append_tlist, for lack of any better way to describe the output of a SetOp node. In typical situations nothing really cares about that, but given nested set-operation queries we will call estimate_num_groups on the output of the subquery, and that wants to know what a Var actually refers to. That logic used to look at subquery-&gt;targetList, but in commit 3fc6e2d7f I'd switched it to look at subroot-&gt;processed_tlist, ie the actual output of the subquery plan not the parser's idea of the result. It seemed like a good idea at the time :-(. As a band-aid fix, change it back. Really we ought to have an honest way of naming the outputs of SetOp steps, which suggests that it'd be a good idea for the parser to emit an RTE corresponding to each one. But that's a task for another day, and it certainly wouldn't yield a back-patchable fix. Report: <a target="_blank" href="https://postgr.es/m/20170407115808.25934.51866@wrigleys.postgresql.org">https://postgr.es/m/20170407115808.25934.51866@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/89deca582a345b9c423bed8ebcf24b6ee81a9953">http://git.postgresql.org/pg/commitdiff/89deca582a345b9c423bed8ebcf24b6ee81a9953</a></li>
<li>Ensure that ExecPrepareExprList's result is all in one memory context. Noted by Amit Langote. Discussion: <a target="_blank" href="https://postgr.es/m/aad31672-4983-d95d-d24e-6b42fee9b985@lab.ntt.co.jp">https://postgr.es/m/aad31672-4983-d95d-d24e-6b42fee9b985@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dbb2a931478a397a2b655eb77e8be8c1ca136f63">http://git.postgresql.org/pg/commitdiff/dbb2a931478a397a2b655eb77e8be8c1ca136f63</a></li>
<li>Optimize joins when the inner relation can be proven unique. If there can certainly be no more than one matching inner row for a given outer row, then the executor can move on to the next outer row as soon as it's found one match; there's no need to continue scanning the inner relation for this outer row. This saves useless scanning in nestloop and hash joins. In merge joins, it offers the opportunity to skip mark/restore processing, because we know we have not advanced past the first possible match for the next outer row. Of course, the devil is in the details: the proof of uniqueness must depend only on joinquals (not otherquals), and if we want to skip mergejoin mark/restore then it must depend only on merge clauses. To avoid adding more planning overhead than absolutely necessary, the present patch errs in the conservative direction: there are cases where inner_unique or skip_mark_restore processing could be used, but it will not do so because it's not sure that the uniqueness proof depended only on "safe" clauses. This could be improved later. David Rowley, reviewed and rather heavily editorialized on by me Discussion: <a target="_blank" href="https://postgr.es/m/CAApHDvqF6Sw-TK98bW48TdtFJ+3a7D2mFyZ7++=D-RyPsL76gw@mail.gmail.com">https://postgr.es/m/CAApHDvqF6Sw-TK98bW48TdtFJ+3a7D2mFyZ7++=D-RyPsL76gw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9c7f5229ad68d7e0e4dd149e3f80257893e404d4">http://git.postgresql.org/pg/commitdiff/9c7f5229ad68d7e0e4dd149e3f80257893e404d4</a></li>
<li>Add newly-symlinked files to "make clean" target. Oversight in 60f11b87a. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aba696d1af9a267eee85d69845c3cdeccf788525">http://git.postgresql.org/pg/commitdiff/aba696d1af9a267eee85d69845c3cdeccf788525</a></li>
<li>Clean up bugs in clause_selectivity() cleanup. Commit ac2b09508 was not terribly carefully reviewed. Band-aid it to not fail on non-RestrictInfo input, per report from Andreas Seltenreich. Also make it do something more reasonable with variable-free clauses, and improve nearby comments. Discussion: <a target="_blank" href="https://postgr.es/m/87inmf5rdx.fsf@credativ.de">https://postgr.es/m/87inmf5rdx.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/eef8c0069e4d5eea2e52965ce3eb018b5a594fd6">http://git.postgresql.org/pg/commitdiff/eef8c0069e4d5eea2e52965ce3eb018b5a594fd6</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>doc: Change xref style to number only. Change the style of links generated by xrefs to section number only, as it was with DSSSL, instead of number and title, as is the default of the XSLT stylesheets. Our documentation is mostly written expecting the old style, so keep that for the time being, per discussion. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/70da87d334ebe14fbbefe98827df5a8e1400444e">http://git.postgresql.org/pg/commitdiff/70da87d334ebe14fbbefe98827df5a8e1400444e</a></li>
<li>Handle change of slot name in logical replication apply. Since change of slot name is a supported operation, handle it more gracefully, instead of in the this-should-not-happen way. Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1116108c926820030bd18b5dbff9163c14e3ad6d">http://git.postgresql.org/pg/commitdiff/1116108c926820030bd18b5dbff9163c14e3ad6d</a></li>
<li>Fix whitespace. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8df9994bc3372fc54214932bfa3a5caa05783ffa">http://git.postgresql.org/pg/commitdiff/8df9994bc3372fc54214932bfa3a5caa05783ffa</a></li>
<li>Make header self-contained. Add necessary include files for things used in the header. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9fa6e08d4a16f9b0461743cff35781e16308c106">http://git.postgresql.org/pg/commitdiff/9fa6e08d4a16f9b0461743cff35781e16308c106</a></li>
<li>Fix remote position tracking in logical replication. We need to set the origin remote position to end_lsn, not commit_lsn, as commit_lsn is the start of commit record, and we use the origin remote position as start position when restarting replication stream. If we'd use commit_lsn, we could request data that we already received from the remote server after a crash of a downstream server. Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fe7bbc4ddb82c635ef08b5eadc5ce472ad515996">http://git.postgresql.org/pg/commitdiff/fe7bbc4ddb82c635ef08b5eadc5ce472ad515996</a></li>
<li>psql: Add some missing tab completion. Add tab completion for COMMENT/SECURITY LABEL ON PUBLICATION/SUBSCRIPTION. Reported-by: Stephen Frost &lt;sfrost@snowman.net&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/553c3bef4cb47bdacb65b87c5460a2775f535a2b">http://git.postgresql.org/pg/commitdiff/553c3bef4cb47bdacb65b87c5460a2775f535a2b</a></li>
<li>Fix typo. Author: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d1f103c7396b667e64141412a8a0d12a2eef2930">http://git.postgresql.org/pg/commitdiff/d1f103c7396b667e64141412a8a0d12a2eef2930</a></li>
<li>Adjust min/max values when changing sequence type. When changing the type of a sequence, adjust the min/max values of the sequence if it looks like the previous values were the default values. Previously, it would leave the old values in place, requiring manual adjustments even in the usual/default cases. Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; Reviewed-by: Vitaly Burovoy &lt;vitaly.burovoy@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/60a0b2ec8943451186dfa22907f88334d97cb2e0">http://git.postgresql.org/pg/commitdiff/60a0b2ec8943451186dfa22907f88334d97cb2e0</a></li>
<li>pageinspect: Add bt_page_items function with bytea argument. Author: Tomas Vondra &lt;tomas.vondra@2ndquadrant.com&gt; Reviewed-by: Ashutosh Sharma &lt;ashu.coek88@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/193f5f9e913f3ead6609cc99be82578e0dedd409">http://git.postgresql.org/pg/commitdiff/193f5f9e913f3ead6609cc99be82578e0dedd409</a></li>
<li>Capitalize names of PLs consistently. Author: Daniel Gustafsson &lt;daniel@yesql.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/afd79873a0b151bfbe5312acebfe361da09c11fd">http://git.postgresql.org/pg/commitdiff/afd79873a0b151bfbe5312acebfe361da09c11fd</a></li>
<li>dblink: Small code rearrangement for clarity. suggested by Tom Lane <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e59b74a3fc524a658172d9ec9f1728da89136bce">http://git.postgresql.org/pg/commitdiff/e59b74a3fc524a658172d9ec9f1728da89136bce</a></li>
<li>doc: Remove remark elements. They were not rendered with DSSSL, but now they show up by default using XSLT. Just remove them, since they are not useful. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/63e5d02af33414ab31d0d59e02333083ac696d37">http://git.postgresql.org/pg/commitdiff/63e5d02af33414ab31d0d59e02333083ac696d37</a></li>
<li>Use American English in error message. All error messages use the American English spelling of recognize, apply to the single one not doing so to be consistent. Author: Daniel Gustafsson &lt;daniel@yesql.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6785fbd60ffd82ef825baf6db34bd944f3c7b121">http://git.postgresql.org/pg/commitdiff/6785fbd60ffd82ef825baf6db34bd944f3c7b121</a></li>
<li>Fix compiler warning and add some more comments. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dc0400cc501ebe839c15a387911945d1585e4787">http://git.postgresql.org/pg/commitdiff/dc0400cc501ebe839c15a387911945d1585e4787</a></li>
<li>Fix AclResult vs bool type mix-up. Using AclResult as a bool or vice versa works by accident, but it's unusual and possibly confusing style, so write it out more explicitly. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/301ca0d9a2f82ade11b2e5039d348badd28334cf">http://git.postgresql.org/pg/commitdiff/301ca0d9a2f82ade11b2e5039d348badd28334cf</a></li>
<li>doc: Formatting fix for XSL-FO PDF build. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a071fe87a21920e5c2e79d521d31b2ddaf83875b">http://git.postgresql.org/pg/commitdiff/a071fe87a21920e5c2e79d521d31b2ddaf83875b</a></li>
<li>Fix mixup of bool and ternary value. Not currently a problem, but could be with stricter bool behavior under stdbool or C++. Reviewed-by: Andres Freund &lt;andres@anarazel.de&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e6c9a5a9bcc9774e6a29cf9cea489b42f492e019">http://git.postgresql.org/pg/commitdiff/e6c9a5a9bcc9774e6a29cf9cea489b42f492e019</a></li>
<li>pg_dump: Rename some typedefs to avoid name conflicts. In struct _archiveHandle, some of the fields have the same name as a typedef. This is kind of confusing, so rename the types so they have names distinct from the struct fields. In C++, the previous coding changes the meaning of the typedef in the scope of the struct, causing warnings and possibly other problems. Reviewed-by: Andres Freund &lt;andres@anarazel.de&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4be613f692b8f474d5766627a636e7f838131587">http://git.postgresql.org/pg/commitdiff/4be613f692b8f474d5766627a636e7f838131587</a></li>
<li>Mark immutable functions in information schema as parallel safe. Also add opr_sanity check that all preloaded immutable functions are parallel safe. (Per discussion, this does not necessarily have to be true for all possible such functions, but deviations would be unlikely enough that maintaining such a test is reasonable.) Reported-by: David Rowley &lt;david.rowley@2ndquadrant.com&gt; Reviewed-by: Robert Haas &lt;robertmhaas@gmail.com&gt; Reviewed-by: Tom Lane &lt;tgl@sss.pgh.pa.us&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5f21f5292c0856536ac0724974a8bc6b296b9ef6">http://git.postgresql.org/pg/commitdiff/5f21f5292c0856536ac0724974a8bc6b296b9ef6</a></li>
<li>Fix logical replication between different encodings. When sending a tuple attribute, the previous coding erroneously sent the length byte before encoding conversion, which would lead to protocol failures on the receiving side if the length did not match the following string. To fix that, use pq_sendcountedtext() for sending tuple attributes, which takes care of all of that internally. To match the API of pq_sendcountedtext(), send even text values without a trailing zero byte and have the receiving end put it in place instead. This matches how the standard FE/BE protocol behaves. Reported-by: Kyotaro HORIGUCHI &lt;horiguchi.kyotaro@lab.ntt.co.jp&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6f1b9aaae35bfabe2654a8e44ce226c91e7d8bd9">http://git.postgresql.org/pg/commitdiff/6f1b9aaae35bfabe2654a8e44ce226c91e7d8bd9</a></li>
<li>Remove use of Jade and DSSSL. All documentation is now built using XSLT. Remove all references to Jade, DSSSL, also JadeTex and some other outdated tooling. For chunked HTML builds, this changes nothing, but removes the transitional "oldhtml" target. The single-page HTML build is ported over to XSLT. For PDF builds, this removes the JadeTex builds and moves the FOP builds in their place. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/510074f9f0131a04322d6a3d2a51c87e6db243f9">http://git.postgresql.org/pg/commitdiff/510074f9f0131a04322d6a3d2a51c87e6db243f9</a></li>
<li>Avoid using a C++ keyword in header file. per cpluspluscheck <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0cb2e51992a7940f9e577a74da250508aedcecf7">http://git.postgresql.org/pg/commitdiff/0cb2e51992a7940f9e577a74da250508aedcecf7</a></li>
<li>Fix compiler warning on MSVC 2010. Author: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/28afad5c85b436f19d9f2c0e3197c7db960fef6f">http://git.postgresql.org/pg/commitdiff/28afad5c85b436f19d9f2c0e3197c7db960fef6f</a></li>
<li>Identity columns. This is the SQL standard-conforming variant of PostgreSQL's serial columns. It fixes a few usability issues that serial columns have: * CREATE TABLE / LIKE copies default but refers to same sequence * cannot add/drop serialness with ALTER TABLE * dropping default does not drop sequence * need to grant separate privileges to sequence * other slight weirdnesses because serial is some kind of special macro. Reviewed-by: Vitaly Burovoy &lt;vitaly.burovoy@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3217327053638085d24dd4d276e7c1f7ac2c4c6b">http://git.postgresql.org/pg/commitdiff/3217327053638085d24dd4d276e7c1f7ac2c4c6b</a></li>
<li>doc: Add SPFLAGS to osx calls. This enables the same OpenSP warnings on osx calls that we get from onsgmls (make check) and formerly from openjade. Older tool chains apparently have some of these warnings on by default (see comment at SPFLAGS assignment). So users of such tool chains would complain about warnings or errors that users of newer tool chains would not see, unless they used "make check". <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/453aaf76880b42eb5f205933d2422fe7c773b06f">http://git.postgresql.org/pg/commitdiff/453aaf76880b42eb5f205933d2422fe7c773b06f</a></li>
<li>doc: Add missing closing tag. Author: Erik Rijkers &lt;er@xs4all.nl&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/234811c21de4246e347e8369328bcaf706a35281">http://git.postgresql.org/pg/commitdiff/234811c21de4246e347e8369328bcaf706a35281</a></li>
<li>doc: Add some markup. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f0e44021dfbdd37cb72aea71e3b3cf8b0397f9c5">http://git.postgresql.org/pg/commitdiff/f0e44021dfbdd37cb72aea71e3b3cf8b0397f9c5</a></li>
</ul>
<p>Andrew Gierth pushed:</p>
<ul>
<li>Try and silence spurious Coverity warning. gset_data (aka gd) in planner.c is always non-null if and only if parse-&gt;groupingSets is non-null, but Coverity doesn't know that and complains. Feed it an assertion to see if that keeps it happy. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f5780935266bd72951c770396f9267366414d1b9">http://git.postgresql.org/pg/commitdiff/f5780935266bd72951c770396f9267366414d1b9</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Properly acquire buffer lock for page-at-a-time hash vacuum. In a couple of places, _hash_kill_items was mistakenly called with the buffer lock not held. Repair. Ashutosh Sharma, per a report from Andreas Seltenreich Discussion: <a target="_blank" href="http://postgr.es/m/87o9wo8o0j.fsf@credativ.de">http://postgr.es/m/87o9wo8o0j.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/93cd7684ee2bba227fa371daa81b88f25456dcb2">http://git.postgresql.org/pg/commitdiff/93cd7684ee2bba227fa371daa81b88f25456dcb2</a></li>
<li>Abstract logic to allow for multiple kinds of child rels. Currently, the only type of child relation is an "other member rel", which is the child of a baserel, but in the future joins and even upper relations may have child rels. To facilitate that, introduce macros that test to test for particular RelOptKind values, and use them in various places where they help to clarify the sense of a test. (For example, a test may allow RELOPT_OTHER_MEMBER_REL either because it intends to allow child rels, or because it intends to allow simple rels.) Also, remove find_childrel_top_parent, which will not work for a child rel that is not a baserel. Instead, add a new RelOptInfo member top_parent_relids to track the same kind of information in a more generic manner. Ashutosh Bapat, slightly tweaked by me. Review and testing of the patch set from which this was taken by Rajkumar Raghuwanshi and Rafia Sabih. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoagTnF2yqR3PT2rv=om=wJiZ4-A+ATwdnriTGku1CLYxA@mail.gmail.com">http://postgr.es/m/CA+TgmoagTnF2yqR3PT2rv=om=wJiZ4-A+ATwdnriTGku1CLYxA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7a39b5e4d11229ece930a51fd7cb29e535db4494">http://git.postgresql.org/pg/commitdiff/7a39b5e4d11229ece930a51fd7cb29e535db4494</a></li>
<li>Update comment. Craig Ringer, reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c8b5c3cb06addfb11d38a85fd8ac7efabb56e811">http://git.postgresql.org/pg/commitdiff/c8b5c3cb06addfb11d38a85fd8ac7efabb56e811</a></li>
<li>Print new RelOptInfo field top_parent_relids in outfuncs.c. I intended to include this adjustment in the previous commit (7a39b5e4d11229ece930a51fd7cb29e535db44940) but messed up. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7cdf6668cf37f48808604906882f6131d3fef251">http://git.postgresql.org/pg/commitdiff/7cdf6668cf37f48808604906882f6131d3fef251</a></li>
<li>Further corrections and improvements to partitioning documentation. Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/80f6b049-e882-f6c3-f82c-f44baa94d369@lab.ntt.co.jp">http://postgr.es/m/80f6b049-e882-f6c3-f82c-f44baa94d369@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/334bf9c77d0630c65d83f59b42b007cf9523cacf">http://git.postgresql.org/pg/commitdiff/334bf9c77d0630c65d83f59b42b007cf9523cacf</a></li>
<li>Expand hash indexes more gradually. Since hash indexes typically have very few overflow pages, adding a new splitpoint essentially doubles the on-disk size of the index, which can lead to large and abrupt increases in disk usage (and perhaps long delays on occasion). To mitigate this problem to some degree, divide larger splitpoints into four equal phases. This means that, for example, instead of growing from 4GB to 8GB all at once, a hash index will now grow from 4GB to 5GB to 6GB to 7GB to 8GB, which is perhaps still not as smooth as we'd like but certainly an improvement. This changes the on-disk format of the metapage, so bump HASH_VERSION from 2 to 3. This will force a REINDEX of all existing hash indexes, but that's probably a good idea anyway. First, hash indexes from pre-10 versions of PostgreSQL could easily be corrupted, and we don't want to confuse corruption carried over from an older release with any corruption caused despite the new write-ahead logging in v10. Second, it will let us remove some backward-compatibility code added by commit 293e24e507838733aba4748b514536af2d39d7f2. Mithun Cy, reviewed by Amit Kapila, Jesper Pedersen and me. Regression test outputs updated by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAD__OuhG6F1gQLCgMQNnMNgoCvOLQZz9zKYJQNYvYmmJoM42gA@mail.gmail.com">http://postgr.es/m/CAD__OuhG6F1gQLCgMQNnMNgoCvOLQZz9zKYJQNYvYmmJoM42gA@mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYty0jCf-pa+m+vYUJ716+AxM7nv_syvyanyf5O-L_i2A@mail.gmail.com">http://postgr.es/m/CA+TgmoYty0jCf-pa+m+vYUJ716+AxM7nv_syvyanyf5O-L_i2A@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ea69a0dead5128c421140dc53fac165ba4af8520">http://git.postgresql.org/pg/commitdiff/ea69a0dead5128c421140dc53fac165ba4af8520</a></li>
<li>Fix formula in _hash_spareindex. This was correct in earlier versions of the patch that lead to commit ea69a0dead5128c421140dc53fac165ba4af8520, but somehow got broken in the last version which I actually committed. Mithun Cy, per an off-list report from Ashutosh Sharma Discussion: <a target="_blank" href="http://postgr.es/m/CAD__OujbAwNU71v1y-RoQxZ8LZ6-V2UFTkex3v34MK6uZ3Xb5w@mail.gmail.com">http://postgr.es/m/CAD__OujbAwNU71v1y-RoQxZ8LZ6-V2UFTkex3v34MK6uZ3Xb5w@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b38006ef6d1ba2f56cc4962ed17956b74c9fa0c4">http://git.postgresql.org/pg/commitdiff/b38006ef6d1ba2f56cc4962ed17956b74c9fa0c4</a></li>
<li>Fix thinko in BitmapAdjustPrefetchIterator. Dilip Kumar Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-uKAvRhWprb0i-U9zFOekgQRRwqjP1wvOBsKZb-UEKbug@mail.gmail.com">http://postgr.es/m/CAFiTN-uKAvRhWprb0i-U9zFOekgQRRwqjP1wvOBsKZb-UEKbug@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a9a7949134189c29a9b38ac7394c53849684fe4d">http://git.postgresql.org/pg/commitdiff/a9a7949134189c29a9b38ac7394c53849684fe4d</a></li>
<li>hash: Fix write-ahead logging bug. The size of the data is not the same thing as the size of the size of the data. Reported off-list by Tushar Ahuja. Fix by Ashutosh Sharma, reviewed by Amit Kapila. Discussion: <a target="_blank" href="http://postgr.es/m/CAE9k0PnmPDXfvf8HDObme7q_Ewc4E26ukHXUBPySoOs0ObqqaQ@mail.gmail.com">http://postgr.es/m/CAE9k0PnmPDXfvf8HDObme7q_Ewc4E26ukHXUBPySoOs0ObqqaQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/75a1cbdc3cfca1e815da6dfa5d7e96d82a6b0725">http://git.postgresql.org/pg/commitdiff/75a1cbdc3cfca1e815da6dfa5d7e96d82a6b0725</a></li>
<li>Fix pageinspect failures on hash indexes. Make every page in a hash index which isn't all-zeroes have a valid special space, so that tools like pageinspect don't error out. Also, make pageinspect cope with all-zeroes pages, because _hash_alloc_buckets can leave behind large numbers of those until they're consumed by splits. Ashutosh Sharma and Robert Haas, reviewed by Amit Kapila. Original trouble report from Jeff Janes. Discussion: <a target="_blank" href="http://postgr.es/m/CAMkU=1y6NjKmqbJ8wLMhr=F74WzcMALYWcVFhEpm7i=mV=XsOg@mail.gmail.com">http://postgr.es/m/CAMkU=1y6NjKmqbJ8wLMhr=F74WzcMALYWcVFhEpm7i=mV=XsOg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/633e15ea0f1bf2e1d70441fe9da8781befebd6e9">http://git.postgresql.org/pg/commitdiff/633e15ea0f1bf2e1d70441fe9da8781befebd6e9</a></li>
<li>Add ProcArrayGroupUpdate wait event. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmobgWHcXDcChX2+BqJDk2dkPVF85ZrJFhUyHHQmw8diTpA@mail.gmail.com">http://postgr.es/m/CA+TgmobgWHcXDcChX2+BqJDk2dkPVF85ZrJFhUyHHQmw8diTpA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d4116a771925379c33cf4c6634ca620ed08b551d">http://git.postgresql.org/pg/commitdiff/d4116a771925379c33cf4c6634ca620ed08b551d</a></li>
<li>Use English, instead of internal names, for translatable messages. Discussion: <a target="_blank" href="http://postgr.es/m/CA+Tgmobuz2C-YiQ87h8h0gECCV=F+SE=HBNaAU75rR5FEwtEhQ@mail.gmail.com">http://postgr.es/m/CA+Tgmobuz2C-YiQ87h8h0gECCV=F+SE=HBNaAU75rR5FEwtEhQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5c4488478b182983f290a61fc8cf2ec83548622b">http://git.postgresql.org/pg/commitdiff/5c4488478b182983f290a61fc8cf2ec83548622b</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Remove --verbose from PROVE_FLAGS. Per discussion, the TAP tests are really more verbose than necessary, so remove the --verbose flag from PROVE_FLAGS. Also add comments to let folks know how they can enable it if they really wish to, as suggested by Craig Ringer. Author: Michael Paquier, additional comments by me. Discussion: <a target="_blank" href="https://postgr.es/m/CAMsr%2BYGAzcMDOZ_BirnMCL6Sb%3DMUjP0FRE82YBDSbXcf6pm9Yg%40mail.gmail.com">https://postgr.es/m/CAMsr%2BYGAzcMDOZ_BirnMCL6Sb%3DMUjP0FRE82YBDSbXcf6pm9Yg%40mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e9c81b6016f431af808e4c08191e7aecf034dc80">http://git.postgresql.org/pg/commitdiff/e9c81b6016f431af808e4c08191e7aecf034dc80</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Speedup 2PC recovery by skipping two phase state files in normal path. 2PC state info held in shmem at PREPARE, then cleaned at COMMIT PREPARED/ABORT PREPARED, avoiding writing/fsyncing any state information to disk in the normal path, greatly enhancing replay speed. Prepared transactions that live past one checkpoint redo horizon will be written to disk as now. Similar conceptually to 978b2f65aa1262eb4ecbf8b3785cb1b9cf4db78e and building upon the infrastructure created by that commit. Authors, in equal measure: Stas Kelvich, Nikhil Sontakke and Michael Paquier Discussion: <a target="_blank" href="https://postgr.es/m/CAMGcDxf8Bn9ZPBBJZba9wiyQq-Qk5uqq=VjoMnRnW5s+fKST3w@mail.gmail.com">https://postgr.es/m/CAMGcDxf8Bn9ZPBBJZba9wiyQq-Qk5uqq=VjoMnRnW5s+fKST3w@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/728bd991c3c4389fb39c45dcb0fe57e4a1dccd71">http://git.postgresql.org/pg/commitdiff/728bd991c3c4389fb39c45dcb0fe57e4a1dccd71</a></li>
<li>Fix uninitialized variables in twophase.c. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd740c0dbfb3038eea2e921e82e2f5345d0718c5">http://git.postgresql.org/pg/commitdiff/cd740c0dbfb3038eea2e921e82e2f5345d0718c5</a></li>
<li>Make min_wal_size/max_wal_size use MB internally. Previously they were defined using multiples of XLogSegSize. Remove GUC_UNIT_XSEGS. Introduce GUC_UNIT_MB Extracted from patch series on XLogSegSize infrastructure. Beena Emerson <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9a3215026bd6955e88bd8c20542cfe6acffdb1c8">http://git.postgresql.org/pg/commitdiff/9a3215026bd6955e88bd8c20542cfe6acffdb1c8</a></li>
<li>Spelling mistake in comment in utility.c. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ed770c325ca374fee7b3b66f5cb29af1a73a1743">http://git.postgresql.org/pg/commitdiff/ed770c325ca374fee7b3b66f5cb29af1a73a1743</a></li>
<li>Allow --with-wal-segsize=n up to n=1024MB. Other part of Beena Emerson's patch to allow testing <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/00b6b6feb12cef53737287b67ecef6aff1f1d8ab">http://git.postgresql.org/pg/commitdiff/00b6b6feb12cef53737287b67ecef6aff1f1d8ab</a></li>
<li>Collect and use multi-column dependency stats. Follow on patch in the multi-variate statistics patch series. CREATE STATISTICS s1 WITH (dependencies) ON (a, b) FROM t; ANALYZE; will collect dependency stats on (a, b) and then use the measured dependency in subsequent query planning. Commit 7b504eb282ca2f5104b5c00b4f05a3ef6bb1385b added CREATE STATISTICS with n-distinct coefficients. These are now specified using the mutually exclusive option WITH (ndistinct). Author: Tomas Vondra, David Rowley Reviewed-by: Kyotaro HORIGUCHI, &Aacute;lvaro Herrera, Dean Rasheed, Robert Haas and many other comments and contributions Discussion: <a target="_blank" href="https://postgr.es/m/56f40b20-c464-fad2-ff39-06b668fac47c@2ndquadrant.com">https://postgr.es/m/56f40b20-c464-fad2-ff39-06b668fac47c@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2686ee1b7ccfb9214064d4d2a98ea77382880306">http://git.postgresql.org/pg/commitdiff/2686ee1b7ccfb9214064d4d2a98ea77382880306</a></li>
<li>Reduce lock level for CREATE STATISTICS. In line with other lock reductions related to planning. Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/68ea2b7f9b52d35b5fcd9c8d44d88de5a64be3ba">http://git.postgresql.org/pg/commitdiff/68ea2b7f9b52d35b5fcd9c8d44d88de5a64be3ba</a></li>
<li>Avoid SnapshotResetXmin() during AtEOXact_Snapshot(). For normal commits and aborts we already reset PgXact-&gt;xmin, so we can simply avoid running SnapshotResetXmin() twice. During performance tests by Alexander Korotkov, diagnosis by Andres Freund showed PgXact array as a bottleneck. After manual analysis by me of the code paths that touch those memory locations, I was able to identify extraneous code in the main transaction commit path. Avoiding touching highly contented shmem improves concurrent performance slightly on all workloads, confirmed by tests run by Ashutosh Sharma and Alexander Korotkov. Simon Riggs Discussion: CANP8+jJdXE9b+b9F8CQT-LuxxO0PBCB-SZFfMVAdp+akqo4zfg@mail.gmail.com <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6bad580d9e678a0b604883e14d8401d469b06566">http://git.postgresql.org/pg/commitdiff/6bad580d9e678a0b604883e14d8401d469b06566</a></li>
<li>Always SnapshotResetXmin() during ClearTransaction(). Avoid corner cases during 2PC with 6bad580d9e678a0b604883e14d8401d469b06566 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd0cebaf7d1ab04427d4045edf7121a8f3753d8b">http://git.postgresql.org/pg/commitdiff/cd0cebaf7d1ab04427d4045edf7121a8f3753d8b</a></li>
<li>Reset API of clause_selectivity(). Discussion: <a target="_blank" href="https://postgr.es/m/CAKJS1f9yurJQW9pdnzL+rmOtsp2vOytkpXKGnMFJEO-qz5O5eA@mail.gmail.com">https://postgr.es/m/CAKJS1f9yurJQW9pdnzL+rmOtsp2vOytkpXKGnMFJEO-qz5O5eA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ac2b09508834c9d6b7ec9467e876213b0304c792">http://git.postgresql.org/pg/commitdiff/ac2b09508834c9d6b7ec9467e876213b0304c792</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Clarify documentation of to_tsvector(json(b)). Per gripe from Sven R. Kunze <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e75a78656bcaa3faff6b85891ca69d45dd21023f">http://git.postgresql.org/pg/commitdiff/e75a78656bcaa3faff6b85891ca69d45dd21023f</a></li>
<li>Make json_populate_record and friends operate recursively. With this change array fields are populated from json(b) arrays, and composite fields are populated from json(b) objects. Along the way, some significant code refactoring is done to remove redundancy in the way to populate_record[_set] and to_record[_set] functions operate, and some significant efficiency gains are made by caching tuple descriptors. Nikita Glukhov, edited some by me. Reviewed by Aleksander Alekseev and Tom Lane. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cf35346e813e5a1373f308d397bb0a8f3f21d530">http://git.postgresql.org/pg/commitdiff/cf35346e813e5a1373f308d397bb0a8f3f21d530</a></li>
<li>Remove extraneous comma to satisfy picky compiler. per buildfarm <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/88dd4e48315878263bcf27e0337daf2b3c1991b8">http://git.postgresql.org/pg/commitdiff/88dd4e48315878263bcf27e0337daf2b3c1991b8</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Force synchronous commit in new-ish test_decoding test. This was missed in a924c327 ff. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bae9b8016053c0a434690add7049a9216afef7e2">http://git.postgresql.org/pg/commitdiff/bae9b8016053c0a434690add7049a9216afef7e2</a></li>
<li>Fix two valgrind issues in slab allocator. During allocation VALGRIND_MAKE_MEM_DEFINED was called with a pointer as size. That kind of works, but makes valgrind exceedingly slow for workloads involving the slab allocator. Secondly there was an access to memory marked as unreachable within SlabCheck(). Fix that too. Author: Tomas Vondra Discussion: <a target="_blank" href="https://postgr.es/m/a6543b6d-6015-99b1-63ef-3ed55a76a730@2ndquadrant.com">https://postgr.es/m/a6543b6d-6015-99b1-63ef-3ed55a76a730@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/490e9a98ff964df95311e2b5a68a15f63bce0cfd">http://git.postgresql.org/pg/commitdiff/490e9a98ff964df95311e2b5a68a15f63bce0cfd</a></li>
<li>Code review for recent slot.c changes. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5c21ad07cc06f00f96e9401209a7da839b326d3a">http://git.postgresql.org/pg/commitdiff/5c21ad07cc06f00f96e9401209a7da839b326d3a</a></li>
<li>Increase parallel bitmap scan test coverage. Author: Dilip Kumar Discussion: <a target="_blank" href="https://postgr.es/m/20170331184603.qcp7t4md5bzxbx32@alap3.anarazel.de">https://postgr.es/m/20170331184603.qcp7t4md5bzxbx32@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5a5931533edd2b70bde1f069609f58998dd26fef">http://git.postgresql.org/pg/commitdiff/5a5931533edd2b70bde1f069609f58998dd26fef</a></li>
<li>Add minimal test for EXPLAIN ANALYZE of parallel query. This displays the number of workers launched, thus the test is dependant on configuration to some degree. We'll see whether that turns out ot be a problem. Author: Rafia Sabih Discussion: <a target="_blank" href="https://postgr.es/m/20170331185540.zmsue4ndvqtnayqw@alap3.anarazel.de">https://postgr.es/m/20170331185540.zmsue4ndvqtnayqw@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b2ff37d43cc81348fd8e9d9c5fcc9dfadf790763">http://git.postgresql.org/pg/commitdiff/b2ff37d43cc81348fd8e9d9c5fcc9dfadf790763</a></li>
<li>Fix parallel bitmapscan tests on builds without USE_PREFETCH. This was broken in 5a5931533edd2. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d611517fc44ebbf7e0d563de6d4cd98fd342a762">http://git.postgresql.org/pg/commitdiff/d611517fc44ebbf7e0d563de6d4cd98fd342a762</a></li>
<li>Allow avoiding tuple copy within tuplesort_gettupleslot(). Add a "copy" argument to make it optional to receive a copy of caller tuple that is safe to use following a subsequent manipulating of tuplesort's state. This is a performance optimization. Most existing tuplesort_gettupleslot() callers are made to opt out of copying. Existing callers that happen to rely on the validity of tuple memory beyond subsequent manipulations of the tuplesort request their own copy. This brings tuplesort_gettupleslot() in line with tuplestore_gettupleslot(). In the future, a "copy" tuplesort_getdatum() argument may be added, that similarly allows callers to opt out of receiving their own copy of tuple. In passing, clarify assumptions that callers of other tuplesort fetch routines may make about tuple memory validity, per gripe from Tom Lane. Author: Peter Geoghegan Discussion: CAM3SWZQWZZ_N=DmmL7tKy_OUjGH_5mN=N=A6h7kHyyDvEhg2DA@mail.gmail.com <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fa117ee40330db401da776e7b003f047098a7d4c">http://git.postgresql.org/pg/commitdiff/fa117ee40330db401da776e7b003f047098a7d4c</a></li>
<li>Fix issues in e8fdbd58fe. When the 64bit atomics simulation is in use, we can't necessarily guarantee the correct alignment of the atomics due to lack of compiler support for doing so- that's fine from a safety perspective, because everything is protected by a lock, but we asserted the alignment in all cases. Weaken them. Per complaint from Alvaro Herrera. My #ifdefery for PG_HAVE_8BYTE_SINGLE_COPY_ATOMICITY wasn't sufficient. Fix that. Per complaint from Alexander Korotkov. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f13a9121f9822eafe05cc3178bf046155a248173">http://git.postgresql.org/pg/commitdiff/f13a9121f9822eafe05cc3178bf046155a248173</a></li>
<li>Improve 64bit atomics support. When adding atomics back in b64d92f1a, I added 64bit support as optional; there wasn't yet a direct user in sight. That turned out to be a bit short-sighted, it'd already have been useful a number of times. Add a fallback implementation of 64bit atomics, just like the one we have for 32bit atomics. Additionally optimize reads/writes to 64bit on a number of platforms where aligned writes of that size are atomic. This can now be tested with PG_HAVE_8BYTE_SINGLE_COPY_ATOMICITY. Author: Andres Freund Reviewed-By: Amit Kapila Discussion: <a target="_blank" href="https://postgr.es/m/20160330230914.GH13305@awork2.anarazel.de">https://postgr.es/m/20160330230914.GH13305@awork2.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e8fdbd58fe564a29977f4331cd26f9697d76fc40">http://git.postgresql.org/pg/commitdiff/e8fdbd58fe564a29977f4331cd26f9697d76fc40</a></li>
</ul>
<p>Kevin Grittner pushed:</p>
<ul>
<li>Follow-on cleanup for the transition table patch. Commit 59702716 added transition table support to PL/pgsql so that SQL queries in trigger functions could access those transient tables. In order to provide the same level of support for PL/perl, PL/python and PL/tcl, refactor the relevant code into a new function SPI_register_trigger_data. Call the new function in the trigger handler of all four PLs, and document it as a public SPI function so that authors of out-of-tree PLs can do the same. Also get rid of a second QueryEnvironment object that was maintained by PL/pgsql. That was previously used to deal with cursors, but the same approach wasn't appropriate for PLs that are less tangled up with core code. Instead, have SPI_cursor_open install the connection's current QueryEnvironment, as already happens for SPI_execute_plan. While in the docs, remove the note that transition tables were only supported in C and PL/pgSQL triggers, and correct some ommissions. Thomas Munro with some work by Kevin Grittner (mostly docs) <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5ebeb579b9b281dba5f8415b2fbda86fdae7b366">http://git.postgresql.org/pg/commitdiff/5ebeb579b9b281dba5f8415b2fbda86fdae7b366</a></li>
<li>Add isolation test for SERIALIZABLE READ ONLY DEFERRABLE. This improves code coverage and lays a foundation for testing similar issues in a distributed environment. Author: Thomas Munro &lt;thomas.munro@enterprisedb.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4deb413813f619b3e859abf435b61efc09cafe09">http://git.postgresql.org/pg/commitdiff/4deb413813f619b3e859abf435b61efc09cafe09</a></li>
<li>Fix the RTE_NAMEDTUPLESTORE case in get_rte_attribute_is_dropped(). Problems pointed out by Andres Freund and Thomas Munro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/255efa241f460ee4f4c4c98c8cdd7457807f3af9">http://git.postgresql.org/pg/commitdiff/255efa241f460ee4f4c4c98c8cdd7457807f3af9</a></li>
<li>Add GUCs for predicate lock promotion thresholds. Defaults match the fixed behavior of prior releases, but now DBAs have better options to tune serializable workloads. It might be nice to be able to set this per relation, but that part will need to wait for another release. Author: Dagfinn Ilmari Manns&aring;ker <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c63172d60f242ad3581c83723a5b315bbe547a0e">http://git.postgresql.org/pg/commitdiff/c63172d60f242ad3581c83723a5b315bbe547a0e</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Remove dead code and fix comments in fast-path function handling. HandleFunctionRequest() is no longer responsible for reading the protocol message from the client, since commit 2b3a8b20c2. Fix the outdated comments. HandleFunctionRequest() now always returns 0, because the code that used to return EOF was moved in 2b3a8b20c2. Therefore, the caller no longer needs to check the return value. Reported by Andres Freund. Backpatch to all supported versions, even though this doesn't have any user-visible effect, to make backporting future patches in this area easier. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20170405010525.rt5azbya5fkbhvrx@alap3.anarazel.de">https://www.postgresql.org/message-id/20170405010525.rt5azbya5fkbhvrx@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fd01983594b7d2119653428e3b532578008c7065">http://git.postgresql.org/pg/commitdiff/fd01983594b7d2119653428e3b532578008c7065</a></li>
<li>Remove bogus SCRAM_ITERATION_LEN constant. It was not used for what the comment claimed, at all. It was actually used as the 'base' argument to strtol(), when reading the iteration count. We don't need a constant for base-10, so remove it. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/07044efe00762bdd04c4d392adb8f6425b13369b">http://git.postgresql.org/pg/commitdiff/07044efe00762bdd04c4d392adb8f6425b13369b</a></li>
<li>Remove duplicate assignment. Harmless, but clearly wrong. Kyotaro Horiguchi <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0c732850d22a2dddb8a2ef64aed3c23731488caa">http://git.postgresql.org/pg/commitdiff/0c732850d22a2dddb8a2ef64aed3c23731488caa</a></li>
<li>Use SASLprep to normalize passwords for SCRAM authentication. An important step of SASLprep normalization, is to convert the string to Unicode normalization form NFKC. Unicode normalization requires a fairly large table of character decompositions, which is generated from data published by the Unicode consortium. The script to generate the table is put in src/common/unicode, as well test code for the normalization. A pre-generated version of the tables is included in src/include/common, so you don't need the code in src/common/unicode to build PostgreSQL, only if you wish to modify the normalization tables. The SASLprep implementation depends on the UTF-8 functions from src/backend/utils/mb/wchar.c. So to use it, you must also compile and link that. That doesn't change anything for the current users of these functions, the backend and libpq, as they both already link with wchar.o. It would be good to move those functions into a separate file in src/commmon, but I'll leave that for another day. No documentation changes included, because there is no details on the SCRAM mechanism in the docs anyway. An overview on that in the protocol specification would probably be good, even though SCRAM is documented in detail in RFC5802. I'll write that as a separate patch. An important thing to mention there is that we apply SASLprep even on invalid UTF-8 strings, to support other encodings. Patch by Michael Paquier and me. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqSByyEmAVLtEf1KxTRh=PWNKiWKEKQR=e1yGehz=wbymQ@mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqSByyEmAVLtEf1KxTRh=PWNKiWKEKQR=e1yGehz=wbymQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/60f11b87a2349985230c08616fa8a34ffde934c8">http://git.postgresql.org/pg/commitdiff/60f11b87a2349985230c08616fa8a34ffde934c8</a></li>
<li>Fix the new SASLprep tests to work with non-UTF-8 locales. Fix by forcing database encoding to UTF-8, regardless of the current locale. Pointed out by Tom Lane. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/8934.1491614631@sss.pgh.pa.us">https://www.postgresql.org/message-id/8934.1491614631@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9025af3ed039dd3bb9286b5af2fbdb29b9eb204e">http://git.postgresql.org/pg/commitdiff/9025af3ed039dd3bb9286b5af2fbdb29b9eb204e</a></li>
</ul>
<p>&Aacute;lvaro Herrera pushed:</p>
<ul>
<li>Comment fixes for extended statistics. Clean up some code comments in new extended statistics code, from 7b504eb282. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b1fc51a36ecdf854be9e41ffb99953c40ef96ccf">http://git.postgresql.org/pg/commitdiff/b1fc51a36ecdf854be9e41ffb99953c40ef96ccf</a></li>
<li>Fix BRIN cost estimation. The original code was overly optimistic about the cost of scanning a BRIN index, leading to BRIN indexes being selected when they'd be a worse choice than some other index. This complete rewrite should be more accurate. Author: David Rowley, based on an earlier patch by Emre Hasegeli Reviewed-by: Emre Hasegeli Discussion: <a target="_blank" href="https://postgr.es/m/CAKJS1f9n-Wapop5Xz1dtGdpdqmzeGqQK4sV2MK-zZugfC14Xtw@mail.gmail.com">https://postgr.es/m/CAKJS1f9n-Wapop5Xz1dtGdpdqmzeGqQK4sV2MK-zZugfC14Xtw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7e534adcdc70866e7be74d626b0ed067c890a251">http://git.postgresql.org/pg/commitdiff/7e534adcdc70866e7be74d626b0ed067c890a251</a></li>
<li>Fix new BRIN desummarize WAL record. The WAL-writing piece was forgetting to set the pages-per-range value. Also, fix the declared type of struct member heapBlk, which I mistakenly set as OffsetNumber rather than BlockNumber. Problem was introduced by commit c655899ba9ae (April 1st). Any system that tries to replay the new WAL record written before this fix is likely to die on replay and require pg_resetwal. Reported by Tom Lane. Discussion: <a target="_blank" href="https://postgr.es/m/20191.1491524824@sss.pgh.pa.us">https://postgr.es/m/20191.1491524824@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/817cb100136a15796cbd9e70f49d20625108d782">http://git.postgresql.org/pg/commitdiff/817cb100136a15796cbd9e70f49d20625108d782</a></li>
<li>Reduce the number of pallocs() in BRIN. Instead of allocating memory in brin_deform_tuple and brin_copy_tuple over and over during a scan, allow reuse of previously allocated memory. This is said to make for a measurable performance improvement. Author: Jinyu Zhang, &Aacute;lvaro Herrera Reviewed by: Tomas Vondra Discussion: <a target="_blank" href="https://postgr.es/m/495deb78.4186.1500dacaa63.Coremail.beijing_pg@163.com">https://postgr.es/m/495deb78.4186.1500dacaa63.Coremail.beijing_pg@163.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8bf74967dab1b368f4e217c960ede1516c42a989">http://git.postgresql.org/pg/commitdiff/8bf74967dab1b368f4e217c960ede1516c42a989</a></li>
<li>Fix printf format to use %zd when printing sizes. Using %ld as we were doing raises compiler warnings on 32 bit platforms. Reported by Andres Freund. Discussion: <a target="_blank" href="https://postgr.es/m/20170407214022.fidezl2e6rk3tuiz@alap3.anarazel.de">https://postgr.es/m/20170407214022.fidezl2e6rk3tuiz@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8acc1e0fe21015d403c0e005d92d04250ece84b9">http://git.postgresql.org/pg/commitdiff/8acc1e0fe21015d403c0e005d92d04250ece84b9</a></li>
</ul>
<p>Joe Conway pushed:</p>
<ul>
<li>Silence compiler warning in sepgsql. &lt;selinux/label.h&gt; includes &lt;stdbool.h&gt;, which creates an incompatible We don't care if &lt;stdbool.h&gt; redefines "true"/"false"; those are close enough. Complaint and initial patch by Mike Palmiotto. Final approach per Tom Lane's suggestion, as discussed on hackers. Backpatching to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com">https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bd190eae36191a6795c4f0fe95419dbf2953d2b0">http://git.postgresql.org/pg/commitdiff/bd190eae36191a6795c4f0fe95419dbf2953d2b0</a></li>
<li>Silence uninitialized variable compiler warning in sepgsql. At -Og optimization gcc warns that variable tclass may be used uninitialized when relkind == RELKIND_INDEX. Actually that can't happen due to an early return, but quiet the compiler by initializing tclass to 0. In passing, use uint16_t consistently for the declaration of tclass. Complaint and initial patch by Mike Palmiotto. Editorializing by me. Probably not worth backpatching given that it is cosmetic, so apply to development head only. Discussion: <a target="_blank" href="https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com">https://postgr.es/m/flat/623bcaae-112e-ced0-8c22-a84f75ae0c53%40joeconway.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/af8a94d18d70ca226a12057ad4b3d17f27d8ff13">http://git.postgresql.org/pg/commitdiff/af8a94d18d70ca226a12057ad4b3d17f27d8ff13</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix typo in comment. Masahiko Sawada <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/32e33a7979a10e9fcf2c9b32703838cec1daf674">http://git.postgresql.org/pg/commitdiff/32e33a7979a10e9fcf2c9b32703838cec1daf674</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Vaishnavi Prabakaran sent in two more revisions of a patch to add batch/pipelining support to libpq.</p>
<p>Craig Ringer sent in five more revisions of a patch to add logical decoding on standby.</p>
<p>Ashutosh Bapat and Amit Langote traded patches to document some intricacies of the relationship between declarative partitions and foreign tables.</p>
<p>Takayuki Tsunakawa sent in three more revisions of a patch to support huge pages on Windows.</p>
<p>Amit Khandekar sent in two more revisions of a patch to enable UPDATEs on partitioned tables which would cause rows to move among partitions to work.</p>
<p>Rushabh Lathia sent in a patch to add coverage tests for gather merge.</p>
<p>Amit Langote sent in a patch to enable ON CONFLICT DO NOTHING on partitioned tables.</p>
<p>Haribabu Kommi sent in another revision of a patch to refactor handling of database attributes between pg_dump and pg_dumpall.</p>
<p>Alexander Korotkov sent in another revision of a patch to implement incremental sort.</p>
<p>Daniel Gustafsson sent in a patch to use strcmp() instead of pg_strcasecmp() for identifier matching.</p>
<p>Kyotaro HORIGUCHI sent in a patch to distinguish "aggressive" VACUUMs from non- in logs.</p>
<p>Vinayak Pokale sent in another revision of a patch to add an ANALYZE progress checker.</p>
<p>Tatsuo Ishii and Andres Freund traded patches to rearm statement_timeout after each executed query.</p>
<p>Micha&euml;l Paquier sent in two revisions of a patch to rewrite the test of pg_upgrade as a TAP test.</p>
<p>Kuntal Ghosh sent in two revisions of a patch to fix parallel worker counts after a crash.</p>
<p>Amit Langote sent in a patch to remove pg_stat_progress_vacuum from Table 28.2.</p>
<p>David Rowley sent in three more revisions of a patch to make clausesel smarter.</p>
<p>Antonin Houska sent in another revision of a patch to implement aggregation pushdown.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to implement asynchronous execution.</p>
<p>Maksim Milyutin sent in a patch to create a "local" index for partitioned tables.</p>
<p>Fabien COELHO sent in a patch to add a special variable in psql to reflect the last query status.</p>
<p>Ashutosh Bapat sent in two more revisions of a patch to implement partition-wise joins for declaratively partitioned tables.</p>
<p>Rahila Syed sent in three more revisions of a patch to add support for a default partition in declarative partitions.</p>
<p>Craig Ringer and Jim Nasby traded patches to add SPI_execute_callback and documentation for same, then use it in PL/PythonU to speed up SPI results.</p>
<p>Dmitry Dolgov sent in two more revisions of a patch to implement generic type subscripting.</p>
<p>Amit Khandekar sent in another revision of a patch to implement parallel append.</p>
<p>Etsuro Fujita sent in another revision of a patch to fix a bug in the PostgreSQL FDW.</p>
<p>Pavan Deolasee sent in two more revisions of a patch to implement WARM.</p>
<p>Mark Dilger sent in a patch to create a generic PG_GETARG_*_P infrastructure.</p>
<p>Robert Haas sent in another revision of a patch to add pgstathashindex() to get hash index table statistics.</p>
<p>Etsuro Fujita sent in another revision of a patch to support parameterized foreign joins.</p>
<p>Fabien COELHO sent in three more revisions of a patch to enable pgbench to store select results into variables.</p>
<p>Jeff Davis sent in a patch to implement range merge join.</p>
<p>Ashutosh Bapat sent in a patch to implement constraint exclusion for partitioned tables.</p>
<p>Kyotaro HORIGUCHI sent in a patch to ensure that enabling subscription starts a worker.</p>
<p>Micha&euml;l Paquier sent in a patch to use base64-based encoding for stored and server keys in SCRAM verifiers, move the routine to build the SCRAM verifier into src/common/, refactor frontend-side random number generation, extend PQencryptPassword with a hashing method, and extend psql's \password and createuser to handle SCRAM verifier creation.</p>
<p>Tatsuro Yamada sent in a patch to make postgresGetForeignPlan use foreignrel instead of baserel.</p>
<p>Thomas Munro sent in a patch to implement hash tables in dynamic shared memory.</p>
<p>Thomas Munro sent in a PoC patch to enable sharing record typmods between backends.</p>
<p>Vitaly Burovoy sent in a patch to implement SET IDENTITY ... IF NOT EXISTS.</p>
<p>Kyotaro HORIGUCHI sent in a patch to fix distclean of src/backend/utils/mb/Unicode.</p>
<p>Yorick Peterse sent in two revisions of a patch to update the hot-standby documentation (in the high availability section) so it explicitly mentions that certain settings need to be applied to servers in a particular order.</p>
<p>Beena Emerson sent in a patch to update the initdb regression tests to include increasing the default WAL segment size.</p>
<p>Aleksander Alekseev sent in another revision of a patch to remove an unused argument in btree_xlog_split.</p>
<p>Tatsuo Ishii sent in a patch to document the fact that pg_export_snapshot() cannot be used during recovery (i.e. on standby servers).</p>
<p>Aleksander Alekseev sent in a patch to warn users about duplicate configuration parameters in postgresql.conf.</p>
<p>&Aacute;lvaro Herrera sent in another revision of a patch to fix wal_level_minimal.</p>
<p>Thomas Munro sent in a patch to initialise a freed segment counter in dsa.c.</p>
<p>Claudio Freire sent in another revision of a patch to allow VACUUM to use more than 1GB work mem in, and make it free dead tuples array as early as possible.</p>
<p>Thomas Munro sent in a patch to fix and document some snapshot issues.</p>
<p>Thomas Munro sent in a patch to add a pg_waiting_for_safe_snapshot() function.</p>
<p>Tom Lane and Mark Dilger traded patches to use IsA checks for bitmapsets.</p>
<p>Michael Banck sent in another revision of a patch to add an option to create a replication slot in pg_basebackup if not yet present.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/04/14/Nouvelles-hebdomadaires-de-PostgreSQL-9-avril-2017">par chl le jeudi 13 avril 2017 à 23h56</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi  4 avril 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:81c5c5b667ecc0abd87bde7bf09fa69a" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/04/05/Nouvelles-hebdomadaires-de-PostgreSQL-2-avril-2017">Nouvelles hebdomadaires de PostgreSQL - 2 avril 2017</a></h4>
<div class="entry">
<div class="content">
<p>PGDay UK 2017 - Inscriptions et appel &agrave; conf&eacute;renciers lanc&eacute;s&nbsp;: <a target="_blank" href="http://www.pgconf.uk">http://www.pgconf.uk</a></p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>postgresql-unit 3.0, une extension impl&eacute;mentant les types de donn&eacute;es correspondant aux unit&eacute;s SI, &agrave; quelques unit&eacute;s non-SI et aux octets&nbsp;: <a target="_blank" href="https://github.com/ChristophBerg/postgresql-unit">https://github.com/ChristophBerg/postgresql-unit</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en avril</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-04/">http://archives.postgresql.org/pgsql-jobs/2017-04/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
<li>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 30 mai&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170402225015.GC10244@fetter.org">http://www.postgresql.org/message-id/20170402225015.GC10244@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>Fix unportable disregard of alignment requirements in RADIUS code. The compiler is entitled to store a char[] local variable with no particular alignment requirement. Our RADIUS code cavalierly took such a local variable and cast its address to a struct type that does have alignment requirements. On an alignment-picky machine this would lead to bus errors. To fix, declare the local variable honestly, and then cast its address to char * for use in the I/O calls. Given the lack of field complaints, there must be very few if any people affected; but nonetheless this is a clear portability issue, so back-patch to all supported branches. Noted while looking at a Coverity complaint in the same code. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4c051c41d63e8462971c13956a38030de9c35c51">http://git.postgresql.org/pg/commitdiff/4c051c41d63e8462971c13956a38030de9c35c51</a></li>
<li>Fix some minor resource leaks in PerformRadiusTransaction(). Failure to free serveraddrs pointed out by Coverity, failure to close socket noted by code-reading. These bugs seem to be quite old, but given the low probability of taking these error-exit paths and the minimal consequences of the leaks (since the process would presumably exit shortly anyway), it doesn't seem worth back-patching. Michael Paquier and Tom Lane <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7cbd944662854a0a5264895bcba3ce7f9bfd1c1f">http://git.postgresql.org/pg/commitdiff/7cbd944662854a0a5264895bcba3ce7f9bfd1c1f</a></li>
<li>Fix typos in logical replication support for initial data copy. Fix an incorrect assert condition (noted by Coverity), and spell the new name of the function correctly. Typos introduced in commit 7c4f52409. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5459cfd3ad52b87a1e2ed293ae55e733c6964715">http://git.postgresql.org/pg/commitdiff/5459cfd3ad52b87a1e2ed293ae55e733c6964715</a></li>
<li>Use ExecPrepareExpr in place of ExecPrepareCheck where appropriate. Change one more place where ExecInitCheck/ExecPrepareCheck's insistence on getting implicit-AND-format quals wasn't really helpful, because the caller had to do make_ands_implicit() for no reason that it cared about. Using ExecPrepareExpr directly simplifies the code and saves cycles. The only remaining use of these functions is to process resultRelInfo-&gt;ri_PartitionCheck quals. However, implicit-AND format does seem to be what we want for that, so leave it alone. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9b95f2fa1e2684fa209a3594db2254b8841bf380">http://git.postgresql.org/pg/commitdiff/9b95f2fa1e2684fa209a3594db2254b8841bf380</a></li>
<li>Improve performance of ExecEvalWholeRowVar. In commit b8d7f053c, we needed to fix ExecEvalWholeRowVar to not change the state of the slot it's copying. The initial quick hack at that required two rounds of tuple construction, which is not very nice. To fix, add another primitive to tuptoaster.c that does precisely what we need. (I initially tried to do this by refactoring one of the existing functions into two pieces; but it looked like that might hurt performance for the existing case, and the amount of code that could be shared is not very large, so I gave up on that.) Discussion: <a target="_blank" href="https://postgr.es/m/26088.1490315792@sss.pgh.pa.us">https://postgr.es/m/26088.1490315792@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2f0903ea196503fc8af373a9de46b1e01a23508c">http://git.postgresql.org/pg/commitdiff/2f0903ea196503fc8af373a9de46b1e01a23508c</a></li>
<li>Show ignored constants as "$N" rather than "?" in pg_stat_statements. The trouble with the original choice here is that "?" is a valid (and indeed used) operator name, so that you could end up with ambiguous statement texts like "SELECT ? ? ?". With this patch, you instead see "SELECT $1 ? $2", which seems significantly more readable. The numbers used for this purpose begin after the last actual $N parameter in the particular query. The conflict with external parameters has its own potential for confusion of course, but it was agreed to be an improvement over the previous behavior. Lukas Fittl Discussion: <a target="_blank" href="https://postgr.es/m/CAP53PkxeaCuwYmF-A4J5z2-qk5fYFo5_NH3gpXGJJBxv1DMwEw@mail.gmail.com">https://postgr.es/m/CAP53PkxeaCuwYmF-A4J5z2-qk5fYFo5_NH3gpXGJJBxv1DMwEw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a6f22e83562d8b78293229587cd3d9430d16d466">http://git.postgresql.org/pg/commitdiff/a6f22e83562d8b78293229587cd3d9430d16d466</a></li>
<li>Suppress implicit-conversion warnings seen with newer clang versions. We were assigning values near 255 through "char *" pointers. On machines where char is signed, that's not entirely kosher, and it's reasonable for compilers to warn about it. A better solution would be to change the pointer type to "unsigned char *", but that would be vastly more invasive. For the moment, let's just apply this simple backpatchable solution. Aleksander Alekseev Discussion: <a target="_blank" href="https://postgr.es/m/20170220141239.GD12278@e733.localdomain">https://postgr.es/m/20170220141239.GD12278@e733.localdomain</a> Discussion: <a target="_blank" href="https://postgr.es/m/2839.1490714708@sss.pgh.pa.us">https://postgr.es/m/2839.1490714708@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8cfeaecfc76a7366b336272bc76e96e09281b133">http://git.postgresql.org/pg/commitdiff/8cfeaecfc76a7366b336272bc76e96e09281b133</a></li>
<li>Make new expression eval code reject references to dropped columns. Formerly, a Var referencing an already-dropped column was allowed and would always produce a NULL value. However, that behavior was implemented in slot_getattr which the new expression code doesn't use; thus there is now a risk of returning theoretically-deleted data. We had regression test cases that purported to exercise this, but they failed to expose any problem, apparently because plpgsql filters the dropped column and produces an output tuple that has a NULL there already. Ideally the DROP or ALTER attempt in these test cases would get rejected due to dependency checks; but until that happens, let's modify the behavior so that we fail the query during executor start. This was already true for the related case of a column having changed type underneath us, and there's no obvious reason why we need to be laxer for dropped columns. In passing, adjust the error messages in CheckVarSlotCompatibility to include the composite type name. In the cases shown in the regression tests this is always just "record", but it should be more useful in actual stale-plan cases, where the slot tupdesc would be a table's tupdesc directly. Discussion: <a target="_blank" href="https://postgr.es/m/16803.1490723570@sss.pgh.pa.us">https://postgr.es/m/16803.1490723570@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2c4debbd0f018aa7322b622c88424a7f68d3081d">http://git.postgresql.org/pg/commitdiff/2c4debbd0f018aa7322b622c88424a7f68d3081d</a></li>
<li>Support \if ... \elif ... \else ... \endif in psql scripting. This patch adds nestable conditional blocks to psql. The control structure feature per se is complete, but the boolean expressions understood by \if and \elif are pretty primitive; basically, after variable substitution and backtick expansion, the result has to be "true" or "false" or one of the other standard spellings of a boolean value. But that's enough for many purposes, since you can always do the heavy lifting on the server side; and we can extend it later. Along the way, pay down some of the technical debt that had built up around psql/command.c: * Refactor exec_command() into a function per command, instead of being a 1500-line monstrosity. This makes the file noticeably longer because of repetitive function header/trailer overhead, but it seems much more readable. * Teach psql_get_variable() and psqlscanslash.l to suppress variable substitution and backtick expansion on the basis of the conditional stack state, thereby allowing removal of the OT_NO_EVAL kluge. * Fix the no-doubt-once-expedient hack of sometimes silently substituting mainloop.c's previous_buf for query_buf when calling HandleSlashCmds. (It's a bit remarkable that commands like \r worked at all with that.) Recall of a previous query is now done explicitly in the slash commands where that should happen. Corey Huinker, reviewed by Fabien Coelho, further hacking by me Discussion: <a target="_blank" href="https://postgr.es/m/CADkLM=c94OSRTnat=LX0ivNq4pxDNeoomFfYvBKM5N_xfmLtAA@mail.gmail.com">https://postgr.es/m/CADkLM=c94OSRTnat=LX0ivNq4pxDNeoomFfYvBKM5N_xfmLtAA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e984ef5861df4bc9733b36271d05763e82de7c04">http://git.postgresql.org/pg/commitdiff/e984ef5861df4bc9733b36271d05763e82de7c04</a></li>
<li>Fix broken markup. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ab1e644005b6ef77dada51188d7b92905e2444d7">http://git.postgresql.org/pg/commitdiff/ab1e644005b6ef77dada51188d7b92905e2444d7</a></li>
<li>For foreign keys, check REFERENCES privilege only on the referenced table. We were requiring that the user have REFERENCES permission on both the referenced and referencing tables --- but this doesn't seem to have any support in the SQL standard, which says only that you need REFERENCES permission on the referenced table. And ALTER TABLE ADD FOREIGN KEY has already checked that you own the referencing table, so the check could only fail if a table owner has revoked his own REFERENCES permission. Moreover, the symmetric interpretation of this permission is unintuitive and confusing, as per complaint from Paul Jungwirth. So let's drop the referencing-side check. In passing, do a bit of wordsmithing on the GRANT reference page so that all the privilege types are described in similar fashion. Discussion: <a target="_blank" href="https://postgr.es/m/8940.1490906755@sss.pgh.pa.us">https://postgr.es/m/8940.1490906755@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/64d4da511c012faff8ac309595620938a43c6817">http://git.postgresql.org/pg/commitdiff/64d4da511c012faff8ac309595620938a43c6817</a></li>
<li>Fix unstable regression test result. Commit e306df7f9 added a test case that depends on "the" being a stop word, which it is not in non-English locales. Since the point of the test is to check stopword behavior, fix by forcibly selecting the 'english' configuration. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f1a285e21111f4d4d0c3f428ce2b3ae9e7f162c2">http://git.postgresql.org/pg/commitdiff/f1a285e21111f4d4d0c3f428ce2b3ae9e7f162c2</a></li>
<li>Fix unstable regression test result. Whoops, missed that same test was made for json as well as jsonb. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c281cd5fe178c946dc23eae4d4642be5ddbe3eb4">http://git.postgresql.org/pg/commitdiff/c281cd5fe178c946dc23eae4d4642be5ddbe3eb4</a></li>
<li>Allow psql variable substitution to occur in backtick command strings. Previously, text between backquotes in a psql metacommand's arguments was always passed to the shell literally. That considerably hobbles the usefulness of the feature for scripting, so we'd foreseen for a long time that we'd someday want to allow substitution of psql variables into the shell command. IMO the addition of \if metacommands has brought us to that point, since \if can greatly benefit from some sort of client-side expression evaluation capability, and psql itself is not going to grow any such thing in time for v10. Hence, this patch. It allows :VARIABLE to be replaced by the exact contents of the named variable, while :'VARIABLE' is replaced by the variable's contents suitably quoted to become a single shell-command argument. (The quoting rules for that are different from those for SQL literals, so this is a bit of an abuse of the :'VARIABLE' notation, but I doubt anyone will be confused.) As with other situations in psql, no substitution occurs if the word following a colon is not a known variable name. That limits the risk of compatibility problems for existing psql scripts; but the risk isn't zero, so this needs to be called out in the v10 release notes. Discussion: <a target="_blank" href="https://postgr.es/m/9561.1490895211@sss.pgh.pa.us">https://postgr.es/m/9561.1490895211@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f833c847b8fa4782efab45c8371d3cee64292d9b">http://git.postgresql.org/pg/commitdiff/f833c847b8fa4782efab45c8371d3cee64292d9b</a></li>
<li>Fix behavior of psql's \p to agree with \g, \w, etc. In commit e984ef586 I (tgl) simplified the behavior of \p to just print the current query buffer; but Daniel V&Atilde;&copy;rit&Atilde;&copy; points out that this made it inconsistent with the behavior of \g and \w. It should print the same thing \g would execute. Fix that, and improve related comments. Daniel V&Atilde;&copy;rit&Atilde;&copy; Discussion: <a target="_blank" href="https://postgr.es/m/9b4ea968-753f-4b5f-b46c-d7d3bf7c8f90@manitou-mail.org">https://postgr.es/m/9b4ea968-753f-4b5f-b46c-d7d3bf7c8f90@manitou-mail.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5dbc5da1187c1ddb6e091047194d364337ebf232">http://git.postgresql.org/pg/commitdiff/5dbc5da1187c1ddb6e091047194d364337ebf232</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Fix cpluspluscheck warning. Structure tag cannot be the same as a typedef that is a pointer to that struct. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/895f93701fd78b6faab6b437685357298a91dfe3">http://git.postgresql.org/pg/commitdiff/895f93701fd78b6faab6b437685357298a91dfe3</a></li>
<li>Change default of log_directory to 'log'. The previous default 'pg_log' might have indicated by its "pg_" prefix that it is an internal system directory. The new default is more in line with the typical naming of directories with user-facing log files. Together with the renaming of pg_clog and pg_xlog, this should clear up that difference. Author: Andreas Karlsson &lt;andreas@proxel.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3371e4d9b12455fe1f8d1516d0bd915aab86be17">http://git.postgresql.org/pg/commitdiff/3371e4d9b12455fe1f8d1516d0bd915aab86be17</a></li>
<li>PL/Python: Add cursor and execute methods to plan object. Instead of plan = plpy.prepare(...) res = plpy.execute(plan, ...) you can now write plan = plpy.prepare(...) res = plan.execute(...) or even res = plpy.prepare(...).execute(...) and similarly for the cursor() method. This is more in object oriented style, and makes the hybrid nature of the existing execute() function less confusing. Reviewed-by: Andrew Dunstan &lt;andrew.dunstan@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/70ec3f1f8f0b753c38a1a582280a02930d7cac5f">http://git.postgresql.org/pg/commitdiff/70ec3f1f8f0b753c38a1a582280a02930d7cac5f</a></li>
<li>doc: Fix oldhtml/old PDF build again. Commit e259e1f748c7a6d67e307a90d6c27b8ab8b90df8 was faulty and created some broken output. This one fixes it better. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5196f13b2726eeabfe2c8b7a97fc05839766cdce">http://git.postgresql.org/pg/commitdiff/5196f13b2726eeabfe2c8b7a97fc05839766cdce</a></li>
<li>doc: Improve rendering of notes/cautions using XSL-FO. Center title and put a border around it, like the output that the DSSSL version gave. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6e31c3e13514be4404f716f152ac4c434adad03a">http://git.postgresql.org/pg/commitdiff/6e31c3e13514be4404f716f152ac4c434adad03a</a></li>
<li>Clean up Perl code according to perlcritic. Fix all perlcritic warnings of severity level 5, except in src/backend/utils/Gen_dummy_probes.pl, which is automatically generated. Reviewed-by: Dagfinn Ilmari Manns&Atilde;&yen;ker &lt;ilmari@ilmari.org&gt; Reviewed-by: Daniel Gustafsson &lt;daniel@yesql.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/facde2a98f0b5f7689b4e30a9e7376e926e733b8">http://git.postgresql.org/pg/commitdiff/facde2a98f0b5f7689b4e30a9e7376e926e733b8</a></li>
<li>Fix Perl code which had broken the Windows build. The previous change wanted to avoid modifying $_ in grep, but the code just made the change in a local variable and then lost it. Rewrite the code using a separate map and grep, which is clearer anyway. Author: Dagfinn Ilmari Manns&Atilde;&yen;ker &lt;ilmari@ilmari.org&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4d33a7f2e714848ca7b5b7ef8e244eead078ca13">http://git.postgresql.org/pg/commitdiff/4d33a7f2e714848ca7b5b7ef8e244eead078ca13</a></li>
<li>dblink: Fix error reporting. The conname variable was not initialized in some code paths, resulting in error reports referring to the "unnamed" connection rather than the correct connection name. Author: Rushabh Lathia &lt;rushabh.lathia@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/85163641f8bdeb7734b37ae67faa224a029afe25">http://git.postgresql.org/pg/commitdiff/85163641f8bdeb7734b37ae67faa224a029afe25</a></li>
<li>Fix ssl tests. facde2a98f0b5f7689b4e30a9e7376e926e733b8 introduced a typo during rebasing. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/967a4b01e3637813365502b46499360b18b86725">http://git.postgresql.org/pg/commitdiff/967a4b01e3637813365502b46499360b18b86725</a></li>
<li>Change 'diag' to 'note' in TAP tests. Reduce noise from TAP tests by changing 'diag' to 'note', so output only goes to the test's log file not stdout, unless in verbose mode. This also removes the junk on screen when running the TAP tests in parallel. Author: Craig Ringer &lt;craig@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2e74e636bd7d90152d596530a17a3d0ff543cc97">http://git.postgresql.org/pg/commitdiff/2e74e636bd7d90152d596530a17a3d0ff543cc97</a></li>
<li>doc: Mention --enable-tap-tests in regression test chapter. Reported-by: Jeff Janes &lt;jeff.janes@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/66b764341ba12206f01e2600713bdc3abdb070b3">http://git.postgresql.org/pg/commitdiff/66b764341ba12206f01e2600713bdc3abdb070b3</a></li>
<li>Cast result of copyObject() to correct type. copyObject() is declared to return void *, which allows easily assigning the result independent of the input, but it loses all type checking. If the compiler supports typeof or something similar, cast the result to the input type. This creates a greater amount of type safety. In some cases, where the result is assigned to a generic type such as Node * or Expr *, new casts are now necessary, but in general casts are now unnecessary in the normal case and indicate that something unusual is happening. Reviewed-by: Mark Dilger &lt;hornschnorter@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4cb824699e12c39fad97fb3d9085ced0d14c067c">http://git.postgresql.org/pg/commitdiff/4cb824699e12c39fad97fb3d9085ced0d14c067c</a></li>
<li>Improve Node vs Expr use a bit. Author: Mark Dilger &lt;hornschnorter@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e0eb5e0aeac7643c10b550e8067182cd08fc59a3">http://git.postgresql.org/pg/commitdiff/e0eb5e0aeac7643c10b550e8067182cd08fc59a3</a></li>
<li>Fix configure check for typeof. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ddce628971fb611f5ecd49d72e1612f983d99097">http://git.postgresql.org/pg/commitdiff/ddce628971fb611f5ecd49d72e1612f983d99097</a></li>
<li>Fix hardcoded typeof check result for Windows. The test result that I had blindly stipulated didn't work out on the build farm, so disable the feature in Windows MSVC for now. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3582b223d494cd505c6a22da98bcb49f99196645">http://git.postgresql.org/pg/commitdiff/3582b223d494cd505c6a22da98bcb49f99196645</a></li>
<li>Update copyright year in recently added files. Author: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4fdb8a82e3c6aaf6ca866c92ee066b6bde82c0b8">http://git.postgresql.org/pg/commitdiff/4fdb8a82e3c6aaf6ca866c92ee066b6bde82c0b8</a></li>
<li>pg_dump: Remove query truncation in error messages. Remove the behavior that a query mentioned in an error message would be truncated to 128 characters. The queries that pg_dump runs are often longer than that, and this behavior makes analyzing failures harder unnecessarily. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/flat/63201ef9-26fb-3f1f-664d-98531678cebc%402ndquadrant.com">https://www.postgresql.org/message-id/flat/63201ef9-26fb-3f1f-664d-98531678cebc%402ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5baf869f74d369319042132ef8cc2d8d4f5b71ce">http://git.postgresql.org/pg/commitdiff/5baf869f74d369319042132ef8cc2d8d4f5b71ce</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Show more processes in pg_stat_activity. Previously, auxiliary processes and background workers not connected to a database (such as the logical replication launcher) weren't shown. Include them, so that we can see the associated wait state information. Add a new column to identify the processes type, so that people can filter them out easily using SQL if they wish. Before this patch was written, there was discussion about whether we should expose this information in a separate view, so as to avoid contaminating pg_stat_activity with things people might not want to see. But putting everything in pg_stat_activity was a more popular choice, so that's what the patch does. Kuntal Ghosh, reviewed by Amit Langote and Michael Paquier. Some revisions and bug fixes by me. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYES5nhkEGw9nZXU8_FhA8XEm8NTm3-SO+3ML1B81Hkww@mail.gmail.com">http://postgr.es/m/CA+TgmoYES5nhkEGw9nZXU8_FhA8XEm8NTm3-SO+3ML1B81Hkww@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fc70a4b0df38bda6a13941f1581f25fbb643c7f3">http://git.postgresql.org/pg/commitdiff/fc70a4b0df38bda6a13941f1581f25fbb643c7f3</a></li>
<li>Fix comment. Cut-and-paste led to something silly. Ashutosh Sharma, reviewed by Amit Kapila and by me Discussion: <a target="_blank" href="http://postgr.es/m/CAE9k0PmUbvQSBY7kwN_OkuqBYyHRXBX-c1ZkuAgR5vgF0GeWzQ@mail.gmail.com">http://postgr.es/m/CAE9k0PmUbvQSBY7kwN_OkuqBYyHRXBX-c1ZkuAgR5vgF0GeWzQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f0a6046bcb15c2fe48384ef547df2bfb5d7f0a89">http://git.postgresql.org/pg/commitdiff/f0a6046bcb15c2fe48384ef547df2bfb5d7f0a89</a></li>
<li>Pass DSA_ALLOC_HUGE when allocating a shared TIDBitmap. When creating an unshared TIDBitmap, we pass MCXT_ALLOC_HUGE to allow allocations &gt;1GB, so by analogy we pass DSA_ALLOC_HUGE for a shared TIDBitmap. Bug introduced by commit 98e6e89040a0534ca26914c66cae9dd49ef62ad9. Report by Rafia Sabih, fix by Dilip Kumar, adjusted by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAOGQiiPpSnkuKq+oUK_bvQFg2EPGFPN8RwgxTgBa6HU_kQa3EA@mail.gmail.com">http://postgr.es/m/CAOGQiiPpSnkuKq+oUK_bvQFg2EPGFPN8RwgxTgBa6HU_kQa3EA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a171f01501e11a2ef65d437ac2397a0050892d88">http://git.postgresql.org/pg/commitdiff/a171f01501e11a2ef65d437ac2397a0050892d88</a></li>
<li>Allow ON CONFLICT .. DO NOTHING on a partitioned table. ON CONFLICT .. DO UPDATE still doesn't work, for lack of a way of enforcing uniqueness across partitions, but we can still allow this case. Amit Langote, per discussion with Peter Geoghegan. Additional wordsmithing by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAA-aLv7Z4uygtq-Q5CvDi9Y=VZxUyEnuWjL=EwCfOof=L04hgg@mail.gmail.com">http://postgr.es/m/CAA-aLv7Z4uygtq-Q5CvDi9Y=VZxUyEnuWjL=EwCfOof=L04hgg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8355a011a0124bdf7ccbada206a967d427039553">http://git.postgresql.org/pg/commitdiff/8355a011a0124bdf7ccbada206a967d427039553</a></li>
<li>Fix improper NULL handling in list partitioning code. The previous logic was wrong when the value was NULL but there was no partition for NULL. Amit Langote, reviewed by Jeevan Ladhe Discussion: <a target="_blank" href="http://postgr.es/m/d64f8498-70eb-3c88-b56d-c54fd3b0500f@lab.ntt.co.jp">http://postgr.es/m/d64f8498-70eb-3c88-b56d-c54fd3b0500f@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7ecb7143589f38d679bb566311dfa9be1a650fd5">http://git.postgresql.org/pg/commitdiff/7ecb7143589f38d679bb566311dfa9be1a650fd5</a></li>
<li>Tidy up the CREATE TABLE documentation for partitioning. Remove some &lt;note&gt; tags that make this too "loud". Fix some typos. Amit Langote, with a few minor corrections by me Discussion: <a target="_blank" href="http://postgr.es/m/a6f99cdb-21e7-1d65-1381-91f2cfa156e2@lab.ntt.co.jp">http://postgr.es/m/a6f99cdb-21e7-1d65-1381-91f2cfa156e2@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4785e377f9c3189c06051ece7ebb112220f365f6">http://git.postgresql.org/pg/commitdiff/4785e377f9c3189c06051ece7ebb112220f365f6</a></li>
<li>Improve documentation of how NOT NULL works with partitioning. Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/a6f99cdb-21e7-1d65-1381-91f2cfa156e2@lab.ntt.co.jp">http://postgr.es/m/a6f99cdb-21e7-1d65-1381-91f2cfa156e2@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d65561464f45d325e82ad91918bcd4e2881ce567">http://git.postgresql.org/pg/commitdiff/d65561464f45d325e82ad91918bcd4e2881ce567</a></li>
<li>Still more code review for single-page hash vacuuming. Most seriously, fix use of incorrect block ID, per a report from Jeff Janes that it causes a crash and a diagnosis from Amit Kapila. Improve consistency between the hash and btree versions of this code by adding back a PANIC that btree has, and by registering data in the xlog record in the same way, per complaints from Jeff Janes and Amit Kapila. Tidy up some minor cosmetic points, per complaints from Amit Kapila. Patch by Ashutosh Sharma, reviewed by Amit Kapila, and tested by Jeff Janes. Discussion: <a target="_blank" href="http://postgr.es/m/CAMkU=1w-9Qe=Ff1o6bSaXpNO9wqpo7_9GL8_CVhw4BoVVHasqg@mail.gmail.com">http://postgr.es/m/CAMkU=1w-9Qe=Ff1o6bSaXpNO9wqpo7_9GL8_CVhw4BoVVHasqg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c4c51541e22bf7f2da8ecf6986271687b0d7a90e">http://git.postgresql.org/pg/commitdiff/c4c51541e22bf7f2da8ecf6986271687b0d7a90e</a></li>
<li>Plug race in dsa_attach. With sufficiently bad luck, it was possible for a parallel worker to attempt attach to a DSA area after all other backends have detached from it, which is not legal. If the worker had waited a little longer to get started, the DSM itself would have been destroyed, which is why this wasn't noticed before. Thomas Munro, per a report from Andreas Seltenreich Discussion: <a target="_blank" href="http://postgr.es/m/87h92g83t3.fsf@credativ.de">http://postgr.es/m/87h92g83t3.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fddf45b38097d14301d249fbeebca32e40233bd2">http://git.postgresql.org/pg/commitdiff/fddf45b38097d14301d249fbeebca32e40233bd2</a></li>
<li>Mark more functions parallel-restricted. Commit 61c2e1a95f94bb904953a6281ce17a18ac38ee6d allowed parallel query to be used in more places, revealing via buildfarm member mandrill that several functions intended to be called from triggers were incorrectly marked parallel-safe rather than parallel-restricted. Report by Tom Lane. Patch by Rafia Sabih. Reviewed by me. Discussion: <a target="_blank" href="http://postgr.es/m/16061.1490479253@sss.pgh.pa.us">http://postgr.es/m/16061.1490479253@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9a09527164311a5735e4a8a83d376a30427336cc">http://git.postgresql.org/pg/commitdiff/9a09527164311a5735e4a8a83d376a30427336cc</a></li>
<li>postgres_fdw: Teach IMPORT FOREIGN SCHEMA about partitioning. Don't import partitions. Do import partitioned tables which are not themselves partitions. Report by Stephen Frost. Design and patch by Michael Paquier, reviewed by Amit Langote. Documentation revised by me. Discussion: <a target="_blank" href="http://postgr.es/m/20170309141531.GD9812@tamriel.snowman.net">http://postgr.es/m/20170309141531.GD9812@tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f49bcd4ef3e9a75de210357a4d9bbe3e004db956">http://git.postgresql.org/pg/commitdiff/f49bcd4ef3e9a75de210357a4d9bbe3e004db956</a></li>
<li>Don't allocate storage for partitioned tables. Also, don't allow setting reloptions on them, since that would have no effect given the lack of storage. The patch does this by introducing a new reloption kind for which there are currently no reloptions -- we might have some in the future -- so it adjusts parseRelOptions to handle that case correctly. Bumped catversion. System catalogs that contained reloptions for partitioned tables are no longer valid; plus, there are now fewer physical files on disk, which is not technically a catalog change but still a good reason to re-initdb. Amit Langote, reviewed by Maksim Milyutin and Kyotaro Horiguchi and revised a bit by me. Discussion: <a target="_blank" href="http://postgr.es/m/20170331.173326.212311140.horiguchi.kyotaro@lab.ntt.co.jp">http://postgr.es/m/20170331.173326.212311140.horiguchi.kyotaro@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c94e6942cefe7d20c5feed856e27f672734b1e2b">http://git.postgresql.org/pg/commitdiff/c94e6942cefe7d20c5feed856e27f672734b1e2b</a></li>
<li>Revert "Allow ON CONFLICT .. DO NOTHING on a partitioned table.". This reverts commit 8355a011a0124bdf7ccbada206a967d427039553, which turns out to have been a misguided effort. We can't really support this in a partitioning hierarchy after all for exactly the reasons stated in the documentation removed by that commit. It's still possible to use ON CONFLICT .. DO NOTHING (or for that matter ON CONFLICT .. DO UPDATE) on individual partitions if desired, but but to allow this on a partitioned table implies that we have some way of evaluating uniqueness across the whole partitioning hierarchy, which is false. Shinoda Noriyoshi noticed that the old code was crashing (which we could fix, though not in a nice way) and Amit Langote realized that this was indicative of a fundamental problem with the commit being reverted here. Discussion: <a target="_blank" href="http://postgr.es/m/ff3dc21d-7204-c09c-50ac-cf11a8c45c81@lab.ntt.co.jp">http://postgr.es/m/ff3dc21d-7204-c09c-50ac-cf11a8c45c81@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f05230752d53c4aa74cffa9b699983bbb6bcb118">http://git.postgresql.org/pg/commitdiff/f05230752d53c4aa74cffa9b699983bbb6bcb118</a></li>
<li>Improve documentation for table partitioning. Emphasize the new declarative partitioning more, and compare and contrast it more clearly with inheritance-based partitioning. Amit Langote, reviewed and somewhat revised by me Discussion: <a target="_blank" href="http://postgr.es/m/a6f99cdb-21e7-1d65-1381-91f2cfa156e2@lab.ntt.co.jp">http://postgr.es/m/a6f99cdb-21e7-1d65-1381-91f2cfa156e2@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8f18a880a5f138d4da94173d15514142331f8de6">http://git.postgresql.org/pg/commitdiff/8f18a880a5f138d4da94173d15514142331f8de6</a></li>
<li>Fix typos. Brandur Leach <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9a12ad042d26ba085f8ef72d030699b6f3d43b01">http://git.postgresql.org/pg/commitdiff/9a12ad042d26ba085f8ef72d030699b6f3d43b01</a></li>
<li>Don't use bgw_main even to specify in-core bgworker entrypoints. On EXEC_BACKEND builds, this can fail if ASLR is in use. Backpatch to 9.5. On master, completely remove the bgw_main field completely, since there is no situation in which it is safe for an EXEC_BACKEND build. On 9.6 and 9.5, leave the field intact to avoid breaking things for third-party code that doesn't care about working under EXEC_BACKEND. Prior to 9.5, there are no in-core bgworker entrypoints. Petr Jelinek, reviewed by me. Discussion: <a target="_blank" href="http://postgr.es/m/09d8ad33-4287-a09b-a77f-77f8761adb5e@2ndquadrant.com">http://postgr.es/m/09d8ad33-4287-a09b-a77f-77f8761adb5e@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2113ac4cbb12b815804e8873d761cade9ddf49b9">http://git.postgresql.org/pg/commitdiff/2113ac4cbb12b815804e8873d761cade9ddf49b9</a></li>
<li>Fix parallel query so it doesn't spoil row estimates above Gather. Commit 45be99f8cd5d606086e0a458c9c72910ba8a613d removed GatherPath's num_workers field, but this is entirely bogus. Normally, a path's parallel_workers flag is supposed to indicate the number of workers that it wants, and should be 0 for a non-partial path. In that commit, I mistakenly thought that GatherPath could also use that field to indicate the number of workers that it would try to start, but that's disastrous, because then it can propagate up to higher nodes in the plan tree, which will then get incorrect rowcounts because the parallel_workers flag is involved in computing those values. Repair by putting the separate field back. Report by Tomas Vondra. Patch by me, reviewed by Amit Kapila. Discussion: <a target="_blank" href="http://postgr.es/m/f91b4a44-f739-04bd-c4b6-f135bd643669@2ndquadrant.com">http://postgr.es/m/f91b4a44-f739-04bd-c4b6-f135bd643669@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7d8f6986b83c9a56f6ea11c959cdd8f52e1b543d">http://git.postgresql.org/pg/commitdiff/7d8f6986b83c9a56f6ea11c959cdd8f52e1b543d</a></li>
<li>Avoid GatherMerge crash when there are no workers. It's unnecessary to return an actual slot when we have no tuple. We can just return NULL, which avoids the risk of indexing into an array that might not contain any elements. Rushabh Lathia, per a report from Tomas Vondra Discussion: <a target="_blank" href="http://postgr.es/m/6ecd6f17-0dcf-1de7-ded8-0de7db1ddc88@2ndquadrant.com">http://postgr.es/m/6ecd6f17-0dcf-1de7-ded8-0de7db1ddc88@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/25dc142a49c60c3107480c487cd8444dc83f9bdf">http://git.postgresql.org/pg/commitdiff/25dc142a49c60c3107480c487cd8444dc83f9bdf</a></li>
</ul>
<p>Andrew Gierth pushed:</p>
<ul>
<li>Support hashed aggregation with grouping sets. This extends the Aggregate node with two new features: HashAggregate can now run multiple hashtables concurrently, and a new strategy MixedAggregate populates hashtables while doing sorted grouping. The planner will now attempt to save as many sorts as possible when planning grouping sets queries, while not exceeding work_mem for the estimated combined sizes of all hashtables used. No SQL-level changes are required. There should be no user-visible impact other than the new EXPLAIN output and possible changes to result ordering when ORDER BY was not used (which affected a few regression tests). The enable_hashagg option is respected. Author: Andrew Gierth Reviewers: Mark Dilger, Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/87vatszyhj.fsf@news-spur.riddles.org.uk">https://postgr.es/m/87vatszyhj.fsf@news-spur.riddles.org.uk</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b5635948ab165b6070e7d05d111f966e07570d81">http://git.postgresql.org/pg/commitdiff/b5635948ab165b6070e7d05d111f966e07570d81</a></li>
<li>Attempt to stabilize grouping sets regression test plans. Per buildfarm members dromedary and arapaima. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/de4da168d57de812bb30d359394b7913635d21a9">http://git.postgresql.org/pg/commitdiff/de4da168d57de812bb30d359394b7913635d21a9</a></li>
</ul>
<p>Teodor Sigaev pushed:</p>
<ul>
<li>Improve performance of find_tabstat_entry()/get_tabstat_entry(). Patch introduces a hash map reloid -&gt; PgStat_TableStatus which improves performance in case of large number of tables/partitions. Author: Aleksander Alekseev Reviewed-by: Andres Freund, Anastasia Lubennikova, Tels, me <a target="_blank" href="https://commitfest.postgresql.org/13/1058/">https://commitfest.postgresql.org/13/1058/</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/090010f2ec9b1f9ac1124dc628b89586f911b641">http://git.postgresql.org/pg/commitdiff/090010f2ec9b1f9ac1124dc628b89586f911b641</a></li>
<li>Improve performance of find_all_inheritors(). Previous coding uses three nested loops which obviously were a pain for large number of table's children. Patch replaces inner loop with a hashmap. Author: Aleksander Alekseev Reviewed-by: me <a target="_blank" href="https://commitfest.postgresql.org/13/1058/">https://commitfest.postgresql.org/13/1058/</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/827d6f977940952ebef4bd21fb0f97be4e20c0c4">http://git.postgresql.org/pg/commitdiff/827d6f977940952ebef4bd21fb0f97be4e20c0c4</a></li>
<li>Fsync directory after creating or unlinking file. If file was created/deleted just before powerloss it's possible that file system will miss that. To prevent it, call fsync() where creating/ unlinkg file is critical. Author: Michael Paquier Reviewed-by: Ashutosh Bapat, Takayuki Tsunakawa, me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1b02be21f271db6bd3cd43abb23fa596fcb6bac3">http://git.postgresql.org/pg/commitdiff/1b02be21f271db6bd3cd43abb23fa596fcb6bac3</a></li>
<li>Altering default privileges on schemas. Extend ALTER DEFAULT PRIVILEGES command to schemas. Author: Matheus Oliveira Reviewed-by: Petr Jel&Atilde;&shy;nek, Ashutosh Sharma <a target="_blank" href="https://commitfest.postgresql.org/13/887/">https://commitfest.postgresql.org/13/887/</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ab89e465cb2032017c4888399f47a76ac16eaf40">http://git.postgresql.org/pg/commitdiff/ab89e465cb2032017c4888399f47a76ac16eaf40</a></li>
<li>Implement SortSupport for macaddr data type. Introduces a scheme to produce abbreviated keys for the macaddr type. Bump catalog version. Author: Brandur Leach Reviewed-by: Julien Rouhaud, Peter Geoghegan <a target="_blank" href="https://commitfest.postgresql.org/13/743/">https://commitfest.postgresql.org/13/743/</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f90d23d0c51895e0d7db7910538e85d3d38691f0">http://git.postgresql.org/pg/commitdiff/f90d23d0c51895e0d7db7910538e85d3d38691f0</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Rework the stats_ext test. As suggested by Tom Lane, avoid printing specific estimated cost values, because they vary across architectures; instead, verify plan shapes (in this case, HashAggregate vs. GroupAggregate), as we do in other planner tests. We can now remove expected/stats_ext_1.out. Author: Tomas Vondra <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bed9ef5a16239d91d97a1fa2efd9309c3cbbc4b2">http://git.postgresql.org/pg/commitdiff/bed9ef5a16239d91d97a1fa2efd9309c3cbbc4b2</a></li>
<li>Fix a couple of problems in pg_get_statisticsextdef. There was a thinko whereby we tested the wrong tuple after fetching it from cache; avoid that by using generate_relation_name instead, which is simpler. Also, the statistics name was not qualified, so add that. (It could be argued that qualification should be conditional on the schema not being on search path. We can add that later, but at least this form is correct.) Author: David Rowley, &Atilde;lvaro Herrera Discussion: <a target="_blank" href="https://postgr.es/m/CAKJS1f8RjLeVZJ2+93pdQGuZJeBF-ifsHaFMR-q-6-Z0qxA8cA@mail.gmail.com">https://postgr.es/m/CAKJS1f8RjLeVZJ2+93pdQGuZJeBF-ifsHaFMR-q-6-Z0qxA8cA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2c3e47527a6f53cd1d98887fdb9e770c118954ca">http://git.postgresql.org/pg/commitdiff/2c3e47527a6f53cd1d98887fdb9e770c118954ca</a></li>
<li>Fix thinko in estimate_num_groups. The code for the reworked n-distinct estimation on commit 7b504eb282 was written differently in a previous version of the patch, prior to commit; on rewriting it, we missed updating an initializer. This caused the code to (mistakenly) apply a fudge factor even in the case where a single value is applied, leading to incorrect results. This means that the 'relvarcount' variable name is now wrong. Add a comment to try and make the situation clearer, and remove an incorrect comment I added. Problem noticed, and code patch, by Tomas Vondra. Additional commentary by &Atilde;lvaro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1f171a1803c28d3ae24636c9ca3352ec82c39e5f">http://git.postgresql.org/pg/commitdiff/1f171a1803c28d3ae24636c9ca3352ec82c39e5f</a></li>
<li>Fix uninitialized memory propagation mistakes. Valgrind complains that some uninitialized bytes are being passed around by the extended statistics code since commit 7b504eb282ca2f, as reported by Andres Freund. Silence it. Tomas Vondra submitted a patch which he verified to fix the complaints in his machine; however I messed with it a bit before pushing, so any remaining problems are likely my (&Atilde;lvaro's) fault. Author: Tomas Vondra Discussion: <a target="_blank" href="https://postgr.es/m/20170325211031.4xxoptigqxm2emn2@alap3.anarazel.de">https://postgr.es/m/20170325211031.4xxoptigqxm2emn2@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6462238f0d7b7c15eb3f54c2108573cee8fb24ba">http://git.postgresql.org/pg/commitdiff/6462238f0d7b7c15eb3f54c2108573cee8fb24ba</a></li>
<li>Remove direct uses of ItemPointer.{ip_blkid,ip_posid}. There are no functional changes here; this simply encapsulates knowledge of the ItemPointerData struct so that a future patch can change things without more breakage. All direct users of ip_blkid and ip_posid are changed to use existing macros ItemPointerGetBlockNumber and ItemPointerGetOffsetNumber respectively. For callers where that's inappropriate (because they Assert that the itempointer is is valid-looking), add ItemPointerGetBlockNumberNoCheck and ItemPointerGetOffsetNumberNoCheck, which lack the assertion but are otherwise identical. Author: Pavan Deolasee Discussion: <a target="_blank" href="https://postgr.es/m/CABOikdNnFon4cJiL=h1mZH3bgUeU+sWHuU4Yr8AB=j3A2p1GiA@mail.gmail.com">https://postgr.es/m/CABOikdNnFon4cJiL=h1mZH3bgUeU+sWHuU4Yr8AB=j3A2p1GiA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ce96ce60ca2293f75f36c3661e4657a3c79ffd61">http://git.postgresql.org/pg/commitdiff/ce96ce60ca2293f75f36c3661e4657a3c79ffd61</a></li>
<li>Allow DSM segments to be created as pinned. dsm_create and dsm_attach assumed that a current resource owner was always in place. Exploration with the API show that this is inconvenient: sometimes one must create a dummy resowner, create/attach the DSM, only to pin the mapping later, which is wasteful. Change create/attach so that if there is no current resowner, the dsm is effectively pinned right from the start. Discussion: <a target="_blank" href="https://postgr.es/m/20170324232710.32acsfsvjqfgc6ud@alvherre.pgsql">https://postgr.es/m/20170324232710.32acsfsvjqfgc6ud@alvherre.pgsql</a> Reviewed by Thomas Munro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/767bc028e5f001351feb498acef9a87c123093d6">http://git.postgresql.org/pg/commitdiff/767bc028e5f001351feb498acef9a87c123093d6</a></li>
<li>Simplify check of modified attributes in heap_update. The old coding was getting more complicated as new things were added, and it would be barely tolerable with upcoming WARM updates and other future features such as indirect indexes. The new coding incurs a small performance cost in synthetic benchmark cases, and is barely measurable in normal cases. A much larger benefit is expected from WARM, which could actually bolt its needs on top of the existing coding, but it is much uglier and bug-prone than doing it on this new code. Additional optimization can be applied on top of this, if need be. Reviewed-by: Pavan Deolasee, Amit Kapila, Mithun CY Discussion: <a target="_blank" href="https://postgr.es/m/20161228232018.4hc66ndrzpz4g4wn@alvherre.pgsql">https://postgr.es/m/20161228232018.4hc66ndrzpz4g4wn@alvherre.pgsql</a> <a target="_blank" href="https://postgr.es/m/CABOikdMJfz69dBNRTOZcB6s5A0tf8OMCyQVYQyR-WFFdoEwKMQ@mail.gmail.com">https://postgr.es/m/CABOikdMJfz69dBNRTOZcB6s5A0tf8OMCyQVYQyR-WFFdoEwKMQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2fd8685e7fd9fddf16f99de1284a787d29781cc8">http://git.postgresql.org/pg/commitdiff/2fd8685e7fd9fddf16f99de1284a787d29781cc8</a></li>
<li>Fix expected output. Previous commit had a thinko in the expected output for new tests. Per buildfarm <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3a82129a40a3a2987356d4051e017fd456876c8d">http://git.postgresql.org/pg/commitdiff/3a82129a40a3a2987356d4051e017fd456876c8d</a></li>
<li>BRIN de-summarization. When the BRIN summary tuple for a page range becomes too "wide" for the values actually stored in the table (because the tuples that were present originally are no longer present due to updates or deletes), it can be useful to remove the outdated summary tuple, so that a future summarization can install a tighter summary. This commit introduces a SQL-callable interface to do so. Author: &Atilde;lvaro Herrera Reviewed-by: Eiji Seki Discussion: <a target="_blank" href="https://postgr.es/m/20170228045643.n2ri74ara4fhhfxf@alvherre.pgsql">https://postgr.es/m/20170228045643.n2ri74ara4fhhfxf@alvherre.pgsql</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c655899ba9ae2a0d24e99c797167c33e0cfa0820">http://git.postgresql.org/pg/commitdiff/c655899ba9ae2a0d24e99c797167c33e0cfa0820</a></li>
<li>BRIN auto-summarization. Previously, only VACUUM would cause a page range to get initially summarized by BRIN indexes, which for some use cases takes too much time since the inserts occur. To avoid the delay, have brininsert request a summarization run for the previous range as soon as the first tuple is inserted into the first page of the next range. Autovacuum is in charge of processing these requests, after doing all the regular vacuuming/ analyzing work on tables. This doesn't impose any new tasks on autovacuum, because autovacuum was already in charge of doing summarizations. The only actual effect is to change the timing, i.e. that it occurs earlier. For this reason, we don't go any great lengths to record these requests very robustly; if they are lost because of a server crash or restart, they will happen at a later time anyway. Most of the new code here is in autovacuum, which can now be told about "work items" to process. This can be used for other things such as GIN pending list cleaning, perhaps visibility map bit setting, both of which are currently invoked during vacuum, but do not really depend on vacuum taking place. The requests are at the page range level, a granularity for which we did not have SQL-level access; we only had index-level summarization requests via brin_summarize_new_values(). It seems reasonable to add SQL-level access to range-level summarization too, so add a function brin_summarize_range() to do that. Authors: &Atilde;lvaro Herrera, based on sketch from Simon Riggs. Reviewed-by: Thomas Munro. Discussion: <a target="_blank" href="https://postgr.es/m/20170301045823.vneqdqkmsd4as4ds@alvherre.pgsql">https://postgr.es/m/20170301045823.vneqdqkmsd4as4ds@alvherre.pgsql</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7526e10224f0792201e99631567bbe44492bbde4">http://git.postgresql.org/pg/commitdiff/7526e10224f0792201e99631567bbe44492bbde4</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Cleanup slots during drop database. Automatically drop all logical replication slots associated with a database when the database is dropped. Previously we threw an ERROR if a slot existed. Now we throw ERROR only if a slot is active in the database being dropped. Craig Ringer <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff539da31691f2cd2694360250571c5c5fb7415e">http://git.postgresql.org/pg/commitdiff/ff539da31691f2cd2694360250571c5c5fb7415e</a></li>
<li>Correct grammar in error message. "could not generate" rather than "could not generation" from commit 818fd4a67d610991757b610755e3065fb99d80a5 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a99f77021f0c8c1c221af4e36b64ca43abd04389">http://git.postgresql.org/pg/commitdiff/a99f77021f0c8c1c221af4e36b64ca43abd04389</a></li>
<li>Fix pgrowlocks minor coding oversight. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ceb3158abe743ddcb213457fc9fcd1a89812194f">http://git.postgresql.org/pg/commitdiff/ceb3158abe743ddcb213457fc9fcd1a89812194f</a></li>
<li>Default monitoring roles. Three nologin roles with non-overlapping privs are created by default * pg_read_all_settings - read all GUCs. * pg_read_all_stats - pg_stat_*, pg_database_size(), pg_tablespace_size() * pg_stat_scan_tables - may lock/scan tables Top level role - pg_monitor includes all of the above by default, plus others Author: Dave Page Reviewed-by: Stephen Frost, Robert Haas, Peter Eisentraut, Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/25fff40798fc4ac11a241bfd9ab0c45c085e2212">http://git.postgresql.org/pg/commitdiff/25fff40798fc4ac11a241bfd9ab0c45c085e2212</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Remove support for version-0 calling conventions. The V0 convention is failure prone because we've so far assumed that a function is V0 if PG_FUNCTION_INFO_V1 is missing, leading to crashes if a function was coded against the V1 interface. V0 doesn't allow proper NULL, SRF and toast handling. V0 doesn't offer features that V1 doesn't. Thus remove V0 support and obsolete fmgr README contents relating to it. Author: Andres Freund, with contributions by Peter Eisentraut &amp; Craig Ringer Reviewed-By: Peter Eisentraut, Craig Ringer Discussion: <a target="_blank" href="https://postgr.es/m/20161208213441.k3mbno4twhg2qf7g@alap3.anarazel.de">https://postgr.es/m/20161208213441.k3mbno4twhg2qf7g@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5ded4bd21403e143dd3eb66b92d52732fdac1945">http://git.postgresql.org/pg/commitdiff/5ded4bd21403e143dd3eb66b92d52732fdac1945</a></li>
<li>Move contrib/seg to only use V1 calling conventions. A later commit will remove V0 support. Author: Andres Freund, with contributions by Craig Ringer Reviewed-By: Peter Eisentraut, Craig Ringer Discussion: <a target="_blank" href="https://postgr.es/m/20161208213441.k3mbno4twhg2qf7g@alap3.anarazel.de">https://postgr.es/m/20161208213441.k3mbno4twhg2qf7g@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/389bb2818f404d5b967f21e1ac4f987f894e94bb">http://git.postgresql.org/pg/commitdiff/389bb2818f404d5b967f21e1ac4f987f894e94bb</a></li>
<li>Try to fix xml docs build broken in 5ded4bd. Apparently the sgml to xml conversion treats non-closed &lt;para&gt;s differently than jade does. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ffae6733db1f9d4a3a75d737a00ee2a4a3e01849">http://git.postgresql.org/pg/commitdiff/ffae6733db1f9d4a3a75d737a00ee2a4a3e01849</a></li>
<li>Based on the infrastructure added in b8d7f053c5c2b, this allows. expressions in expensive queries to be compiled to native code. In TPC-H this yields up to 40% of speedups. Whenever a query has a total cost over jit_expression_minimum, all expressions in it will be JIT compiled. That allows to perform JIT compilation of all expressions in one go, which is a lot more efficient. Originally slated for v11, discussions at pgconf.us convinced me to add this to v10. Author: Andres Freund Reviewed-By: Robert Haas, Heikki Linnakangas Discussion: <a target="_blank" href="http://postgr.es/m/20161206034955.bh33paeralxbtluv@alap3.anarazel.de">http://postgr.es/m/20161206034955.bh33paeralxbtluv@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d31084e9d1118b25fd16580d9d8c2924b5740dff">http://git.postgresql.org/pg/commitdiff/d31084e9d1118b25fd16580d9d8c2924b5740dff</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Simplify the example of VACUUM in documentation. Previously a detailed activity report by VACUUM VERBOSE ANALYZE was described as an example of VACUUM in docs. But it had been obsolete for a long time. For example, commit feb4f44d296b88b7f0723f4a4f3945a371276e0b updated the content of that activity report in 2003, but we had forgotten to update the example. So basically we need to update the example. But since no one cared about the details of VACUUM output and complained about that mistake for such long time, per discussion on hackers, we decided to get rid of the detailed activity report from the example and simplify it. Back-patch to all supported versions. Reported by Masahiko Sawada, patch by me. Discussion: <a target="_blank" href="https://postgr.es/m/CAD21AoAGA2pB3p-CWmTkxBsbkZS1bcDGBLcYVcvcDxspG_XAfA@mail.gmail.com">https://postgr.es/m/CAD21AoAGA2pB3p-CWmTkxBsbkZS1bcDGBLcYVcvcDxspG_XAfA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ec19693014ed48fa1d8c7e0ce450795f752c4456">http://git.postgresql.org/pg/commitdiff/ec19693014ed48fa1d8c7e0ce450795f752c4456</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix typo in comment. Daniel Gustafsson <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/156d3882f89d2a224029e4c81adacd279eb1cdfc">http://git.postgresql.org/pg/commitdiff/156d3882f89d2a224029e4c81adacd279eb1cdfc</a></li>
<li>Write "waiting for checkpoint" on regular progress row. When reporting progress, make the "waiting for checkpoint" test be overwritten by the file-based progress once it's completed. This is more consistent with how we report the rest of the progress. Suggested by Jeff Janes <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7220c7b3e5c847227fbfe53bbaca326044674a6c">http://git.postgresql.org/pg/commitdiff/7220c7b3e5c847227fbfe53bbaca326044674a6c</a></li>
<li>Fix some typos and spelling errors in comments. Author: Erik Rijkers <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/130ae4a5478b3b3965779ece1436fa3611aa957f">http://git.postgresql.org/pg/commitdiff/130ae4a5478b3b3965779ece1436fa3611aa957f</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Transform or iterate over json(b) string values. Dmitry Dolgov, reviewed and lightly edited by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c80b9920fcbcbf75e3d7e8fe092bf6e15d9d40b8">http://git.postgresql.org/pg/commitdiff/c80b9920fcbcbf75e3d7e8fe092bf6e15d9d40b8</a></li>
<li>Full Text Search support for json and jsonb. The new functions are ts_headline() and to_tsvector. Dmitry Dolgov, edited and documented by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e306df7f9cd6b4433273e006df11bdc966b7079e">http://git.postgresql.org/pg/commitdiff/e306df7f9cd6b4433273e006df11bdc966b7079e</a></li>
</ul>
<p>Kevin Grittner pushed:</p>
<ul>
<li>Add transition table support to plpgsql. Kevin Grittner and Thomas Munro Reviewed by Heikki Linnakangas, David Fetter, and Thomas Munro with valuable comments and suggestions from many others <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/59702716324ab9c07b02fb005dcf14c7f48c4632">http://git.postgresql.org/pg/commitdiff/59702716324ab9c07b02fb005dcf14c7f48c4632</a></li>
<li>Add infrastructure to support EphemeralNamedRelation references. A QueryEnvironment concept is added, which allows new types of objects to be passed into queries from parsing on through execution. At this point, the only thing implemented is a collection of EphemeralNamedRelation objects -- relations which can be referenced by name in queries, but do not exist in the catalogs. The only type of ENR implemented is NamedTuplestore, but provision is made to add more types fairly easily. An ENR can carry its own TupleDesc or reference a relation in the catalogs by relid. Although these features can be used without SPI, convenience functions are added to SPI so that ENRs can easily be used by code run through SPI. The initial use of all this is going to be transition tables in AFTER triggers, but that will be added to each PL as a separate commit. An incidental effect of this patch is to produce a more informative error message if an attempt is made to modify the contents of a CTE from a referencing DML statement. No tests previously covered that possibility, so one is added. Kevin Grittner and Thomas Munro Reviewed by Heikki Linnakangas, David Fetter, and Thomas Munro with valuable comments and suggestions from many others <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/18ce3a4ab22d2984f8540ab480979c851dae5338">http://git.postgresql.org/pg/commitdiff/18ce3a4ab22d2984f8540ab480979c851dae5338</a></li>
<li>Try to fix breakage of sepgsql hooks by ENR patch. Turned up by buildfarm animal rhinoceros. Fixing blind. Will have to wait for next run by rhinoceros to know whether it worked. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/01fd6f8f2d15a9369768921d6fc95ac481779430">http://git.postgresql.org/pg/commitdiff/01fd6f8f2d15a9369768921d6fc95ac481779430</a></li>
<li>Fix two undocumented parameters to functions from ENR patch. On ProcessUtility document the parameter, to match others. On CreateCachedPlan drop the queryEnv parameter. It was not referenced within the function, and had been added on the assumption that with some unknown future usage of QueryEnvironment it might be useful to do something there. We have avoided other "just in case" implementation of unused paramters, so drop it here. Per gripe from Tom Lane <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/41bd155dd656e7f17c02855be7aff234843347cd">http://git.postgresql.org/pg/commitdiff/41bd155dd656e7f17c02855be7aff234843347cd</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Kyotaro HORIGUCHI sent in a patch to add encoding_dumper and map_dumper.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two more revisions of a patch to change detection of corrupted 2PC files as FATAL and minimize window between history file and end-of-recovery.</p>
<p>Nikhil Sontakke sent in another revision of a patch to speed up two-phase transactions.</p>
<p>Stas Kelvich and Craig Ringer traded patches to implement logical decoding of two-phase transactions.</p>
<p>Haribabu Kommi sent in three more revisions of a patch to implement a pg_stat_wal_write statistics view.</p>
<p>Ashutosh Bapat sent in two more revisions of a patch to implement partition-wise join for declaratively partitioned tables.</p>
<p>Kyotaro HORIGUCHI sent in a patch to fix a bug in physical replication slots.</p>
<p>Beena Emerson sent in another revision of a patch to allow increasing the default WAL segment size.</p>
<p>Amit Khandekar sent in two more revisions of a patch to enable UPDATE of partition key for declaratively partitioned tables.</p>
<p>Vaishnavi Prabakaran sent in two more revisions of a patch to implement batch/pipelining support for libpq.</p>
<p>Pavan Deolasee sent in six more revisions of a patch to implement WARM.</p>
<p>Mithun Cy sent in eight more revisions of a patch to expand hash indexes more efficiently.</p>
<p>Ashutosh Sharma sent in two more revisions of a patch to fix a failed assertion found by sqlsmith in _hash_kill_items/MarkBufferDirtyHint.</p>
<p>Pavel St&Auml;&rsaquo;hule and Surafel Temesgen traded patches to add CORRESPONDING.</p>
<p>Dmitry Dolgov sent in three more revisions of a patch to implement generic type subscripting.</p>
<p>Ashutosh Sharma sent in three more revisions of a patch to rewrite hash index scans to work a page at a time, remove redundant function _hash_step() and some of the unused members of HashScanOpaqueData, and improve the locking strategy during VACUUM in hash index.</p>
<p>Jan Mich&Atilde;&iexcl;lek sent in four more revisions of a patch to add markdown and rst to psql's output formats.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add an xmltable doc fix and example for XMLNAMESPACES.</p>
<p>Pavel St&Auml;&rsaquo;hule and Petr Jel&Atilde;&shy;nek traded patches to add a plan_cache control PRAGMA to pl/pgsql.</p>
<p>Jeff Janes sent in a patch to fix an infelicity between free space map and visibility map.</p>
<p>Claudio Freire sent in another revision of a patch for VACUUM which frees the dead tuples array as early as possible.</p>
<p>Jim Nasby sent in a patch to fix a missing increment of vacrelstats-&gt;pinskipped_pages.</p>
<p>Ashutosh Bapat and Amit Langote traded patches to fix a comment in src/backend/optimizer/path/allpaths.c.</p>
<p>Haribabu Kommi sent in another revision of a patch to refactor handling of database attributes between pg_dump and pg_dumpall.</p>
<p>Kyotaro HORIGUCHI sent in a patch to show vacuum aggressiveness in autovacuum logs.</p>
<p>Alexander Law sent in a patch to remove trailing spaces in strings in the source code.</p>
<p>Daniel Gustafsson sent in a patch to use American English spelling in pg_waldump error message.</p>
<p>Nikhil Sontakke sent in another revision of a patch to move all am-related reloption code into src/backend/access/[am-name] and get rid of relopt_kind for custom AM.</p>
<p>Alexander Korotkov sent in another revision of a patch to implement incremental sort.</p>
<p>Masahiko Sawada sent in another revision of a patch to implement support for transactions involving multiple postgres foreign servers.</p>
<p>Daniel Gustafsson sent in a patch to error out more informatively when multiple TO VERSION arguments are supplied to ALTER EXTENSION.</p>
<p>Takeshi Ideriha sent in another revision of a patch to implement DECLARE STATEMENT setting up a connection in ECPG.</p>
<p>Peter Eisentraut sent in a patch to adjust min/max values when changing sequence type.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement IDENTITY columns.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in three more revisions of a patch to allow interrupts on waiting standby.</p>
<p>Vinayak Pokale sent in another revision of a patch to implement an ANALYZE command progress checker.</p>
<p>Tomas Vondra sent in two more revisions of a patch to add page_checksum and bt_page_items(bytea) to page_inspect.</p>
<p>Ashutosh Sharma sent in a patch to fix an issue that manifested as an inconsistent page found on STANDBY server.</p>
<p>Takayuki Tsunakawa sent in another revision of a patch to implement huge pages on Windows.</p>
<p>Kuntal Ghosh sent in a patch to fix some strange parallel query behavior after OOM crashes.</p>
<p>David Rowley sent in two more revisions of a patch to fix functional dependencies in materialized views in light of the extended statistics recently committed.</p>
<p>Thomas Munro sent in another revision of a patch to implement [[Parallel] Shared] Hash.</p>
<p>Anastasia Lubennikova and Teodor Sigaev traded patches to add covering + unique indexes.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to implement SASLprep aka NFKC for SCRAM authentication.</p>
<p>Aleksander Alekseev sent in a patch to remove an unused argument in btree_xlog_split.</p>
<p>Etsuro Fujita sent in another revision of a patch to add epqpath support for foreign joins.</p>
<p>Masahiko Sawada sent in a patch to remove some dead code from the table sync worker.</p>
<p>Fabien COELHO sent in a patch to refactor psql's ef/ev and sf/sv handling functions so they're not copypasta.</p>
<p>Feike Steenbergen sent in a patch to fix an issue where passwords in user mappings were leaked by psql's \deu+ command.</p>
<p>Alexander Korotkov sent in another revision of a patch to implement a LWLock optimization for multicore Power machines.</p>
<p>Takayuki Tsunakawa sent in a patch to fix an issue where savepoint-related statements in a multi-command query terminates the connection unexpectedly.</p>
<p>Mike Palmiotto sent in two revisions of a patch to silence some sepgsql compiler warnings and add partitioned table support to sepgsql.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to use weaker locks when updating subscription relation state.</p>
<p>Dilip Kumar sent in a patch to ensure that parallel bitmapscan is exercised in regression tests.</p>
<p>David Rowley sent in another revision of a patch to improve performance for outer joins where the outer side is unique.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/04/05/Nouvelles-hebdomadaires-de-PostgreSQL-2-avril-2017">par chl le mardi  4 avril 2017 à 22h08</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi 21 mars 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:6f17bd26a720ead75350394f4eed80da" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/03/21/Nouvelles-hebdomadaires-de-PostgreSQL-19-mars-2017">Nouvelles hebdomadaires de PostgreSQL - 19 mars 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pgpool versions 3.6.2, 3.5.6, 3.4.10, 3.3.14 et 3.2.19 publi&eacute;es. <a target="_blank" href="http://pgpool.net/mediawiki/index.php/Downloads">http://pgpool.net/mediawiki/index.php/Downloads</a></li>
<li>Postgresqltuner, un programme d'analyse et d'affinage de la configuration de PostgreSQL&nbsp;: <a target="_blank" href="https://github.com/jfcoz/postgresqltuner">https://github.com/jfcoz/postgresqltuner</a></li>
<li>psycopg2 2.7.1, un connecteur python pour PostgreSQL&nbsp;: <a target="_blank" href="http://initd.org/psycopg/articles/2017/03/13/psycopg-271-released/">http://initd.org/psycopg/articles/2017/03/13/psycopg-271-released/</a></li>
<li>pg_chameleon beta 1 est disponible. Tests et retours souhait&eacute;s [ndt: réplication MySQL vers PostgreSQL]&nbsp;: <a target="_blank" href="https://pypi.python.org/pypi/pg_chameleon">https://pypi.python.org/pypi/pg_chameleon</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en mars</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-03/">http://archives.postgresql.org/pgsql-jobs/2017-03/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
<li>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170320021208.GB30492@fetter.org">http://www.postgresql.org/message-id/20170320021208.GB30492@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>Remove dead code in nodeGatherMerge.c. Coverity noted that the last line of gather_merge_getnext() was unreachable, since each arm of the preceding "if" ends in a "return". Drop it as an oversight. In passing, improve some nearby comments. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5d3f7c57ab9c9e2f074ad29d619056570fc5c51e">http://git.postgresql.org/pg/commitdiff/5d3f7c57ab9c9e2f074ad29d619056570fc5c51e</a></li>
<li>Fix typo in initdb's SCRAM password processing. Noted by Coverity (a rather impressive catch). Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/835cc1136745e8cf02d3d0231b5b7c7a543df5df">http://git.postgresql.org/pg/commitdiff/835cc1136745e8cf02d3d0231b5b7c7a543df5df</a></li>
<li>Add "break"s to make it clearer what will happen in a nested switch. This could only matter if the guessed_type variable had a value that wasn't a member of the PasswordType enum; but just in case, let's be sure that control falls out to reach the elog(ERROR) at the end of the function. Per gripe from Coverity. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/766f7fd613adbceaf1b40803793e10dc487f8596">http://git.postgresql.org/pg/commitdiff/766f7fd613adbceaf1b40803793e10dc487f8596</a></li>
<li>Remove unnecessary dependency on statement_timeout in prepared_xacts test. Rather than waiting around for statement_timeout to expire, we can just try to take the table's lock in nowait mode. This saves some fraction under 4 seconds when running this test with prepared xacts available, and it guards against timeout-expired-anyway failures on very slow machines when prepared xacts are not available, as seen in a recent failure on axolotl for instance. This approach could fail if autovacuum were to take an exclusive lock on the test table concurrently, but there's no reason for it to do so. Since the main point here is to improve stability in the buildfarm, back-patch to all supported branches. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1c7a66a8e9378aeb092d7ed26890134d17fdd691">http://git.postgresql.org/pg/commitdiff/1c7a66a8e9378aeb092d7ed26890134d17fdd691</a></li>
<li>Add a "void *" passthrough pointer for psqlscan.l's callback functions. The immediate motivation for this is to provide clean infrastructure for the proposed \if...\endif patch for psql; but it seems like a good thing to have even if that patch doesn't get in. Previously the callback functions could only make use of application-global state, which is a pretty severe handicap. For the moment, the pointer is only passed through to the get_variable callback function. I considered also passing it to the write_error callback, but for now let's not. Neither psql nor pgbench has a use for that, and in the case of psql we'd have to invent a separate wrapper function because we would certainly not want to change the signature of psql_error(). Discussion: <a target="_blank" href="https://postgr.es/m/10108.1489418309@sss.pgh.pa.us">https://postgr.es/m/10108.1489418309@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/895e36bb3f36fdb7ec8e573be1a20d104fac820b">http://git.postgresql.org/pg/commitdiff/895e36bb3f36fdb7ec8e573be1a20d104fac820b</a></li>
<li>Fix busted markup. Oversight in commit 9ca5c8721. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0c87cd003d9966fcb19d6998ccf90d3276b08e0c">http://git.postgresql.org/pg/commitdiff/0c87cd003d9966fcb19d6998ccf90d3276b08e0c</a></li>
<li>Make logging about multixact wraparound protection less chatty. The original messaging design, introduced in commit 068cfadf9, seems too chatty now that some time has elapsed since the bug fix; most installations will be in good shape and don't really need a reminder about this on every postmaster start. Hence, arrange to suppress the "wraparound protections are now enabled" message during startup (specifically, during the TrimMultiXact() call). The message will still appear if protection becomes effective at some later point. Discussion: <a target="_blank" href="https://postgr.es/m/17211.1489189214@sss.pgh.pa.us">https://postgr.es/m/17211.1489189214@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5ed6fff6b729c3cce55d4abc8f695da93aa40a0d">http://git.postgresql.org/pg/commitdiff/5ed6fff6b729c3cce55d4abc8f695da93aa40a0d</a></li>
<li>Include port number when logging successful binding to a TCP port. Per suggestion from Andres Freund. Discussion: <a target="_blank" href="https://postgr.es/m/20170314033842.st7gifec55yigz2h@alap3.anarazel.de">https://postgr.es/m/20170314033842.st7gifec55yigz2h@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2b32ac2a59df18246c3b79e96a209bfdb39bb918">http://git.postgresql.org/pg/commitdiff/2b32ac2a59df18246c3b79e96a209bfdb39bb918</a></li>
<li>Rewrite async-connection loop in libpqwalreceiver.c, once again. The original coding in commit 1e8a85009 didn't use PQconnectPoll per spec, and while the rewrite in e434ad39a is closer, it still doesn't guarantee to wait until the socket is read-ready or write-ready (as appropriate) before calling PQconnectPoll. It's not clear whether that omission is causing the continuing failures on buildfarm member bowerbird; but given the lack of other explanations meeting the available facts, let's tighten that up and see what happens. An independent issue in the same loop was that it had a race condition whereby it could clear the process's latch without having serviced an interrupt request, causing failure to respond to a cancel while waiting for connection (the very problem 1e8a85009 was meant to fix). Discussion: <a target="_blank" href="https://postgr.es/m/7295.1489596949@sss.pgh.pa.us">https://postgr.es/m/7295.1489596949@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b5dd50f2c0ad8edcc3145aabe18788d448bf940d">http://git.postgresql.org/pg/commitdiff/b5dd50f2c0ad8edcc3145aabe18788d448bf940d</a></li>
<li>Fix WaitEventSetWait() to handle write-ready waits properly on Windows. Windows apparently will not detect socket write-ready events unless a preceding send attempt returned WSAEWOULDBLOCK. In many usage patterns that's satisfied by the caller of WaitEvenSetWait(), but not always. Apply the same solution that we already had in pgwin32_select(), namely to perform a dummy WSASend() call with len=0. This will return WSAEWOULDBLOCK if there's no buffer space (even though it could legitimately do nothing and report success, which makes me a bit nervous about this solution; but since it's been working fine in libpq, let's roll with it). In passing, improve the comments about this in pgwin32_select(), and remove duplicated code there. Back-patch to 9.6 where WaitEventSetWait() was introduced. We might need to back-patch something similar into predecessor code. But given the lack of complaints so far, it's not clear that the case ever gets exercised in the back branches, so I'm not going to expend effort on it right now. This should resolve recurring failures on buildfarm member bowerbird, which has been failing since 1e8a85009 went in. Diagnosis and patch by Petr Jelinek, cosmetic adjustments by me. Discussion: <a target="_blank" href="https://postgr.es/m/5b6a6d6d-fb45-0afb-2e95-5600063c3dbd@2ndquadrant.com">https://postgr.es/m/5b6a6d6d-fb45-0afb-2e95-5600063c3dbd@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f7819baa618c528f60e266874051563ecfe08207">http://git.postgresql.org/pg/commitdiff/f7819baa618c528f60e266874051563ecfe08207</a></li>
<li>Fix REFRESH MATERIALIZED VIEW to report activity to the stats collector. The non-concurrent code path for REFRESH MATERIALIZED VIEW failed to report its updates to the stats collector. This is bad since it means auto-analyze doesn't know there's any work to be done. Adjust it to report the refresh as a table truncate followed by insertion of an appropriate number of rows. Since a matview could contain more than INT_MAX rows, change the signature of pgstat_count_heap_insert() to accept an int64 rowcount. (The accumulator it's adding into is already int64, but existing callers could not insert more than a small number of rows at once, so the argument had been declared just "int n".) This is surely a bug fix, but changing pgstat_count_heap_insert()'s API seems too risky for the back branches. Given the lack of previous complaints, I'm not sure it's a big enough problem to justify a kluge solution that would avoid that. So, no back-patch, at least for now. Jim Mlodgenski, adjusted a bit by me Discussion: <a target="_blank" href="https://postgr.es/m/CAB_5SRchSz7-WmdO5szdiknG8Oj_GGqJytrk1KRd11yhcMs1KQ@mail.gmail.com">https://postgr.es/m/CAB_5SRchSz7-WmdO5szdiknG8Oj_GGqJytrk1KRd11yhcMs1KQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/17f8ffa1e331cd0d95a3c4ccec66ea83d8b893c5">http://git.postgresql.org/pg/commitdiff/17f8ffa1e331cd0d95a3c4ccec66ea83d8b893c5</a></li>
<li>Avoid use of already-closed relcache entry. Oversight in commit 17f8ffa1e. Per buildfarm member prion. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e3044f6184beac395e88b4e1230e6c9d449db7f2">http://git.postgresql.org/pg/commitdiff/e3044f6184beac395e88b4e1230e6c9d449db7f2</a></li>
</ul>
<p>Noah Misch pushed:</p>
<ul>
<li>Assume deconstruct_array() outputs are untoasted. In functions that issue a deconstruct_array() call, consistently use plain VARSIZE()/VARDATA() on the array elements. Prior practice was divided between those and VARSIZE_ANY_EXHDR()/VARDATA_ANY(). <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2fd26b23b662dcb0cf649e983a58581cb911fc4b">http://git.postgresql.org/pg/commitdiff/2fd26b23b662dcb0cf649e983a58581cb911fc4b</a></li>
<li>Fix comment about length of text, bytea, etc. When commit 3e23b68dac006e8deb0afa327e855258df8de064 introduced single-byte varlena headers, it rendered this comment incomplete. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9e0926468a1c41a31c09785787a737311dcd92c1">http://git.postgresql.org/pg/commitdiff/9e0926468a1c41a31c09785787a737311dcd92c1</a></li>
<li>Recommend wrappers of PG_DETOAST_DATUM_PACKED(). When commit 3e23b68dac006e8deb0afa327e855258df8de064 introduced single-byte varlena headers, its fmgr.h changes presented PG_GETARG_TEXT_PP() and PG_GETARG_TEXT_P() as equals. Its postgres.h changes presented PG_DETOAST_DATUM_PACKED() and VARDATA_ANY() as the exceptional case. Now, instead, firmly recommend PG_GETARG_TEXT_PP() over PG_GETARG_TEXT_P(); likewise for other ...PP() macros. This shaves cycles and invites consistency of style. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9d7726c2ba06b932f791f2d0cc5acf73cc0b4dca">http://git.postgresql.org/pg/commitdiff/9d7726c2ba06b932f791f2d0cc5acf73cc0b4dca</a></li>
<li>Use wrappers of PG_DETOAST_DATUM_PACKED() more. This makes almost all core code follow the policy introduced in the previous commit. Specific decisions: * Text search support functions with char* and length arguments, such as prsstart and lexize, may receive unaligned strings. I doubt maintainers of non-core text search code will notice. * Use plain VARDATA() on values detoasted or synthesized earlier in the same function. Use VARDATA_ANY() on varlenas sourced outside the function, even if they happen to always have four-byte headers. As an exception, retain the universal practice of using VARDATA() on return values of SendFunctionCall(). * Retain PG_GETARG_BYTEA_P() in pageinspect. (Page images are too large for a one-byte header, so this misses no optimization.) Sites that do not call get_page_from_raw() typically need the four-byte alignment. * For now, do not change btree_gist. Its use of four-byte headers in memory is partly entangled with storage of 4-byte headers inside GBT_VARKEY, on disk. * For now, do not change gtrgm_consistent() or gtrgm_distance(). They incorporate the varlena header into a cache, and there are multiple credible implementation strategies to consider. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3a0d473192b2045cbaf997df8437e7762d34f3ba">http://git.postgresql.org/pg/commitdiff/3a0d473192b2045cbaf997df8437e7762d34f3ba</a></li>
<li>Fix pg_file_write() error handling. Detect fclose() failures; given "ln -s /dev/full $PGDATA/devfull", "pg_file_write('devfull', 'x', true)" now fails as it should. Don't leak a stream when fwrite() fails. Remove a born-ineffective test that aimed to skip zero-length writes. Back-patch to 9.2 (all supported versions). <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/944a026b4ec252667f275768ba4dcd53ae3bb07e">http://git.postgresql.org/pg/commitdiff/944a026b4ec252667f275768ba4dcd53ae3bb07e</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix typo in comment. Masahiko Sawada <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1bfebffe81d02e6124fc604ae4293c6487ef7e83">http://git.postgresql.org/pg/commitdiff/1bfebffe81d02e6124fc604ae4293c6487ef7e83</a></li>
<li>Update obsolete comment. Commit ff27db5d changed this function to no longer return the start position, but forgot the comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/839da3c7d9b76b178910ce2999f7cbbdf6e91f70">http://git.postgresql.org/pg/commitdiff/839da3c7d9b76b178910ce2999f7cbbdf6e91f70</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>initdb: Re-add translatable string that got lost. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d69fae203c8223c45ae1201acce46e8beb0eb6ee">http://git.postgresql.org/pg/commitdiff/d69fae203c8223c45ae1201acce46e8beb0eb6ee</a></li>
<li>Change xlog to WAL in some error messages. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e6de941e38fde512cadf33e55e644492f12abd1">http://git.postgresql.org/pg/commitdiff/1e6de941e38fde512cadf33e55e644492f12abd1</a></li>
<li>Fix compiler warning. From: David Rowley &lt;david.rowley@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/57488c1ce32181730a2724ceaad973c9bc2d7c3a">http://git.postgresql.org/pg/commitdiff/57488c1ce32181730a2724ceaad973c9bc2d7c3a</a></li>
<li>doc: Fix synopsis. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/37289ffdbfc7319a3cdb271b11227bf682f76d90">http://git.postgresql.org/pg/commitdiff/37289ffdbfc7319a3cdb271b11227bf682f76d90</a></li>
<li>Spelling fixes. From: Josh Soref &lt;jsoref@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a47b38c9ee4960556b0edb76a42171bd281cc1cf">http://git.postgresql.org/pg/commitdiff/a47b38c9ee4960556b0edb76a42171bd281cc1cf</a></li>
<li>Spelling fixes in code comments. From: Josh Soref &lt;jsoref@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f97a028d8ee3e7d64a93285707af94b612c47651">http://git.postgresql.org/pg/commitdiff/f97a028d8ee3e7d64a93285707af94b612c47651</a></li>
<li>ecpg: Improve some variable names. based on patch from Josh Soref &lt;jsoref@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/100871c2d10f1aca80824a979d926c96db3a0af2">http://git.postgresql.org/pg/commitdiff/100871c2d10f1aca80824a979d926c96db3a0af2</a></li>
<li>Add option to control snapshot export to CREATE_REPLICATION_SLOT. We used to export snapshots unconditionally in CREATE_REPLICATION_SLOT in the replication protocol, but several upcoming patches want more control over what happens. Suppress snapshot export in pg_recvlogical, which neither needs nor can use the exported snapshot. Since snapshot exporting can fail this improves reliability. This also paves the way for allowing the creation of replication slots on standbys, which cannot export snapshots because they cannot allocate new XIDs. Author: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/eb4da3e3807d2054bb05c3eb201cb9a363682f09">http://git.postgresql.org/pg/commitdiff/eb4da3e3807d2054bb05c3eb201cb9a363682f09</a></li>
<li>doc: Fix TOC generation for refentries. The XSLT stylesheets by default don't show refentries inside sections in table of contents, which for our documentation leads to some regressions compared to the DSSSL output. For example, in the SPI chapter, which is mostly refentries, you don't get any usable table of contents. Tweak things so it's mostly back to what it was before. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0c068205df5299fa41bce8ac33acdc9cfa5e7c6a">http://git.postgresql.org/pg/commitdiff/0c068205df5299fa41bce8ac33acdc9cfa5e7c6a</a></li>
<li>doc: Remove useless elements in bibliography. Under DSSSL, bibliodiv/para elements didn't show up, but under XSLT they do, but they are kind of useless here, so remove them. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3f6ea5fc8d9c6d7c85827c87a717be0016d06b89">http://git.postgresql.org/pg/commitdiff/3f6ea5fc8d9c6d7c85827c87a717be0016d06b89</a></li>
<li>Allow referring to functions without arguments when unique. In DDL commands referring to an existing function, allow omitting the argument list if the function name is unique in its schema, per SQL standard. This uses the same logic that the regproc type uses for finding functions by name only. Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aefeb68741fb9456f14b4d690b0c646e532fea6b">http://git.postgresql.org/pg/commitdiff/aefeb68741fb9456f14b4d690b0c646e532fea6b</a></li>
<li>Add more documentation and tests for publications. Add/correct documentation and add some tests related to how access control around adding tables to publications works. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e76db009f079ece9408e37336887bc6457cc1fc6">http://git.postgresql.org/pg/commitdiff/e76db009f079ece9408e37336887bc6457cc1fc6</a></li>
<li>Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f2a9998fb34c768d8870bd34daa4c298999fee00">http://git.postgresql.org/pg/commitdiff/f2a9998fb34c768d8870bd34daa4c298999fee00</a></li>
<li>Simplify publication/subscription tests a bit. After testing RENAME TO, rename the object back. This reduces the merge mess when subsequent patches add test cases before or after the rename test. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bd1827c7c961568eabe850df254c60d175bec195">http://git.postgresql.org/pg/commitdiff/bd1827c7c961568eabe850df254c60d175bec195</a></li>
<li>psql: Add completion for \help DROP|ALTER. While \help CREATE would complete usefully, \help DROP or \help ALTER did not complete anything. Expand the list of things after CREATE and DROP to cover ALTER as well, and use that for the ALTER completion. Also make minor tweaks to that list. Also add support for completing \help on multiword commands like CREATE TEXT SEARCH ... Author: Andreas Karlsson &lt;andreas@proxel.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d7d77f3825122bde55be9e06f6c4851028b99795">http://git.postgresql.org/pg/commitdiff/d7d77f3825122bde55be9e06f6c4851028b99795</a></li>
<li>pageinspect: Add test for page_header function. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a02731cb10535a6d5f66447295e7b8e22807f471">http://git.postgresql.org/pg/commitdiff/a02731cb10535a6d5f66447295e7b8e22807f471</a></li>
<li>pageinspect: Add page_checksum function. Author: Tomas Vondra &lt;tomas.vondra@2ndquadrant.com&gt; Reviewed-by: Ashutosh Sharma &lt;ashu.coek88@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fef2bcdcba0888c95ddf2a7535179c3b9a6a2f0e">http://git.postgresql.org/pg/commitdiff/fef2bcdcba0888c95ddf2a7535179c3b9a6a2f0e</a></li>
<li>doc: Correct row count in table. The incorrect count causes FOP to error out. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/164bdbe9c2412d90b62d6f145a43f9e41a90003b">http://git.postgresql.org/pg/commitdiff/164bdbe9c2412d90b62d6f145a43f9e41a90003b</a></li>
<li>doc: Tweak reference page header style. Change the header style of references pages in HTML and PDF output to be more like the old style under DSSSL. In particular, the page should start with a header containing the command name, instead of just "Name". <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cb5fa4130ed5bdd37a51ce8cade3c2a2461097b9">http://git.postgresql.org/pg/commitdiff/cb5fa4130ed5bdd37a51ce8cade3c2a2461097b9</a></li>
<li>doc: Update compatibility claim. Update outdated claim that TRUNCATE is a PostgreSQL extension. Add cross-links between DELETE and TRUNCATE references pages. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5e86bb51eaeeb5c70f64102f46c4431cb12999e9">http://git.postgresql.org/pg/commitdiff/5e86bb51eaeeb5c70f64102f46c4431cb12999e9</a></li>
<li>doc: Add markup. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a72188a35bbd71a8cc29f10eab27d4140d296b9d">http://git.postgresql.org/pg/commitdiff/a72188a35bbd71a8cc29f10eab27d4140d296b9d</a></li>
<li>doc: Improve wording. Link to CREATE and ALTER ROLE consistently, instead of mixing CREATE USER and ALTER ROLE. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/27f1f585fd7ee749cacd3de8c2c77a457ef4c288">http://git.postgresql.org/pg/commitdiff/27f1f585fd7ee749cacd3de8c2c77a457ef4c288</a></li>
<li>doc: Fix a few typos and awkward links. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/767ce36ff36747e334ce3e163d57d5376403db37">http://git.postgresql.org/pg/commitdiff/767ce36ff36747e334ce3e163d57d5376403db37</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Remove obsolete references to JIS0201.TXT JIS0208.TXT. We don't use those files anymore, since commit 1de9cc0dcc. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/84892692fdedb753cfdd9a63b318b47ec640915f">http://git.postgresql.org/pg/commitdiff/84892692fdedb753cfdd9a63b318b47ec640915f</a></li>
<li>Use radix tree for character encoding conversions. Replace the mapping tables used to convert between UTF-8 and other character encodings with new radix tree-based maps. Looking up an entry in a radix tree is much faster than a binary search in the old maps. As a bonus, the radix tree representation is also more compact, making the binaries slightly smaller. The "combined" maps work the same as before, with binary search. They are much smaller than the main tables, so it doesn't matter so much. However, the "combined" maps are now stored in the same .map files as the main tables. This seems more clear, since they're always used together, and generated from the same source files. Patch by Kyotaro Horiguchi, with lot of hacking by me at various stages. Reviewed by Michael Paquier and Daniel Gustafsson. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20170306.171609.204324917.horiguchi.kyotaro%40lab.ntt.co.jp">https://www.postgresql.org/message-id/20170306.171609.204324917.horiguchi.kyotaro%40lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aeed17d00037950a16cc5ebad5b5592e5fa1ad0f">http://git.postgresql.org/pg/commitdiff/aeed17d00037950a16cc5ebad5b5592e5fa1ad0f</a></li>
<li>Include array size in forward declaration. Some compilers require it. At least Visual Studio, according to the buildfarm, and gcc with the -pedantic flag. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dd12bef58ccee3596066cda9ded4fc6b3399d3ba">http://git.postgresql.org/pg/commitdiff/dd12bef58ccee3596066cda9ded4fc6b3399d3ba</a></li>
<li>Fix and simplify check for whether we're running as Windows service. If the process token contains SECURITY_SERVICE_RID, but it has been disabled by the SE_GROUP_USE_FOR_DENY_ONLY attribute, win32_is_service() would incorrectly report that we're running as a service. That situation arises, e.g. if postmaster is launched with a restricted security token, with the "Log in as Service" privilege explicitly removed. Replace the broken code with CheckProcessTokenMembership(), which does this correctly. Also replace similar code in win32_is_admin(), even though it got this right, for simplicity and consistency. Per bug #13755, reported by Breen Hagan. Back-patch to all supported versions. Patch by Takayuki Tsunakawa, reviewed by Michael Paquier. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20151104062315.2745.67143%40wrigleys.postgresql.org">https://www.postgresql.org/message-id/20151104062315.2745.67143%40wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff30aec759bdc4de78912d91f650ec8fd95ff6bc">http://git.postgresql.org/pg/commitdiff/ff30aec759bdc4de78912d91f650ec8fd95ff6bc</a></li>
<li>Allow plaintext 'password' authentication when user has a SCRAM verifier. Oversight in the main SCRAM patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c6305a9c572aaf3509ea90eec5127340dab89546">http://git.postgresql.org/pg/commitdiff/c6305a9c572aaf3509ea90eec5127340dab89546</a></li>
<li>Add TAP tests for password-based authentication methods. Tests all combinations of users with MD5, plaintext and SCRAM verifiers stored in pg_authid, with plain 'password', 'md5' and 'scram' authentication methods. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aa7464d949bf69ce1e8697f77400ff6b7ebb2d18">http://git.postgresql.org/pg/commitdiff/aa7464d949bf69ce1e8697f77400ff6b7ebb2d18</a></li>
</ul>
<p>Michael Meskes pushed:</p>
<ul>
<li>Document two phase commit commands in ecpg docu. Patch by Masahiko Sawada <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9ca5c8721dfa2413e910531373395c6e18062ddf">http://git.postgresql.org/pg/commitdiff/9ca5c8721dfa2413e910531373395c6e18062ddf</a></li>
<li>Ecpg should support COMMIT PREPARED and ROLLBACK PREPARED. The problem was that "begin transaction" was issued automatically before executing COMMIT/ROLLBACK PREPARED if not in auto commit. This fix by Masahiko Sawada fixes this. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/43c79c7d68044cb804ddf8f549dfc4cb895f8542">http://git.postgresql.org/pg/commitdiff/43c79c7d68044cb804ddf8f549dfc4cb895f8542</a></li>
<li>Add test case for two phase commit. Also by Masahiko Sawada. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/42fcad68a9c0e0ebecf6842888723cad1f9d5be2">http://git.postgresql.org/pg/commitdiff/42fcad68a9c0e0ebecf6842888723cad1f9d5be2</a></li>
<li>Fix schedule of ecpg test files to only try two-phase commit test when possible. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/928250aef5f8363825acbf58540328089c26b0d4">http://git.postgresql.org/pg/commitdiff/928250aef5f8363825acbf58540328089c26b0d4</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Silence unused variable compiler warning. Fallout from fcec6caafa2: mark a variable in set_tablefunc_size_estimates as used for asserts only. Also, the planner_rte_fetch() call is pointless with assertions disabled, so enclose it in a USE_ASSERT_CHECKING #ifdef; fix the same problem in set_subquery_size_estimates(). First problem noted by David Rowley, whose compiler is noisier than mine in this regard. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a9c074ba7ec2827832c2f5e2fa0de16bf4851b9b">http://git.postgresql.org/pg/commitdiff/a9c074ba7ec2827832c2f5e2fa0de16bf4851b9b</a></li>
<li>Fix ancient get_object_address_opf_member bug. The original coding was trying to use a TypeName as a string Value, which doesn't work; an oversight in my commit a61fd533. Repair. Also, make sure we cover the broken case in the relevant test script. Backpatch to 9.5. Discussion: <a target="_blank" href="https://postgr.es/m/20170315151829.bhxsvrp75xdxhm3n@alvherre.pgsql">https://postgr.es/m/20170315151829.bhxsvrp75xdxhm3n@alvherre.pgsql</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a3eac988c26706059ae74c740a1abcb588449abe">http://git.postgresql.org/pg/commitdiff/a3eac988c26706059ae74c740a1abcb588449abe</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Remove some bogus logic from create_gather_merge_plan. This logic was adapated from create_merge_append_plan, but the two cases aren't really analogous, because create_merge_append_plan is not projection-capable and must therefore have a tlist identical to that of the underlying paths. Overwriting the tlist of Gather Merge with whatever the underlying plan happens to produce is no good at all. Patch by me, reviewed by Rushabh Lathia, who also reported the issue and made an initial attempt at a fix. Discussion: <a target="_blank" href="http://postgr.es/m/CA+Tgmob_-oHEOBfT9S25bjqokdqv8e8xEmh9zOY+3MPr_LmuhA@mail.gmail.com">http://postgr.es/m/CA+Tgmob_-oHEOBfT9S25bjqokdqv8e8xEmh9zOY+3MPr_LmuhA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bce352fb46196340749cf907f3168b5f63969329">http://git.postgresql.org/pg/commitdiff/bce352fb46196340749cf907f3168b5f63969329</a></li>
<li>Update overlooked comment for Gather Merge. Commit 355d3993c53ed62c5b53d020648e4fbcfbf5f155 probably should have done this, but nobody noticed that it was needed. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a82178020de2c4b3576d0a079e11a431e382e4de">http://git.postgresql.org/pg/commitdiff/a82178020de2c4b3576d0a079e11a431e382e4de</a></li>
<li>Fix failure to mark init buffers as BM_PERMANENT. This could result in corruption of the init fork of an unlogged index if the ambuildempty routine for that index used shared buffers to create the init fork, which was true for brin, gin, gist, and hash indexes. Patch by me, based on an earlier patch by Michael Paquier, who also reviewed this one. This also incorporates an idea from Artur Zakirov. Discussion: <a target="_blank" href="http://postgr.es/m/CACYUyc8yccE4xfxhqxfh_Mh38j7dRFuxfaK1p6dSNAEUakxUyQ@mail.gmail.com">http://postgr.es/m/CACYUyc8yccE4xfxhqxfh_Mh38j7dRFuxfaK1p6dSNAEUakxUyQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/87f99820349bbb020d1d65dd739a910c6f9c813b">http://git.postgresql.org/pg/commitdiff/87f99820349bbb020d1d65dd739a910c6f9c813b</a></li>
<li>Update .gitignore. Commit 42fcad68a9c0e0ebecf6842888723cad1f9d5be2 failed to do this. Michael Paquier Discussion: <a target="_blank" href="http://postgr.es/m/CAB7nPqTXK9Qn8TmonPf29jNXGw_CA3fTDaRfgnbHCFYr-Tx6qw@mail.gmail.com">http://postgr.es/m/CAB7nPqTXK9Qn8TmonPf29jNXGw_CA3fTDaRfgnbHCFYr-Tx6qw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c6c099d31abd5ae22265787d4ab5fc9b3f563c87">http://git.postgresql.org/pg/commitdiff/c6c099d31abd5ae22265787d4ab5fc9b3f563c87</a></li>
<li>Fix regression in parallel planning against inheritance tables. Commit 51ee6f3160d2e1515ed6197594bda67eb99dc2cc accidentally changed the behavior around inheritance hierarchies; before, we always considered parallel paths even for very small inheritance children, because otherwise an inheritance hierarchy with even one small child wouldn't be eligible for parallelism. That exception was inadverently removed; put it back. In passing, also adjust the degree-of-parallelism comptuation for index-only scans not to consider the number of heap pages fetched. Otherwise, we'll avoid parallel index-only scans on tables that are mostly all-visible, which isn't especially logical. Robert Haas and Amit Kapila, per a report from Ashutosh Sharma. Discussion: <a target="_blank" href="http://postgr.es/m/CAE9k0PmgSoOHRd60SHu09aRVTHRSs8s6pmyhJKWHxWw9C_x+XA@mail.gmail.com">http://postgr.es/m/CAE9k0PmgSoOHRd60SHu09aRVTHRSs8s6pmyhJKWHxWw9C_x+XA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2609e91fcf9dcf36af40cd0c5b755dccf6057df6">http://git.postgresql.org/pg/commitdiff/2609e91fcf9dcf36af40cd0c5b755dccf6057df6</a></li>
<li>hash: Support WAL consistency checking. Kuntal Ghosh, reviewed by Amit Kapila and Ashutosh Sharma, with a few tweaks by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAGz5QCJLERUn_zoO0eDv6_Y_d0o4tNTMPeR7ivTLBg4rUrJdwg@mail.gmail.com">http://postgr.es/m/CAGz5QCJLERUn_zoO0eDv6_Y_d0o4tNTMPeR7ivTLBg4rUrJdwg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bb4a39637ac6155b4ed5a9f83d17921fb57400b6">http://git.postgresql.org/pg/commitdiff/bb4a39637ac6155b4ed5a9f83d17921fb57400b6</a></li>
<li>Some preliminary refactoring towards partitionwise join. Partitionwise join proposes add a concept of child join relations, which will have the same relationship with join relations as "other member" relations do with base relations. These relations will need some but not all of the handling that we currently have for join relations, and some but not all of the handling that we currently have for appendrels, since they are a mix of the two. Refactor a little bit so that the necessary bits of logic are exposed as separate functions. Ashutosh Bapat, reviewed and tested by Rajkumar Raghuwanshi and by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAFjFpRfqotRR6cM3sooBHMHEVdkFfAZ6PyYg4GRZsoMuW08HjQ@mail.gmail.com">http://postgr.es/m/CAFjFpRfqotRR6cM3sooBHMHEVdkFfAZ6PyYg4GRZsoMuW08HjQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c44c47a773bd9073012935a29b0264d95920412c">http://git.postgresql.org/pg/commitdiff/c44c47a773bd9073012935a29b0264d95920412c</a></li>
<li>hash: Add write-ahead logging support. The warning about hash indexes not being write-ahead logged and their use being discouraged has been removed. "snapshot too old" is now supported for tables with hash indexes. Most importantly, barring bugs, hash indexes will now be crash-safe and usable on standbys. This commit doesn't yet add WAL consistency checking for hash indexes, as we now have for other index types; a separate patch has been submitted to cure that lack. Amit Kapila, reviewed and slightly modified by me. The larger patch series of which this is a part has been reviewed and tested by &Atilde;lvaro Herrera, Ashutosh Sharma, Mark Kirkwood, Jeff Janes, and Jesper Pedersen. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1JOBX=YU33631Qh-XivYXtPSALh514+jR8XeD7v+K3r_Q@mail.gmail.com">http://postgr.es/m/CAA4eK1JOBX=YU33631Qh-XivYXtPSALh514+jR8XeD7v+K3r_Q@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c11453ce0aeaa377cbbcc9a3fc418acb94629330">http://git.postgresql.org/pg/commitdiff/c11453ce0aeaa377cbbcc9a3fc418acb94629330</a></li>
<li>Cosmetic fixes for hash index write-ahead logging. Amit Kapila. One of these was reported by Tom Lane. Discussion: <a target="_blank" href="http://postgr.es/m/5515.1489514099@sss.pgh.pa.us">http://postgr.es/m/5515.1489514099@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f7b711c8bcef46c67dc5345b983752ac833e51ad">http://git.postgresql.org/pg/commitdiff/f7b711c8bcef46c67dc5345b983752ac833e51ad</a></li>
<li>Fix MB regression tests for WAL-logging of hash indexes. Thomas Munro noted that these files still contained the now-removed deprecation message in the expected output. Patch by Amit Kapila Discussion: <a target="_blank" href="http://postgr.es/m/CAEepm=16HW_C+MBA27aOV9t4tQBU-vf1BT_yhRUTWZVMd9bq8A@mail.gmail.com">http://postgr.es/m/CAEepm=16HW_C+MBA27aOV9t4tQBU-vf1BT_yhRUTWZVMd9bq8A@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d8f356e1bd3382308b32eed01394879e20eb5158">http://git.postgresql.org/pg/commitdiff/d8f356e1bd3382308b32eed01394879e20eb5158</a></li>
<li>Add a regression test for snapshot too old with hash indexes. Amit Kapila, but I changed the comment not to be a copy-and-paste of an existing one, and instead referred to it. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1K0UJswCRf81WwJFO4H=+ZvbmKTNhAps-NkdmHRsq1GnQ@mail.gmail.com">http://postgr.es/m/CAA4eK1K0UJswCRf81WwJFO4H=+ZvbmKTNhAps-NkdmHRsq1GnQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/42bdaebf161841c8e248b197b7319779b8730323">http://git.postgresql.org/pg/commitdiff/42bdaebf161841c8e248b197b7319779b8730323</a></li>
<li>Fix failure to use clamp_row_est() for parallel joins. Commit 0c2070cefa0e5d097b715c9a3b9b5499470019aa neglected to use clamp_row_est() where it should have done so. Patch by me. Report by Amit Kapila. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1KPm8RYa1Kun3ZmQj9pb723b-EFN70j47Pid1vn3ByquA@mail.gmail.com">http://postgr.es/m/CAA4eK1KPm8RYa1Kun3ZmQj9pb723b-EFN70j47Pid1vn3ByquA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1ea60ad602f9e97246958b721c8fa7c713aa86eb">http://git.postgresql.org/pg/commitdiff/1ea60ad602f9e97246958b721c8fa7c713aa86eb</a></li>
<li>Port single-page btree vacuum logic to hash indexes. This is advantageous for hash indexes for the same reasons it's good for btrees: it accelerates space recycling, reducing bloat. Ashutosh Sharma, reviewed by Amit Kapila and by me. A bit of additional hacking by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAE9k0PkRSyzx8dOnokEpUi2A-RFZK72WN0h9DEMv_ut9q6bPRw@mail.gmail.com">http://postgr.es/m/CAE9k0PkRSyzx8dOnokEpUi2A-RFZK72WN0h9DEMv_ut9q6bPRw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6977b8b7f4dfb40896ff5e2175cad7fdbda862eb">http://git.postgresql.org/pg/commitdiff/6977b8b7f4dfb40896ff5e2175cad7fdbda862eb</a></li>
<li>postgres_fdw: Push down FULL JOINs with restriction clauses. The previous deparsing logic wasn't smart enough to produce subqueries when deparsing; make it smart enough to do that. However, we only do it that way when necessary, because it generates more complicated SQL which will be harder for any humans reading the queries to understand. Etsuro Fujita, reviewed by Ashutosh Bapat Discussion: <a target="_blank" href="http://postgr.es/m/c449261a-b033-dc02-9254-2fe5b7044795@lab.ntt.co.jp">http://postgr.es/m/c449261a-b033-dc02-9254-2fe5b7044795@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b30fb56b07a885f3476fe05920249f4832ca8da5">http://git.postgresql.org/pg/commitdiff/b30fb56b07a885f3476fe05920249f4832ca8da5</a></li>
<li>Add pg_ls_logdir() and pg_ls_waldir() functions. These functions are intended to be used by monitoring tools, and, unlike pg_ls_dir(), access to them can be granted to non-superusers, so that those monitoring tools can observe the principle of least privilege. Dave Page, revised by me, and also reviewed a bit by Thomas Munro. Discussion: <a target="_blank" href="http://postgr.es/m/CA+OCxow-X=D2fWdKy+HP+vQ1LtrgbsYQ=CshzZBqyFT5jOYrFw@mail.gmail.com">http://postgr.es/m/CA+OCxow-X=D2fWdKy+HP+vQ1LtrgbsYQ=CshzZBqyFT5jOYrFw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/befd73c50f11a6c6a6719dae20f0de7b7585bef4">http://git.postgresql.org/pg/commitdiff/befd73c50f11a6c6a6719dae20f0de7b7585bef4</a></li>
<li>Avoid access to uninitialized memory in shared tidbitmap iteration. Primarily, this didn't work correctly when the tidbitmap ended up empty. Dilip Kumar, per a report from Emre Hasegeli Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-ujHFKb8WSLhK54rfqQT3r2yiPQOyeBrCDsA4p9Fwp_jw@mail.gmail.com">http://postgr.es/m/CAFiTN-ujHFKb8WSLhK54rfqQT3r2yiPQOyeBrCDsA4p9Fwp_jw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/80824ddda30154d56c9f40fe47dd1900d44ced32">http://git.postgresql.org/pg/commitdiff/80824ddda30154d56c9f40fe47dd1900d44ced32</a></li>
<li>Fix grammar. This would have ben grammatical if the closing tag name were actually part of the output, but of course it's not. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b4ff8609dbad541d287b332846442b076a25a6df">http://git.postgresql.org/pg/commitdiff/b4ff8609dbad541d287b332846442b076a25a6df</a></li>
<li>Remove dead link. David Christensen Discussion: <a target="_blank" href="http://postgr.es/m/82299377-1480-4439-9ABA-5828D71AA22E@endpoint.com">http://postgr.es/m/82299377-1480-4439-9ABA-5828D71AA22E@endpoint.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bd9028b824c9c5f97795bb6b7b6f5ce38eb69f98">http://git.postgresql.org/pg/commitdiff/bd9028b824c9c5f97795bb6b7b6f5ce38eb69f98</a></li>
<li>Rename "pg_clog" directory to "pg_xact". Names containing the letters "log" sometimes confuse users into believing that only non-critical data is present. It is hoped this renaming will discourage ill-considered removals of transaction status data. Michael Paquier Discussion: <a target="_blank" href="http://postgr.es/m/CA+Tgmoa9xFQyjRZupbdEFuwUerFTvC6HjZq1ud6GYragGDFFgA@mail.gmail.com">http://postgr.es/m/CA+Tgmoa9xFQyjRZupbdEFuwUerFTvC6HjZq1ud6GYragGDFFgA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/88e66d193fbaf756b3cc9bf94cad116aacbb355b">http://git.postgresql.org/pg/commitdiff/88e66d193fbaf756b3cc9bf94cad116aacbb355b</a></li>
<li>Create and use wait events for read, write, and fsync operations. Previous commits, notably 53be0b1add7064ca5db3cd884302dfc3268d884e and 6f3bd98ebfc008cbd676da777bb0b2376c4c4bfa, made it possible to see from pg_stat_activity when a backend was stuck waiting for another backend, but it's also fairly common for a backend to be stuck waiting for an I/O. Add wait events for those operations, too. Rushabh Lathia, with further hacking by me. Reviewed and tested by Michael Paquier, Amit Kapila, Rajkumar Raghuwanshi, and Rahila Syed. Discussion: <a target="_blank" href="http://postgr.es/m/CAGPqQf0LsYHXREPAZqYGVkDqHSyjf=KsD=k0GTVPAuzyThh-VQ@mail.gmail.com">http://postgr.es/m/CAGPqQf0LsYHXREPAZqYGVkDqHSyjf=KsD=k0GTVPAuzyThh-VQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/249cf070e36721a65be74838c53acf8249faf935">http://git.postgresql.org/pg/commitdiff/249cf070e36721a65be74838c53acf8249faf935</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>amcheck: Harden tests against concurrent autovacuums. The previous coding of the test was vulnerable against autovacuum triggering work on one of the tables in check_btree.sql. For the purpose of the test it's entirely sufficient to check for locks taken by the current process, so add an appropriate restriction. While touching the test, expand it to also check for locks on the underlying relations, rather than just the indexes. Reported-By: Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/30354.1489434301@sss.pgh.pa.us">https://postgr.es/m/30354.1489434301@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/71504026556fc1494c9a7045aad9645f7d9e4cdf">http://git.postgresql.org/pg/commitdiff/71504026556fc1494c9a7045aad9645f7d9e4cdf</a></li>
<li>Improve isolation tests infrastructure. Previously if a directory had both isolationtester and plain regression tests, they couldn't be run in parallel, because they'd access the same files/directories. That, so far, only affected contrib/test_decoding. Rather than fix that locally in contrib/test_decoding, improve pg_regress_isolation_[install]check to use separate resources from plain regression tests. That requires a minor change in pg_regress, namely that the --outputdir is created if not already existing, that seems like good idea anyway. Use the improved helpers even where previously not used. Author: Tom Lane and Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/20170311194831.vm5ikpczq52c2drg@alap3.anarazel.de">https://postgr.es/m/20170311194831.vm5ikpczq52c2drg@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/60f826c5e62446d211e15ae31710562a26afc442">http://git.postgresql.org/pg/commitdiff/60f826c5e62446d211e15ae31710562a26afc442</a></li>
<li>Improve grammar / fix typos in snapbuild.c. Author: Erik Rijkers Discussion: <a target="_blank" href="https://postgr.es/m/797c6c4496a1ae49cc69e90aa768bac2@xs4all.nl">https://postgr.es/m/797c6c4496a1ae49cc69e90aa768bac2@xs4all.nl</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/61d0c320b55902d321e69de2ec4e9a355959ea2c">http://git.postgresql.org/pg/commitdiff/61d0c320b55902d321e69de2ec4e9a355959ea2c</a></li>
<li>Specify bindir in pg_isolation_regress_installcheck. It appears dcae5faccab64776376d3 forgot to add it to pg_isolation_regress_installcheck, while it was added to pg_regress_installcheck. It seems to so far have escaped notice, because buildfarm animals requiring it, didn't actually use pg_isolation_regress_installcheck anywhere - that changed with 60f826c5e6244, triggering failures on narwhal and frogmouth. I've decided to not, for now at least, backpatch this, because the relevant invocations look quite different in the back branches. Seems quite possible that we'll want to backport 60f826c5e6244 as a whole if it proves stable. Discussion: <a target="_blank" href="https://postgr.es/m/20170315174003.3dyl4teashdwgblh@alap3.anarazel.de">https://postgr.es/m/20170315174003.3dyl4teashdwgblh@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2038bf41c963f9ec626f7f8f1f03f0471d063b6d">http://git.postgresql.org/pg/commitdiff/2038bf41c963f9ec626f7f8f1f03f0471d063b6d</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Add support for EUI-64 MAC addresses as macaddr8. This adds in support for EUI-64 MAC addresses by adding a new data type called 'macaddr8' (using our usual convention of indicating the number of bytes stored). This was largely a copy-and-paste from the macaddr data type, with appropriate adjustments for having 8 bytes instead of 6 and adding support for converting a provided EUI-48 (6 byte format) to the EUI-64 format. Conversion from EUI-48 to EUI-64 inserts FFFE as the 4th and 5th bytes but does not perform the IPv6 modified EUI-64 action of flipping the 7th bit, but we add a function to perform that specific action for the user as it may be commonly done by users who wish to calculate their IPv6 address based on their network prefix and 48-bit MAC address. Author: Haribabu Kommi, with a good bit of rework of macaddr8_in by me. Reviewed by: Vitaly Burovoy, Kuntal Ghosh Discussion: <a target="_blank" href="https://postgr.es/m/CAJrrPGcUi8ZH+KkK+=TctNQ+EfkeCEHtMU_yo1mvX8hsk_ghNQ@mail.gmail.com">https://postgr.es/m/CAJrrPGcUi8ZH+KkK+=TctNQ+EfkeCEHtMU_yo1mvX8hsk_ghNQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c7a9fa399d557c6366222e90b35db31e45d25678">http://git.postgresql.org/pg/commitdiff/c7a9fa399d557c6366222e90b35db31e45d25678</a></li>
<li>Bump catversion for MACADDR8. Pointed out by Robert. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c5832346625af4193b1242e57e7d13e66a220b38">http://git.postgresql.org/pg/commitdiff/c5832346625af4193b1242e57e7d13e66a220b38</a></li>
<li>Clean up overly paranoid checks in mac8.c. Andres' compiler points out, quite correctly, that there's no need for some of the overly paranoid checks which were put into mac8.c. Remove those, as they're useless, add some comments and make a few other minor improvements- reduce the size of hexlookup by making it a char array instead of an int array, and pass in the ptr location directly instead of making hex2_to_uchar re-calculate the location based off the offset every time. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7821f7229c6e149046ee0dd8cab57928c4f86a37">http://git.postgresql.org/pg/commitdiff/7821f7229c6e149046ee0dd8cab57928c4f86a37</a></li>
<li>Be more careful about signed vs. unsigned char. The buildfarm has reminded me that not all systems consider char to be signed and we need to be explicit. Adjust the various bits of mac8.c for what we intend, mostly using casts to unsigned char as suggested by Tom, and adjust the tests for valid input accordingly. Explicitly make the hexlookup table signed as it's useful to use -1 there to indicate an invalid value. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cccbddeb1483b85f1853a29dc3b6464647b91eee">http://git.postgresql.org/pg/commitdiff/cccbddeb1483b85f1853a29dc3b6464647b91eee</a></li>
<li>Improve pg_dump regression tests and code coverage. These improvements bring the lines-of-code coverage of pg_dump.c up to 87.7% (at least using LCOV 1.12, 1.11 seems to differ slightly). Nearly every function is covered, three of the four which aren't are only called when talking to older PG instances. There is more which can, and should, be done here to improve the coverage but it's past time to see what the buildfarm thinks of this. What has been added: * Coverage for many more command-line options * Use command_fails_like instead of command_exit_is * Operator classes, operator families * Text search configuration, templates, parsers, dictionaries * FDWs, servers, foreign tables * Materialized views * Improved Publications / Subscriptions test (though this needs work, see PG10 open items and tests marked with XXX in 002_pg_dump.pl) * Unlogged tables * Partitioned tables * Additional ACL testing for various object types There is room for improvement, specifically: * Various type-based option (alignment, storage, etc) * Composite type collation * Extra Procedural language functions (inline, validator) * Different function options (SRF, Transform, config, security definer, cost, leakproof) * OpClass options (default, storage, order by, recheck) * OpFamily options (order by, recheck) * Aggregate functions (combinefunc, serialfunc, deserialfunc, etc) * Text Search parser 'headline' * Text Search template 'init' * FDW options (handler, validator, options) * Server options (type, version, options) * User mapping options * Default ACLs for sequences, types * Security labels * View circular dependencies (last function that needs coverage) * Toast table autovacuum options * Replica identity options * Independent indexes (plus marking them as clustered on) * Deferrable / initially deferred constraints * Independent domain constraints There's bits of extension pg_dump'ing also not covered, but those will need to go into test_pg_dump (such as having a filter for config tables). Last, but not least, this approximately halves the number of tests run with 'ok()' by removing the ok()-based checking of if all runs are covered by each test. Instead, 002_pg_dump.pl will just exit out in such a case (with a message in the log file). In general, when adding tests, cover all runs unless there is a very good reason not to (such as adding a 'catch-all' case). With these changes, the resulting output and number of "tests" run is actually reduced. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/31a8b77a9244a0883e1968adcff9b6038e575d77">http://git.postgresql.org/pg/commitdiff/31a8b77a9244a0883e1968adcff9b6038e575d77</a></li>
<li>pg_dump: Remove "option requires an argument -- j" test. This is really testing getopt more than pg_dump, and what getopt returns exactly appears to differ based on platform, so remove this test. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5abda5a3e9e7f2a472ccbb1b8389d9166d4a9eca">http://git.postgresql.org/pg/commitdiff/5abda5a3e9e7f2a472ccbb1b8389d9166d4a9eca</a></li>
<li>Adjust number of tests for pg_dump 001_basic.pl. When removing a test, need to make sure the count of tests is adjusted when it isn't calculated. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/805e8bc7029b6eb19f0ca3a68051cfda5bd07ef3">http://git.postgresql.org/pg/commitdiff/805e8bc7029b6eb19f0ca3a68051cfda5bd07ef3</a></li>
<li>pg_dump: Skip COLLATION-related regression tests. Not every platform supports non-default collations, as pointed out by the buildfarm, so skip collation-related regression tests in pg_dump when they aren't supported. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/de34123834c3fa465b97f65ded171888edbfbccf">http://git.postgresql.org/pg/commitdiff/de34123834c3fa465b97f65ded171888edbfbccf</a></li>
</ul>
<p>Andrew Gierth pushed:</p>
<ul>
<li>Avoid having vacuum set reltuples to 0 on non-empty relations in the presence of page pins, which leads to serious estimation errors in the planner. This particularly affects small heavily-accessed tables, especially where locking (e.g. from FK constraints) forces frequent vacuums for mxid cleanup. Fix by keeping separate track of pages whose live tuples were actually counted vs. pages that were only scanned for freezing purposes. Thus, reltuples can only be set to 0 if all pages of the relation were actually counted. Backpatch to all supported versions. Per bug #14057 from Nicolas Baccelli, analyzed by me. Discussion: <a target="_blank" href="https://postgr.es/m/20160331103739.8956.94469@wrigleys.postgresql.org">https://postgr.es/m/20160331103739.8956.94469@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1914c5ea7daaaaba4420f65c991256af5d4a9813">http://git.postgresql.org/pg/commitdiff/1914c5ea7daaaaba4420f65c991256af5d4a9813</a></li>
<li>Repair test for vacuum reltuples fix. Concurrent auto-analyze could be holding a snapshot, affecting the removal of deleted row versions. Remove the deletion to avoid this happening. Per buildfarm. In passing, make the test independent of assumptions of physical row order, just out of sheer paranoia. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/64ae420b275a82534732aafd9d550b9982ca0a5d">http://git.postgresql.org/pg/commitdiff/64ae420b275a82534732aafd9d550b9982ca0a5d</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Andreas Karlsson sent in another revision of a patch to implement REINDEX CONCURRENTLY.</p>
<p>Amit Langote sent in a patch to fix a bug in get_partition_for_tuple.</p>
<p>KaiGai Kohei sent in another revision of a patch to add PassDownLimitBound for ForeignScan/CustomScan.</p>
<p>Masahiko Sawada sent in another revision of a patch to support 2PC for FDWs.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to fix an xpath bug.</p>
<p>Craig Ringer and Petr Jel&Atilde;&shy;nek traded patches to add an option to control snapshot export to CREATE_REPLICATION_SLOT and add logical replication support for initial data copy.</p>
<p>Craig Ringer sent in two more revisions of a patch to add a pg_recvlogical wrapper to PostgresNode, follow timeline switches in logical decoding, and enable logical decoding on standby.</p>
<p>Mithun Cy sent in another revision of a patch to implement auto_prewarm.</p>
<p>Thomas Munro sent in a patch to fix a bug in psql's tab completion for UPDATE.</p>
<p>Jeff Janes sent in a patch to silence a perl warning in the check-world make target.</p>
<p>Peter Geoghegan sent in a patch to avoid copying within tuplesort_gettupleslot().</p>
<p>Thomas Munro sent in a patch to update the "tool sets" documentation for modern FreeBSD.</p>
<p>David Rowley sent in two more revisions of a patch to improve performance for joins where outer side is unique.</p>
<p>Anastasia Lubennikova and Ashutosh Bapat traded patches to add IF NOT EXISTS option for CREATE SERVER and CREATE USER MAPPING statements.</p>
<p>Rafia Sabih sent in another revision of a patch to add parallelism support for queries coming from SQL or other PL functions.</p>
<p>Thomas Munro sent in another revision of a patch to help measure replay lag.</p>
<p>Vaishnavi Prabakaran sent in a patch to fix a bug in libpq's single row mode.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to change references of password encryption to hashing.</p>
<p>Amit Langote sent in four more revisions of a patch to avoid creating scan nodes for partitioned tables and not allocate storage for partitioned tables.</p>
<p>David Steele sent in two more revisions of a patch to make pg_stop_backup() archive wait optional.</p>
<p>Andres Freund, Heikki Linnakangas, and Andreas Karlsson traded patches to process expressions faster.</p>
<p>Aleksander Alekseev sent in another revision of a patch to suppress clang 3.9 warnings.</p>
<p>Beena Emerson sent in another revision of a patch to allow increasing the default WAL segment size.</p>
<p>Amit Kapila sent in another revision of a patch to enable parallel queries containing initplans.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to fix backend crash on non-exclusive backup cancel.</p>
<p>&Atilde;lvaro Herrera and David Rowley traded patches to add extended (multivariate) statistics.</p>
<p>Ashutosh Sharma sent in six more revisions of a patch to add microvacuum support for Hash Index.</p>
<p>Surafel Temesgen and Pavel St&Auml;&rsaquo;hule traded patches to add CORRESPONDING.</p>
<p>Ashutosh Bapat and Rafia Sabih traded patches to support partition-wise join for join between (declaratively) partitioned tables.</p>
<p>Pavan Deolasee sent in two more revisions of a patch to implement WARM.</p>
<p>Masahiko Sawada sent in another revision of a patch to report the number of skipped frozen pages by manual VACUUM.</p>
<p>Kuntal Ghosh sent in a patch to show extParams and allParams in explain.</p>
<p>Andrew Gierth sent in another revision of a patch to add hash support for GROUPING SETS.</p>
<p>Haribabu Kommi sent in another revision of a patch to mark utility commands benefiting from parallel plan.</p>
<p>Haribabu Kommi sent in another revision of a patch to add pg_stat_wal_write statistics view.</p>
<p>Vaishnavi Prabakaran sent in another revision of a patch to add pipelining batch support for libpq code and tests for same.</p>
<p>Dilip Kumar sent in three revisions of a patch to fix a bug in parallel bitmap scans.</p>
<p>Nikhil Sontakke sent in another revision of a patch to speed up 2PC transactions.</p>
<p>Kuntal Ghosh sent in two more revisions of a patch to add infra to expose all backend processes in pg_stat_get_activity, expose stats for all backends, and add backend_type column in pg_stat_get_activity.</p>
<p>Heikki Linnakangas sent in a patch to allow SCRAM authentication, when pg_hba.conf says 'md5'.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to use base64-based encoding for stored and server keys in SCRAM verifiers, refactor frontend-side random number generation, move routine to build SCRAM verifier into src/common/, and extend PQencryptPassword with a hashing method.</p>
<p>Simon Riggs and David Rowley traded patches to improve the performance of replay of AccessExclusiveLock.</p>
<p>Peter Eisentraut sent in another revision of a patch to refine rules for altering publication owner, change logical replication pg_hba.conf use, add USAGE privilege for publications, add subscription apply worker privilege checks, and add CREATE SUBSCRIPTION privilege on databases.</p>
<p>Rushabh Lathia sent in two more revisions of a patch to add wait events for disk I/O.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement ICU integration.</p>
<p>Thomas Munro sent in two revisions of a patch to change ancient use of Size to the now-common size_t.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to add clause PASSWORD (val USING protocol) to CREATE/ALTER ROLE.</p>
<p>Takayuki Tsunakawa sent in a patch to fix an issue where pgwin32_is_service was not checking whether SECURITY_SERVICE_SID was disabled.</p>
<p>Michael Banck sent in three revisions of a patch to reorder tablespaces for non-WAL streaming basebackups.</p>
<p>Amit Khandekar sent in another revision of a patch to implement parallel append.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to rename pg_subtrans to pg_subxact.</p>
<p>Corey Huinker sent in two more revisions of a patch to add \if and friends to psql.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to implement asynchronous execution.</p>
<p>Dave Page sent in another revision of a patch to add monitoring roles.</p>
<p>Emre Hasegeli sent in another revision of a patch to add new BRIN cost estimates.</p>
<p>Yugo Nagata sent in another revision of a patch to implement hash partitioning.</p>
<p>Robert Haas sent in a patch to put make a single point of truth for adjust_relid_set while keeping it static.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to fix wait for writable socket on Windows.</p>
<p>Pritam Baral sent in a patch to enable using indexes for element-contained-by-const-range clauses.</p>
<p>Nikolay Shaplov sent in another revision of a patch to move all am-related reloption code into src/backend/access/[am-name] and get rid of relopt_kind for custom AM.</p>
<p>Peter Eisentraut sent in a patch to pageinspect to add bt_page_items function with a bytea argument.</p>
<p>Elvis Pranskevichus sent in a patch to add and report the new "in_hot_standby" GUC pseudo-variable.</p>
<p>Vinayak Pokale sent in another revision of a patch to add an ANALYZE command progress checker.</p>
<p>Petr Jel&Atilde;&shy;nek sent in another revision of a patch to add an option to modify sync commit per subscription in logical replication.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to psql to add \gload for loading binary formats.</p>
<p>Mithun Cy sent in another revision of a patch to expand hash buckets efficiently.</p>
<p>Jan Mich&Atilde;&iexcl;lek sent in another revision of a patch to add markdown and rst output formats to psql.</p>
<p>Michael Banck sent in two revisions of a patch to create replication slot in pg_basebackup if requested and not yet present.</p>
<p>Peter Eisentraut sent in a patch to remove createlang and droplang.</p>
<p>Peter Geoghegan sent in another revision of a patch to add parallel B-tree index build sorting and add temporary testing tools.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/03/21/Nouvelles-hebdomadaires-de-PostgreSQL-19-mars-2017">par chl le mardi 21 mars 2017 à 19h50</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi 14 mars 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:618a7f3a2bf8b4f69338b6d6ecc099bb" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/03/14/Nouvelles-hebdomadaires-de-PostgreSQL-12-mars-2017">Nouvelles hebdomadaires de PostgreSQL - 12 mars 2017</a></h4>
<div class="entry">
<div class="content">
<p>Le PostgresOpen aura lieu &agrave; San Francisco du 6 au 8 septembre&nbsp;: <a target="_blank" href="https://2017.postgresopen.org/">https://2017.postgresopen.org/</a></p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>psqlODBC 09.06.0200&nbsp;: <a target="_blank" href="https://odbc.postgresql.org/docs/release.html">https://odbc.postgresql.org/docs/release.html</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en mars</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-03/">http://archives.postgresql.org/pgsql-jobs/2017-03/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://2017.pgday.asia/">http://2017.pgday.asia/</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170312234158.GB31409@fetter.org">http://www.postgresql.org/message-id/20170312234158.GB31409@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Simon Riggs pushed:</p>
<ul>
<li>Allow partitioned tables to be dropped without CASCADE. Record partitioned table dependencies as DEPENDENCY_AUTO rather than DEPENDENCY_NORMAL, so that DROP TABLE just works. Remove all the tests for partitioned tables where earlier work had deliberately avoided using CASCADE. Amit Langote, reviewed by Ashutosh Bapat and myself <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8b4d582d279d784616c228be58af1e39aa430402">http://git.postgresql.org/pg/commitdiff/8b4d582d279d784616c228be58af1e39aa430402</a></li>
<li>Reduce lock levels for table storage params related to planning. The following parameters are now updateable with ShareUpdateExclusiveLock effective_io_concurrency parallel_workers seq_page_cost random_page_cost n_distinct n_distinct_inherited Simon Riggs and Fabr&Atilde;&shy;zio Mello <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/21d4e2e20656381b4652eb675af4f6d65053607f">http://git.postgresql.org/pg/commitdiff/21d4e2e20656381b4652eb675af4f6d65053607f</a></li>
<li>Enhance docs for ALTER TABLE lock levels of storage parms. As requested by Robert Haas <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6f3a13ff058f15d565a30c16c0c2cb14cc994e42">http://git.postgresql.org/pg/commitdiff/6f3a13ff058f15d565a30c16c0c2cb14cc994e42</a></li>
<li>Ensure ThisTimeLineID is valid before START_REPLICATION. Craig Ringer <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5ee2197767f648bc21e324e751b84d42af573b43">http://git.postgresql.org/pg/commitdiff/5ee2197767f648bc21e324e751b84d42af573b43</a></li>
<li>Allow pg_dumpall to dump roles w/o user passwords. Add new option --no-role-passwords which dumps roles without passwords. Since we don&acirc;&euro;&trade;t need passwords, we choose to use pg_roles in preference to pg_authid since access may be restricted for security reasons in some configrations. Robins Tharakan and Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9a83d56b38c870ce47b7651385ff2add583bf136">http://git.postgresql.org/pg/commitdiff/9a83d56b38c870ce47b7651385ff2add583bf136</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Reorder the asynchronous libpq calls for replication connection. Per libpq documentation, the initial state must be PGRES_POLLING_WRITING. Failing to do that appears to cause some issues on some Windows systems. From: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e434ad39ae7316bcf35fd578dd34ad7e1ff3c25f">http://git.postgresql.org/pg/commitdiff/e434ad39ae7316bcf35fd578dd34ad7e1ff3c25f</a></li>
<li>Combine several DROP variants into generic DropStmt. Combine DROP of FOREIGN DATA WRAPPER, SERVER, POLICY, RULE, and TRIGGER into generic DropStmt grammar. Reviewed-by: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e6477a8134ace06ef3a45a7ce15813cd398e72d8">http://git.postgresql.org/pg/commitdiff/e6477a8134ace06ef3a45a7ce15813cd398e72d8</a></li>
<li>Replace LookupFuncNameTypeNames() with LookupFuncWithArgs(). The old function took function name and function argument list as separate arguments. Now that all function signatures are passed around as ObjectWithArgs structs, this is no longer necessary and can be replaced by a function that takes ObjectWithArgs directly. Similarly for aggregates and operators. Reviewed-by: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2ca64c6f7105f97ce886bdbbd880f50225bf24ba">http://git.postgresql.org/pg/commitdiff/2ca64c6f7105f97ce886bdbbd880f50225bf24ba</a></li>
<li>Add operator_with_argtypes grammar rule. This makes the handling of operators similar to that of functions and aggregates. Rename node FuncWithArgs to ObjectWithArgs, to reflect the expanded use. Reviewed-by: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/550214a4efb214dfc9c2a475607deeeea69da858">http://git.postgresql.org/pg/commitdiff/550214a4efb214dfc9c2a475607deeeea69da858</a></li>
<li>Use class_args field in opclass_drop. This makes it consistent with the usage in opclass_item. Reviewed-by: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/63ebd377a6ecd3388596c3ea958e813f23b5f4ae">http://git.postgresql.org/pg/commitdiff/63ebd377a6ecd3388596c3ea958e813f23b5f4ae</a></li>
<li>Remove objname/objargs split for referring to objects. In simpler times, it might have worked to refer to all kinds of objects by a list of name components and an optional argument list. But this doesn't work for all objects, which has resulted in a collection of hacks to place various other nodes types into these fields, which have to be unpacked at the other end. This makes it also weird to represent lists of such things in the grammar, because they would have to be lists of singleton lists, to make the unpacking work consistently. The other problem is that keeping separate name and args fields makes it awkward to deal with lists of functions. Change that by dropping the objargs field and have objname, renamed to object, be a generic Node, which can then be flexibly assigned and managed using the normal Node mechanisms. In many cases it will still be a List of names, in some cases it will be a string Value, for types it will be the existing Typename, for functions it will now use the existing ObjectWithArgs node type. Some of the more obscure object types still use somewhat arbitrary nested lists. Reviewed-by: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8b6d6cf853aab12f0dc2adba7c99c3e458662734">http://git.postgresql.org/pg/commitdiff/8b6d6cf853aab12f0dc2adba7c99c3e458662734</a></li>
<li>Allow dropping multiple functions at once. The generic drop support already supported dropping multiple objects of the same kind at once. But the previous representation of function signatures across two grammar symbols and structure members made this cumbersome to do for functions, so it was not supported. Now that function signatures are represented by a single structure, it's trivial to add this support. Same for aggregates and operators. Reviewed-by: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/583f6c414895e72c710f723fbb3649df664530d7">http://git.postgresql.org/pg/commitdiff/583f6c414895e72c710f723fbb3649df664530d7</a></li>
<li>Fix segfault in ALTER PUBLICATION/SUBSCRIPTION RENAME. From: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; Reported-by: Fujii Masao &lt;masao.fujii@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b8957927e642ae15c01f985c17fd6fe00ec68069">http://git.postgresql.org/pg/commitdiff/b8957927e642ae15c01f985c17fd6fe00ec68069</a></li>
<li>pg_waldump: Remove extra newline in error message. fatal_error() already prints out a trailing newline. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/911244610cd08fcdc28bd57db4a0d810cffc5080">http://git.postgresql.org/pg/commitdiff/911244610cd08fcdc28bd57db4a0d810cffc5080</a></li>
<li>Enable replication connections by default in pg_hba.conf. initdb now initializes a pg_hba.conf that allows replication connections from the local host, same as it does for regular connections. The connecting user still needs to have the REPLICATION attribute or be a superuser. The intent is to allow pg_basebackup from the local host to succeed without requiring additional configuration. Michael Paquier &lt;michael.paquier@gmail.com&gt; and me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/be37c2120a2a88e5ba852d42952c77b6bf5d5271">http://git.postgresql.org/pg/commitdiff/be37c2120a2a88e5ba852d42952c77b6bf5d5271</a></li>
<li>Use SQL standard error code for nextval. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd603a4d6b5381cb28e993c6219037c2582100c9">http://git.postgresql.org/pg/commitdiff/cd603a4d6b5381cb28e993c6219037c2582100c9</a></li>
<li>Create INSTALL file via XSLT. As before, create an INSTALL.html file for processing with lynx, but use xsltproc and a new XSLT stylesheet instead of jade and DSSSL. Replacing jade with xsltproc removes jade from the requirements for distribution building. Reviewed-by: Magnus Hagander &lt;magnus@hagander.net&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/044d9efb6c97d65247a1287e7676de0ee75b3cfe">http://git.postgresql.org/pg/commitdiff/044d9efb6c97d65247a1287e7676de0ee75b3cfe</a></li>
<li>dblink: Replace some macros by static functions. Also remove some unused code and the no longer useful dblink.h file. Reviewed-by: Tsunakawa, Takayuki &lt;tsunakawa.takay@jp.fujitsu.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/acaf7ccb94a3916ea83712671a3563f0eb595558">http://git.postgresql.org/pg/commitdiff/acaf7ccb94a3916ea83712671a3563f0eb595558</a></li>
<li>dblink: Change some StringInfo to StringInfoData. For consistency with other code and to avoid wasting some small amount of memory. From: Tsunakawa, Takayuki &lt;tsunakawa.takay@jp.fujitsu.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/22ef6b041a554b7536edb3a79e0b9d5d8403f432">http://git.postgresql.org/pg/commitdiff/22ef6b041a554b7536edb3a79e0b9d5d8403f432</a></li>
<li>Improve gitignore file. One file was listed under a wrong comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/07a61e16703b5f90650d509e29a724c68efd79ab">http://git.postgresql.org/pg/commitdiff/07a61e16703b5f90650d509e29a724c68efd79ab</a></li>
<li>pg_dump: Fix dumping of publications. Dumping a publication with more than one table crashed pg_dump. patch by Amit Langote &lt;Langote_Amit_f8@lab.ntt.co.jp&gt;, test by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/de75281637b762b4ccfb776366c44251e6864d0a">http://git.postgresql.org/pg/commitdiff/de75281637b762b4ccfb776366c44251e6864d0a</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Fix user-after-free bug. Introduced by commit aea5d298362e881b13d95a48c5ae116879237389. Patch from Amit Kapila. Issue discovered independently by Amit Kapila and Ashutosh Sharma. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7f6fa29f18aa84743185ee7ada97f277459228a7">http://git.postgresql.org/pg/commitdiff/7f6fa29f18aa84743185ee7ada97f277459228a7</a></li>
<li>Fix incorrect comments. Commit 19dc233c32f2900e57b8da4f41c0f662ab42e080 introduced these comments. Michael Paquier noticed that one of them had a typo, but a bigger problem is that they were not an accurate description of what the code was doing. Patch by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/12a2544cb5f9e1f8541d1b941da6d9dae15f50a5">http://git.postgresql.org/pg/commitdiff/12a2544cb5f9e1f8541d1b941da6d9dae15f50a5</a></li>
<li>Mark pg_start_backup and pg_stop_backup as parallel-restricted. They depend on backend-private state that will not be synchronized by the parallel machinery, so they should not be marked parallel-safe. This issue also exists in 9.6, but we obviously can't do anything about 9.6 clusters that already exist. Possibly this could be back-patched so that future 9.6 clusters would come out OK, or possibly we should back-patch some other fix, but that would need more discussion. David Steele, reviewed by Michael Paquier Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYCWfO2UM-t=HUMFJyxJywLDiLL0nAJpx88LKtvBvNECw@mail.gmail.com">http://postgr.es/m/CA+TgmoYCWfO2UM-t=HUMFJyxJywLDiLL0nAJpx88LKtvBvNECw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9fe3c644a73198941e9a502958c24727dc4a6434">http://git.postgresql.org/pg/commitdiff/9fe3c644a73198941e9a502958c24727dc4a6434</a></li>
<li>Fix parallel hash join path search. When the very cheapest path is not parallel-safe, we want to instead use the cheapest unparameterized path that is. The old code searched innerrel-&gt;cheapest_parameterized_paths, but that isn't right, because the path we want may not be in that list. Search innerrel-&gt;pathlist instead. Spotted by Dilip Kumar. Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-szCEcZrQm0i_w4xqSaRUTOUFstNu32Zn4rxxDcoa8gnA@mail.gmail.com">http://postgr.es/m/CAFiTN-szCEcZrQm0i_w4xqSaRUTOUFstNu32Zn4rxxDcoa8gnA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/655393a022bd653e2b48dbf20b69236981e35195">http://git.postgresql.org/pg/commitdiff/655393a022bd653e2b48dbf20b69236981e35195</a></li>
<li>Preparatory refactoring for parallel merge join support. Extract the logic used by hash_inner_and_outer into a separate function, get_cheapest_parallel_safe_total_inner, so that it can also be used to plan parallel merge joins. Also, add a require_parallel_safe argument to the existing function get_cheapest_path_for_pathkeys, because parallel merge join needs to find the cheapest path for a given set of pathkeys that is parallel-safe, not just the cheapest one overall. Patch by me, reviewed by Dilip Kumar. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYOv+dFK0MWW6366dFj_xTnohQfoBDrHyB7d1oZhrgPjA@mail.gmail.com">http://postgr.es/m/CA+TgmoYOv+dFK0MWW6366dFj_xTnohQfoBDrHyB7d1oZhrgPjA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a71f10189dc10a2fe422158a2c9409e0f77c6b9e">http://git.postgresql.org/pg/commitdiff/a71f10189dc10a2fe422158a2c9409e0f77c6b9e</a></li>
<li>Fix wrong word in comment. Third time's the charm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd87a5ed65f2b4f3bdf07c9664a64696c86d17be">http://git.postgresql.org/pg/commitdiff/cd87a5ed65f2b4f3bdf07c9664a64696c86d17be</a></li>
<li>Document what values postgres_fdw sets for each parameter it sets. David Rader, reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/889a3f4892b271c502f74082a352447408f6292d">http://git.postgresql.org/pg/commitdiff/889a3f4892b271c502f74082a352447408f6292d</a></li>
<li>Remove duplicated word. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/508dabaf39e1f66cbe3fc54d2b66f010aa59c66b">http://git.postgresql.org/pg/commitdiff/508dabaf39e1f66cbe3fc54d2b66f010aa59c66b</a></li>
<li>Fix relcache reference leak. Reported by Kevin Grittner. Faulty commit identified by Tom Lane. Patch by Amit Langote, reviewed by Michael Paquier. Discussion: <a target="_blank" href="http://postgr.es/m/CACjxUsOHbH1=99u8mGxmLHfy5hov4ENEpvM6=3ARjos7wG7rtQ@mail.gmail.com">http://postgr.es/m/CACjxUsOHbH1=99u8mGxmLHfy5hov4ENEpvM6=3ARjos7wG7rtQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d88d06cd0783933b7103d42d3f101baa22b37292">http://git.postgresql.org/pg/commitdiff/d88d06cd0783933b7103d42d3f101baa22b37292</a></li>
<li>Give partitioned table "p" in regression tests a less generic name. And don't drop it, so that we improve the coverage of the pg_upgrade regression tests. Amit Langote, per a gripe from Tom Lane Discussion: <a target="_blank" href="http://postgr.es/m/9071.1488863082@sss.pgh.pa.us">http://postgr.es/m/9071.1488863082@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aa56671836e6f80dc3bdc917dfc860ac10b822be">http://git.postgresql.org/pg/commitdiff/aa56671836e6f80dc3bdc917dfc860ac10b822be</a></li>
<li>Consider parallel merge joins. Commit 45be99f8cd5d606086e0a458c9c72910ba8a613d took the position that performing a merge join in parallel was not likely to work out well, but this conclusion was greeted with skepticism even at the time. Whether it was true then or not, it's clearly not true any more now that we have parallel index scan. Dilip Kumar, reviewed by Amit Kapila and by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-v3=cM6nyFwFGp0fmvY4=kk79Hq9Fgu0u8CSJ-EEq1Tiw@mail.gmail.com">http://postgr.es/m/CAFiTN-v3=cM6nyFwFGp0fmvY4=kk79Hq9Fgu0u8CSJ-EEq1Tiw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3bc7dafa9bebbdaa1bbf0da0798d29a8bdaf6a8f">http://git.postgresql.org/pg/commitdiff/3bc7dafa9bebbdaa1bbf0da0798d29a8bdaf6a8f</a></li>
<li>Properly initialize variable. Commit 3bc7dafa9bebbdaa1bbf0da0798d29a8bdaf6a8f forgot to do this. Noted while experimenting with valgrind. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/506f05423a7c60eef8ed8b5430d03be1fec138a2">http://git.postgresql.org/pg/commitdiff/506f05423a7c60eef8ed8b5430d03be1fec138a2</a></li>
<li>Improve postgresql.conf.sample comments about parallel workers. David Rowley, reviewed by Amit Kapila Discussion: <a target="_blank" href="http://postgr.es/m/CAKJS1f8gPEUPscj6kSqpveMnnx9_3ZypzwsKstv+8atx6VmjBg@mail.gmail.com">http://postgr.es/m/CAKJS1f8gPEUPscj6kSqpveMnnx9_3ZypzwsKstv+8atx6VmjBg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2b87dd8d7ae33ef5c70671674c08bbff066738bf">http://git.postgresql.org/pg/commitdiff/2b87dd8d7ae33ef5c70671674c08bbff066738bf</a></li>
<li>hash: Refactor hash index creation. The primary goal here is to move all of the related page modifications to a single section of code, in preparation for adding write-ahead logging. In passing, rename _hash_metapinit to _hash_init, since it initializes more than just the metapage. Amit Kapila. The larger patch series of which this is a part has been reviewed and tested by &Atilde;lvaro Herrera, Ashutosh Sharma, Mark Kirkwood, Jeff Janes, and Jesper Pedersen. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/38305398cdc029e3a74bfad1815cb33f5b087336">http://git.postgresql.org/pg/commitdiff/38305398cdc029e3a74bfad1815cb33f5b087336</a></li>
<li>tidbitmap: Support shared iteration. When a shared iterator is used, each call to tbm_shared_iterate() returns a result that has not yet been returned to any process attached to the shared iterator. In other words, each cooperating processes gets a disjoint subset of the full result set, but all results are returned exactly once. This is infrastructure for parallel bitmap heap scan. Dilip Kumar. The larger patch set of which this is a part has been reviewed and tested by (at least) Andres Freund, Amit Khandekar, Tushar Ahuja, Rafia Sabih, Haribabu Kommi, and Thomas Munro. Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-uc4=0WxRGfCzs-xfkMYcSEWUC-Fon6thkJGjkh9i=13A@mail.gmail.com">http://postgr.es/m/CAFiTN-uc4=0WxRGfCzs-xfkMYcSEWUC-Fon6thkJGjkh9i=13A@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/98e6e89040a0534ca26914c66cae9dd49ef62ad9">http://git.postgresql.org/pg/commitdiff/98e6e89040a0534ca26914c66cae9dd49ef62ad9</a></li>
<li>Fix parallel index and index-only scans to fall back to serial. Parallel executor nodes can't assume that parallel execution will happen in every case where the plan calls for it, because it might not work out that way. However, parallel index scan and parallel index-only scan failed to do the right thing here. Repair. Amit Kapila, per a report from me. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1Kq5qb_u2AOoda5XBB91vVWz90w=LgtRLgsssriS8pVTw@mail.gmail.com">http://postgr.es/m/CAA4eK1Kq5qb_u2AOoda5XBB91vVWz90w=LgtRLgsssriS8pVTw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/09529a70bb5a77935d086d651c63396767d240d7">http://git.postgresql.org/pg/commitdiff/09529a70bb5a77935d086d651c63396767d240d7</a></li>
<li>Remove inclusion of postgres.h from a few header files. Thomas Munro, per project policy articuled by Andres Freund and Tom Lane. Discussion: <a target="_blank" href="http://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com">http://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d9528604ccb05f545be7ca2bad161877fd3d9c13">http://git.postgresql.org/pg/commitdiff/d9528604ccb05f545be7ca2bad161877fd3d9c13</a></li>
<li>Add tests for foreign partitions. Amit Langote, reviewed by Ashutosh Bapat Discussion: <a target="_blank" href="http://postgr.es/m/475dd52c-be4a-9b32-6d54-3044a00c93d9@lab.ntt.co.jp">http://postgr.es/m/475dd52c-be4a-9b32-6d54-3044a00c93d9@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0d130c7abc85f828dced6c134a5fcbff3215c497">http://git.postgresql.org/pg/commitdiff/0d130c7abc85f828dced6c134a5fcbff3215c497</a></li>
<li>Support parallel bitmap heap scans. The index is scanned by a single process, but then all cooperating processes can iterate jointly over the resulting set of heap blocks. In the future, we might also want to support using a parallel bitmap index scan to set up for a parallel bitmap heap scan, but that's a job for another day. Dilip Kumar, with some corrections and cosmetic changes by me. The larger patch set of which this is a part has been reviewed and tested by (at least) Andres Freund, Amit Khandekar, Tushar Ahuja, Rafia Sabih, Haribabu Kommi, Thomas Munro, and me. Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-uc4=0WxRGfCzs-xfkMYcSEWUC-Fon6thkJGjkh9i=13A@mail.gmail.com">http://postgr.es/m/CAFiTN-uc4=0WxRGfCzs-xfkMYcSEWUC-Fon6thkJGjkh9i=13A@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f35742ccb7aa53ee3ed8416bbb378b0c3eeb6bb9">http://git.postgresql.org/pg/commitdiff/f35742ccb7aa53ee3ed8416bbb378b0c3eeb6bb9</a></li>
<li>Add a Gather Merge executor node. Like Gather, we spawn multiple workers and run the same plan in each one; however, Gather Merge is used when each worker produces the same output ordering and we want to preserve that output ordering while merging together the streams of tuples from various workers. (In a way, Gather Merge is like a hybrid of Gather and MergeAppend.) This works out to a win if it saves us from having to perform an expensive Sort. In cases where only a small amount of data would need to be sorted, it may actually be faster to use a regular Gather node and then sort the results afterward, because Gather Merge sometimes needs to wait synchronously for tuples whereas a pure Gather generally doesn't. But if this avoids an expensive sort then it's a win. Rushabh Lathia, reviewed and tested by Amit Kapila, Thomas Munro, and Neha Sharma, and reviewed and revised by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAGPqQf09oPX-cQRpBKS0Gq49Z+m6KBxgxd_p9gX8CKk_d75HoQ@mail.gmail.com">http://postgr.es/m/CAGPqQf09oPX-cQRpBKS0Gq49Z+m6KBxgxd_p9gX8CKk_d75HoQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/355d3993c53ed62c5b53d020648e4fbcfbf5f155">http://git.postgresql.org/pg/commitdiff/355d3993c53ed62c5b53d020648e4fbcfbf5f155</a></li>
<li>Fix a couple of planner bugs in Gather Merge. Neha Sharma reported these to Rushabh Lathia just after I commit 355d3993c53ed62c5b53d020648e4fbcfbf5f155 went in. The patch is Rushabh's, with input from me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0ee92e1c9b570f90d043e5b033a19b67497ea1f6">http://git.postgresql.org/pg/commitdiff/0ee92e1c9b570f90d043e5b033a19b67497ea1f6</a></li>
<li>Fix bug in parallel tidbitmap iteration. Avoid computing idxpages[istate-&gt;spageptr] until after checking that istate-&gt;spageptr is a legal index. Dilip Kumar, per a report from David Rowley Discussion: <a target="_blank" href="http://postgr.es/m/CAKJS1f8OtrHE+-P+=E=4ycnL29e9idZKuaTQ6o2MbhvGN9D8ig@mail.gmail.com">http://postgr.es/m/CAKJS1f8OtrHE+-P+=E=4ycnL29e9idZKuaTQ6o2MbhvGN9D8ig@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6a468c343b31aabead7d3a5e11079bfcddbfd667">http://git.postgresql.org/pg/commitdiff/6a468c343b31aabead7d3a5e11079bfcddbfd667</a></li>
<li>Document some new parallel query capabilities. This updates the text for parallel index scan, parallel index-only scan, parallel bitmap heap scan, and parallel merge join. It also expands the discussion of parallel joins slightly. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoZnCUoM31w3w7JSakVQJQOtcuTyX=HLUr-X1rto2=2bjw@mail.gmail.com">http://postgr.es/m/CA+TgmoZnCUoM31w3w7JSakVQJQOtcuTyX=HLUr-X1rto2=2bjw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/054637d2e08cda6a096f48cc99696136a06f4ef5">http://git.postgresql.org/pg/commitdiff/054637d2e08cda6a096f48cc99696136a06f4ef5</a></li>
<li>Document lack of validation when attaching foreign partitions. Ashutosh Bapat, revised a bit by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAFjFpRdLaCa-1wJase0=YWG5o3cJnbuUt_vrqm2TDBKM_vQ_oA@mail.gmail.com">http://postgr.es/m/CAFjFpRdLaCa-1wJase0=YWG5o3cJnbuUt_vrqm2TDBKM_vQ_oA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b54aad8e34bd6299093e965c50f4a23da96d7cc3">http://git.postgresql.org/pg/commitdiff/b54aad8e34bd6299093e965c50f4a23da96d7cc3</a></li>
<li>Use group updates when setting transaction status in clog. Commit 0e141c0fbb211bdd23783afa731e3eef95c9ad7a introduced a mechanism to reduce contention on ProcArrayLock by having a single process clear XIDs in the procArray on behalf of multiple processes, reducing the need to hand the lock around. Use a similar mechanism to reduce contention on CLogControlLock. Testing shows that this very significantly reduces the amount of time waiting for CLogControlLock on high-concurrency pgbench tests run on a large multi-socket machines; whether that translates into a TPS improvement depends on how much of that contention is simply shifted to some other lock, particularly WALWriteLock. Amit Kapila, with some cosmetic changes by me. Extensively reviewed, tested, and benchmarked over a period of about 15 months by Simon Riggs, Robert Haas, Andres Freund, Jesper Pedersen, and especially by Tomas Vondra and Dilip Kumar. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1L_snxM_JcrzEstNq9P66++F4kKFce=1r5+D1vzPofdtg@mail.gmail.com">http://postgr.es/m/CAA4eK1L_snxM_JcrzEstNq9P66++F4kKFce=1r5+D1vzPofdtg@mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1LyR2A+m=RBSZ6rcPEwJ=rVi1ADPSndXHZdjn56yqO6Vg@mail.gmail.com">http://postgr.es/m/CAA4eK1LyR2A+m=RBSZ6rcPEwJ=rVi1ADPSndXHZdjn56yqO6Vg@mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/91d57161-d3ea-0cc2-6066-80713e4f90d7@2ndquadrant.com">http://postgr.es/m/91d57161-d3ea-0cc2-6066-80713e4f90d7@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ccce90b398673d55b0387b3de66639b1b30d451b">http://git.postgresql.org/pg/commitdiff/ccce90b398673d55b0387b3de66639b1b30d451b</a></li>
<li>Throw an error if a DATA() line contains wrong # of attributes. David Christensen, reviewed by Dagfinn Ilmari Manns&Atilde;&yen;ker Discussion: <a target="_blank" href="http://postgr.es/m/20170215154018.fs5vwtqhp5d2sifs@veeddeux.attlocal.net">http://postgr.es/m/20170215154018.fs5vwtqhp5d2sifs@veeddeux.attlocal.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7666e73a2e9e0e91a9f3b246a4299b44daadcbf8">http://git.postgresql.org/pg/commitdiff/7666e73a2e9e0e91a9f3b246a4299b44daadcbf8</a></li>
<li>Revert "Use group updates when setting transaction status in clog.". This reverts commit ccce90b398673d55b0387b3de66639b1b30d451b. This optimization is unsafe, at least, of rollbacks and rollbacks to savepoints, but I'm concerned there may be other problematic cases as well. Therefore, I've decided to revert this pending further investigation. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/390811750d1647ed81a462da3af7f1fd66166e95">http://git.postgresql.org/pg/commitdiff/390811750d1647ed81a462da3af7f1fd66166e95</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Avoid dangling pointer to relation name in RLS code path in DoCopy(). With RLS active, "COPY tab TO ..." failed under -DRELCACHE_FORCE_RELEASE, and would sometimes fail without that, because it used the relation name directly from the relcache as part of the parsetree it's building. That becomes a potentially-dangling pointer as soon as the relcache entry is closed, a bit further down. Typical symptom if the relcache entry chanced to get cleared would be "relation does not exist" error with a garbage relation name, or possibly a core dump; but if you were really truly unlucky, the COPY might copy from the wrong table. Per report from Andrew Dunstan that regression tests fail with -DRELCACHE_FORCE_RELEASE. The core tests now pass for me (but have not tried "make check-world" yet). Discussion: <a target="_blank" href="https://postgr.es/m/7b52f900-0579-cda9-ae2e-de5da17090e6@2ndQuadrant.com">https://postgr.es/m/7b52f900-0579-cda9-ae2e-de5da17090e6@2ndQuadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a8df75b0a470f477dad75a7408e429e10c13fc07">http://git.postgresql.org/pg/commitdiff/a8df75b0a470f477dad75a7408e429e10c13fc07</a></li>
<li>Repair incorrect pg_dump labeling for some comments and security labels. We attached no schema label to comments for procedural languages, casts, transforms, operator classes, operator families, or text search objects. The first three categories of objects don't really have schemas, but pg_dump treats them as if they do, and it seems like the TocEntry fields for their comments had better match the TocEntry fields for the parent objects. (As an example of a possible hazard, the type names in a CAST will be formatted with the assumption of a particular search_path, so failing to ensure that this same path is active for the COMMENT ON command could lead to an error or to attaching the comment to the wrong cast.) In the last six cases, this was a flat-out error --- possibly mine to begin with, but it was a long time ago. The security label for a procedural language was likewise not correctly labeled as to schema, and both the comment and security label for a procedural language were not correctly labeled as to owner. In simple cases the restore would accidentally work correctly anyway, since these comments and security labels would normally get emitted right after the owning object, and so the search path and active user would be correct anyhow. But it could fail in corner cases; for example a schema-selective restore would omit comments it should include. Giuseppe Broccolo noted the oversight, and proposed the correct fix, for text search dictionary objects; I found the rest by cross-checking other dumpComment() calls. These oversights are ancient, so back-patch all the way. Discussion: <a target="_blank" href="https://postgr.es/m/CAFzmHiWwwzLjzwM4x5ki5s_PDMR6NrkipZkjNnO3B0xEpBgJaA@mail.gmail.com">https://postgr.es/m/CAFzmHiWwwzLjzwM4x5ki5s_PDMR6NrkipZkjNnO3B0xEpBgJaA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/299990ba16ab75b09b7fed61322f1f23fdc7cf4c">http://git.postgresql.org/pg/commitdiff/299990ba16ab75b09b7fed61322f1f23fdc7cf4c</a></li>
<li>Remove vestigial grammar support for CHARACTER ... CHARACTER SET option. The SQL standard says that you should be able to write "CHARACTER SET foo" as part of the declaration of a char-type column. We don't implement that, but a rough form of support has existed in gram.y since commit f10b63923. That's now sat there for nigh 20 years without anyone fleshing it out --- and even if someone did, the contemplated approach of having separate data type name(s) for every character set certainly isn't what we'd do today. Let's just remove the grammar production; if anyone is ever motivated to work on this, reinventing the grammar support is a trivial fraction of what they'd have to do. And we've never documented anything about supporting such a clause. Per gripe from Neha Khatri. Discussion: <a target="_blank" href="https://postgr.es/m/CAFO0U+-iOS5oYN5v3SBuZvfhPUTRrkDFEx8w7H17B07Rwg3YUA@mail.gmail.com">https://postgr.es/m/CAFO0U+-iOS5oYN5v3SBuZvfhPUTRrkDFEx8w7H17B07Rwg3YUA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/11324e408f0e3a25621c611467927c644894b30d">http://git.postgresql.org/pg/commitdiff/11324e408f0e3a25621c611467927c644894b30d</a></li>
<li>Fix pgbench's failure to honor the documented long-form option "--builtin". Not only did it not accept --builtin as a synonym for -b, but what it did accept as a synonym was --tpc-b (huh?), which it got even further wrong by marking as no_argument, so that if you did try that you got a core dump. I suppose this is leftover from some early design for the new switches added by commit 8bea3d221, but it's still pretty sloppy work. Per bug #14580 from Stepan Pesternikov. Back-patch to 9.6 where the error was introduced. Report: <a target="_blank" href="https://postgr.es/m/20170307123347.25054.73207@wrigleys.postgresql.org">https://postgr.es/m/20170307123347.25054.73207@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ef2662394455578f6c57e99a7896c69bdd9fbd74">http://git.postgresql.org/pg/commitdiff/ef2662394455578f6c57e99a7896c69bdd9fbd74</a></li>
<li>Clean up test_ifaddrs a bit. We customarily #include &lt;netinet/in.h&gt; before &lt;arpa/inet.h&gt;; according to our git history (cf commit 527f8babc) there used to be platform(s) where &lt;arpa/inet.h&gt; didn't compile otherwise. That's probably not really an issue anymore, but since test_ifaddrs.c is the one and only place in our code that's not following that rule, bring it into line. Also remove #include &lt;sys/socket.h&gt;, as that's duplicative given that libpq/ifaddr.h does so (via pqcomm.h). In passing, add a .gitignore file so nobody accidentally commits the test_ifaddrs executable, as I nearly did. I see no particular need to back-patch this, as it's just neatnik-ism considering we don't build test_ifaddrs by default, or even document it anywhere. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/03cf2219346aa78ecd1b6d4501a7697692a43c62">http://git.postgresql.org/pg/commitdiff/03cf2219346aa78ecd1b6d4501a7697692a43c62</a></li>
<li>Invent start_proc parameters for PL/Tcl. Define GUCs pltcl.start_proc and pltclu.start_proc. When set to a nonempty value at the time a new Tcl interpreter is created, the parameterless pltcl or pltclu function named by the GUC is called to allow user-controlled initialization to occur within the interpreter. This is modeled on plv8's start_proc parameter, and also has much in common with plperl's on_init feature. It allows users to fully replace the "modules" feature that was removed in commit 817f2a586. Since an initializer function could subvert later Tcl code in nearly arbitrary ways, mark both GUCs as SUSET for now. It would be nice to find a way to relax that someday; but the corresponding GUCs in plperl are also SUSET, and there's not been much complaint. Discussion: <a target="_blank" href="https://postgr.es/m/22067.1488046447@sss.pgh.pa.us">https://postgr.es/m/22067.1488046447@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0d2b1f305dc78d536d80cfb4bb2ac4d7104453db">http://git.postgresql.org/pg/commitdiff/0d2b1f305dc78d536d80cfb4bb2ac4d7104453db</a></li>
<li>Silence compiler warnings in tbm_prepare_shared_iterate(). Maybe Robert's compiler can convince itself that these variables are never used uninitialized, but mine can't. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/270d7dd8a5a7128fc2b859f3bf95e2c1fb45be79">http://git.postgresql.org/pg/commitdiff/270d7dd8a5a7128fc2b859f3bf95e2c1fb45be79</a></li>
<li>Use doubly-linked block lists in aset.c to reduce large-chunk overhead. Large chunks (those too large for any palloc freelist) are managed as separate blocks. Formerly, realloc'ing or pfree'ing such a chunk required O(N) time in a context with N blocks, since we had to traipse down the singly-linked block list to locate the block's predecessor before we could fix the list links. This can result in O(N^2) runtime in situations where large numbers of such chunks are manipulated within one context. Cases like that were not foreseen in the original design of aset.c, and indeed didn't arise until fairly recently. But such problems can now occur in reorderbuffer.c and in hash joining, both of which make repeated large requests without scaling up their request size as they do so, and which will free their requests in not-necessarily-LIFO order. To fix, change the block list from singly-linked to doubly-linked. This adds another 4 or 8 bytes to ALLOC_BLOCKHDRSZ, but that doesn't seem like unacceptable overhead, since aset.c's blocks are normally 8K or more, and never less than 1K in current practice. In passing, get rid of some redundant AllocChunkGetPointer() calls in AllocSetRealloc (the compiler might be smart enough to optimize these away anyway, but no need to assume that) and improve AllocSetCheck's checking of block header fields. Back-patch to 9.4 where reorderbuffer.c appeared. We could take this further back, but currently there's no evidence that it would be useful. Discussion: <a target="_blank" href="https://postgr.es/m/CAMkU=1x1hvue1XYrZoWk_omG0Ja5nBvTdvgrOeVkkeqs71CV8g@mail.gmail.com">https://postgr.es/m/CAMkU=1x1hvue1XYrZoWk_omG0Ja5nBvTdvgrOeVkkeqs71CV8g@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff97741bc810390db6dd4da0f31ee1e93c8d3abb">http://git.postgresql.org/pg/commitdiff/ff97741bc810390db6dd4da0f31ee1e93c8d3abb</a></li>
<li>Silence compiler warnings in BitmapHeapNext(). Same disease as 270d7dd8a5a7128fc2b859f3bf95e2c1fb45be79. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/15d03e597662847e13428a8b3ce9dd59c38decf3">http://git.postgresql.org/pg/commitdiff/15d03e597662847e13428a8b3ce9dd59c38decf3</a></li>
<li>Put back &lt;float.h&gt; in a few files that need it for _isnan(). Further fallout from commit c29aff959: there are some files that need &lt;float.h&gt;, and were getting it from datatype/timestamp.h, but it was not apparent in my (tgl's) testing because the requirement for &lt;float.h&gt; exists only on certain Windows toolchains. Report and patch by David Rowley. Discussion: <a target="_blank" href="https://postgr.es/m/CAKJS1f-BHceaFzZScFapDV48gUVM2CAOBfhkgffdqXzFb+kwew@mail.gmail.com">https://postgr.es/m/CAKJS1f-BHceaFzZScFapDV48gUVM2CAOBfhkgffdqXzFb+kwew@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/86dbbf20d8496ede77566873d1e22cd11c1e544c">http://git.postgresql.org/pg/commitdiff/86dbbf20d8496ede77566873d1e22cd11c1e544c</a></li>
<li>Suppress compiler warning in non-USE_LIBXML builds. Compilers that don't realize that ereport(ERROR) doesn't return complained that XmlTableGetValue() failed to return a value. Also, make XmlTableFetchRow's non-USE_LIBXML case look more like the other ones. As coded, it could lead to "unreachable code" warnings with USE_LIBXML enabled. Oversights in commit fcec6caaf. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f379121093deb5465b01d93ebe9410d96c6cd093">http://git.postgresql.org/pg/commitdiff/f379121093deb5465b01d93ebe9410d96c6cd093</a></li>
<li>Suppress compiler warning in slab.c. Compilers that don't realize that elog(ERROR) doesn't return complained that SlabRealloc() failed to return a value. While at it, fix the rather muddled header comment for the function. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2f899e7d37ece937740c99164dd846c4b6f884eb">http://git.postgresql.org/pg/commitdiff/2f899e7d37ece937740c99164dd846c4b6f884eb</a></li>
<li>Document intentional violations of header inclusion policy. Although there are good reasons for our policy of including postgres.h as the first #include in every .c file, never from .h files, there are two places where it seems expedient to violate the policy because the alternative is to modify externally-supplied .c files. (In the case of the regexp library, the idea that it's externally-supplied is kind of at odds with reality, but I haven't entirely given up hope that it will become a standalone project some day.) Add some comments to make it explicit that this is a policy violation and provide the reasoning. In passing, move #include "miscadmin.h" out of regcomp.c and into regcustom.h, which is where it should be if we're taking this reasoning seriously at all. Discussion: <a target="_blank" href="https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com">https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com</a> Discussion: <a target="_blank" href="https://postgr.es/m/11634.1488932128@sss.pgh.pa.us">https://postgr.es/m/11634.1488932128@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d6b059ec740a6affce9a069f1210d161068317e3">http://git.postgresql.org/pg/commitdiff/d6b059ec740a6affce9a069f1210d161068317e3</a></li>
<li>Bring plpgsql into line with header inclusion policy. We have a project policy that every .c file should start by including postgres.h, postgres_fe.h, or c.h as appropriate; and then there is no need for any .h file to explicitly include any of these. (The core reason for this policy is to make it easy to verify that pg_config_os.h is included before any system headers such as &lt;stdio.h&gt;; without that, we have portability issues on some platforms due to variation in largefile options across different modules in the backend. Also, if .h files were responsible for choosing which of these key headers to include, .h files that need to be includable in either frontend or backend compiles would be in trouble.) plpgsql was blithely ignoring this policy, so whack it upside the head until it complies. I also chose to standardize on including plpgsql's own .h files after all core-system headers that it pulls in. That could've been done either way, but this way seems saner. Discussion: <a target="_blank" href="https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com">https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com</a> Discussion: <a target="_blank" href="https://postgr.es/m/11634.1488932128@sss.pgh.pa.us">https://postgr.es/m/11634.1488932128@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/08da52859a1fadeac10aab621c6c793791ec1f2c">http://git.postgresql.org/pg/commitdiff/08da52859a1fadeac10aab621c6c793791ec1f2c</a></li>
<li>Fix inclusions of postgres_fe.h from .h files. We have a project policy that every .c file should start by including postgres.h, postgres_fe.h, or c.h as appropriate; and then there is no need for any .h file to explicitly include any of these. Fix a few headers that were violating this policy by including postgres_fe.h. Discussion: <a target="_blank" href="https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com">https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com</a> Discussion: <a target="_blank" href="https://postgr.es/m/11634.1488932128@sss.pgh.pa.us">https://postgr.es/m/11634.1488932128@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9722bb5757c5e90617be685bf127911b63efe08d">http://git.postgresql.org/pg/commitdiff/9722bb5757c5e90617be685bf127911b63efe08d</a></li>
<li>Fix inclusions of c.h from .h files. We have a project policy that every .c file should start by including postgres.h, postgres_fe.h, or c.h as appropriate; and then there is no need for any .h file to explicitly include any of these. Fix a few headers that were violating this policy by including c.h. Discussion: <a target="_blank" href="https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com">https://postgr.es/m/CAEepm=2zCoeq3QxVwhS5DFeUh=yU6z81pbWMgfOB8OzyiBwxzw@mail.gmail.com</a> Discussion: <a target="_blank" href="https://postgr.es/m/11634.1488932128@sss.pgh.pa.us">https://postgr.es/m/11634.1488932128@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a72f0365db4168e7d720608fe3ac0ca3fe9355df">http://git.postgresql.org/pg/commitdiff/a72f0365db4168e7d720608fe3ac0ca3fe9355df</a></li>
<li>Fix timestamptz regression test to still work with latest IANA zone data. The IANA timezone crew continues to chip away at their project of removing timezone abbreviations that have no real-world currency from their database. The tzdata2017a update removes all such abbreviations for South American zones, as well as much of the Pacific. This breaks some test cases in timestamptz.sql that were expecting America/Santiago and America/Caracas to have non-numeric abbreviations. The test cases involving America/Santiago seem to have selected that zone more or less at random, so just replace it with America/New_York, which is of similar longitude. The cases involving America/Caracas are harder since they were chosen to test a time-varying zone abbreviation around a point where it changed meaning in the backwards direction. Fortunately, Europe/Moscow has a similar case in 2014, and the MSK/MSD abbreviations are well enough attested that IANA seems unlikely to decide to remove them from the database in future. With these changes, this regression test should pass when using any IANA zone database from 2015 or later. One could wish that there were a few years more daylight on how out-of-date your zone database can be ... but really the --with-system-tzdata option is only meant for use on platforms where the zone database is kept up-to-date pretty faithfully, so I do not think this is a big objection. Discussion: <a target="_blank" href="https://postgr.es/m/6749.1489087470@sss.pgh.pa.us">https://postgr.es/m/6749.1489087470@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f077e1b2e374fadc443b6aa9fa54ad9bb6f908c7">http://git.postgresql.org/pg/commitdiff/f077e1b2e374fadc443b6aa9fa54ad9bb6f908c7</a></li>
<li>Fix hard-coded relkind constants in pg_dump.c. Although it's reasonable to expect that most of these constants will never change, that does not make it good programming style to hard-code the value rather than using the RELKIND_FOO macros. There were only a few such violations, and all relatively new AFAICT. Existing style is mostly to inject relkind values into constructed query strings using %c. I did not bother to touch places that did it like that, but really a better technique is to stringify the RELKIND macro, at least in places where you'd want single quotes around the code character. That avoids any runtime effort and keeps the RELKIND symbol close to where it's used. Discussion: <a target="_blank" href="https://postgr.es/m/11145.1488931324@sss.pgh.pa.us">https://postgr.es/m/11145.1488931324@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fe797b4a6a69ec0c9bf6ff992eac20c4084fda41">http://git.postgresql.org/pg/commitdiff/fe797b4a6a69ec0c9bf6ff992eac20c4084fda41</a></li>
<li>Make CppAsString2() more visible in c.h. For some reason this standard C string-processing hack was buried in an NLS-related section of c.h. Put it beside CppAsString() so that people are more likely to find it and not be tempted to reinvent local copies, as I nearly did. And provide a more helpful comment, too. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9cfc4deeb9e6bd8162bd85dce5809d4d7aea2b66">http://git.postgresql.org/pg/commitdiff/9cfc4deeb9e6bd8162bd85dce5809d4d7aea2b66</a></li>
<li>Fix hard-coded relkind constants in psql/describe.c. Although it's reasonable to expect that most of these constants will never change, that does not make it good programming style to hard-code the value rather than using the RELKIND_FOO macros. Discussion: <a target="_blank" href="https://postgr.es/m/11145.1488931324@sss.pgh.pa.us">https://postgr.es/m/11145.1488931324@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/395bfaae8e786eb17fc9dd79e4636f97c9d9b820">http://git.postgresql.org/pg/commitdiff/395bfaae8e786eb17fc9dd79e4636f97c9d9b820</a></li>
<li>Fix portability problem in Catalog.pm. Commit 7666e73a2 introduced a dependency on filehandles' input_line_number method, but apparently that's a Perl neologism. Use $. instead, which works at least back to Perl 5.10, and hopefully back to 5.8. Jeff Janes Discussion: <a target="_blank" href="https://postgr.es/m/CAMkU=1wuQW=xVfu-14A4VCvxO0ohkD3m9vk6HOj_dprQoKNAQw@mail.gmail.com">https://postgr.es/m/CAMkU=1wuQW=xVfu-14A4VCvxO0ohkD3m9vk6HOj_dprQoKNAQw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/15bb93e28e49fdf4f28d509c07d1527886acb3e2">http://git.postgresql.org/pg/commitdiff/15bb93e28e49fdf4f28d509c07d1527886acb3e2</a></li>
<li>Fix hard-coded relkind constants in assorted src/bin files. Although it's reasonable to expect that most of these constants will never change, that does not make it good programming style to hard-code the value rather than using the RELKIND_FOO macros. Discussion: <a target="_blank" href="https://postgr.es/m/11145.1488931324@sss.pgh.pa.us">https://postgr.es/m/11145.1488931324@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fcd778eb703c154c0fbba249e17c21b7ae4de19b">http://git.postgresql.org/pg/commitdiff/fcd778eb703c154c0fbba249e17c21b7ae4de19b</a></li>
<li>Add .gitignore to contrib/amcheck. Oversight in commit 3717dc149. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/574268e37b3b7b3449eb0034013443d88f4bd320">http://git.postgresql.org/pg/commitdiff/574268e37b3b7b3449eb0034013443d88f4bd320</a></li>
<li>Fix hard-coded relkind constants in assorted other files. Although it's reasonable to expect that most of these constants will never change, that does not make it good programming style to hard-code the value rather than using the RELKIND_FOO macros. I think I've now gotten all the hard-coded references in C code. Unfortunately there's no equally convenient way to parameterize SQL files ... Discussion: <a target="_blank" href="https://postgr.es/m/11145.1488931324@sss.pgh.pa.us">https://postgr.es/m/11145.1488931324@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9c2635e26f6f4e34b3b606c0fc79d0e111953a74">http://git.postgresql.org/pg/commitdiff/9c2635e26f6f4e34b3b606c0fc79d0e111953a74</a></li>
<li>Un-break things on IPv6-less platforms. Commit be37c2120 forgot to teach initdb about commenting out the IPv6 replication entry that it caused to exist in pg_hba.conf.sample. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a83e4b4f31c7afa5f7360086ebb1916cc99a4dbe">http://git.postgresql.org/pg/commitdiff/a83e4b4f31c7afa5f7360086ebb1916cc99a4dbe</a></li>
<li>Change the relkind for partitioned tables from 'P' to 'p'. Seven of the eight other relkind codes are lower-case, so it wasn't consistent for this one to be upper-case. Fix it while we still can. Historical notes: the reason for the lone exception, i.e. sequences being 'S', is that 's' was once used for "special" relations. Also, at one time the partitioned-tables patch used both 'P' and 'p', but that got changed, leaving only a surprising choice behind. This also fixes a couple little bits of technical debt, such as type_sanity.sql not knowing that 'm' is a legal value for relkind. Discussion: <a target="_blank" href="https://postgr.es/m/27899.1488909319@sss.pgh.pa.us">https://postgr.es/m/27899.1488909319@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8b358b42f8eb6156a82ac9a41fc4e8335c8dc37a">http://git.postgresql.org/pg/commitdiff/8b358b42f8eb6156a82ac9a41fc4e8335c8dc37a</a></li>
<li>Sanitize newlines in object names in "pg_restore -l" output. Commits 89e0bac86 et al replaced newlines with spaces in object names printed in SQL comments, but we neglected to consider that the same names are also printed by "pg_restore -l", and a newline would render the output unparseable by "pg_restore -L". Apply the same replacement in "-l" output. Since "pg_restore -L" doesn't actually examine any object names, only the dump ID field that starts each line, this is enough to fix things for its purposes. The previous fix was treated as a security issue, and we might have done that here as well, except that the issue was reported publicly to start with. Anyway it's hard to see how this could be exploited for SQL injection; "pg_restore -L" doesn't do much with the file except parse it for leading integers. Per bug #14587 from Milos Urbanek. Back-patch to all supported versions. Discussion: <a target="_blank" href="https://postgr.es/m/20170310155318.1425.30483@wrigleys.postgresql.org">https://postgr.es/m/20170310155318.1425.30483@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f39ddd843667c68f760cb4cf23c89c1f1d9aebb8">http://git.postgresql.org/pg/commitdiff/f39ddd843667c68f760cb4cf23c89c1f1d9aebb8</a></li>
<li>Reduce log verbosity of startup/shutdown for launcher subprocesses. There's no really good reason why the autovacuum launcher and logical replication launcher should announce themselves at startup and shutdown by default. Users don't care that those processes exist, and it's inconsistent that those background processes announce themselves while others don't. So, reduce those messages from LOG to DEBUG1 level. I was sorely tempted to reduce the "starting logical replication worker for subscription ..." message to DEBUG1 as well, but forebore for now. Those processes might possibly be of direct interest to users, at least until logical replication is a lot better shaken out than it is today. Discussion: <a target="_blank" href="https://postgr.es/m/19479.1489121003@sss.pgh.pa.us">https://postgr.es/m/19479.1489121003@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6ec4c8584c45ee784a95e02c40bb643430dee32a">http://git.postgresql.org/pg/commitdiff/6ec4c8584c45ee784a95e02c40bb643430dee32a</a></li>
<li>contrib/amcheck needs RecentGlobalXmin to be PGDLLIMPORT'ified. Per buildfarm. Maybe some of the other xmin variables in snapmgr.h ought to get this too, but for the moment I'm just interested in un-breaking the buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/56018bf26eec1a0b4bf20303c98065a8eb1b0c5d">http://git.postgresql.org/pg/commitdiff/56018bf26eec1a0b4bf20303c98065a8eb1b0c5d</a></li>
<li>Improve postmaster's logging of listen socket creation. When one of the kernel calls in the socket()/bind()/listen() sequence fails, include the specific address we're trying to bind to in the log message. This greatly eases debugging of network misconfigurations. Also, after successfully setting up a listen socket, report its address in the log, to ease verification that the expected addresses were bound. There was some debate about whether to print this message at LOG level or only DEBUG1, but the majority of votes were for the former. Discussion: <a target="_blank" href="https://postgr.es/m/9564.1489091245@sss.pgh.pa.us">https://postgr.es/m/9564.1489091245@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f9dfa5c9776649f769d537dd0923003b35f128de">http://git.postgresql.org/pg/commitdiff/f9dfa5c9776649f769d537dd0923003b35f128de</a></li>
<li>Add a "subtransaction" command to PL/Tcl. This allows rolling back the effects of some SPI commands without having to fail the entire PL/Tcl function. Victor Wagner, reviewed by Pavel Stehule Discussion: <a target="_blank" href="https://postgr.es/m/20170108205750.2dab04a1@wagner.wagner.home">https://postgr.es/m/20170108205750.2dab04a1@wagner.wagner.home</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b58fd4a9cab21e9d937a4e369bab31b3a5d24710">http://git.postgresql.org/pg/commitdiff/b58fd4a9cab21e9d937a4e369bab31b3a5d24710</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>pg_upgrade: Fix large object COMMENTS, SECURITY LABELS. When performing a pg_upgrade, we copy the files behind pg_largeobject and pg_largeobject_metadata, allowing us to avoid having to dump out and reload the actual data for large objects and their ACLs. Unfortunately, that isn't all of the information which can be associated with large objects. Currently, we also support COMMENTs and SECURITY LABELs with large objects and these were being silently dropped during a pg_upgrade as pg_dump would skip everything having to do with a large object and pg_upgrade only copied the tables mentioned to the new cluster. As the file copies happen after the catalog dump and reload, we can't simply include the COMMENTs and SECURITY LABELs in pg_dump's binary-mode output but we also have to include the actual large object definition as well. With the definition, comments, and security labels in the pg_dump output and the file copies performed by pg_upgrade, all of the data and metadata associated with large objects is able to be successfully pulled forward across a pg_upgrade. In 9.6 and master, we can simply adjust the dump bitmask to indicate which components we don't want. In 9.5 and earlier, we have to put explciit checks in in dumpBlob() and dumpBlobs() to not include the ACL or the data when in binary-upgrade mode. Adjustments made to the privileges regression test to allow another test (large_object.sql) to be added which explicitly leaves a large object with a comment in place to provide coverage of that case with pg_upgrade. Back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/20170221162655.GE9812@tamriel.snowman.net">https://postgr.es/m/20170221162655.GE9812@tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff992c074e308ade204a38eb43a6d19c8403414e">http://git.postgresql.org/pg/commitdiff/ff992c074e308ade204a38eb43a6d19c8403414e</a></li>
<li>pg_dump: Properly handle public schema ACLs with --clean. pg_dump has always handled the public schema in a special way when it comes to the "--clean" option. To wit, we do not drop or recreate the public schema in "normal" mode, but when we are run in "--clean" mode then we do drop and recreate the public schema. When running in "--clean" mode, the public schema is dropped and then recreated and it is recreated with the normal schema-default privileges of "nothing". This is unlike how the public schema starts life, which is to have CREATE and USAGE GRANT'd to the PUBLIC role, and that is what is recorded in pg_init_privs. Due to this, in "--clean" mode, pg_dump would mistakenly only dump out the set of privileges required to go from the initdb-time privileges on the public schema to whatever the current-state privileges are. If the privileges were not changed from initdb time, then no privileges would be dumped out for the public schema, but with the schema being dropped and recreated, the result was that the public schema would have no ACLs on it instead of what it should have, which is the initdb-time privileges. Practically speaking, this meant that pg_dump with --clean mode dumping a database where the ACLs on the public schema were not changed from the default would, upon restore, result in a public schema with *no* privileges GRANT'd, not matching the state of the existing database (where the initdb-time privileges would have been CREATE and USAGE to the PUBLIC role for the public schema). To fix, adjust the query in getNamespaces() to ignore the pg_init_privs entry for the public schema when running in "--clean" mode, meaning that the privileges for the public schema would be dumped, correctly, as if it was going from a newly-created schema to the current state (which is, indeed, what will happen during the restore thanks to the DROP/CREATE). Only the public schema is handled in this special way by pg_dump, no other initdb-time objects are dropped/recreated in --clean mode. Back-patch to 9.6 where the bug was introduced. Discussion: <a target="_blank" href="https://postgr.es/m/3534542.o3cNaKiDID%40techfox">https://postgr.es/m/3534542.o3cNaKiDID%40techfox</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/330b84d8c40864007833e05dc9d849c4bda77240">http://git.postgresql.org/pg/commitdiff/330b84d8c40864007833e05dc9d849c4bda77240</a></li>
<li>psql: Add \gx command. It can often be useful to use expanded mode output (\x) for just a single query. Introduce a \gx which acts exactly like \g except that it will force expanded output mode for that one \gx call. This is simpler than having to use \x as a toggle and also means that the user doesn't have to worry about the current state of the expanded variable, or resetting it later, to ensure a given query is always returned in expanded mode. Primairly Christoph's patch, though I did tweak the documentation and help text a bit, and re-indented the tab completion section. Author: Christoph Berg Reviewed By: Daniel Verite Discussion: <a target="_blank" href="https://postgr.es/m/20170127132737.6skslelaf4txs6iw%40msg.credativ.de">https://postgr.es/m/20170127132737.6skslelaf4txs6iw%40msg.credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b2678efd43f17db7dfa04e0ca076ea01275cd9bc">http://git.postgresql.org/pg/commitdiff/b2678efd43f17db7dfa04e0ca076ea01275cd9bc</a></li>
<li>Expose explain's SUMMARY option. This exposes the existing explain summary option to users to allow them to choose if they wish to have the planning time and totalled run time included in the EXPLAIN result. The existing default behavior is retained if SUMMARY is not specified- running explain without analyze will not print the summary lines (just the planning time, currently) while running explain with analyze will include the summary lines (both the planning time and the totalled execution time). Users who wish to see the summary information for plain explain can now use: EXPLAIN (SUMMARY ON) query; Users who do not want to have the summary printed for an analyze run can use: EXPLAIN (ANALYZE ON, SUMMARY OFF) query; With this, we can now also have EXPLAIN ANALYZE queries included in our regression tests by using: EXPLAIN (ANALYZE ON, TIMING OFF, SUMMARY off) query; I went ahead and added an example of this, which will hopefully not make the buildfarm complain. Author: Ashutosh Bapat Discussion: <a target="_blank" href="https://postgr.es/m/CAFjFpReE5z2h98U2Vuia8hcEkpRRwrauRjHmyE44hNv8-xk+XA@mail.gmail.com">https://postgr.es/m/CAFjFpReE5z2h98U2Vuia8hcEkpRRwrauRjHmyE44hNv8-xk+XA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f9b1a0dd403ec0931213c66d5f979a3d3e8e7e30">http://git.postgresql.org/pg/commitdiff/f9b1a0dd403ec0931213c66d5f979a3d3e8e7e30</a></li>
<li>Add relkind checks to certain contrib modules. The contrib extensions pageinspect, pg_visibility and pgstattuple only work against regular relations which have storage. They don't work against foreign tables, partitioned (parent) tables, views, et al. Add checks to the user-callable functions to return a useful error message to the user if they mistakenly pass an invalid relation to a function which doesn't accept that kind of relation. In passing, improve some of the existing checks to use ereport() instead of elog(), add a function to consolidate common checks where appropriate, and add some regression tests. Author: Amit Langote, with various changes by me Reviewed by: Michael Paquier and Corey Huinker Discussion: <a target="_blank" href="https://postgr.es/m/ab91fd9d-4751-ee77-c87b-4dd704c1e59c@lab.ntt.co.jp">https://postgr.es/m/ab91fd9d-4751-ee77-c87b-4dd704c1e59c@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c08d82f38ebf763b79bd43ae34b7310ee47aaacd">http://git.postgresql.org/pg/commitdiff/c08d82f38ebf763b79bd43ae34b7310ee47aaacd</a></li>
<li>pgstattuple: Fix typo partitiond -&gt; partitioned. Pointed out by Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/90e91e242fe99582b6d2dc18177e79d99c91695d">http://git.postgresql.org/pg/commitdiff/90e91e242fe99582b6d2dc18177e79d99c91695d</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Make simplehash.h grow hashtable in additional cases. Increase the size when either the distance between actual and optimal slot grows too large, or when too many subsequent entries would have to be moved. This addresses reports that the simplehash performed, sometimes considerably, worse than dynahash. The reason turned out to be that insertions into the hashtable where, due to the use of parallel query, in effect done from another hashtable, in hash-value order. If the target hashtable, due to mis-estimation, was sized a lot smaller than the source table(s) that lead to very imbalanced tables; a lot of entries in many close-by buckets from the source tables were inserted into a single, wider, bucket on the target table. As the growth factor was solely computed based on the fillfactor, the performance of the table decreased further and further. b81b5a96f424531b was an attempt to address this problem for hash aggregates (but not for bitmap scans), but it turns out that the current method of mixing hash values often actually leaves neighboring hash-values close to each other, just in different value range. It might be worth revisiting that independently of the performance issues addressed in this patch.. To address that problem resize tables in two additional cases: Firstly when the optimal position for an entry would be far from the actual position, secondly when many entries would have to be moved to make space for the new entry (while satisfying the robin hood property). Due to the additional resizing threshold it seems possible, and testing confirms that so far, that a higher fillfactor doesn't hurt performance and saves a bit of memory. It seems better to increase it now, before a release containing any of this code, rather than wonder in some later release. The various boundaries aren't determined in a particularly scientific manner, they might need some fine-tuning. In all my tests the new code now, even with parallelism, performs at least as good as the old code, in several scenarios significantly better. Reported-By: Dilip Kumar, Robert Haas, Kuntal Ghosh Discussion: <a target="_blank" href="https://postgr.es/m/CAFiTN-vagvuAydKG9VnWcoK=ADAhxmOa4ZTrmNsViBBooTnriQ@mail.gmail.com">https://postgr.es/m/CAFiTN-vagvuAydKG9VnWcoK=ADAhxmOa4ZTrmNsViBBooTnriQ@mail.gmail.com</a> <a target="_blank" href="https://postgr.es/m/CAGz5QC+=fNTYgzMLTBUNeKt6uaWZFXJbkB5+7oWm-n9DwVxcLA@mail.gmail.com">https://postgr.es/m/CAGz5QC+=fNTYgzMLTBUNeKt6uaWZFXJbkB5+7oWm-n9DwVxcLA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d4c62a6b623d6eef88218158e9fa3cf974c6c7e5">http://git.postgresql.org/pg/commitdiff/d4c62a6b623d6eef88218158e9fa3cf974c6c7e5</a></li>
<li>Add amcheck extension to contrib. This is the beginning of a collection of SQL-callable functions to verify the integrity of data files. For now it only contains code to verify B-Tree indexes. This adds two SQL-callable functions, validating B-Tree consistency to a varying degree. Check the, extensive, docs for details. The goal is to later extend the coverage of the module to further access methods, possibly including the heap. Once checks for additional access methods exist, we'll likely add some "dispatch" functions that cover multiple access methods. Author: Peter Geoghegan, editorialized by Andres Freund Reviewed-By: Andres Freund, Tomas Vondra, Thomas Munro, Anastasia Lubennikova, Robert Haas, Amit Langote Discussion: CAM3SWZQzLMhMwmBqjzK+pRKXrNUZ4w90wYMUWfkeV8mZ3Debvw@mail.gmail.com <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3717dc149ecf44b8be95350a68605ba7299474fd">http://git.postgresql.org/pg/commitdiff/3717dc149ecf44b8be95350a68605ba7299474fd</a></li>
<li>amcheck: editorialize variable name &amp; comment. No exclusive lock is taken anymore... <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fcd8d25d38b5f42ec4ae77a673813c2dc279ccf7">http://git.postgresql.org/pg/commitdiff/fcd8d25d38b5f42ec4ae77a673813c2dc279ccf7</a></li>
<li>Enable 64 bit atomics on ARM64. Previously they were disabled due to performance concerns on 32bit arm, where 64bit atomics are often implemented via kernel traps. Author: Roman Shaposhnik Discussion: <a target="_blank" href="http://postgr.es/m/CA+ULb+uErkFuXUCCXWHYvnV5KnAyjGUzzRcPA-M0cgO+Hm4RSA@mail.gmail.com">http://postgr.es/m/CA+ULb+uErkFuXUCCXWHYvnV5KnAyjGUzzRcPA-M0cgO+Hm4RSA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f8f1430ae709c0018a217c77893754f38b3c5b93">http://git.postgresql.org/pg/commitdiff/f8f1430ae709c0018a217c77893754f38b3c5b93</a></li>
<li>Improve expression evaluation test coverage. Upcoming patches are revamping expression evaluation significantly. It therefore seems prudent to try to ensure that the coverage of the existing evaluation code is high. This commit adds coverage for the cases that can reasonably be tested. There's still a bunch of unreachable error messages and such, but otherwise this achieves nearly full regression test coverage (with the exception of the unused GetAttributeByNum/GetAttributeByName). Author: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/20170310194021.ek4bs4bl2khxkmll@alap3.anarazel.de">https://postgr.es/m/20170310194021.ek4bs4bl2khxkmll@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ce38949ba23ab311f274aa4196be09d18d30e5a6">http://git.postgresql.org/pg/commitdiff/ce38949ba23ab311f274aa4196be09d18d30e5a6</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Refactor SHA2 functions and move them to src/common/. This way both frontend and backends can use them. The functions are taken from pgcrypto, which now fetches the source files it needs from src/common/. A new interface is designed for the SHA2 functions, which allow linking to either OpenSSL or the in-core stuff taken from KAME as needed. Michael Paquier, reviewed by Robert Haas. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqTGKuTM5jiZriHrNaQeVqp5e_iT3X4BFLWY_HyHxLvySQ%40mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqTGKuTM5jiZriHrNaQeVqp5e_iT3X4BFLWY_HyHxLvySQ%40mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/273c458a2b3a0fb73968020ea5e9e35eb6928967">http://git.postgresql.org/pg/commitdiff/273c458a2b3a0fb73968020ea5e9e35eb6928967</a></li>
<li>Add regression tests for passwords. Michael Paquier. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1fff35d872321015a87ca55042384b83f51dedcf">http://git.postgresql.org/pg/commitdiff/1fff35d872321015a87ca55042384b83f51dedcf</a></li>
<li>Fix comments in SCRAM-SHA-256 patch. Amit Kapila. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/55acfcbffd7d11db8c10cd94ba44bfe5974894e0">http://git.postgresql.org/pg/commitdiff/55acfcbffd7d11db8c10cd94ba44bfe5974894e0</a></li>
<li>Support SCRAM-SHA-256 authentication (RFC 5802 and 7677). This introduces a new generic SASL authentication method, similar to the GSS and SSPI methods. The server first tells the client which SASL authentication mechanism to use, and then the mechanism-specific SASL messages are exchanged in AuthenticationSASLcontinue and PasswordMessage messages. Only SCRAM-SHA-256 is supported at the moment, but this allows adding more SASL mechanisms in the future, without changing the overall protocol. Support for channel binding, aka SCRAM-SHA-256-PLUS is left for later. The SASLPrep algorithm, for pre-processing the password, is not yet implemented. That could cause trouble, if you use a password with non-ASCII characters, and a client library that does implement SASLprep. That will hopefully be added later. Authorization identities, as specified in the SCRAM-SHA-256 specification, are ignored. SET SESSION AUTHORIZATION provides more or less the same functionality, anyway. If a user doesn't exist, perform a "mock" authentication, by constructing an authentic-looking challenge on the fly. The challenge is derived from a new system-wide random value, "mock authentication nonce", which is created at initdb, and stored in the control file. We go through these motions, in order to not give away the information on whether the user exists, to unauthenticated users. Bumps PG_CONTROL_VERSION, because of the new field in control file. Patch by Michael Paquier and Heikki Linnakangas, reviewed at different stages by Robert Haas, Stephen Frost, David Steele, Aleksander Alekseev, and many others. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqRbR3GmFYdedCAhzukfKrgBLTLtMvENOmPrVWREsZkF8g%40mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqRbR3GmFYdedCAhzukfKrgBLTLtMvENOmPrVWREsZkF8g%40mail.gmail.com</a> Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqSMXU35g%3DW9X74HVeQp0uvgJxvYOuA4A-A3M%2B0wfEBv-w%40mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqSMXU35g%3DW9X74HVeQp0uvgJxvYOuA4A-A3M%2B0wfEBv-w%40mail.gmail.com</a> Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/55192AFE.6080106@iki.fi">https://www.postgresql.org/message-id/55192AFE.6080106@iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/818fd4a67d610991757b610755e3065fb99d80a5">http://git.postgresql.org/pg/commitdiff/818fd4a67d610991757b610755e3065fb99d80a5</a></li>
<li>A collection of small fixes for the SCRAM patch. * Add required #includes for htonl. Per buildfarm members pademelon/gaur. * Remove unnecessary "#include &lt;utils/memutils&gt;". * Fix checking for empty string in pg_SASL_init. (Reported by Peter Eisentraut and his compiler) * Move code in pg_SASL_init to match the recent changes (commit ba005f193d) to pg_fe_sendauth() function, where it's copied from. * Return value of malloc() was not checked for NULL in scram_SaltedPassword(). Fix by avoiding the malloc(). <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/95c1dbcdfffcc3a77e693c3c2759e26a01f465c8">http://git.postgresql.org/pg/commitdiff/95c1dbcdfffcc3a77e693c3c2759e26a01f465c8</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix grammar. Reported by Jeremy Finzel <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b7fa016d68b51bc385b75f9d5cffef79e5671981">http://git.postgresql.org/pg/commitdiff/b7fa016d68b51bc385b75f9d5cffef79e5671981</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Fix connection leak in DROP SUBSCRIPTION command, take 2. Commit 898a792eb8283e31efc0b6fcbc03bbcd5f7df667 fixed the connection leak issue, but it was an unreliable way of bugfix. This bugfix was assuming that walrcv_command() subroutine cannot throw an error, but it's untenable assumption. For example, if it will be changed so that an error is thrown, connection leak issue will happen again. This patch ensures that the connection is closed even when walrcv_command() subroutine throws an error. Patch by me, reviewed by Petr Jelinek and Michael Paquier Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/2058.1487704345@sss.pgh.pa.us">https://www.postgresql.org/message-id/2058.1487704345@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/77d21970ae19418f321e6a76ddf1a57ae999c77a">http://git.postgresql.org/pg/commitdiff/77d21970ae19418f321e6a76ddf1a57ae999c77a</a></li>
<li>Prevent logical rep workers with removed subscriptions from starting. Any logical rep workers must have their subscription entries in pg_subscription. To ensure this, we need to prevent the launcher from starting new worker corresponding to the subscription that DROP SUBSCRIPTION command is removing. To implement this, previously LogicalRepLauncherLock was introduced and held until the end of transaction running DROP SUBSCRIPTION. But using LWLock for that purpose was not valid. Instead, this commit changes DROP SUBSCRIPTION so that it takes AccessExclusiveLock on pg_subscription, in order to ensure that the launcher cannot see any subscriptions being removed. Also this commit gets rid of LogicalRepLauncherLock. Patch by me, reviewed by Petr Jelinek Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAHGQGwHPi8ky-yANFfe0sgmhKtsYcQLTnKx07bW9S7-Rn1746w@mail.gmail.com">https://www.postgresql.org/message-id/CAHGQGwHPi8ky-yANFfe0sgmhKtsYcQLTnKx07bW9S7-Rn1746w@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4eafdcc27608dfb8a3afa3155d6ae07f66179782">http://git.postgresql.org/pg/commitdiff/4eafdcc27608dfb8a3afa3155d6ae07f66179782</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Support XMLTABLE query expression. XMLTABLE is defined by the SQL/XML standard as a feature that allows turning XML-formatted data into relational form, so that it can be used as a &lt;table primary&gt; in the FROM clause of a query. This new construct provides significant simplicity and performance benefit for XML data processing; what in a client-side custom implementation was reported to take 20 minutes can be executed in 400ms using XMLTABLE. (The same functionality was said to take 10 seconds using nested PostgreSQL XPath function calls, and 5 seconds using XMLReader under PL/Python). The implemented syntax deviates slightly from what the standard requires. First, the standard indicates that the PASSING clause is optional and that multiple XML input documents may be given to it; we make it mandatory and accept a single document only. Second, we don't currently support a default namespace to be specified. This implementation relies on a new executor node based on a hardcoded method table. (Because the grammar is fixed, there is no extensibility in the current approach; further constructs can be implemented on top of this such as JSON_TABLE, but they require changes to core code.) Author: Pavel Stehule, &Atilde;lvaro Herrera Extensively reviewed by: Craig Ringer Discussion: <a target="_blank" href="https://postgr.es/m/CAFj8pRAgfzMD-LoSmnMGybD0WsEznLHWap8DO79+-GTRAPR4qA@mail.gmail.com">https://postgr.es/m/CAFj8pRAgfzMD-LoSmnMGybD0WsEznLHWap8DO79+-GTRAPR4qA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fcec6caafa2346b6c9d3ad5065e417733bd63cd9">http://git.postgresql.org/pg/commitdiff/fcec6caafa2346b6c9d3ad5065e417733bd63cd9</a></li>
<li>Fix XMLTABLE on older libxml2. libxml2 older than 2.9.1 does not have xmlXPathSetContextNode (released in 2013, so reasonable platforms have trouble). That function is fairly trivial, so I have inlined it in the one added caller. This passes tests on my machine; let's see what the buildfarm thinks about it. Per joint complaint from Tom Lane and buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a9f66f92533b2bfd7abf289219152091b7697e87">http://git.postgresql.org/pg/commitdiff/a9f66f92533b2bfd7abf289219152091b7697e87</a></li>
</ul>
<p>Michael Meskes pushed:</p>
<ul>
<li>Fix a potential double-free in ecpg. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d1ca82d0a226f22438a1cf4ba0ed3460e6db692b">http://git.postgresql.org/pg/commitdiff/d1ca82d0a226f22438a1cf4ba0ed3460e6db692b</a></li>
</ul>
<p>Joe Conway pushed:</p>
<ul>
<li>Fix ancient connection leak in dblink. When using unnamed connections with dblink, every time a new connection is made, the old one is leaked. Fix that. This has been an issue probably since dblink was first committed. Someone complained almost ten years ago, but apparently I decided not to pursue it at the time, and neither did anyone else, so it slipped between the cracks. Now that someone else has complained, fix in all supported branches. Discussion: (orig) +<a target="_blank" href="https://postgr.es/m/flat/F680AB59-6D6F-4026-9599-1BE28880273D%40decibel.org#F680AB59-6D6F-4026-9599-1BE28880273D@decibel.org">https://postgr.es/m/flat/F680AB59-6D6F-4026-9599-1BE28880273D%40decibel.org#F680AB59-6D6F-4026-9599-1BE28880273D@decibel.org</a> Discussion: (new) <a target="_blank" href="https://postgr.es/m/flat/0A3221C70F24FB45833433255569204D1F6ADF8C@G01JPEXMBYT05">https://postgr.es/m/flat/0A3221C70F24FB45833433255569204D1F6ADF8C@G01JPEXMBYT05</a> Reported by: Jim Nasby and Takayuki Tsunakawa <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd1e23e93bc12b7d084dc2acf9f80e9ea1f1e6de">http://git.postgresql.org/pg/commitdiff/cd1e23e93bc12b7d084dc2acf9f80e9ea1f1e6de</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Jim Nasby sent in another revision of a patch to add SPI_execute_callback() and a callback-based DestReceiver, and modify plpython to use same.</p>
<p>Etsuro Fujita, Ashutosh Bapat, and David Rowley traded patches to fix an issue where foreign Join pushdowns were not working properly for outer joins.</p>
<p>Amit Langote sent in two more revisions of a patch to avoid creating scan nodes for partitioned tables and not allocate storage for partitioned tables.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to use a radix tree for character conversion.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to fix some infelicities between logical replication and database encoding.</p>
<p>Masahiko Sawada sent in a patch to update the documentation to reflect the fact that oldestxmin is now shown in VACUUM.</p>
<p>Dagfinn Ilmari Manns&Atilde;&yen;ker sent in another revision of a patch to fix many perlcritic exceptions.</p>
<p>Kyotaro HORIGUCHI sent in a patch to add a WAL relief vent for replication slots.</p>
<p>Takeshi Ideriha sent in another revision of a patch to add DECLARE STATEMENT to ECPG.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to logical replication apply to run with sync commit off by default.</p>
<p>Robert Haas sent in a patch to fix the computation of parallel workers to distinguish "can't have a heap page" from "found zero heap pages."</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to remove NamedLWLockTrancheArray.</p>
<p>Masahiko Sawada sent in another revision of a patch to add a GUC for cleanup indexes threshold.</p>
<p>Thomas Munro sent in two more revisions of a patch to add a [parallel [shared]] hash.</p>
<p>Aleksander Alekseev sent in three more revisions of a patch to make declarative partitioning work faster when large numbers of partitions are present.</p>
<p>Masahiko Sawada sent in another revision of a patch to report the number of skipped frozen pages by manual VACUUM.</p>
<p>David Steele sent in another revision of a patch to add a configurable file mode mask.</p>
<p>Amos Bird sent in a patch to make psql show indexes with type info.</p>
<p>Andreas Karlsson sent in a patch to rename the default log directory from pg_log to log.</p>
<p>Petr Jel&Atilde;&shy;nek and Peter Eisentraut traded patches to allow enable an existing data copy for logical replication.</p>
<p>Andres Freund sent in another revision of a patch to speed up expression processing.</p>
<p>Jan Mich&Atilde;&iexcl;lek sent in another revision of a patch to allow formatting tables in psql as markdown, mediawiki, and rst.</p>
<p>Masahiko Sawada sent in another revision of a patch to allow transactions across foreign tables.</p>
<p>Masahiko Sawada sent in a patch to document the fact that PREPARE TRANSACTION is now part of ECPG.</p>
<p>Simon Riggs and Dean Rasheed traded patches to speed up replay of AccessExclusiveLock.</p>
<p>Tomas Vondra sent in another revision of a patch to implement two slab-like memory allocators.</p>
<p>David Rowley sent in a patch to fix some warnings in the slab-like memory allocators patch.</p>
<p>Haribabu Kommi sent in another revision of a patch to refactor handling of database attributes between pg_dump and pg_dumpall.</p>
<p>Haribabu Kommi sent in another revision of a patch to implement a pg_stat_sql view.</p>
<p>Pavan Deolasee sent in another revision of a patch to skip all-visible pages during second HeapScan of CREATE INDEX CONCURRENTLY.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to implement SASLprep.</p>
<p>Ivan Kartyshov sent in two more revisions of a patch to make async slave to wait for lsn to be replayed.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two revisions of a patch to add clause PASSWORD (val USING protocol) to CREATE/ALTER ROLE.</p>
<p>Rafia Sabih and Robert Haas traded patches to enable parallelism for queries coming from SQL or other PL functions.</p>
<p>Daniel V&Atilde;&copy;rit&Atilde;&copy; and Vaishnavi Prabakaran traded patches to add batch/pipelining support for libpq.</p>
<p>Takayuki Tsunakawa sent in a patch to refactor strinfo in dblink.</p>
<p>Daniel V&Atilde;&copy;rit&Atilde;&copy; and Vaishnavi Prabakaran traded patches to add batch/pipelining support for libpq.</p>
<p>Takayuki Tsunakawa sent in a patch to refactor strinfo in dblink.</p>
<p>Amit Khandekar sent in two more revisions of a patch to implement parallel append.</p>
<p>Kevin Grittner sent in two more revisions of a patch to add transition table support for, among other things, statement triggers and materialized view refreshes.</p>
<p>Kuntal Ghosh sent in another revision of a patch to add WAL consistency check support for hash indexes.</p>
<p>Andrew Gierth sent in two more revisions of a patch to add hash support for grouping sets.</p>
<p>Takayuki Tsunakawa sent in another revision of a patch to support huge pages on Windows.</p>
<p>Craig Ringer sent in a patch to fix an off-by-one error in logical slot resource retention.</p>
<p>Rushabh Lathia sent in another revision of a patch to add wait events for disk I/O.</p>
<p>Amit Langote sent in a patch to use ALTER FOREIGN TABLE with foreign table in tests.</p>
<p>&Atilde;lvaro Herrera sent in another revision of a patch to add WARM.</p>
<p>Victor Wagner sent in three more revisions of a patch to add explicit subtransactions for PL/Tcl.</p>
<p>Peter Eisentraut sent in another revision of a patch to cast result of copyObject() to correct type.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement ICU integration.</p>
<p>Amit Langote sent in another revision of a patch to fix an infelicity between declarative partitioning and ON CONFLICT.</p>
<p>Amit Langote sent in another revision of a patch to improve the documents on declarative partitioning.</p>
<p>Amit Langote sent in a patch to fix a bug in get_partition_for_tuple.</p>
<p>Peter Geoghegan sent in a patch to fix the amcheck build on Windows.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to fix remote position tracking in logical replication.</p>
<p>Kuntal Ghosh sent in another revision of a patch to expose wait events for non-backends.</p>
<p>Beena Emerson sent in another revision of a patch to allow increasing the default WAL segment size.</p>
<p>Vinayak Pokale sent in another revision of a patch to add an ANALYZE command progress checker.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two more revisions of a patch to fix unlogged flushes.</p>
<p>Surafel Temesgen and Pavel St&Auml;&rsaquo;hule traded patches to implement CORRESPONDING.</p>
<p>Tom Lane sent in two revisions of a patch to upgrade the postmaster's log messages about bind/listen errors.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to change references of password encryption to hashing.</p>
<p>Nikita Glukhov sent in another revision of a patch to fix a bug in SP-GiST box_ops.</p>
<p>Ashutosh Bapat sent in another revision of a patch to implement partition-wise join for join between (declaratively) partitioned tables.</p>
<p>Dmitry Dolgov sent in another revision of a patch to add FTS support for JSON[B].</p>
<p>Thomas Munro sent in another revision of a patch to fix SERIALIZABLE isolation for parallel query.</p>
<p>Nikhil Sontakke sent in another revision of a patch to speed up two-phase transactions.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add VERBOSE_SORT_COLUMNS and VERBOSE_SORT_DIRECTION to psql.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add default namespaces for XPath expressions.</p>
<p>Tom Lane and Andres Freund traded patches to speed up running all the tests.</p>
<p>Tom Lane sent in another revision of a patch to add \if and friends to psql.</p>
<p>Nikolay Shaplov sent in another revision of a patch to move all am-related reloption code into src/backend/access/[am-name] and get rid of relopt_kind for custom AM.</p>
<p>Stephen Frost sent in two more revisions of a patch to add macaddr 64 bit (EUI-64) datatype support.</p>
<p>Peter Geoghegan sent in another revision of a patch to add parallel tuplesort (for parallel B-Tree index creation).</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/03/14/Nouvelles-hebdomadaires-de-PostgreSQL-12-mars-2017">par chl le mardi 14 mars 2017 à 00h12</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi  9 mars 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:a7cb4bf732993c580210304fcb3d645f" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/03/09/Nouvelles-hebdomadaires-de-PostgreSQL-5-mars-2017">Nouvelles hebdomadaires de PostgreSQL - 5 mars 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pgpoolAdmin 3.6.0, an administration tool for pgpool, released. <a target="_blank" href="http://pgpool.net/mediawiki/index.php/Downloads">http://pgpool.net/mediawiki/index.php/Downloads</a></li>
<li>psycopg2 2.7, un connecteur python pour PostgreSQL&nbsp;: <a target="_blank" href="http://initd.org/psycopg/docs/news.html#what-s-new-in-psycopg-2-7">http://initd.org/psycopg/docs/news.html#what-s-new-in-psycopg-2-7</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en mars</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-03/">http://archives.postgresql.org/pgsql-jobs/2017-03/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Nantes le 8 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/</a>]</li>
<li>[ndt: Meetup &agrave; Paris le 9 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/</a>]</li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://2017.pgday.asia/">http://2017.pgday.asia/</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170306025346.GA11640@fetter.org">http://www.postgresql.org/message-id/20170306025346.GA11640@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Andres Freund pushed:</p>
<ul>
<li>Add "Slab" MemoryContext implementation for efficient equal-sized allocations. The default general purpose aset.c style memory context is not a great choice for allocations that are all going to be evenly sized, especially when those objects aren't small, and have varying lifetimes. There tends to be a lot of fragmentation, larger allocations always directly go to libc rather than have their cost amortized over several pallocs. These problems lead to the introduction of ad-hoc slab allocators in reorderbuffer.c. But it turns out that the simplistic implementation leads to problems when a lot of objects are allocated and freed, as aset.c is still the underlying implementation. Especially freeing can easily run into O(n^2) behavior in aset.c. While the O(n^2) behavior in aset.c can, and probably will, be addressed, custom allocators for this behavior are more efficient both in space and time. This allocator is for evenly sized allocations, and supports both cheap allocations and freeing, without fragmenting significantly. It does so by allocating evenly sized blocks via malloc(), and carves them into chunks that can be used for allocations. In order to release blocks to the OS as early as possible, chunks are allocated from the fullest block that still has free objects, increasing the likelihood of a block being entirely unused. A subsequent commit uses this in reorderbuffer.c, but a further allocator is needed to resolve the performance problems triggering this work. There likely are further potentialy uses of this allocator besides reorderbuffer.c. There's potential further optimizations of the new slab.c, in particular the array of freelists could be replaced by a more intelligent structure - but for now this looks more than good enough. Author: Tomas Vondra, editorialized by Andres Freund Reviewed-By: Andres Freund, Petr Jelinek, Robert Haas, Jim Nasby Discussion: <a target="_blank" href="https://postgr.es/m/d15dff83-0b37-28ed-0809-95a5cc7292ad@2ndquadrant.com">https://postgr.es/m/d15dff83-0b37-28ed-0809-95a5cc7292ad@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/58b25e98106dbe062cec0f3d31d64977bffaa4af">http://git.postgresql.org/pg/commitdiff/58b25e98106dbe062cec0f3d31d64977bffaa4af</a></li>
<li>Use the new "Slab" context for some allocations in reorderbuffer.h. Note that this change alone does not yet fully address the performance problems triggering this work, a large portion of the slowdown is triggered by the tuple allocator, which isn't converted to the new allocator. It would be possible to do so, but using evenly sized objects, like both the current implementation in reorderbuffer.c and slab.c, wastes a fair amount of memory. A later patch by Tomas will introduce a better approach. Author: Tomas Vondra Reviewed-By: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/d15dff83-0b37-28ed-0809-95a5cc7292ad@2ndquadrant.com">https://postgr.es/m/d15dff83-0b37-28ed-0809-95a5cc7292ad@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9fab40ad32efa4038d19eaed975bb4c1713ccbc0">http://git.postgresql.org/pg/commitdiff/9fab40ad32efa4038d19eaed975bb4c1713ccbc0</a></li>
<li>Make useful infrastructure from aset.c generally available. An upcoming patch introduces a new type of memory context. To avoid duplicating debugging infrastructure within aset.c, move useful pieces to memdebug.[ch]. While touching aset.c, fix printf format code in AllocFree* debug macros. Author: Tomas Vondra Reviewed-By: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/b3b2245c-b37a-e1e5-ebc4-857c914bc747@2ndquadrant.com">https://postgr.es/m/b3b2245c-b37a-e1e5-ebc4-857c914bc747@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bfd12cccbd72c1846bfa3e4031155c9bd479d70a">http://git.postgresql.org/pg/commitdiff/bfd12cccbd72c1846bfa3e4031155c9bd479d70a</a></li>
<li>Overhaul memory management README. The README was written as a "historical account", and that style hasn't aged particularly well. Rephrase it to describe the current situation, instead of having various version specific comments. This also updates the description of how allocated chunks are associated with their corresponding context, the method of which has changed in the preceding commit. Author: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/20170228074420.aazv4iw6k562mnxg@alap3.anarazel.de">https://postgr.es/m/20170228074420.aazv4iw6k562mnxg@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f4e2d50cd7483a068c0a32e56b2d40f980cdea72">http://git.postgresql.org/pg/commitdiff/f4e2d50cd7483a068c0a32e56b2d40f980cdea72</a></li>
<li>Reduce size of common allocation header. The new slab allocator needs different per-allocation information than the classical aset.c. The definition in 58b25e981 wasn't sufficiently careful on 32 platforms with 8 byte alignment, leading to buildfarm failures. That's not entirely easy to fix by just adjusting the definition. As slab.c doesn't actually need the size part(s) of the common header, all chunks are equally sized after all, it seems better to instead reduce the header to the part needed by all allocators, namely which context an allocation belongs to. That has the advantage of reducing the overhead of slab allocations, and also allows for more flexibility in future allocators. To avoid spreading the logic about accessing a chunk's context around, centralize it in GetMemoryChunkContext(), which allows to delete a good number of lines. A followup commit will revise the mmgr/README portion about StandardChunkHeader, and more. Author: Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/20170228074420.aazv4iw6k562mnxg@alap3.anarazel.de">https://postgr.es/m/20170228074420.aazv4iw6k562mnxg@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7e3aa03b418d604d33040ed8fb866857dae82a02">http://git.postgresql.org/pg/commitdiff/7e3aa03b418d604d33040ed8fb866857dae82a02</a></li>
<li>Fix assertion failure due to over-eager code deduplication. In the previous commit I'd made MemoryContextContains() use GetMemoryChunkContext(), but that causes trouble when the passed pointer isn't allocated in any memory context - that's probably something we shouldn't do, but the previous commit isn't a place for a "policy" change. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/123ccbe58309d08e42009e99a4b34a3a1aef7798">http://git.postgresql.org/pg/commitdiff/123ccbe58309d08e42009e99a4b34a3a1aef7798</a></li>
<li>Fix s/ITERTOR/ITERATOR/ typo in simplehash.h. This could lead to problem when simplehash.h is used to define two different types of hashtable visible in the same translation unit. Reported-By: Josh Soref Discussion: <a target="_blank" href="https://postgr.es/m/CACZqfqCC7WdBAY=rQePb9-qW1rjdaTdHsV5KoVejHkDb6qrtOg@mail.gmail.com">https://postgr.es/m/CACZqfqCC7WdBAY=rQePb9-qW1rjdaTdHsV5KoVejHkDb6qrtOg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8f7277dfb5e703a034dbce7b155d998e577a6bc3">http://git.postgresql.org/pg/commitdiff/8f7277dfb5e703a034dbce7b155d998e577a6bc3</a></li>
<li>Fix two recently introduced grammar errors in mmgr/README. These were introduced by me in f4e2d50c. Reported-By: Tomas Vondra Discussion: <a target="_blank" href="https://postgr.es/m/11adca69-be28-44bc-a801-64e6d53851e3@2ndquadrant.com">https://postgr.es/m/11adca69-be28-44bc-a801-64e6d53851e3@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1309375e706440e1e2fe2a5bb74effbc639261ef">http://git.postgresql.org/pg/commitdiff/1309375e706440e1e2fe2a5bb74effbc639261ef</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>chomp PQerrorMessage() in backend uses. PQerrorMessage() returns an error message with a trailing newline, but in backend use (dblink, postgres_fdw, libpqwalreceiver), we want to have the error message without that for emitting via ereport(). To simplify that, add a function pchomp() that returns a pstrdup'ed string with the trailing newline characters removed. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2ed193c904679a533d5e26a27c97119793bcae52">http://git.postgresql.org/pg/commitdiff/2ed193c904679a533d5e26a27c97119793bcae52</a></li>
<li>Use proper enum constants for LockWaitPolicy. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/eb75f4fced77e108393f18425ec3f7aba2e70a9d">http://git.postgresql.org/pg/commitdiff/eb75f4fced77e108393f18425ec3f7aba2e70a9d</a></li>
<li>psql: Add tab completion for DEALLOCATE. EXECUTE already tab-completes the list of prepared statements, but DEALLOCATE was missing. From: Dagfinn Ilmari Manns&Atilde;&yen;ker &lt;ilmari@ilmari.org&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b5a388392dab4c4a7c0fbd6cd0ad7421eabfc5cf">http://git.postgresql.org/pg/commitdiff/b5a388392dab4c4a7c0fbd6cd0ad7421eabfc5cf</a></li>
<li>Move atooid() definition to a central place. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/788af6f8541d5f30acec540e4fd3cb24f5347209">http://git.postgresql.org/pg/commitdiff/788af6f8541d5f30acec540e4fd3cb24f5347209</a></li>
<li>Collect duplicate copies of oid_cmp(). <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/20f6d74242b3c9c84924e890248d027d30283e21">http://git.postgresql.org/pg/commitdiff/20f6d74242b3c9c84924e890248d027d30283e21</a></li>
<li>Fix naming inconsistency. subobjid -&gt; objsubid From: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/005638e9886aeedeeef933bdbd123d928053d390">http://git.postgresql.org/pg/commitdiff/005638e9886aeedeeef933bdbd123d928053d390</a></li>
<li>Fix timeouts in PostgresNode::psql. Newer Perl or IPC::Run versions default to appending the filename to string exceptions, e.g. the exception psql timed out is thrown as psql timed out at /usr/share/perl5/vendor_perl/IPC/Run.pm line 2961. To handle this, match exceptions with !~ rather than ne. From: Craig Ringer &lt;craig@2ndquadrant.com&gt; Reviewed-by: Dagfinn Ilmari Manns&Atilde;&yen;ker &lt;ilmari@ilmari.org&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/231f48796bcf2976f19122b8c6e12f50b463f94e">http://git.postgresql.org/pg/commitdiff/231f48796bcf2976f19122b8c6e12f50b463f94e</a></li>
<li>Correct old release note item. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/be6ed6451c693d9121d357996cbc21b06058b9c1">http://git.postgresql.org/pg/commitdiff/be6ed6451c693d9121d357996cbc21b06058b9c1</a></li>
<li>Use asynchronous connect API in libpqwalreceiver. This makes the connection attempt from CREATE SUBSCRIPTION and from WalReceiver interruptable by the user in case the libpq connection is hanging. The previous coding required immediate shutdown (SIGQUIT) of PostgreSQL in that situation. From: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; Tested-by: Thom Brown &lt;thom@linux.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e8a850094478a2036891fa3d4ce769bce411ee3">http://git.postgresql.org/pg/commitdiff/1e8a850094478a2036891fa3d4ce769bce411ee3</a></li>
<li>Fix after trigger execution in logical replication. From: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; Tested-by: Thom Brown &lt;thom@linux.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/713f7c47d9c38654adbc36c47fd9e439f0d1f715">http://git.postgresql.org/pg/commitdiff/713f7c47d9c38654adbc36c47fd9e439f0d1f715</a></li>
<li>Add RENAME support for PUBLICATIONs and SUBSCRIPTIONs. From: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6da9759a03d6d985c3b95a3177bbda7bcffd0ae6">http://git.postgresql.org/pg/commitdiff/6da9759a03d6d985c3b95a3177bbda7bcffd0ae6</a></li>
<li>psql: Add tab completion for logical replication. Add tab completion for publications and subscriptions. Also, to be able to get a list of subscriptions, make pg_subscription world-readable but revoke access to subconninfo using column privileges. From: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6f236e1eb8c7601bded96fd96244d676e95b8c26">http://git.postgresql.org/pg/commitdiff/6f236e1eb8c7601bded96fd96244d676e95b8c26</a></li>
<li>doc: Put callouts in SQL comments. This makes copy-and-pasting the SQL code easier. From: Thomas Munro &lt;thomas.munro@enterprisedb.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/47b55d4174fd5662cd2f8c40852a20eec5f07c8f">http://git.postgresql.org/pg/commitdiff/47b55d4174fd5662cd2f8c40852a20eec5f07c8f</a></li>
<li>Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2357c12b4988b4d30c1e2e813e438424546eaa88">http://git.postgresql.org/pg/commitdiff/2357c12b4988b4d30c1e2e813e438424546eaa88</a></li>
<li>Fix parsing of DROP SUBSCRIPTION ... DROP SLOT. It didn't actually parse before. Reported-by: Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/347302730dc3092143ccbc1c29b47ac3354f924b">http://git.postgresql.org/pg/commitdiff/347302730dc3092143ccbc1c29b47ac3354f924b</a></li>
<li>Disallow CREATE/DROP SUBSCRIPTION in transaction block. Disallow CREATE SUBSCRIPTION and DROP SUBSCRIPTION in a transaction block when the replication slot is to be created or dropped, since that cannot be rolled back. based on patch by Masahiko Sawada &lt;sawada.mshk@gmail.com&gt; == Pending Patches ==</li>
<li>pg_dump: Fix ordering. Materialized views refresh should be last. From: Jim Nasby &lt;Jim.Nasby@BlueTreble.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d77ff69341f20db348ba2a4b29c522a93ac8e901">http://git.postgresql.org/pg/commitdiff/d77ff69341f20db348ba2a4b29c522a93ac8e901</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Remove PL/Tcl's "module" facility. PL/Tcl has long had a facility whereby Tcl code could be autoloaded from a database table named "pltcl_modules". However, nobody is using it, as evidenced by the recent discovery that it's never been fixed to work with standard_conforming_strings turned on. Moreover, it's rather shaky from a security standpoint, and the table design is very old and crufty (partly because it dates from before we had TOAST). A final problem is that because the table-population scripts depend on the Tcl client library Pgtcl, which we removed from the core distribution in 2004, it's impossible to create a self-contained regression test for the feature. Rather than try to surmount these problems, let's just remove it. A follow-on patch will provide a way to execute user-defined initialization code, similar to features that exist in plperl and plv8. With that, it will be possible to implement this feature or similar ones entirely in userspace, which is where it belongs. Discussion: <a target="_blank" href="https://postgr.es/m/22067.1488046447@sss.pgh.pa.us">https://postgr.es/m/22067.1488046447@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/817f2a586342767d3289a320bb1dac5dcbb76979">http://git.postgresql.org/pg/commitdiff/817f2a586342767d3289a320bb1dac5dcbb76979</a></li>
<li>Allow index AMs to return either HeapTuple or IndexTuple format during IOS. Previously, only IndexTuple format was supported for the output data of an index-only scan. This is fine for btree, which is just returning a verbatim index tuple anyway. It's not so fine for SP-GiST, which can return reconstructed data that's much larger than a page. To fix, extend the index AM API so that index-only scan data can be returned in either HeapTuple or IndexTuple format. There's other ways we could have done it, but this way avoids an API break for index AMs that aren't concerned with the issue, and it costs little except a couple more fields in IndexScanDescs. I changed both GiST and SP-GiST to use the HeapTuple method. I'm not very clear on whether GiST can reconstruct data that's too large for an IndexTuple, but that seems possible, and it's not much of a code change to fix. Per a complaint from Vik Fearing. Reviewed by Jason Li. Discussion: <a target="_blank" href="https://postgr.es/m/49527f79-530d-0bfe-3dad-d183596afa92@2ndquadrant.fr">https://postgr.es/m/49527f79-530d-0bfe-3dad-d183596afa92@2ndquadrant.fr</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9b88f27cb42fe8ff59ddc75e29c005624b8850a2">http://git.postgresql.org/pg/commitdiff/9b88f27cb42fe8ff59ddc75e29c005624b8850a2</a></li>
<li>Update documentation of tsquery_phrase(). Missed in commit 028350f61. Noted by Eiji Seki. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d99706ed5178d7f37ac322e02e8c56e4e5e0e99a">http://git.postgresql.org/pg/commitdiff/d99706ed5178d7f37ac322e02e8c56e4e5e0e99a</a></li>
<li>In rebuild_relation(), don't access an already-closed relcache entry. This reliably fails with -DRELCACHE_FORCE_RELEASE, as reported by Andrew Dunstan, and could sometimes fail in normal operation, resulting in a wrong persistence value being used for the transient table. It's not immediately clear to me what effects that might have beyond the risk of a crash while accessing OldHeap-&gt;rd_rel-&gt;relpersistence, but it's probably not good. Bug introduced by commit f41872d0c, and made substantially worse by commit 85b506bbf, which added a second such access significantly later than the heap_close. I doubt the first reference could fail in a production scenario, but the second one definitely could. Discussion: <a target="_blank" href="https://postgr.es/m/7b52f900-0579-cda9-ae2e-de5da17090e6@2ndQuadrant.com">https://postgr.es/m/7b52f900-0579-cda9-ae2e-de5da17090e6@2ndQuadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dbca84f04ed5debe748029699aa44fa86beca32d">http://git.postgresql.org/pg/commitdiff/dbca84f04ed5debe748029699aa44fa86beca32d</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>hash: Refactor bucket squeeze code. In preparation for adding write-ahead logging to hash indexes, refactor _hash_freeovflpage and _hash_squeezebucket so that all related page modifications happen in a single section of code. The previous coding assumed that it would be fine to move tuples one at a time, and also that the various operations involved in freeing an overflow page didn't necessarily all need to be done together, all of which is true if you don't care about write-ahead logging. Amit Kapila, with slight changes by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b0f18cb77f50a54e997d857d592f6a511617f52c">http://git.postgresql.org/pg/commitdiff/b0f18cb77f50a54e997d857d592f6a511617f52c</a></li>
<li>hash: Refactor overflow page allocation. As with commit b0f18cb77f50a54e997d857d592f6a511617f52c, the goal here is to move all of the related page modifications to a single section of code, in preparation for adding write-ahead logging. Amit Kapila, with slight changes by me. The larger patch series of which this is a part has been reviewed and tested by &Atilde;lvaro Herrera, Ashutosh Sharma, Mark Kirkwood, Jeff Janes, and Jesper Pedersen, all of whom should also have been credited in the previous commit message. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/30df93f698d016d086e8961aa6c6076b37ea0ef4">http://git.postgresql.org/pg/commitdiff/30df93f698d016d086e8961aa6c6076b37ea0ef4</a></li>
<li>hash: Refactor and clean up bucket split code. As with commit 30df93f698d016d086e8961aa6c6076b37ea0ef4 and commit b0f18cb77f50a54e997d857d592f6a511617f52c, the goal here is to move all of the related page modifications to a single section of code, in preparation for adding write-ahead logging. Amit Kapila, with slight changes by me. The larger patch series of which this is a part has been reviewed and tested by &Atilde;lvaro Herrera, Ashutosh Sharma, Mark Kirkwood, Jeff Janes, and Jesper Pedersen. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/21a3cf41284c08307ef9abe3400be5dc53723519">http://git.postgresql.org/pg/commitdiff/21a3cf41284c08307ef9abe3400be5dc53723519</a></li>
<li>Update comments overlooked by 2f5c9d9c9cec436e55847ec580606d7e88067df6. Tomas Vondra <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fa42b2005f0cd825fe5a5fd4db93a7c30b5fe883">http://git.postgresql.org/pg/commitdiff/fa42b2005f0cd825fe5a5fd4db93a7c30b5fe883</a></li>
<li>Don't uselessly rewrite, truncate, VACUUM, or ANALYZE partitioned tables. Also, recursively perform VACUUM and ANALYZE on partitions when the command is applied to a partitioned table. In passing, some related documentation updates. Amit Langote, reviewed by Michael Paquier, Ashutosh Bapat, and by me. Discussion: <a target="_blank" href="http://postgr.es/m/47288cf1-f72c-dfc2-5ff0-4af962ae5c1b@lab.ntt.co.jp">http://postgr.es/m/47288cf1-f72c-dfc2-5ff0-4af962ae5c1b@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3c3bb99330aa9b4c2f6258bfa0265d806bf365c3">http://git.postgresql.org/pg/commitdiff/3c3bb99330aa9b4c2f6258bfa0265d806bf365c3</a></li>
<li>Refactor bitmap heap scan in preparation for parallel support. The final patch will be less messy if the prefetching support is a bit better isolated, so do that. Dilip Kumar, with some changes by me. The larger patch set of which this is a part has been reviewed and tested by (at least) Andres Freund, Amit Khandekar, Tushar Ahuja, Rafia Sabih, Haribabu Kommi, and Thomas Munro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9e0fe09fc5dc1135479b532d1806e28cbc5a35aa">http://git.postgresql.org/pg/commitdiff/9e0fe09fc5dc1135479b532d1806e28cbc5a35aa</a></li>
<li>Improve error reporting for tuple-routing failures. Currently, the whole row is shown without column names. Instead, adopt a style similar to _bt_check_unique() in ExecFindPartition() and show the failing key: (key1, ...) = (val1, ...). Amit Langote, per a complaint from Simon Riggs. Reviewed by me; I also adjusted the grammar in one of the comments. Discussion: <a target="_blank" href="http://postgr.es/m/9f9dc7ae-14f0-4a25-5485-964d9bfc19bd@lab.ntt.co.jp">http://postgr.es/m/9f9dc7ae-14f0-4a25-5485-964d9bfc19bd@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5a73e17317e91912b2755f7960d5bf31d374cf31">http://git.postgresql.org/pg/commitdiff/5a73e17317e91912b2755f7960d5bf31d374cf31</a></li>
<li>Notify bgworker registrant after freeing worker slot. Tom Lane observed buildfarm failures caused by the select_parallel regression test trying to launch new parallel queries before the worker slots used by the previous ones were freed. Try to fix this by having the postmaster free the worker slots before it sends the SIGUSR1 notifications to the registering process. This doesn't completely eliminate the possibility that the user backend might (correctly) observe the worker as dead before the slot is free, but I believe it should make the window significantly narrower. Patch by me, per complaint from Tom Lane. Reviewed by Amit Kapila. Discussion: <a target="_blank" href="http://postgr.es/m/30673.1487310734@sss.pgh.pa.us">http://postgr.es/m/30673.1487310734@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aea5d298362e881b13d95a48c5ae116879237389">http://git.postgresql.org/pg/commitdiff/aea5d298362e881b13d95a48c5ae116879237389</a></li>
<li>Add pg_current_logfile() function. The syslogger will write out the current stderr and csvlog names, if it's running and there are any, to a new file in the data directory called "current_logfiles". We take care to remove this file when it might no longer be valid (but not at shutdown). The function pg_current_logfile() can be used to read the entries in the file. Gilles Darold, reviewed and modified by Karl O. Pinc, Michael Paquier, and me. Further review by &Atilde;lvaro Herrera and Christoph Berg. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/19dc233c32f2900e57b8da4f41c0f662ab42e080">http://git.postgresql.org/pg/commitdiff/19dc233c32f2900e57b8da4f41c0f662ab42e080</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix incorrect variable datatype. Both datatypes map to the same underlying one which is why it still worked, but we should use the correct type. Author: Kyotaro HORIGUCHI <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/016c9908347ed2ba7b9d7101c858ea7730b6c0b0">http://git.postgresql.org/pg/commitdiff/016c9908347ed2ba7b9d7101c858ea7730b6c0b0</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Create &lt;sect3&gt; in the functions-xml section. This is a small change so that a new XMLTABLE sect3 can be added easily later. Author: Craig Ringer Discussion: <a target="_blank" href="https://postgr.es/m/CAFj8pRAgfzMD-LoSmnMGybD0WsEznLHWap8DO79+-GTRAPR4qA@mail.gmail.com">https://postgr.es/m/CAFj8pRAgfzMD-LoSmnMGybD0WsEznLHWap8DO79+-GTRAPR4qA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4461a9bfd1ac4aa1f922e8309e79d097bde9fcb4">http://git.postgresql.org/pg/commitdiff/4461a9bfd1ac4aa1f922e8309e79d097bde9fcb4</a></li>
</ul>
<p>Noah Misch pushed:</p>
<ul>
<li>Handle unaligned SerializeSnapshot() buffer. Likewise in RestoreSnapshot(). Do so by copying between the user buffer and a stack buffer of known alignment. Back-patch to 9.6, where this last applies cleanly. In master, the select_parallel test dies with SIGBUS on "Oracle Solaris 10 1/13 s10s_u11wos_24a SPARC", building 32-bit with gcc 4.9.2. In 9.6 and 9.5, the buffers in question happen to be sufficiently-aligned, and this change is mere insurance against future 9.6 changes or extension code compromising that. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7f3112135eb67e5df56cd34b8ce662bf6a2390e9">http://git.postgresql.org/pg/commitdiff/7f3112135eb67e5df56cd34b8ce662bf6a2390e9</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Allow vacuums to report oldestxmin. Allow VACUUM and Autovacuum to report the oldestxmin value they used while cleaning tables, helping to make better sense out of the other statistics we report in various cases. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9eb344faf54a849898d9be012ddfa8204cfeb57c">http://git.postgresql.org/pg/commitdiff/9eb344faf54a849898d9be012ddfa8204cfeb57c</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Thomas Munro sent in two revisions of a patch to add a test for SSI SLRU wraparound.</p>
<p>Beena Emerson sent in another revision of a patch to allow setting the default WAL segment size at initdb time.</p>
<p>Kyotaro HORIGUCHI and Peter Eisentraut traded patches to fix an issue in the logical replication protocol.</p>
<p>Amit Langote sent in a patch to allow dropping declaratively partitioned table without CASCADE.</p>
<p>Noah Misch sent in a patch to use wrappers of PG_DETOAST_DATUM_PACKED() more.</p>
<p>Etsuro Fujita sent in a patch to add support for parameterized foreign joins.</p>
<p>Dagfinn Ilmari Manns&Atilde;&yen;ker sent in a patch to add max_pred_locks_per_{relation,page} reloptions.</p>
<p>Alexander Korotkov sent in another revision of a patch to add incremental sort.</p>
<p>Haribabu Kommi sent in another revision of a patch to add infrastructure which will be used to parallelize DML and utility commands.</p>
<p>Pavan Deolasee sent in another revision of a patch to implement WARM.</p>
<p>&Atilde;lvaro Herrera sent in a patch to make a BRIN page range unsummarized.</p>
<p>Andrew Dunstan sent in another revision of a patch to enable tree_gin and btree_gist for enums.</p>
<p>Simon Riggs sent in a patch to reduce the amount of bloat resulting from running CREATE INDEX CONCURRENTLY by destroying the snapshot taken in the first phase, before entering the second phase.</p>
<p>Kyotaro HORIGUCHI sent in a patch to make slotSegNo a XLogSegNo, which it already should have been.</p>
<p>Daisuke Higuchi sent in a patch to enable walsender for async to wait until walsender for sync confirms that WAL is written to disk, controlled by a new boolean GUC, async_walsender_delay.</p>
<p>Robert Haas, Amit Langote, and Ashutosh Bapat traded patches to fix an infelicity between declaratively partitioned tables and relfilenode.</p>
<p>Kyotaro HORIGUCHI sent in two more revisions of a patch to implement character conversion with a radix tree.</p>
<p>Takayuki Tsunakawa sent in a PoC patch to implement statement-level ROLLBACK.</p>
<p>Kyotaro HORIGUCHI sent in a patch to add WAL relief vent for replication slots.</p>
<p>Surafel Temesgen sent in a patch to disallow multiple queries per PQexec().</p>
<p>Tom Lane sent in two revisions of a patch to remove PL/Tcl's unused modules infrastructure.</p>
<p>Kuntal Ghosh sent in a patch to implement WAL consistency checking for hash indexes.</p>
<p>David Steele sent in two revisions of a patch to make pg_stop_backup() archive wait optional.</p>
<p>Dmitry Dolgov sent in a patch to add some full text search functions for JSONB.</p>
<p>Etsuro Fujita sent in a patch to the PostgreSQL FDW to enable evaluating placeholdervars on the remote server.</p>
<p>Simon Riggs sent in a patch to avoid bloat in CREATE INDEX CONCURRENTLY.</p>
<p>Dmitry Dolgov sent in another revision of a patch to implement generic type subscripting.</p>
<p>David Steele sent in a patch to implement a configurable file mode mask.</p>
<p>Haribabu Kommi sent in a patch to refactor the handling of database attributes between pg_dump and pg_dumpall.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement IDENTITY columns.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement background sessions.</p>
<p>Peter Eisentraut sent in a patch to use the SQL standard error code for nextval.</p>
<p>Peter Eisentraut sent in another revision of a patch to cast result of copyObject() to the correct type.</p>
<p>Venkata B Nagothi sent in two more revisions of a patch to add recovery_start_point and recovery_incomplete.</p>
<p>Amit Kapila sent in another revision of a patch to add WAL logging for hash indexes.</p>
<p>Peter Moser sent in another revision of a patch to add temporal query processing with range types.</p>
<p>Peter Eisentraut sent in another revision of a patch to do some of the infrastructure for making PostgreSQL's source C++-compatible.</p>
<p>Peter Eisentraut sent in a patch to refactor dblink, replacing some macros with static functions.</p>
<p>Peter Eisentraut sent in a patch to make much of the Perl code perlcritic-clean.</p>
<p>Andres Freund sent in a patch to move contrib/seg to only use V1 calling conventions and remove support for version-0 calling conventions.</p>
<p>KaiGai Kohei sent in two more revisions of a patch to add a PassDownLimitBound for ForeignScan/CustomScan.</p>
<p>Tomas Vondra sent in a patch to update comments about CatalogUpdateIndexes.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel bitmap heap scan.</p>
<p>Jim Nasby sent in another revision of a patch to add SPI_execute_callback() and callback-based DestReceiver and minimally use same in PL/PythonU.</p>
<p>&Atilde;lvaro Herrera sent in a patch to add autovacuum work items for BRIN summarization.</p>
<p>Brandur Leach sent in another revision of a patch to add SortSupport for the macaddr type.</p>
<p>Rahila Syed sent in a patch to add support for default partition in declarative partitioning.</p>
<p>Peter Eisentraut sent in another revision of a patch to enable referring to functions without arguments when the name is unique.</p>
<p>Corey Huinker sent in three more revisions of a patch to implement \if and friends in psql.</p>
<p>Yugo Nagata and Amul Sul traded different implementations of patches to implement hash partitioning for declaratively partitioned tables.</p>
<p>Vinayak Pokale sent in a patch to add a progress checker for ANALYZE.</p>
<p>Oleg Bartunov sent in a patch to implement SQL/JSON.</p>
<p>Pavan Deolasee sent in a patch to skip all-visible pages during second HeapScan of CREATE INDEX CONCURRENTLY.</p>
<p>Andres Freund sent in a patch to make simplehash.h grow hashtable in additional cases.</p>
<p>Dilip Kumar and Robert Haas traded patches to implement parallel merge join.</p>
<p>Lucas Fitti sent in a patch to use $ parameters as replacement characters for pg_stat_statements.</p>
<p>Jan Mich&Atilde;&iexcl;lek sent in two more revisions of a patch to implement markdown, rst and mediawiki output formats in psql.</p>
<p>Andreas Karlsson sent in another revision of a patch to implement REINDEX CONCURRENTLY.</p>
<p>Anastasia Lubennikova sent in another revision of a patch to add covering + unique indexes.</p>
<p>&Atilde;lvaro Herrera sent in another revision of a patch to improve BRIN cost estimates.</p>
<p>Dagfinn Ilmari Manns&Atilde;&yen;ker sent in a patch to address all the ## no critic annotations except RequireFilenameMatchesPackage.</p>
<p>David Rowley sent in a patch to improve performance of replay of AccessExclusiveLock.</p>
<p>Ashutosh Bapat sent in two more revisions of a patch to improve partition-wise join between declaratively partitioned tables.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two more revisions of a patch to implement SCRAM authentication.</p>
<p>&Atilde;lvaro Herrera sent in another revision of a patch to optimize memory allocation in the 'bringetbitmap' function.</p>
<p>Tomas Vondra sent in two more revisions of a patch to implement extended statistics, formerly multivariate statistics.</p>
<p>Jim Mlodgenski sent in two revisions of a patch to track stats for materialized views.</p>
<p>Thomas Munro sent in another revision of a patch to measure replay lag.</p>
<p>Petr Jel&Atilde;&shy;nek sent in another revision of a patch to reserve global xmin for create slot snasphot export, not use on disk snapshots for snapshot export in logical decoding, prevent snapshot builder xmin from going backwards, fix xl_running_xacts usage in snapshot builder, and skip unnecessary snapshot builds.</p>
<p>Amit Langote sent in another revision of a patch to improve the documents for partitioning.</p>
<p>Ronan Dunklau sent in a patch to fix mergeappend costsort estimates.</p>
<p>Masahiko Sawada sent in a patch to implement 2PC in ECPG.</p>
<p>Rushabh Lathia sent in a patch to print the correct startup cost for the group aggregate.</p>
<p>&Atilde;lvaro Herrera and Pavel St&Auml;&rsaquo;hule traded patches to implement xmltable().</p>
<p>Kyotaro HORIGUCHI sent in a patch to remove NamedLWLockTrancheArray.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to reorder the asynchronous libpq calls for replication connection.</p>
<p>Tomas Vondra sent in another revision of a patch to add page_checksum and bt_page_items(bytea).</p>
<p>Ashutosh Sharma sent in another revision of a patch to fix an issue where parallel seq. plan was not coming against inheritance or partition table.</p>
<p>David Rowley sent in a patch to fix an issue where foreign join pushdowns not working properly for outer joins.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/03/09/Nouvelles-hebdomadaires-de-PostgreSQL-5-mars-2017">par chl le jeudi  9 mars 2017 à 00h09</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi  2 mars 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:d1184e47b9bb7c60b8b61147d8a915ba" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/03/02/Nouvelles-hebdomadaires-de-PostgreSQL-26-f%C3%A9vrier-2017">Nouvelles hebdomadaires de PostgreSQL - 26 février 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Offres d'emplois autour de PostgreSQL en f&eacute;vrier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-02/">http://archives.postgresql.org/pgsql-jobs/2017-02/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</li>
<li>Le premier pgDay Israel 2017 aura lieu le 2 mars 2017. Les inscriptions sont ouvertes&nbsp;: <a target="_blank" href="http://pgday.org.il/">http://pgday.org.il/</a></li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>[ndt: Meetup &agrave; Nantes le 8 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/</a>]</li>
<li>[ndt: Meetup &agrave; Paris le 9 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/</a>]</li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://2017.pgday.asia/">http://2017.pgday.asia/</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/">http://www.pgcon.org/2017/</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170226230150.GA2560@fetter.org">http://www.postgresql.org/message-id/20170226230150.GA2560@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>Fix documentation of to_char/to_timestamp TZ, tz, OF formatting patterns. These are only supported in to_char, not in the other direction, but the documentation failed to mention that. Also, describe TZ/tz as printing the time zone "abbreviation", not "name", because what they print is elsewhere referred to that way. Per bug #14558. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/10257fc5ff74487a46594bd8c8c041878f409c17">http://git.postgresql.org/pg/commitdiff/10257fc5ff74487a46594bd8c8c041878f409c17</a></li>
<li>Improve error message for misuse of TZ, tz, OF formatting patterns. Be specific about which pattern is being complained of, and avoid saying "it's not supported in to_date", which is just confusing if the error is actually coming out of to_timestamp. We can phrase it as "is only supported in to_char", instead. Also, use the term "formatting field" not "format pattern", because other error messages in the same file prefer that terminology. (This isn't terribly consistent with the documentation, so maybe we should change all these error messages?) <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1c073505e8e4fa8a03312fea714da25ab83cb5fa">http://git.postgresql.org/pg/commitdiff/1c073505e8e4fa8a03312fea714da25ab83cb5fa</a></li>
<li>Reject too-old Python versions a bit sooner. Commit 04aad4018 added this check after the search for a Python shared library, which seems to me to be a pretty unfriendly ordering. The search might fail for what are basically version-related reasons, and in such a case it'd be better to say "your Python is too old" than "could not find shared library for Python". <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4e5ce3c1aeadf81b504bc9d683b67950bd3f8766">http://git.postgresql.org/pg/commitdiff/4e5ce3c1aeadf81b504bc9d683b67950bd3f8766</a></li>
<li>Use less-generic table name in new regression test case. Creating global objects named "foo" isn't an especially wise thing, but especially not in a test script that has already used that name for something else, and most especially not in a script that runs in parallel with other scripts that use that name :-( Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1c95f0b478a91b58391720dcda35bc032e582564">http://git.postgresql.org/pg/commitdiff/1c95f0b478a91b58391720dcda35bc032e582564</a></li>
<li>Fix sloppy handling of corner-case errors in fd.c. Several places in fd.c had badly-thought-through handling of error returns from lseek() and close(). The fact that those would seldom fail on valid FDs is probably the reason we've not noticed this up to now; but if they did fail, we'd get quite confused. LruDelete and LruInsert actually just Assert'd that lseek never fails, which is pretty awful on its face. In LruDelete, we indeed can't throw an error, because that's likely to get called during error abort and so throwing an error would probably just lead to an infinite loop. But by the same token, throwing an error from the close() right after that was ill-advised, not to mention that it would've left the LRU state corrupted since we'd already unlinked the VFD from the list. I also noticed that really, most of the time, we should know the current seek position and it shouldn't be necessary to do an lseek here at all. As patched, if we don't have a seek position and an lseek attempt doesn't give us one, we'll close the file but then subsequent re-open attempts will fail (except in the somewhat-unlikely case that a FileSeek(SEEK_SET) call comes between and allows us to re-establish a known target seek position). This isn't great but it won't result in any state corruption. Meanwhile, having an Assert instead of an honest test in LruInsert is really dangerous: if that lseek failed, a subsequent read or write would read or write from the start of the file, not where the caller expected, leading to data corruption. In both LruDelete and FileClose, if close() fails, just LOG that and mark the VFD closed anyway. Possibly leaking an FD is preferable to getting into an infinite loop or corrupting the VFD list. Besides, as far as I can tell from the POSIX spec, it's unspecified whether or not the file has been closed, so treating it as still open could be the wrong thing anyhow. I also fixed a number of other places that were being sloppy about behaving correctly when the seekPos is unknown. Also, I changed FileSeek to return -1 with EINVAL for the cases where it detects a bad offset, rather than throwing a hard elog(ERROR). It seemed pretty inconsistent that some bad-offset cases would get a failure return while others got elog(ERROR). It was missing an offset validity check for the SEEK_CUR case on a closed file, too. Back-patch to all supported branches, since all this code is fundamentally identical in all of them. Discussion: <a target="_blank" href="https://postgr.es/m/2982.1487617365@sss.pgh.pa.us">https://postgr.es/m/2982.1487617365@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f97de05a14bbd26cf0252906b44643e8923bdf85">http://git.postgresql.org/pg/commitdiff/f97de05a14bbd26cf0252906b44643e8923bdf85</a></li>
<li>Suppress unused-variable warning. Rearrange so we don't have an unused variable in disable-cassert case. Discussion: <a target="_blank" href="https://postgr.es/m/CAMkU=1x63f2QyFTeas83xJqD+Hm1PBuok1LrzYzS-OngDzYOVA@mail.gmail.com">https://postgr.es/m/CAMkU=1x63f2QyFTeas83xJqD+Hm1PBuok1LrzYzS-OngDzYOVA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c56ac2913a1f3adce674a2eb27257d0bca81317f">http://git.postgresql.org/pg/commitdiff/c56ac2913a1f3adce674a2eb27257d0bca81317f</a></li>
<li>Fix contrib/pg_trgm's extraction of trigrams from regular expressions. The logic for removing excess trigrams from the result was faulty. It intends to avoid merging the initial and final states of the NFA, which is necessary, but in testing whether removal of a specific trigram would cause that, it failed to consider the combined effects of all the state merges that that trigram's removal would cause. This could result in a broken final graph that would never match anything, leading to GIN or GiST indexscans not finding anything. To fix, add a "tentParent" field that is used only within this loop, and set it to show state merges that we are tentatively going to do. While examining a particular arc, we must chase up through tentParent links as well as regular parent links (the former can only appear atop the latter), and we must account for state init/fin flag merges that haven't actually been done yet. To simplify the latter, combine the separate init and fin bool fields into a bitmap flags field. I also chose to get rid of the "children" state list, which seems entirely inessential. Per bug #14563 from Alexey Isayko, which the added test cases are based on. Back-patch to 9.3 where this code was added. Report: <a target="_blank" href="https://postgr.es/m/20170222111446.1256.67547@wrigleys.postgresql.org">https://postgr.es/m/20170222111446.1256.67547@wrigleys.postgresql.org</a> Discussion: <a target="_blank" href="https://postgr.es/m/8816.1487787594@sss.pgh.pa.us">https://postgr.es/m/8816.1487787594@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9e43e8714c9e976e41b7429fa7c426c9a6e5e8e6">http://git.postgresql.org/pg/commitdiff/9e43e8714c9e976e41b7429fa7c426c9a6e5e8e6</a></li>
<li>De-support floating-point timestamps. Per discussion, the time has come to do this. The handwriting has been on the wall at least since 9.0 that this would happen someday, whenever it got to be too much of a burden to support the float-timestamp option. The triggering factor now is the discovery that there are multiple bugs in the code that attempts to implement use of integer timestamps in the replication protocol even when the server is built for float timestamps. The internal float timestamps leak into the protocol fields in places. While we could fix the identified bugs, there's a very high risk of introducing more. Trying to build a wall that would positively prevent mixing integer and float timestamps is more complexity than we want to undertake to maintain a long-deprecated option. The fact that these bugs weren't found through testing also indicates a lack of interest in float timestamps. This commit disables configure's --disable-integer-datetimes switch (it'll still accept --enable-integer-datetimes, though), removes direct references to USE_INTEGER_DATETIMES, and removes discussion of float timestamps from the user documentation. A considerable amount of code is rendered dead by this, but removing that will occur as separate mop-up. Discussion: <a target="_blank" href="https://postgr.es/m/26788.1487455319@sss.pgh.pa.us">https://postgr.es/m/26788.1487455319@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b6aa17e0ae367afdcea07118e016111af4fa6bc3">http://git.postgresql.org/pg/commitdiff/b6aa17e0ae367afdcea07118e016111af4fa6bc3</a></li>
<li>Remove pg_control's enableIntTimes field. We don't need it any more. pg_controldata continues to report that date/time type storage is "64-bit integers", but that's now a hard-wired behavior not something it sees in the data. This avoids breaking pg_upgrade, and perhaps other utilities that inspect pg_control this way. Ditto for pg_resetwal. I chose to remove the "bigint_timestamps" output column of pg_control_init(), though, as that function hasn't been around long and probably doesn't have ossified users. Discussion: <a target="_blank" href="https://postgr.es/m/26788.1487455319@sss.pgh.pa.us">https://postgr.es/m/26788.1487455319@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d28aafb6dda326688e2f042c95c93ea57963c03c">http://git.postgresql.org/pg/commitdiff/d28aafb6dda326688e2f042c95c93ea57963c03c</a></li>
<li>Remove now-dead code for !HAVE_INT64_TIMESTAMP. This is a basically mechanical removal of #ifdef HAVE_INT64_TIMESTAMP tests and the negative-case controlled code. Discussion: <a target="_blank" href="https://postgr.es/m/26788.1487455319@sss.pgh.pa.us">https://postgr.es/m/26788.1487455319@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b9d092c962ea3262930e3c31a8c3d79b66ce9d43">http://git.postgresql.org/pg/commitdiff/b9d092c962ea3262930e3c31a8c3d79b66ce9d43</a></li>
<li>Consistently declare timestamp variables as TimestampTz. Twiddle the replication-related code so that its timestamp variables are declared TimestampTz, rather than the uninformative "int64" that was previously used for meant-to-be-always-integer timestamps. This resolves the int64-vs-TimestampTz declaration inconsistencies introduced by commit 7c030783a, though in the opposite direction to what was originally suggested. This required including datatype/timestamp.h in a couple more places than before. I decided it would be a good idea to slim down that header by not having it pull in &lt;float.h&gt; etc, as those headers are no longer at all relevant to its purpose. Unsurprisingly, a small number of .c files turn out to have been depending on those inclusions, so add them back in the .c files as needed. Discussion: <a target="_blank" href="https://postgr.es/m/26788.1487455319@sss.pgh.pa.us">https://postgr.es/m/26788.1487455319@sss.pgh.pa.us</a> Discussion: <a target="_blank" href="https://postgr.es/m/27694.1487456324@sss.pgh.pa.us">https://postgr.es/m/27694.1487456324@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c29aff959dc64f7321062e7f33d8c6ec23db53d3">http://git.postgresql.org/pg/commitdiff/c29aff959dc64f7321062e7f33d8c6ec23db53d3</a></li>
<li>Add an Assert that enum_cmp_internal() gets passed an FmgrInfo pointer. If someone were to try to call one of the enum comparison functions using DirectFunctionCallN, it would very likely seem to work, because only in unusual cases does enum_cmp_internal() need to access the typcache. But once such a case occurred, code like that would crash with a null pointer dereference. To make an oversight of that sort less likely to escape detection, add a non-bypassable Assert that fcinfo-&gt;flinfo isn't NULL. Discussion: <a target="_blank" href="https://postgr.es/m/25226.1487900067@sss.pgh.pa.us">https://postgr.es/m/25226.1487900067@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6d493e1a013514a6f0abb5d30d08219c1831cfec">http://git.postgresql.org/pg/commitdiff/6d493e1a013514a6f0abb5d30d08219c1831cfec</a></li>
<li>Suppress compiler warnings in ecpg test on newer Windows toolchains. nan_test.pgc supposed that it could unconditionally #define isnan() and isinf() on WIN32. This was evidently copied at some point from src/include/port/win32.h, but nowadays there's a test on _MSC_VER there. Make nan_test.pgc look the same. Per buildfarm warnings. There's no evidence this produces anything worse than a warning, and besides it's only a test case, so I don't feel a need to back-patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c5658a0764d5ac5ea8c2c11d27c62d5472234227">http://git.postgresql.org/pg/commitdiff/c5658a0764d5ac5ea8c2c11d27c62d5472234227</a></li>
<li>Fix unportable definition of BSWAP64() macro. We have a portable way of writing uint64 constants, but whoever wrote this macro didn't know about it. While at it, fix unsafe under-parenthesization of arguments. That might be moot, because there are already good reasons not to use the macro on anything more complicated than a simple variable, but it's still poor practice. Per buildfarm warnings. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/41c16edcf6c90d1f42810ea523b7e65c99edad50">http://git.postgresql.org/pg/commitdiff/41c16edcf6c90d1f42810ea523b7e65c99edad50</a></li>
<li>Remove useless duplicate inclusions of system header files. c.h #includes a number of core libc header files, such as &lt;stdio.h&gt;. There's no point in re-including these after having read postgres.h, postgres_fe.h, or c.h; so remove code that did so. While at it, also fix some places that were ignoring our standard pattern of "include postgres[_fe].h, then system header files, then other Postgres header files". While there's not any great magic in doing it that way rather than system headers last, it's silly to have just a few files deviating from the general pattern. (But I didn't attempt to enforce this globally, only in files I was touching anyway.) I'd be the first to say that this is mostly compulsive neatnik-ism, but over time it might save enough compile cycles to be useful. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9e3755ecb2d058f7d123dd35a2e1784006190962">http://git.postgresql.org/pg/commitdiff/9e3755ecb2d058f7d123dd35a2e1784006190962</a></li>
<li>Remove some configure header-file checks that we weren't really using. We had some AC_CHECK_HEADER tests that were really wastes of cycles, because the code proceeded to #include those headers unconditionally anyway, in all or a large majority of cases. The lack of complaints shows that those headers are available on every platform of interest, so we might as well let configure run a bit faster by not probing those headers at all. I suspect that some of the tests I left alone are equally useless, but since all the existing #includes of the remaining headers are properly guarded, I didn't touch them. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2bd7f85796ec373ecae61dd480437b3e668ec883">http://git.postgresql.org/pg/commitdiff/2bd7f85796ec373ecae61dd480437b3e668ec883</a></li>
<li>Put back #include &lt;windows.h&gt; in dirmod.c. I removed this in commit 9e3755ecb, reasoning that the win32.h port-specific header file included by c.h would have provided it. However, that's only true on native win32 builds, not Cygwin builds. It may be that some of the other &lt;windows.h&gt; inclusions also need to be put back on the same grounds; but this is the only one that is clearly meant to be included #ifdef __CYGWIN__, so maybe this is the extent of the problem. Awaiting further buildfarm results. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/285ca26132abdd0a1adc11a21789f103c4e3f6d8">http://git.postgresql.org/pg/commitdiff/285ca26132abdd0a1adc11a21789f103c4e3f6d8</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Small correction to BRIN docs. Replace incorrect word "index" with "heap" Takayuki Tsunakawa <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0bf41dd1908a0c05833168b9972e1c52cb7547b7">http://git.postgresql.org/pg/commitdiff/0bf41dd1908a0c05833168b9972e1c52cb7547b7</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Drop support for Python 2.3. There is no specific reason for this right now, but keeping support for old Python versions around indefinitely increases the maintenance burden. The oldest supported Python version is now Python 2.4, which is still shipped in RHEL/CentOS 5 by default. In configure, add a check for the required Python version and give a friendly error message for an old version, instead of relying on an obscure build error later on. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/04aad401867ad3e1519615d8486e32b50dbcb5f5">http://git.postgresql.org/pg/commitdiff/04aad401867ad3e1519615d8486e32b50dbcb5f5</a></li>
<li>Make more use of castNode(). <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/38d103763d14baddf3cbfe4b00b501059fc9447f">http://git.postgresql.org/pg/commitdiff/38d103763d14baddf3cbfe4b00b501059fc9447f</a></li>
<li>doc: Update URL for plr. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7248099c169b40b8f70cdaf8e12d0deaab9b16e2">http://git.postgresql.org/pg/commitdiff/7248099c169b40b8f70cdaf8e12d0deaab9b16e2</a></li>
<li>Fix whitespace. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/74321d87fb1a27746c9dd0853b2da3287a0940d9">http://git.postgresql.org/pg/commitdiff/74321d87fb1a27746c9dd0853b2da3287a0940d9</a></li>
<li>Remove deprecated COMMENT ON RULE syntax. This was only used for allowing upgrades from pre-7.3 instances, which was a long time ago. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e8d016d81940e75c126aa52971b7903b7301002e">http://git.postgresql.org/pg/commitdiff/e8d016d81940e75c126aa52971b7903b7301002e</a></li>
<li>Fix logical replication with different encodings. reported by Shinoda, Noriyoshi &lt;noriyoshi.shinoda@hpe.com&gt;; partial patch by Kyotaro HORIGUCHI &lt;horiguchi.kyotaro@lab.ntt.co.jp&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c3368f9173c13e2e293df91f75f1a5c565c4ca18">http://git.postgresql.org/pg/commitdiff/c3368f9173c13e2e293df91f75f1a5c565c4ca18</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Remove confusing comment about unsupported feature. The initial table synchronization feature has not been supported yet, but there was the confusing header comment about it in logical/worker.c. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d36537008a8d53853d2fda49913cb54fa6e28f94">http://git.postgresql.org/pg/commitdiff/d36537008a8d53853d2fda49913cb54fa6e28f94</a></li>
<li>Fix typo in comment. neha khatri <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e14ec7d346f8686c9471c16a01579d6b1c3b4975">http://git.postgresql.org/pg/commitdiff/e14ec7d346f8686c9471c16a01579d6b1c3b4975</a></li>
<li>Make walsender always initialize the buffers. Walsender uses the local buffers for each outgoing and incoming message. Previously when creating replication slot, walsender forgot to initialize one of them and which can cause the segmentation fault error. To fix this issue, this commit changes walsender so that it always initialize them before it executes the requested replication command. Back-patch to 9.4 where replication slot was introduced. Problem report and initial patch by Stas Kelvich, modified by me. Report: <a target="_blank" href="https://www.postgresql.org/message-id/A1E9CB90-1FAC-4CAD-8DBA-9AA62A6E97C5@postgrespro.ru">https://www.postgresql.org/message-id/A1E9CB90-1FAC-4CAD-8DBA-9AA62A6E97C5@postgrespro.ru</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1d04a59be31bf004b880226be0e3fe84acff2815">http://git.postgresql.org/pg/commitdiff/1d04a59be31bf004b880226be0e3fe84acff2815</a></li>
<li>Fix connection leak in DROP SUBSCRIPTION command. Previously the command forgot to close the connection to the publisher when it failed to drop the replication slot. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/898a792eb8283e31efc0b6fcbc03bbcd5f7df667">http://git.postgresql.org/pg/commitdiff/898a792eb8283e31efc0b6fcbc03bbcd5f7df667</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Add tests for two-phase commit. There's some ongoing performance work on this area, so let's make sure we don't break things. Extracted from a larger patch originally by Stas Kelvich. Authors: Stas Kelvich, Nikhil Sontakke, Michael Paquier Discussion: <a target="_blank" href="https://postgr.es/m/CAMGcDxfsuLLOg=h5cTg3g77Jjk-UGnt=RW7zK57zBSoFsapiWA@mail.gmail.com">https://postgr.es/m/CAMGcDxfsuLLOg=h5cTg3g77Jjk-UGnt=RW7zK57zBSoFsapiWA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/30820982b295404ed00ddd28c8864211dc986dd3">http://git.postgresql.org/pg/commitdiff/30820982b295404ed00ddd28c8864211dc986dd3</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>doc: Add missing comma. Yugo Nagata <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d912dd062b64287adcabab4180abafefd07cea14">http://git.postgresql.org/pg/commitdiff/d912dd062b64287adcabab4180abafefd07cea14</a></li>
<li>Shut down Gather's children before shutting down Gather itself. It turns out that the original shutdown order here does not work well. Multiple people attempting to develop further parallel query patches have discovered that they need to do cleanup before the DSM goes away, and you can't do that if the parent node gets cleaned up first. Patch by me, reviewed by KaiGai Kohei and Dilip Kumar. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoY6bOc1YnhcAQnMfCBDbsJzROQ3sYxSAL-SYB5tMJcTKg@mail.gmail.com">http://postgr.es/m/CA+TgmoY6bOc1YnhcAQnMfCBDbsJzROQ3sYxSAL-SYB5tMJcTKg@mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/9A28C8860F777E439AA12E8AEA7694F8012AEB82@BPXM15GP.gisp.nec.co.jp">http://postgr.es/m/9A28C8860F777E439AA12E8AEA7694F8012AEB82@BPXM15GP.gisp.nec.co.jp</a> Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYuPOc=+xrG1v0fCsoLbKAab9F1ddOeaaiLMzKOiBar1Q@mail.gmail.com">http://postgr.es/m/CA+TgmoYuPOc=+xrG1v0fCsoLbKAab9F1ddOeaaiLMzKOiBar1Q@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/acf555bc53acb589b5a2827e65d655fa8c9adee0">http://git.postgresql.org/pg/commitdiff/acf555bc53acb589b5a2827e65d655fa8c9adee0</a></li>
<li>Fix incorrect typecast. Ashutosh Sharma, per a report from Mithun Cy. Discussion: <a target="_blank" href="http://postgr.es/m/CAD__OujgqNNnCujeFTmKpjNu+W4smS8Hbi=RcWAhf1ZUs3H4WA@mail.gmail.com">http://postgr.es/m/CAD__OujgqNNnCujeFTmKpjNu+W4smS8Hbi=RcWAhf1ZUs3H4WA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b4316928d57bec22e95875e6487a4d665bd03a52">http://git.postgresql.org/pg/commitdiff/b4316928d57bec22e95875e6487a4d665bd03a52</a></li>
<li>Pass the source text for a parallel query to the workers. With this change, you can see the query that a parallel worker is executing in pg_stat_activity, and if the worker crashes you can see what query it was executing when it crashed. Rafia Sabih, reviewed by Kuntal Ghosh and Amit Kapila and slightly revised by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4c728f382970b6346142fe4409212063ee3e92dc">http://git.postgresql.org/pg/commitdiff/4c728f382970b6346142fe4409212063ee3e92dc</a></li>
<li>Make tablesample work with partitioned tables. This was an oversight in the original partitioning commit. Amit Langote, reviewed by David Fetter Discussion: <a target="_blank" href="http://postgr.es/m/59af6590-8ace-04c4-c36c-ea35d435c60e@lab.ntt.co.jp">http://postgr.es/m/59af6590-8ace-04c4-c36c-ea35d435c60e@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5dbdb2f799232cb1b6df7d7a85d59ade3234d30c">http://git.postgresql.org/pg/commitdiff/5dbdb2f799232cb1b6df7d7a85d59ade3234d30c</a></li>
<li>Allow custom and foreign scans to have shutdown callbacks. This is expected to be useful mostly when performing such scans in parallel, because in that case it allows (in combination with commit acf555bc53acb589b5a2827e65d655fa8c9adee0) nodes below a Gather to get control just before the DSM segment goes away. KaiGai Kohei, except that I rewrote the documentation. Reviewed by Claudio Freire. Discussion: <a target="_blank" href="http://postgr.es/m/CADyhKSXJK0jUJ8rWv4AmKDhsUh124_rEn39eqgfC5D8fu6xVuw@mail.gmail.com">http://postgr.es/m/CADyhKSXJK0jUJ8rWv4AmKDhsUh124_rEn39eqgfC5D8fu6xVuw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a315b967cc1bd43ecf3c10ea48b44a4fb0ff8d45">http://git.postgresql.org/pg/commitdiff/a315b967cc1bd43ecf3c10ea48b44a4fb0ff8d45</a></li>
<li>Basic tab completion for partitioning. Amit Langote Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmobYOj=A8GesiEs_V2Wq46-_w0+7MOwPiNWC+iuzJ-uWjA@mail.gmail.com">http://postgr.es/m/CA+TgmobYOj=A8GesiEs_V2Wq46-_w0+7MOwPiNWC+iuzJ-uWjA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9d1fb11a95bafdae9889898361f70e9bcbef6993">http://git.postgresql.org/pg/commitdiff/9d1fb11a95bafdae9889898361f70e9bcbef6993</a></li>
<li>TAP tests for target_session_attrs connection parameter. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/caa6c1f193a9ab4b4fb9b8687f41e6d66bbeaade">http://git.postgresql.org/pg/commitdiff/caa6c1f193a9ab4b4fb9b8687f41e6d66bbeaade</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Correctly handle array pseudotypes in to_json and to_jsonb. Columns with array pseudotypes have not been identified as arrays, so they have been rendered as strings in the json and jsonb conversion routines. This change allows them to be rendered as json arrays, making it possible to deal correctly with the anyarray columns in pg_stats. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/502a3832cc54c7115dacb8a2dae06f0620995ac6">http://git.postgresql.org/pg/commitdiff/502a3832cc54c7115dacb8a2dae06f0620995ac6</a></li>
</ul>
<p>Bruce Momjian pushed:</p>
<ul>
<li>pg_upgrade docs: clarify instructions on standby extensions. Previously the pg_upgrade standby upgrade instructions said not to execute pgcrypto.sql, but it should have referenced the extension command "CREATE EXTENSION pgcrypto". This patch makes that doc change. Reported-by: a private bug report Backpatch-through: 9.4, where standby instructions were added <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5639ceddcb7f3efa8751b2ba6e50cc1d27cc2a45">http://git.postgresql.org/pg/commitdiff/5639ceddcb7f3efa8751b2ba6e50cc1d27cc2a45</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Clarify the role of checkpoint at the begininng of base backups. Output a message about checkpoint starting in verbose mode of pg_basebackup, and make the documentation state more clearly that this happens. Author: Michael Banck <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/51e26c9c3d2904b65041fc4a19c72c62508f63d4">http://git.postgresql.org/pg/commitdiff/51e26c9c3d2904b65041fc4a19c72c62508f63d4</a></li>
<li>Add missing progname prefix to some messages. Author: Michael Banck <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1513dbea7f89053476a5e95e2f2e952135a5b34c">http://git.postgresql.org/pg/commitdiff/1513dbea7f89053476a5e95e2f2e952135a5b34c</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Rushabh Lathia sent in another revision of a patch to implement Gather Merge.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to make hba configuration for SASL more extensible and implement SASLprep aka NFKC for SCRAM authentication.</p>
<p>Amit Langote and Ashutosh Bapat traded patches to allow dropping partitioned table without CASCADE.</p>
<p>Rushabh Lathia sent in another revision of a patch to implement wait events for disk I/O.</p>
<p>Dave Page sent in a patch to implement pg_ls_wal_dir() and pg_ls_logdir().</p>
<p>Tomas Vondra sent in a patch to add page_checksum and bt_page_items(bytea) to the pageinspect supplied module.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to implement xmltable().</p>
<p>Takeshi Ideriha sent in another revision of a patch to allow DECLARE STATEMENT to set up a connection in ECPG.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to add tab completion in psql for the new SUBSCRIPTION commands.</p>
<p>Thomas Munro sent in another revision of a patch to make SERIALIZABLE work with parallel query.</p>
<p>Etsuro Fujita and Rushabh Lathia traded patches to push down more UPDATEs/DELETEs in postgres_fdw.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to smooth the transition from floating point timestamps.</p>
<p>Amit Langote and Ashutosh Bapat traded patches to take note of the fact that partitioned tables are empty themselves by preventing the from trying to do things to them that need to access files, not allocating storage for partitioned tables, and avoiding creating scan nodes for partitioned tables.</p>
<p>Simon Riggs sent in two revisions of a patch to ensure that SnapshotResetXmin() is not issued at the end of xact and reduce the calls to SnapshotResetXmin() using a simple heuristic to reduce the effects.</p>
<p>Beena Emerson sent in two more revisions of a patch to allow increasing the default WAL segment size.</p>
<p>Peter Moser sent in another revision of a patch to add ALIGN and NORMALIZE operators for temporal queries.</p>
<p>Tomas Vondra and Andres Freund traded patches to add two slab-like memory allocators.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel bitmap heap scan.</p>
<p>Jim Mlodgenski sent in a patch to add system views for monitoring materialized views.</p>
<p>Amit Langote sent in a patch to show only the partition key upon failing to find a partition.</p>
<p>Mithun Cy sent in another revision of a patch to expand hash indexes differently.</p>
<p>Tatsuo Ishii sent in a patch to improve the calculation of statement_timeout for the extended query protocol.</p>
<p>Amit Langote sent in a patch to add regression tests foreign partition DDL.</p>
<p>Vaishnavi Prabakaran sent in another revision of a patch to add batch/pipelining support to libpq.</p>
<p>Masahiko Sawada sent in two more revisions of a patch to fix an infelicity between DROP SUBSCRIPTION and ROLLBACK.</p>
<p>Thomas Munro sent in two more revisions of a patch to measure replication lag.</p>
<p>Petr Jel&Atilde;&shy;nek sent in three more revisions of a patch to fix some snapbuild woes.</p>
<p>Pavan Deolasee sent in another revision of a patch to implement WARM.</p>
<p>Robins Tharakan and Simon Riggs traded patches to make pg_dumpall work without access to pg_authid.</p>
<p>Rafia Sabih sent in two revisions of a patch to make parallelism work for queries coming from functions (SQL and several PLs).</p>
<p>Michael Banck sent in two revisions of a patch to reorder tablespaces in basebackup tar stream for backup_label.</p>
<p>Petr Jel&Atilde;&shy;nek sent in two more revisions of a patch to use asynchronous connect API in libpqwalreceiver, fix after trigger execution in logical replication, and add RENAME support for PUBLICATIONs and SUBSCRIPTIONs.</p>
<p>Pavan Deolasee sent in a patch to remove all direct references to ip_posid and ip_blkid members of ItemPointerData struct and instead use ItemPointerGetOffsetNumber and ItemPointerGetBlockNumber macros respectively to access these members.</p>
<p>Peter Eisentraut sent in a patch to silence compiler warnings from gcc -O3.</p>
<p>Nikolay Shaplov sent in another revision of a patch to move all am-related reloption code into src/backend/access/[am-name] and get rid of relopt_kind for custom AM.</p>
<p>Jim Nasby sent in a patch to move refreshes of materialized views to last in dbObjectTypePriority[].</p>
<p>Jim Nasby sent in a patch to standardize on one of objsubid, subobjid.</p>
<p>Takayuki Tsunakawa sent in another revision of a patch to support huge pages on Windows.</p>
<p>Kyotaro HORIGUCHI sent in two more revisions of a patch to implement asynchronous execution.</p>
<p>Yugo Nagata sent in two more revisions of a patch to fix a comment on the JunkFilter struct.</p>
<p>Bernd Helmle sent in a patch to make subquery alias optional in FROM clause.</p>
<p>Chhatoi Pritam Baral sent in a patch to make the planner expand "foocol &lt;@ 'x,y'::foorange" into "foocol between x and y".</p>
<p>Petr Jel&Atilde;&shy;nek sent in two more revisions of a patch to add logical replication support for initial data copy.</p>
<p>Mithun Cy sent in another revision of a patch to implement auto_prewarm.</p>
<p>Corey Huinker sent in four more revisions of a patch to add \if and friends to psql.</p>
<p>Stephen Frost sent in another revision of a patch to fix pg_upgrade blob comments.</p>
<p>Masahiko Sawada sent in a patch to report the number of skipped frozen pages by manual VACUUM.</p>
<p>Craig Ringer sent in a patch to better detect timeouts in PostgresNode::psql using regex.</p>
<p>Eiji Seki sent in another revision of a patch to add a GetOldestXminExtend for ignoring arbitrary vacuum flags.</p>
<p>Haribabu Kommi sent in a patch to make it possible to have utility commands benefit from a parallel plan.</p>
<p>Tom Lane sent in a patch to turn AllocBlockData from a linked list into a doubly-linked list.</p>
<p>Andrew Dunstan sent in a patch to make enums indexable in the btree_gin and btree_gist extensions.</p>
<p>Tom Lane sent in a patch to assert that an enum comparator can use cache.</p>
<p>Dave Page sent in a patch to add a default role called pg_monitor, complete with a lot of things such a role should have.</p>
<p>Naoki Okano sent in a patch to add an --enable-parse-comment option to ECPG.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add a VERBOSE_SORT variable to psql.</p>
<p>Andrew Gierth sent in another revision of a patch to add hash support for grouping sets.</p>
<p>Dilip Kumar sent in two more revisions of a patch to implement parallel merge join.</p>
<p>David Rowley sent in a patch to add recognition of "range queries" like "x &gt; 34 AND x &lt; 42" and IS [NOT] NULL to clausesel.</p>
<p>Simon Riggs sent in another revision of a patch to make some changes to the recovery.conf API.</p>
<p>Peter Eisentraut sent in another revision of a patch to enable DROP FUNCTION to drop multiple functions at once.</p>
<p>Peter Eisentraut sent in a patch to add cursor and execute methods to plan object in PL/PythonU.</p>
<p>Simon Riggs sent in another revision of a patch to reduce lock levels for reloptions.</p>
<p>Andrew Dunstan sent in two revisions of a patch to turn the DirectFunctionCall{n]Coll functions into macros calling these functions and passing NULL as the flinfo param.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to prevent pg_dump -t from dumping publications.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/03/02/Nouvelles-hebdomadaires-de-PostgreSQL-26-f%C3%A9vrier-2017">par chl le jeudi  2 mars 2017 à 00h33</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mercredi  1 mars 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.taadeem.net/" title="- PGFR">Damien Clochard</a></h3>
<img class="face" src="images/damien.jpg" width="80" height="80" alt="">


<div class="entrygroup" id="http://blog.taadeem.net///french/2017/03/01/3_meetups_PostgreSQL_en_1_semaine">
<h4><a href="http://blog.taadeem.net///french/2017/03/01/3_meetups_PostgreSQL_en_1_semaine">3 Meetups PostgreSQL en 1 semaine !</a></h4>
<div class="entry">
<div class="content">
<p>Toulouse, Nantes ou Paris ? Vous avez l’embarras du choix 3 rendez-vous autour de PostgreSQL s’offrent à vous 
dans les jours à venir !</p>

<!-- More -->

<ul>
  <li>
    <p><a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/events/237017073/">Le 2 mars chez Air France à Toulouse</a></p>
  </li>
  <li>
    <p><a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/events/237613952/">Le mercredi 8 mars chez la Cordée à Nantes</a></p>
  </li>
  <li>
    <p><a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/events/237613952/">Le jeudi 9 mars chez Magency à Paris</a></p>
  </li>
</ul>

<p>A noter pour être complet qu’il y a aussi un groupe actif à <a href="http://www.meetup.com/fr-FR/PostgreSQL-User-Group-Lyon/">Lyon</a> 
et un autre à <a href="http://www.meetup.com/fr-FR/Meetup-PostgreSQL-Lille/">Lille</a></p>

<p>Et si vous en voulez encore, vous avez aussi deux conférences PostgreSQL en approche :</p>

<ul>
  <li>
    <p>Le <a href="http://pgday.paris">PG Day Paris</a> le 23 mars avec un programme très riche et intégralement en anglais</p>
  </li>
  <li>
    <p>Le <a href="http://pgday.fr">PG Day France</a> le 8 juin chez Météo France à Toulouse</p>
  </li>
</ul>

<p>Bref il y en a pour tous les gouts et aux 4 coins de la France :-)</p></div>







<p class="date">
<a href="http://blog.taadeem.net///french/2017/03/01/3_meetups_PostgreSQL_en_1_semaine">par Damien Clochard le mercredi  1 mars 2017 à 21h17</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mercredi 22 février 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:a082516b20f0afe9f3ffb7e19dedc20b" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/02/22/Nouvelles-hebdomadaires-de-PostgreSQL-19-f%C3%A9vrier-2017">Nouvelles hebdomadaires de PostgreSQL - 19 février 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>Ora2PG 18.1, un outil de migration de bases Oracle vers PostgreSQL&nbsp;: <a target="_blank" href="http://ora2pg.darold.net/">http://ora2pg.darold.net/</a></li>
<li>psycopg2 2.7 beta2, un connecteur python pour PostgreSQL&nbsp;: <a target="_blank" href="http://initd.org/psycopg/docs/news.html#what-s-new-in-psycopg-2-7">http://initd.org/psycopg/docs/news.html#what-s-new-in-psycopg-2-7</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en f&eacute;vrier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-02/">http://archives.postgresql.org/pgsql-jobs/2017-02/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</li>
<li>Le premier pgDay Israel 2017 aura lieu le 2 mars 2017. Les inscriptions sont ouvertes&nbsp;: <a target="_blank" href="http://pgday.org.il/">http://pgday.org.il/</a></li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>[ndt: Meetup &agrave; Nantes le 8 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/</a>]</li>
<li>[ndt: Meetup &agrave; Paris le 9 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/</a>]</li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://2017.pgday.asia/">http://2017.pgday.asia/</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 24 f&eacute;vrier 2017 : &eacute;crire &agrave; CFP AT PostgresVision DOT com&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
<li>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170219235135.GA1213@fetter.org">http://www.postgresql.org/message-id/20170219235135.GA1213@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>doc: Remove accidental extra table cell. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ae0e550ce1703621efb3b75f4558df253cef5bca">http://git.postgresql.org/pg/commitdiff/ae0e550ce1703621efb3b75f4558df253cef5bca</a></li>
<li>Add CREATE COLLATION IF NOT EXISTS clause. The core of the functionality was already implemented when pg_import_system_collations was added. This just exposes it as an option in the SQL command. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6d16ecc646d21b39092970c591fd0f73b4cfc26b">http://git.postgresql.org/pg/commitdiff/6d16ecc646d21b39092970c591fd0f73b4cfc26b</a></li>
<li>doc: Add advice about systemd RemoveIPC. Reviewed-by: Magnus Hagander &lt;magnus@hagander.net&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fbe7a3fa45f360e73ce141e51005a3e86cd1926c">http://git.postgresql.org/pg/commitdiff/fbe7a3fa45f360e73ce141e51005a3e86cd1926c</a></li>
<li>Fix typo on comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e7e4cd1ab51b506f9fad9b7b107e315fdb4b8b74">http://git.postgresql.org/pg/commitdiff/e7e4cd1ab51b506f9fad9b7b107e315fdb4b8b74</a></li>
<li>Remove redundant coverage target. This was probably forgotten to be removed when general recursion support was added. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/638d650dd7200e0eba91abb521284f239f547bbb">http://git.postgresql.org/pg/commitdiff/638d650dd7200e0eba91abb521284f239f547bbb</a></li>
<li>pg_dump: Fix typo in query. This could lead to incorrect dumping of language privileges in some cases, which is probably a rare situation. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/39370e6a0ae6e92a79a50a9531b6a291cb2ee590">http://git.postgresql.org/pg/commitdiff/39370e6a0ae6e92a79a50a9531b6a291cb2ee590</a></li>
<li>pg_dump: Message style improvements. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/363ac78aee37790a1f932ee3050bdd21085aabfe">http://git.postgresql.org/pg/commitdiff/363ac78aee37790a1f932ee3050bdd21085aabfe</a></li>
<li>doc: Fix typos. From: Thom Brown &lt;thom@linux.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/68f3dbc5525a7e78290f7dee8a74f66d5fa738d6">http://git.postgresql.org/pg/commitdiff/68f3dbc5525a7e78290f7dee8a74f66d5fa738d6</a></li>
<li>Optimize query for information_schema.constraint_column_usage. The way the old query was written prevented some join optimizations because the join conditions were hidden inside a CASE expression. With a large number of constraints, the query became unreasonably slow. The new query performs much better. From: Alexey Bashtanov &lt;bashtanov@imap.cc&gt; Reviewed-by: Ashutosh Bapat &lt;ashutosh.bapat@enterprisedb.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e3a58c8835a2cd428b8534dd8df30a7cb96c976b">http://git.postgresql.org/pg/commitdiff/e3a58c8835a2cd428b8534dd8df30a7cb96c976b</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Remove contrib/tsearch2. This module was intended to ease migrations of applications that used the pre-8.3 version of text search to the in-core version introduced in that release. However, since all pre-8.3 releases of the database have been out of support for more than 5 years at this point, we expect that few people are depending on it at this point. If some people still need it, nothing prevents it from being maintained as a separate extension, outside of core. Discussion: <a target="_blank" href="http://postgr.es/m/CA+Tgmob5R8aDHiFRTQsSJbT1oreKg2FOSBrC=2f4tqEH3dOMAg@mail.gmail.com">http://postgr.es/m/CA+Tgmob5R8aDHiFRTQsSJbT1oreKg2FOSBrC=2f4tqEH3dOMAg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7ada2d31f47f1d378ae7d4ee2d044df1bb2b0c6a">http://git.postgresql.org/pg/commitdiff/7ada2d31f47f1d378ae7d4ee2d044df1bb2b0c6a</a></li>
<li>Corrections and improvements to generic parallel query documentation. David Rowley, reviewed by Brad DeJong, Amit Kapila, and me. Discussion: <a target="_blank" href="http://postgr.es/m/CAKJS1f81fob-M6RJyTVv3SCasxMuQpj37ReNOJ=tprhwd7hAVg@mail.gmail.com">http://postgr.es/m/CAKJS1f81fob-M6RJyTVv3SCasxMuQpj37ReNOJ=tprhwd7hAVg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0ede57a1a5161012f8f4a55049ef24c987d5b59c">http://git.postgresql.org/pg/commitdiff/0ede57a1a5161012f8f4a55049ef24c987d5b59c</a></li>
<li>Don't disallow dropping NOT NULL for a list partition key. Range partitioning doesn't support nulls in the partitioning columns, but list partitioning does. Amit Langote, per a complaint from Amul Sul <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e28b1156122f4d48d6f6f7a7f26381ee7af65a91">http://git.postgresql.org/pg/commitdiff/e28b1156122f4d48d6f6f7a7f26381ee7af65a91</a></li>
<li>Minor fixes for WAL consistency checking. Michael Paquier, reviewed and slightly revised by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAB7nPqRzCQb=vdfHvMtP0HMLBHU6z1aGdo4GJsUP-HP8jx+Pkw@mail.gmail.com">http://postgr.es/m/CAB7nPqRzCQb=vdfHvMtP0HMLBHU6z1aGdo4GJsUP-HP8jx+Pkw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fb47544d0ca18312bf0b9e53e335217db5c41a08">http://git.postgresql.org/pg/commitdiff/fb47544d0ca18312bf0b9e53e335217db5c41a08</a></li>
<li>Split index xlog headers from other private index headers. The xlog-specific headers need to be included in both frontend code - specifically, pg_waldump - and the backend, but the remainder of the private headers for each index are only needed by the backend. By splitting the xlog stuff out into separate headers, pg_waldump pulls in fewer backend headers, which is a good thing. Patch by me, reviewed by Michael Paquier and Andres Freund, per a complaint from Dilip Kumar. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoZ=F=GkxV0YEv-A8tb+AEGy_Qa7GSiJ8deBKFATnzfEug@mail.gmail.com">http://postgr.es/m/CA+TgmoZ=F=GkxV0YEv-A8tb+AEGy_Qa7GSiJ8deBKFATnzfEug@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8da9a226369e9ceec7cef1ab7a16cdc0adb4d657">http://git.postgresql.org/pg/commitdiff/8da9a226369e9ceec7cef1ab7a16cdc0adb4d657</a></li>
<li>Allow parallel workers to execute subplans. This doesn't do anything to make Param nodes anything other than parallel-restricted, so this only helps with uncorrelated subplans, and it's not necessarily very cheap because each worker will run the subplan separately (just as a Hash Join will build a separate copy of the hash table in each participating process), but it's a first step toward supporting cases that are more likely to help in practice, and is occasionally useful on its own. Amit Kapila, reviewed and tested by Rafia Sabih, Dilip Kumar, and me. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1+e8Z45D2n+rnDMDYsVEb5iW7jqaCH_tvPMYau=1Rru9w@mail.gmail.com">http://postgr.es/m/CAA4eK1+e8Z45D2n+rnDMDYsVEb5iW7jqaCH_tvPMYau=1Rru9w@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5e6d8d2bbbcace304450b309e79366c0da4063e4">http://git.postgresql.org/pg/commitdiff/5e6d8d2bbbcace304450b309e79366c0da4063e4</a></li>
<li>Fix typo in comment. Higuchi Daisuke <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8569955ee39650a667b9700385e1bc19fbf47069">http://git.postgresql.org/pg/commitdiff/8569955ee39650a667b9700385e1bc19fbf47069</a></li>
<li>btree: Support parallel index scans. This isn't exposed to the optimizer or the executor yet; we'll add support for those things in a separate patch. But this puts the basic mechanism in place: several processes can attach to a parallel btree index scan, and each one will get a subset of the tuples that would have been produced by a non-parallel scan. Each index page becomes the responsibility of a single worker, which then returns all of the TIDs on that page. Rahila Syed, Amit Kapila, Robert Haas, reviewed and tested by Anastasia Lubennikova, Tushar Ahuja, and Haribabu Kommi. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/569174f1be92be93f5366212cc46960d28a5c5cd">http://git.postgresql.org/pg/commitdiff/569174f1be92be93f5366212cc46960d28a5c5cd</a></li>
<li>Fix some nonstandard capitalization. Ashutosh Bapat <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e403732ef66d368f0a9a154d8f756f5d28615b8a">http://git.postgresql.org/pg/commitdiff/e403732ef66d368f0a9a154d8f756f5d28615b8a</a></li>
<li>pg_upgrade: Fix problems caused by renaming pg_resetxlog. Commit 85c11324cabaddcfaf3347df78555b30d27c5b5a renamed pg_resetxlog to pg_resetwal, but didn't make pg_upgrade smart enough to cope with the situation. Michael Paquier, per a complaint from Jeff Janes <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b8777611230ac94734ea99004d2a7d4266f9a954">http://git.postgresql.org/pg/commitdiff/b8777611230ac94734ea99004d2a7d4266f9a954</a></li>
<li>libpq: Make target_session_attrs=read-write consume empty result. Otherwise, the leftover empty result can cause problems in some situations. Michael Paquier and Ashutosh Bapat, per a report from Higuchi Daisuke <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1de0a4e00eee2a72c0b5b34892092efcec681f81">http://git.postgresql.org/pg/commitdiff/1de0a4e00eee2a72c0b5b34892092efcec681f81</a></li>
<li>Document new libpq connection statuses for target_session_attrs. I didn't realize these would ever be visible to clients, but Michael figured out that it can happen when using asynchronous interfaces such as PQconnectPoll. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1330a7d7265577412cae44653a5368172af396c7">http://git.postgresql.org/pg/commitdiff/1330a7d7265577412cae44653a5368172af396c7</a></li>
<li>Fix wrong articles in pg_proc descriptions. This technically should involve a catversion bump, but that seems pedantic, so I skipped it. Report and patch by David Christensen. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5d40286985af3ea60eda3b873ce4ee26f96505f4">http://git.postgresql.org/pg/commitdiff/5d40286985af3ea60eda3b873ce4ee26f96505f4</a></li>
<li>Replace min_parallel_relation_size with two new GUCs. When min_parallel_relation_size was added, the only supported type of parallel scan was a parallel sequential scan, but there are pending patches for parallel index scan, parallel index-only scan, and parallel bitmap heap scan. Those patches introduce two new types of complications: first, what's relevant is not really the total size of the relation but the portion of it that we will scan; and second, index pages and heap pages shouldn't necessarily be treated in exactly the same way. Typically, the number of index pages will be quite small, but that doesn't necessarily mean that a parallel index scan can't pay off. Therefore, we introduce min_parallel_table_scan_size, which works out a degree of parallelism for scans based on the number of table pages that will be scanned (and which is therefore equivalent to min_parallel_relation_size for parallel sequential scans) and also min_parallel_index_scan_size which can be used to work out a degree of parallelism based on the number of index pages that will be scanned. Amit Kapila and Robert Haas Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1KowGSYYVpd2qPpaPPA5R90r++QwDFbrRECTE9H_HvpOg@mail.gmail.com">http://postgr.es/m/CAA4eK1KowGSYYVpd2qPpaPPA5R90r++QwDFbrRECTE9H_HvpOg@mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1+TnM4pXQbvn7OXqam+k_HZqb0ROZUMxOiL6DWJYCyYow@mail.gmail.com">http://postgr.es/m/CAA4eK1+TnM4pXQbvn7OXqam+k_HZqb0ROZUMxOiL6DWJYCyYow@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/51ee6f3160d2e1515ed6197594bda67eb99dc2cc">http://git.postgresql.org/pg/commitdiff/51ee6f3160d2e1515ed6197594bda67eb99dc2cc</a></li>
<li>Add optimizer and executor support for parallel index scans. In combination with 569174f1be92be93f5366212cc46960d28a5c5cd, which taught the btree AM how to perform parallel index scans, this allows parallel index scan plans on btree indexes. This infrastructure should be general enough to support parallel index scans for other index AMs as well, if someone updates them to support parallel scans. Amit Kapila, reviewed and tested by Anastasia Lubennikova, Tushar Ahuja, and Haribabu Kommi, and me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5262f7a4fc44f651241d2ff1fa688dd664a34874">http://git.postgresql.org/pg/commitdiff/5262f7a4fc44f651241d2ff1fa688dd664a34874</a></li>
<li>Avoid crash in ALTER TABLE not_partitioned DETACH PARTITION. Amit Langote, reviewed and slightly changed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/59407301a39f47e35098a1c211f154adcd2bdaf9">http://git.postgresql.org/pg/commitdiff/59407301a39f47e35098a1c211f154adcd2bdaf9</a></li>
<li>Add new function dsa_allocate0. This does the same thing as dsa_allocate, except that the memory is guaranteed to be zero-filled on return. Dilip Kumar, adjusted by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9acb85597f1223ac26a5b19a9345849c43d0ff54">http://git.postgresql.org/pg/commitdiff/9acb85597f1223ac26a5b19a9345849c43d0ff54</a></li>
<li>Make dsa_allocate interface more like MemoryContextAlloc. A new function dsa_allocate_extended now takes flags which indicate that huge allocations should be permitted, that out-of-memory conditions should not throw an error, and/or that the returned memory should be zero-filled, just like MemoryContextAllocateExtended. Commit 9acb85597f1223ac26a5b19a9345849c43d0ff54, which added dsa_allocate0, was broken because it failed to account for the possibility that dsa_allocate() might return InvalidDsaPointer. This fixes that problem along the way. Thomas Munro, with some comment changes by me. Discussion: <a target="_blank" href="http://postgr.es/m/CA+Tgmobt7CcF_uQP2UQwWmu4K9qCHehMJP9_9m1urwP8hbOeHQ@mail.gmail.com">http://postgr.es/m/CA+Tgmobt7CcF_uQP2UQwWmu4K9qCHehMJP9_9m1urwP8hbOeHQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/16be2fd100199bdf284becfcee02c5eb20d8a11d">http://git.postgresql.org/pg/commitdiff/16be2fd100199bdf284becfcee02c5eb20d8a11d</a></li>
<li>Add optimizer and executor support for parallel index-only scans. Commit 5262f7a4fc44f651241d2ff1fa688dd664a34874 added similar support for parallel index scans; this extends that work to index-only scans. As with parallel index scans, this requires support from the index AM, so currently parallel index-only scans will only be possible for btree indexes. Rafia Sabih, reviewed and tested by Rahila Syed, Tushar Ahuja, and Amit Kapila Discussion: <a target="_blank" href="http://postgr.es/m/CAOGQiiPEAs4C=TBp0XShxBvnWXuzGL2u++Hm1=qnCpd6_Mf8Fw@mail.gmail.com">http://postgr.es/m/CAOGQiiPEAs4C=TBp0XShxBvnWXuzGL2u++Hm1=qnCpd6_Mf8Fw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0414b26bac09379a4cbf1fbd847d1cee2293c5e4">http://git.postgresql.org/pg/commitdiff/0414b26bac09379a4cbf1fbd847d1cee2293c5e4</a></li>
<li>Make partitions automatically inherit OIDs. Previously, if the parent was specified as WITH OIDS, each child also had to be explicitly specified as WITH OIDS. Amit Langote, per a report from Simon Riggs. Some additional work on the documentation changes by me. Discussion: <a target="_blank" href="http://postgr.es/m/CANP8+jJBpWocfKrbJcaf3iBt9E3U=WPE_NC8YE6rye+YJ1sYnQ@mail.gmail.com">http://postgr.es/m/CANP8+jJBpWocfKrbJcaf3iBt9E3U=WPE_NC8YE6rye+YJ1sYnQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a3dc8e495b4967fe07086a700d115c89f4f0add0">http://git.postgresql.org/pg/commitdiff/a3dc8e495b4967fe07086a700d115c89f4f0add0</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Replace references to "xlog" with "wal" in docs. Commit f82ec32ac30ae7e3ec7c84067192535b2ff8ec0e renamed the pg_xlog directory to pg_wal. To make things consistent, we decided to eliminate "xlog" from user-visible docs. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f10637ebe02074e264b17606c00bc09da986c60d">http://git.postgresql.org/pg/commitdiff/f10637ebe02074e264b17606c00bc09da986c60d</a></li>
<li>Replace reference to "xlog-method" with "wal-method" in error message. Commit 62e8b38 renamed "--xlog-method" option for pg_basebackup to "--wal-method", but forgot to update the error message mentioning that option. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0dfa89ba2992b1be86ad3a5523a8d26dce31a08c">http://git.postgresql.org/pg/commitdiff/0dfa89ba2992b1be86ad3a5523a8d26dce31a08c</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Remove duplicate code in planner.c. I noticed while hacking on join UNION transforms that planner.c's function get_base_rel_indexes() just duplicates the functionality of get_relids_in_jointree(). It doesn't even have the excuse of being older code :-(. Drop it and use the latter function instead. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8d396a0a7046438ced8d8ada6ceb7c0756e58351">http://git.postgresql.org/pg/commitdiff/8d396a0a7046438ced8d8ada6ceb7c0756e58351</a></li>
<li>Fix YA unwanted behavioral difference with operator_precedence_warning. Jeff Janes noted that the error cursor position shown for some errors would vary when operator_precedence_warning is turned on. We'd prefer that option to have no undocumented effects, so this isn't desirable. To fix, make sure that an AEXPR_PAREN node has the same exprLocation as its child node. (Note: it would be a little cheaper to use @2 here instead of an exprLocation call, but there are cases where that wouldn't produce the identical answer, so don't do it like that.) Back-patch to 9.5 where this feature was introduced. Discussion: <a target="_blank" href="https://postgr.es/m/CAMkU=1ykK+VhhcQ4Ky8KBo9FoaUJH3f3rDQB8TkTXi-ZsBRUkQ@mail.gmail.com">https://postgr.es/m/CAMkU=1ykK+VhhcQ4Ky8KBo9FoaUJH3f3rDQB8TkTXi-ZsBRUkQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/01e0cbc4f687325b825e7953f99f0b16a2bd4e96">http://git.postgresql.org/pg/commitdiff/01e0cbc4f687325b825e7953f99f0b16a2bd4e96</a></li>
<li>Fix tab completion for "ALTER SYSTEM SET variable ...". It wouldn't complete "TO" after the variable name, which is certainly minor enough. But since we do complete "TO" after "SET variable ...", and since this case used to work pre-9.6, I think this is a bug. Also, fix the query used to collect the variable names; whoever last touched it evidently didn't understand how the pieces are supposed to fit together. It accidentally worked anyway, because readline ignores irrelevant completions, but it was randomly unlike the ones around it, and could be a source of actual bugs if someone copied it as a prototype for another query. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a5d4e3ff79636a647a69e93ec8b9239703e9556a">http://git.postgresql.org/pg/commitdiff/a5d4e3ff79636a647a69e93ec8b9239703e9556a</a></li>
<li>Doc: fix syntax synopsis for INSERT ... ON CONFLICT DO UPDATE. Commit 906bfcad7 adjusted the syntax synopsis for UPDATE, but missed the fact that the INSERT synopsis now contains a duplicate of that. In passing, improve wording and markup about using a table alias to dodge the conflict with use of "excluded" as a special table name. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2b18743614bb526e5a49a542c9c80c96668639cd">http://git.postgresql.org/pg/commitdiff/2b18743614bb526e5a49a542c9c80c96668639cd</a></li>
<li>Make sure that hash join's bulk-tuple-transfer loops are interruptible. The loops in ExecHashJoinNewBatch(), ExecHashIncreaseNumBatches(), and ExecHashRemoveNextSkewBucket() are all capable of iterating over many tuples without ever doing a CHECK_FOR_INTERRUPTS, so that the backend might fail to respond to SIGINT or SIGTERM for an unreasonably long time. Fix that. In the case of ExecHashJoinNewBatch(), it seems useful to put the added CHECK_FOR_INTERRUPTS into ExecHashJoinGetSavedTuple() rather than directly in the loop, because that will also ensure that both principal code paths through ExecHashJoinOuterGetTuple() will do a CHECK_FOR_INTERRUPTS, which seems like a good idea to avoid surprises. Back-patch to all supported branches. Tom Lane and Thomas Munro Discussion: <a target="_blank" href="https://postgr.es/m/6044.1487121720@sss.pgh.pa.us">https://postgr.es/m/6044.1487121720@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f2ec57dee93b29e2e27235ec8cc0683d0bc7d775">http://git.postgresql.org/pg/commitdiff/f2ec57dee93b29e2e27235ec8cc0683d0bc7d775</a></li>
<li>Doc: fix typo in logicaldecoding.sgml. There's no such field as OutputPluginOptions.output_mode; it's actually output_type. Noted by T. Katsumata. Discussion: <a target="_blank" href="https://postgr.es/m/20170215072115.6101.29870@wrigleys.postgresql.org">https://postgr.es/m/20170215072115.6101.29870@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/adb67d67f0f29acb175620ab05be26a146512fa2">http://git.postgresql.org/pg/commitdiff/adb67d67f0f29acb175620ab05be26a146512fa2</a></li>
<li>Formatting and docs corrections for logical decoding output plugins. Make the typedefs for output plugins consistent with project style; they were previously not even consistent with each other as to layout or inclusion of parameter names. Make the documentation look the same, and fix errors therein (missing and misdescribed parameters). Back-patch because of the documentation bugs. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/93e6e40574bccf9c6f33c520a4189d3e98e2fd1f">http://git.postgresql.org/pg/commitdiff/93e6e40574bccf9c6f33c520a4189d3e98e2fd1f</a></li>
<li>Doc: remove duplicate index entry. This causes a warning with the old html-docs toolchain, though not with the new. I had originally supposed that we needed both &lt;indexterm&gt; entries to get both a primary index entry and a see-also link; but evidently not, as pointed out by Fabien Coelho. Discussion: <a target="_blank" href="https://postgr.es/m/alpine.DEB.2.20.1702161616060.5445@lancre">https://postgr.es/m/alpine.DEB.2.20.1702161616060.5445@lancre</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3b7673388da3598933ae6c4f9fdc7c79dee05558">http://git.postgresql.org/pg/commitdiff/3b7673388da3598933ae6c4f9fdc7c79dee05558</a></li>
<li>Document usage of COPT environment variable for adjusting configure flags. Also add to the existing rather half-baked description of PROFILE, which does exactly the same thing, but I think people use it differently. Discussion: <a target="_blank" href="https://postgr.es/m/16461.1487361849@sss.pgh.pa.us">https://postgr.es/m/16461.1487361849@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a029d2cf4203f8f240bae4651e62c2358673b9f4">http://git.postgresql.org/pg/commitdiff/a029d2cf4203f8f240bae4651e62c2358673b9f4</a></li>
<li>Suppress "unused variable" warnings with older versions of flex. Versions of flex before 2.5.36 might generate code that results in an "unused variable" warning, when using %option reentrant. Historically we've worked around that by specifying -Wno-error, but that's an unsatisfying solution. The official "fix" for this was just to insert a dummy reference to the variable, so write a small perl script that edits the generated C code similarly. The MSVC side of this is untested, but the buildfarm should soon reveal if I broke that. Discussion: <a target="_blank" href="https://postgr.es/m/25456.1487437842@sss.pgh.pa.us">https://postgr.es/m/25456.1487437842@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/65d508fd4decee4d5a54c1e7b93acd25d5e80556">http://git.postgresql.org/pg/commitdiff/65d508fd4decee4d5a54c1e7b93acd25d5e80556</a></li>
<li>Adjust PL/Tcl regression test to dodge a possible bug or zone dependency. One case in the PL/Tcl tests is observed to fail on RHEL5 with a Turkish time zone setting. It's not clear if this is an old Tcl bug or something odd about the zone data, but in any case that test is meant to see if the Tcl [clock] command works at all, not what its corner-case behaviors are. Therefore we have no need to test exactly which week a Sunday midnight is considered to fall into. Probe the following Tuesday instead. Discussion: <a target="_blank" href="https://postgr.es/m/797.1487517822@sss.pgh.pa.us">https://postgr.es/m/797.1487517822@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/170511b30da40d73b54d8190711cd6066327b934">http://git.postgresql.org/pg/commitdiff/170511b30da40d73b54d8190711cd6066327b934</a></li>
<li>Dept of second thoughts: rename new perl script. It didn't take long at all for me to become irritated that the original choice of name for this script resulted in "warning" showing up in several places in build logs, because I tend to grep for that. Change the script name to avoid that. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5b3a2ca850718e1fd74f26bc2886e880676b2cd6">http://git.postgresql.org/pg/commitdiff/5b3a2ca850718e1fd74f26bc2886e880676b2cd6</a></li>
<li>Make src/interfaces/libpq/test clean up after itself. It failed to remove a .o file during "make clean", and it lacked a .gitignore file entirely. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/090f21bbad98001979da8589e9647a1d49bce4ee">http://git.postgresql.org/pg/commitdiff/090f21bbad98001979da8589e9647a1d49bce4ee</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix help message for pg_basebackup -R. The recovery.conf file that's generated is specifically for replication, and not needed (or wanted) for regular backup restore, so indicate that in the message. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1a16af8b35216bf8967007cabdb7f84206bd067f">http://git.postgresql.org/pg/commitdiff/1a16af8b35216bf8967007cabdb7f84206bd067f</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to fix an issue where 2PC files could be lost that stemmed from the fact that unlink() is not guaranteed to be durable.</p>
<p>Corey Huinker sent in two more revisions of a patch to add \if and friends to psql.</p>
<p>Ashutosh Sharma sent in a patch to scan has indexes a page at a time, where the previous scans did tuple-at-a-time.</p>
<p>Amit Langote sent in a patch to add relkind checks to certain contrib modules.</p>
<p>Seki Eiji sent in two revisions of a patch to add a GetOldestXmin option which ignores arbitrary vacuum flags.</p>
<p>Thomas Munro sent in another revision of a patch to implement [[Parallel] Shared] Hash.</p>
<p>Amit Khandekar sent in a patch to enable UPDATEs on partitioned tables that would cause a tuple to move from one partition to another.</p>
<p>Vaishnavi Prabakaran and Aya Iwata traded patches to add batch/pipelining support for libpq.</p>
<p>Amit Kapila sent in three more revisions of a patch to add WAL support for hash indexes.</p>
<p>Alexander Korotkov sent in another revision of a patch to cacheline-align PGXACT.</p>
<p>Kyotaro HORIGUCHI and Peter Eisentraut traded patches to make it possible for logical encoding to do the right thing when the encodings of the origin and replica don't match.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to make it possible to set a template database for pg_regress.</p>
<p>Dilip Kumar sent in three more revisions of a patch to implement parallel bitmap heap scan.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to fix some issues with the WAL consistency check facility.</p>
<p>Amit Langote and Ashutosh Bapat traded patches to improve the documentation for partitioning.</p>
<p>Erik Rijkers sent in a patch to fix the docs for CREATE SUBSCRIPTION.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to refactor tab completion in psql.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel merge join.</p>
<p>Tom Lane sent in another revision of a patch to improve OR conditions on joined columns.</p>
<p>Haribabu Kommi sent in another revision of a patch to add a pg_stat_wal_write statistics view.</p>
<p>Masahiko Sawada sent in another revision of a patch to implement transactions involving multiple postgres foreign servers.</p>
<p>Jeff Janes and Neha Khatri traded patches to fix an infelicity between bytea_output and make installcheck.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to fix an issue in PQsendQuery where an error occurs when target_session_attrs is set to read-write.</p>
<p>Masahiko Sawada sent in two more revisions of a patch to fix an infelicity between DROP SUBSCRIPTION and ROLLBACK.</p>
<p>Robert Haas and Amit Kapila traded patches to implement parallel index scans.</p>
<p>Thomas Munro sent in two more revisions of a patch to help measure replay lag.</p>
<p>Kuntal Ghosh sent in a patch to add infrastructure required to expose non-backend processes in pg_stat_activity, use same to expose stats for auxiliary processes in pg_stat_get_activity, expose stats for autovacuum launcher and bgworker, and add a proc_type column in pg_stat_get_activity.</p>
<p>Peter Eisentraut sent in a patch to add a max_worker_processes_per_user setting.</p>
<p>Peter Eisentraut sent in a patch to add errcontext to background worker registration, and hange failures in RegisterBackgroundWorker() to hard errors.</p>
<p>David Christensen sent in a patch to fix some DESCR() grammar mistakes introduced by the xlog -&gt; wal changes.</p>
<p>Anastasia Lubennikova sent in another revision of a patch to add an IF NOT EXISTS option for CREATE SERVER and CREATE USER MAPPING statements.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to implement xmltable().</p>
<p>Thomas Munro sent in another revision of a patch to make it possible to run parallel queries in SERIALIZABLE isolation mode.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement ICU integration.</p>
<p>Haribabu Kommi sent in a patch to allow parallel writers by separating concerns so that the backend does the write operations, while the workers produce the results.</p>
<p>Masahiko Sawada sent in another revision of a patch to add a GUC for cleanup indexes threshold.</p>
<p>David Christensen sent in a patch to teach Catalog.pm how many attributes there should be per DATA() line.</p>
<p>Heikki Linnakangas sent in another revision of a patch to implement SCRAM auth.</p>
<p>Karl O. Pinc and Gilles Darold traded patches to implement pg_current_logfile().</p>
<p>Anastasia Lubennikova sent in another revision of a patch to implement covering and unique indexes.</p>
<p>Amit Kapila sent in two revisions of a patch to ensure that ON CONFLICT DO NOTHING work with partitioned tables.</p>
<p>Rafia Sabih sent in three more revisions of a patch to implement parallel index-only scan.</p>
<p>Tom Lane sent in two revisions of a patch to avoiding OOM in a hash join with many duplicate inner keys.</p>
<p>Rushabh Lathia sent in two more revisions of a patch to implement gather merge.</p>
<p>Rafia Sabih sent in another revision of a patch to allow query string to workers.</p>
<p>Surafel Temsgen sent in another revision of a patch to implement CORRESPONDING.</p>
<p>David Christensen sent in two revisions of a patch to add pg_disable_checksums() and supporting infrastructure.</p>
<p>KaiGai Kohei sent in another revision of a patch to implement a ParallelFinish-hook for FDW/CSP.</p>
<p>Amit Langote sent in a patch to fix the fact that pg_dump would emit ALTER TABLE ONLY for partitioned tables.</p>
<p>Mithun Cy sent in a PoC patch to use a better way to expand hash indexes.</p>
<p>Peter Eisentraut sent in a patch to implement DCL for logical replication.</p>
<p>Amit Khandekar sent in another revision of a patch to implement parallel append.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to implement SASLprep aka NFKC for SCRAM authentication.</p>
<p>Tom Lane sent in a patch to add an InterTimestamp struct to fix an issue with floating point timestamps in logical replication.</p>
<p>Alexander Korotkov sent in another revision of a patch to implement incremental sort.</p>
<p>Jim Nasby sent in a patch to deal with the fact that pg_get_object_address() doesn't support composites.</p>
<p>Robert Haas sent in a patch to fix an instability in the select_parallel regression test by ensuring that workers get forgotten faster.</p>
<p>Robins Tharakan sent in a patch to add a --no-pgauthid to pg_dumpall, which will make it at least not fail immediately on Amazon RDS Postgres and similar systems.</p>
<p>Erik Rijkers sent in a patch to fix some comments in origin.c and snapbuild.c</p>
<p>Neha Khatri sent in a patch to fix a typo in varlena.c.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/02/22/Nouvelles-hebdomadaires-de-PostgreSQL-19-f%C3%A9vrier-2017">par chl le mercredi 22 février 2017 à 00h43</a>
</p>
</div>
</div>




<div class="entrygroup" id="urn:md5:d741eb881de13e800dbbd666b5a91d8f" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/02/22/Nouvelles-hebdomadaires-de-PostgreSQL-12-f%C3%A9vrier-2017">Nouvelles hebdomadaires de PostgreSQL - 12 février 2017</a></h4>
<div class="entry">
<div class="content">
<p>Versions correctives 9.6.2, 9.5.6, 9.4.11, 9.3.16 et 9.2.20 disponibles. Mettez &agrave; jour &agrave; la prochaine opportunit&eacute; d'immobilisation. <a target="_blank" href="https://www.postgresql.org/about/news/1733/">https://www.postgresql.org/about/news/1733/</a></p>
<p>Le PGDay suisse se tiendra &agrave; Rapperwil le 30 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 14 avril&nbsp;: <a target="_blank" href="http://www.pgday.ch/2017/">http://www.pgday.ch/2017/</a></p>
<p>[ndt: Meetup &agrave; Paris le 9 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Paris/</a>]</p>
<h2>Offres d'emplois autour de PostgreSQL en f&eacute;vrier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-02/">http://archives.postgresql.org/pgsql-jobs/2017-02/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</li>
<li>Le premier pgDay Israel 2017 aura lieu le 2 mars 2017. Les inscriptions sont ouvertes&nbsp;: <a target="_blank" href="http://pgday.org.il/">http://pgday.org.il/</a></li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>[ndt: Meetup &agrave; Nantes le 8 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/</a>]</li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://2017.pgday.asia/">http://2017.pgday.asia/</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
<li>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 24 f&eacute;vrier 2017 : &eacute;crire &agrave; CFP AT PostgresVision DOT com&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170212221755.GA21298@fetter.org">http://www.postgresql.org/message-id/20170212221755.GA21298@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Fix typos in comments. Backpatch to all supported versions, where applicable, to make backpatching of future fixes go more smoothly. Josh Soref Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CACZqfqCf+5qRztLPgmmosr-B0Ye4srWzzw_mo4c_8_B_mtjmJQ@mail.gmail.com">https://www.postgresql.org/message-id/CACZqfqCf+5qRztLPgmmosr-B0Ye4srWzzw_mo4c_8_B_mtjmJQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/181bdb90ba1f2361aec5a621c8f1e01736f8cad2">http://git.postgresql.org/pg/commitdiff/181bdb90ba1f2361aec5a621c8f1e01736f8cad2</a></li>
<li>Fix typo in variable name. Masahiko Sawada <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d02d985349cad066330786bd38e186a569415751">http://git.postgresql.org/pg/commitdiff/d02d985349cad066330786bd38e186a569415751</a></li>
<li>Fix typo also in expected output. Commit 181bdb90ba fixed the typo in the .sql file, but forgot to update the expected output. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d93b7535a68b03cb8126b930af796af469fdd109">http://git.postgresql.org/pg/commitdiff/d93b7535a68b03cb8126b930af796af469fdd109</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Add missing newline to error messages. Also improve the message style a bit while we're here. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/afcb0c97efc58459bcbbe795f42d8b7be414e076">http://git.postgresql.org/pg/commitdiff/afcb0c97efc58459bcbbe795f42d8b7be414e076</a></li>
<li>doc: Update CREATE DATABASE examples. The example of using CREATE DATABASE with the ENCODING option did not work anymore (except in special circumstances) and did not represent a good general-purpose example, so write some new examples. Reported-by: marc+pgsql@milestonerdl.com <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/549f74733f45804cd3180de853e5d0610eecc22f">http://git.postgresql.org/pg/commitdiff/549f74733f45804cd3180de853e5d0610eecc22f</a></li>
<li>doc: Document sequence function privileges better. Document the privileges required for each of the sequence functions. This was already in the GRANT reference page, but also add it to the function description for easier reference. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/696af9ab0a92642978169c227e187a65c2f35f17">http://git.postgresql.org/pg/commitdiff/696af9ab0a92642978169c227e187a65c2f35f17</a></li>
<li>Avoid permission failure in pg_sequences.last_value. Before, reading pg_sequences.last_value would fail unless the user had appropriate sequence permissions, which would make the pg_sequences view cumbersome to use. Instead, return null instead of the real value when there are no permissions. From: Michael Paquier &lt;michael.paquier@gmail.com&gt; Reported-by: Shinoda, Noriyoshi &lt;noriyoshi.shinoda@hpe.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ab82340a43bebe57a3db0e52bb74120b3bb53ae5">http://git.postgresql.org/pg/commitdiff/ab82340a43bebe57a3db0e52bb74120b3bb53ae5</a></li>
<li>doc: Some improvements in CREATE SUBSCRIPTION ref page. Add link to description of libpq connection strings. Add link to explanation of replication access control. This currently points to the description of streaming replication access control, which is currently the same as for logical replication, but that might be refined later. Also remove plain-text passwords from the examples, to not encourage that dubious practice. based on suggestions from Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e35bbea7ddd89c7f51988fcf03c87150938ea2e3">http://git.postgresql.org/pg/commitdiff/e35bbea7ddd89c7f51988fcf03c87150938ea2e3</a></li>
<li>Fix relcache leaks in get_object_address_publication_rel(). <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/115cb31597fac8a17202d1e41da8baf33fcb60cf">http://git.postgresql.org/pg/commitdiff/115cb31597fac8a17202d1e41da8baf33fcb60cf</a></li>
<li>Add CREATE SEQUENCE AS &lt;data type&gt; clause. This stores a data type, required to be an integer type, with the sequence. The sequences min and max values default to the range supported by the type, and they cannot be set to values exceeding that range. The internal implementation of the sequence is not affected. Change the serial types to create sequences of the appropriate type. This makes sure that the min and max values of the sequence for a serial column match the range of values supported by the table column. So the sequence can no longer overflow the table column. This also makes monitoring for sequence exhaustion/wraparound easier, which currently requires various contortions to cross-reference the sequences with the table columns they are used with. This commit also effectively reverts the pg_sequence column reordering in f3b421da5f4addc95812b9db05a24972b8fd9739, because the new seqtypid column allows us to fill the hole in the struct and create a more natural overall column ordering. Reviewed-by: Steve Singer &lt;steve@ssinger.info&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2ea5b06c7a7056dca0af1610aadebe608fbcca08">http://git.postgresql.org/pg/commitdiff/2ea5b06c7a7056dca0af1610aadebe608fbcca08</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Update comment in relcache.c. Commit 665d1fad9 introduced rd_pkindex, and made RelationGetIndexList responsible for updating it, but didn't bother to fix RelationGetIndexList's header comment to say so. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a59318346ef476d3e66c4d13e92cf4ad6ce328ac">http://git.postgresql.org/pg/commitdiff/a59318346ef476d3e66c4d13e92cf4ad6ce328ac</a></li>
<li>Avoid returning stale attribute bitmaps in RelationGetIndexAttrBitmap(). The problem with the original coding here is that we might receive (and clear) a relcache invalidation signal for the target relation down inside one of the index_open calls we're doing. Since the target is open, we would not drop the relcache entry, just reset its rd_indexvalid and rd_indexlist fields. But RelationGetIndexAttrBitmap() kept going, and would eventually cache and return potentially-obsolete attribute bitmaps. The case where this matters is where the inval signal was from a CREATE INDEX CONCURRENTLY telling us about a new index on a formerly-unindexed column. (In all other cases, the lock we hold on the target rel should prevent any concurrent change in index state.) Even just returning the stale attribute bitmap is not such a problem, because it shouldn't matter during the transaction in which we receive the signal. What hurts is caching the stale data, because it can survive into later transactions, breaking CREATE INDEX CONCURRENTLY's expectation that later transactions will not create new broken HOT chains. The upshot is that there's a window for building corrupted indexes during CREATE INDEX CONCURRENTLY. This patch fixes the problem by rechecking that the set of index OIDs is still the same at the end of RelationGetIndexAttrBitmap() as it was at the start. If not, we loop back and try again. That's a little more than is strictly necessary to fix the bug --- in principle, we could return the stale data but not cache it --- but it seems like a bad idea on general principles for relcache to return data it knows is stale. There might be more hazards of the same ilk, or there might be a better way to fix this one, but this patch definitely improves matters and seems unlikely to make anything worse. So let's push it into today's releases even as we continue to study the problem. Pavan Deolasee and myself Discussion: <a target="_blank" href="https://postgr.es/m/CABOikdM2MUq9cyZJi1KyLmmkCereyGp5JQ4fuwKoyKEde_mzkQ@mail.gmail.com">https://postgr.es/m/CABOikdM2MUq9cyZJi1KyLmmkCereyGp5JQ4fuwKoyKEde_mzkQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2aaec65464dad497536199dea13612b9232eaa3e">http://git.postgresql.org/pg/commitdiff/2aaec65464dad497536199dea13612b9232eaa3e</a></li>
<li>Release note updates. Add item for last-minute CREATE INDEX CONCURRENTLY fix. Repair a couple of misspellings of patch authors' names. Back-branch updates will follow shortly, but I thought I'd commit this separately just to make it more visible. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ad6af3fc4256c0e1eecf5d93d510da4b44e0d480">http://git.postgresql.org/pg/commitdiff/ad6af3fc4256c0e1eecf5d93d510da4b44e0d480</a></li>
<li>Correct thinko in last-minute release note item. The CREATE INDEX CONCURRENTLY bug can only be triggered by row updates, not inserts, since the problem would arise from an update incorrectly being made HOT. Noted by Alvaro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/39c3ca5161911cebafbcce160ef89e5a4faaf569">http://git.postgresql.org/pg/commitdiff/39c3ca5161911cebafbcce160ef89e5a4faaf569</a></li>
<li>Speed up "brin" regression test a little bit. In the large DO block, collect row TIDs into array variables instead of creating and dropping a pile of temporary tables. In a normal build, this reduces the brin test script's runtime from about 1.1 sec to 0.4 sec on my workstation. That's not all that exciting perhaps, but in a CLOBBER_CACHE_ALWAYS test build, the runtime drops from 20 min to 17 min, which is a little more useful. In combination with some other changes I plan to propose, this will help provide a noticeable reduction in cycle time for CLOBBER_CACHE_ALWAYS buildfarm critters. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/242066cc8e587ccbe5e1cf38c4f085f080dcd5e0">http://git.postgresql.org/pg/commitdiff/242066cc8e587ccbe5e1cf38c4f085f080dcd5e0</a></li>
<li>Fix roundoff problems in float8_timestamptz() and make_interval(). When converting a float value to integer microseconds, we should be careful to round the value to the nearest integer, typically with rint(); simply assigning to an int64 variable will truncate, causing apparently off-by-one values in cases that should work. Most places in the datetime code got this right, but not these two. float8_timestamptz() is new as of commit e511d878f (9.6). Previous versions effectively depended on interval_mul() to do roundoff correctly, which it does, so this fixes an accuracy regression in 9.6. The problem in make_interval() dates to its introduction in 9.4. Aside from being careful to round not truncate, let's incorporate the hours and minutes inputs into the result with exact integer arithmetic, rather than risk introducing roundoff error where there need not have been any. float8_timestamptz() problem reported by Erik Nordstr&Atilde;&para;m, though this is not his proposed patch. make_interval() problem found by me. Discussion: <a target="_blank" href="https://postgr.es/m/CAHuQZDS76jTYk3LydPbKpNfw9KbACmD=49dC4BrzHcfPv6yA1A@mail.gmail.com">https://postgr.es/m/CAHuQZDS76jTYk3LydPbKpNfw9KbACmD=49dC4BrzHcfPv6yA1A@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8f93bd8512466c9b6c4dbc1e5efd0f72b8e2be9a">http://git.postgresql.org/pg/commitdiff/8f93bd8512466c9b6c4dbc1e5efd0f72b8e2be9a</a></li>
<li>Allow index AMs to cache data across aminsert calls within a SQL command. It's always been possible for index AMs to cache data across successive amgettuple calls within a single SQL command: the IndexScanDesc.opaque field is meant for precisely that. However, no comparable facility exists for amortizing setup work across successive aminsert calls. This patch adds such a feature and teaches GIN, GIST, and BRIN to use it to amortize catalog lookups they'd previously been doing on every call. (The other standard index AMs keep everything they need in the relcache, so there's little to improve there.) For GIN, the overall improvement in a statement that inserts many rows can be as much as 10%, though it seems a bit less for the other two. In addition, this makes a really significant difference in runtime for CLOBBER_CACHE_ALWAYS tests, since in those builds the repeated catalog lookups are vastly more expensive. The reason this has been hard up to now is that the aminsert function is not passed any useful place to cache per-statement data. What I chose to do is to add suitable fields to struct IndexInfo and pass that to aminsert. That's not widening the index AM API very much because IndexInfo is already within the ken of ambuild; in fact, by passing the same info to aminsert as to ambuild, this is really removing an inconsistency in the AM API. Discussion: <a target="_blank" href="https://postgr.es/m/27568.1486508680@sss.pgh.pa.us">https://postgr.es/m/27568.1486508680@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/86d911ec0f9d4643e9a47db42510959dec0ed76b">http://git.postgresql.org/pg/commitdiff/86d911ec0f9d4643e9a47db42510959dec0ed76b</a></li>
<li>Blind try to fix portability issue in commit 8f93bd851 et al. The S/390 members of the buildfarm are showing failures indicating that they're having trouble with the rint() calls I added yesterday. There's no good reason for that, and I wonder if it is a compiler bug similar to the one we worked around in d9476b838. Try to fix it using the same method as before, namely to store the result of rint() back into a "double" variable rather than immediately converting to int64. (This isn't entirely waving a dead chicken, since on machines with wider-than-double float registers, the extra store forces a width conversion. I don't know if S/390 is like that, but it seems worth trying.) In passing, merge duplicate ereport() calls in float8_timestamptz(). Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5d2adf0f81a2e4ca4f101b19b1efea147b462301">http://git.postgresql.org/pg/commitdiff/5d2adf0f81a2e4ca4f101b19b1efea147b462301</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Cache hash index's metapage in rel-&gt;rd_amcache. This avoids a very significant amount of buffer manager traffic and contention when scanning hash indexes, because it's no longer necessary to lock and pin the metapage for every scan. We do need some way of figuring out when the cache is too stale to use any more, so that when we lock the primary bucket page to which the cached metapage points us, we can tell whether a split has occurred since we cached the metapage data. To do that, we use the hash_prevblkno field in the primary bucket page, which would otherwise always be set to InvalidBuffer. This patch contains code so that it will continue working (although less efficiently) with hash indexes built before this change, but perhaps we should consider bumping the hash version and ripping out the compatibility code. That decision can be made later, though. Mithun Cy, reviewed by Jesper Pedersen, Amit Kapila, and by me. Before committing, I made a number of cosmetic changes to the last posted version of the patch, adjusted _hash_getcachedmetap to be more careful about order of operation, and made some necessary updates to the pageinspect documentation and regression tests. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/293e24e507838733aba4748b514536af2d39d7f2">http://git.postgresql.org/pg/commitdiff/293e24e507838733aba4748b514536af2d39d7f2</a></li>
<li>Fix compiler warning. Mithun Cy, per a report by Erik Rijkers <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/94708c0e8c32ad1c9c6ffbdb894fe158eda596e7">http://git.postgresql.org/pg/commitdiff/94708c0e8c32ad1c9c6ffbdb894fe158eda596e7</a></li>
<li>Allow the element allocator for a simplehash to be specified. This is infrastructure for a pending patch to allow parallel bitmap heap scans. Dilip Kumar, reviewed (in earlier versions) by Andres Freund and (more recently) by me. Some further renaming by me, also. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/565903af474e85cef28ff712d773f13b6701ded5">http://git.postgresql.org/pg/commitdiff/565903af474e85cef28ff712d773f13b6701ded5</a></li>
<li>Avoid redefining simplehash_allocate/simplehash_free. There's no generic guard against multiple inclusion in this file, for good reason. But these typedefs need one, as per a report from Jeff Janes. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ac8eb972f268c787bfe7579b1747c3866fced5a9">http://git.postgresql.org/pg/commitdiff/ac8eb972f268c787bfe7579b1747c3866fced5a9</a></li>
<li>Revise the way the element allocator for a simplehash is specified. This method is more elegant and more efficient. Per a suggestion from Andres Freund, who also briefly reviewed the patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c3c4f6e1740be256178cd7551d5b8a7677159b74">http://git.postgresql.org/pg/commitdiff/c3c4f6e1740be256178cd7551d5b8a7677159b74</a></li>
<li>Add WAL consistency checking facility. When the new GUC wal_consistency_checking is set to a non-empty value, it triggers recording of additional full-page images, which are compared on the standby against the results of applying the WAL record (without regard to those full-page images). Allowable differences such as hints are masked out, and the resulting pages are compared; any difference results in a FATAL error on the standby. Kuntal Ghosh, based on earlier patches by Michael Paquier and Heikki Linnakangas. Extensively reviewed and revised by Michael Paquier and by me, with additional reviews and comments from Amit Kapila, &Atilde;lvaro Herrera, Simon Riggs, and Peter Eisentraut. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a507b86900f695aacc8d52b7d2cfcb65f58862a2">http://git.postgresql.org/pg/commitdiff/a507b86900f695aacc8d52b7d2cfcb65f58862a2</a></li>
<li>pageinspect: Fix hash_bitmap_info not to read the underlying page. It did that to verify that the page was an overflow page rather than anything else, but that means that checking the status of all the overflow bits requires reading the entire index. So don't do that. The new code validates that the page is not a primary bucket page or bitmap page by looking at the metapage, so that using this on large numbers of pages can be reasonably efficient. Ashutosh Sharma, per a complaint from me, and with further modifications by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fc8219dc54c95ea673560b786aa8123ce6ec5977">http://git.postgresql.org/pg/commitdiff/fc8219dc54c95ea673560b786aa8123ce6ec5977</a></li>
<li>Fix race condition in ConditionVariablePrepareToSleep. Thomas Munro <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3f3d60d3bbd10f6cc118d24aadc60e96b9854576">http://git.postgresql.org/pg/commitdiff/3f3d60d3bbd10f6cc118d24aadc60e96b9854576</a></li>
<li>simplehash: Additional tweaks to make specifying an allocator work. Even if we don't emit definitions for SH_ALLOCATE and SH_FREE, we still need prototypes. The user can't define them before including simplehash.h because SH_TYPE isn't available yet. For the allocator to be able to access private_data, it needs to become an argument to SH_CREATE. Previously we relied on callers to set that after returning from SH_CREATE, but SH_CREATE calls SH_ALLOCATE before returning. Dilip Kumar, reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/72257f95781af97108fa9a9e7224ec81a90e7693">http://git.postgresql.org/pg/commitdiff/72257f95781af97108fa9a9e7224ec81a90e7693</a></li>
<li>Remove all references to "xlog" from SQL-callable functions in pg_proc. Commit f82ec32ac30ae7e3ec7c84067192535b2ff8ec0e renamed the pg_xlog directory to pg_wal. To make things consistent, and because "xlog" is terrible terminology for either "transaction log" or "write-ahead log" rename all SQL-callable functions that contain "xlog" in the name to instead contain "wal". (Note that this may pose an upgrade hazard for some users.) Similarly, rename the xlog_position argument of the functions that create slots to be called wal_position. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CA+Tgmob=YmA=H3DbW1YuOXnFVgBheRmyDkWcD9M8f=5bGWYEoQ@mail.gmail.com">https://www.postgresql.org/message-id/CA+Tgmob=YmA=H3DbW1YuOXnFVgBheRmyDkWcD9M8f=5bGWYEoQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/806091c96f9b81f7631e4e37a05af377b473b5da">http://git.postgresql.org/pg/commitdiff/806091c96f9b81f7631e4e37a05af377b473b5da</a></li>
<li>Rename user-facing tools with "xlog" in the name to say "wal". This means pg_receivexlog because pg_receivewal, pg_resetxlog becomes pg_resetwal, and pg_xlogdump becomes pg_waldump. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/85c11324cabaddcfaf3347df78555b30d27c5b5a">http://git.postgresql.org/pg/commitdiff/85c11324cabaddcfaf3347df78555b30d27c5b5a</a></li>
<li>Rename dtrace probes for ongoing xlog -&gt; wal conversion. xlog-switch becomes wal-switch, and xlog-insert becomes wal-insert. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3f01fd4ca0b4c81333b1f0dadb09c73aa589ab6e">http://git.postgresql.org/pg/commitdiff/3f01fd4ca0b4c81333b1f0dadb09c73aa589ab6e</a></li>
<li>Rename command line options for ongoing xlog -&gt; wal conversion. initdb and pg_basebackup now have a --waldir option rather --xlogdir, and pg_basebackup now has --wal-method rather than --xlog-method. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/62e8b387514ce965c8b3d67c81990e0ecf8c9b83">http://git.postgresql.org/pg/commitdiff/62e8b387514ce965c8b3d67c81990e0ecf8c9b83</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Add explicit ORDER BY to a few tests that exercise hash-join code. A proposed patch, also by Thomas and in the same thread, would change the output order of these. Independent of the follow-up patches getting committed, nailing down the order in these specific tests at worst seems harmless. Author: Thomas Munro Discussion: <a target="_blank" href="https://postgr.es/m/CAEepm=1D4-tP7j7UAgT_j4ZX2j4Ehe1qgZQWFKBMb8F76UW5Rg@mail.gmail.com">https://postgr.es/m/CAEepm=1D4-tP7j7UAgT_j4ZX2j4Ehe1qgZQWFKBMb8F76UW5Rg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7c5d8c16e12e56c1043ff4a28e07a306a15c2b85">http://git.postgresql.org/pg/commitdiff/7c5d8c16e12e56c1043ff4a28e07a306a15c2b85</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Improve CREATE TABLE documentation of partitioning. Amit Langote, with corrections by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c1369fe2ea79724e56ee55e4c87778afd6016942">http://git.postgresql.org/pg/commitdiff/c1369fe2ea79724e56ee55e4c87778afd6016942</a></li>
<li>Add keywords for partitioning. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/61c9a9dac44c0f0c24342a4fa4f750756ac72f2f">http://git.postgresql.org/pg/commitdiff/61c9a9dac44c0f0c24342a4fa4f750756ac72f2f</a></li>
<li>Update ddl.sgml for declarative partitioning syntax. Add a section titled "Partitioned Tables" to describe what are partitioned tables, partition, their similarities with inheritance. The existing section on inheritance is retained for clarity. Then add examples to the partitioning chapter that show syntax for partitioned tables. In fact they implement the same partitioning scheme that is currently shown using inheritance. Amit Langote, with additional details and explanatory text by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9401883a7a598f1f1664c74835821f697932666f">http://git.postgresql.org/pg/commitdiff/9401883a7a598f1f1664c74835821f697932666f</a></li>
</ul>
<p>Noah Misch pushed:</p>
<ul>
<li>Ignore tablespace ACLs when ignoring schema ACLs. The ALTER TABLE ALTER TYPE implementation can issue DROP INDEX and CREATE INDEX to refit existing indexes for the new column type. Since this CREATE INDEX is an implementation detail of an index alteration, the ensuing DefineIndex() should skip ACL checks specific to index creation. It already skips the namespace ACL check. Make it skip the tablespace ACL check, too. Back-patch to 9.2 (all supported versions). Reviewed by Tom Lane. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f30f34e5897b64e0fb6616154c11dc9765866046">http://git.postgresql.org/pg/commitdiff/f30f34e5897b64e0fb6616154c11dc9765866046</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Amit Khandekar sent in two more revisions of a patch to implement Parallel Append.</p>
<p>Boris Muratshin sent in a patch to implement 3D Z-curve spatial indexes.</p>
<p>Corey Huinker sent in five more revisions of a patch to implement \if and friends in psql.</p>
<p>Nikita Glukhov sent in another revision of a patch to implement KNN for B-trees.</p>
<p>Nikita Glukhov sent in another revision of a patch to implement KNN for SP-GiST.</p>
<p>Beena Emerson sent in another revision of a patch to allow increasing the default WAL segment size.</p>
<p>Nikolay Shaplov sent in another revision of a patch to move all am-related reloption code into src/backend/access/[am-name] and get rid of relopt_kind for custom AM.</p>
<p>Fujii Masao sent in a patch to fix a bug that made it impossible to shut down a subscriber after DROP SUBSCRIPTION.</p>
<p>Heikki Linnakangas sent in another revision of a patch to implement SCRAM authentication.</p>
<p>Christoph Berg sent in two more revisions of a patch to implement \gx, a one-shot expanded output for queries, in psql.</p>
<p>Mithun Cy sent in two more revisions of a patch to implement auto_prewarm.</p>
<p>Rafia Sabih sent in two more revisions of a patch to enable passing query string to workers.</p>
<p>Takeshi Ideriha sent in another revision of a patch to enable DECLARE STATEMENT to set up a connection in ECPG.</p>
<p>Peter Eisentraut sent in a patch to drop Python 2.3 support.</p>
<p>Pavel Raiskup sent in two revisions of a patch to create a configure-time knob to set default ssl ciphers.</p>
<p>Naoki Okano sent in a patch to implement CREATE OR REPLACE TRIGGER.</p>
<p>Piotr Stefaniak sent in a patch to pg_bsd_indent to implement -lps ("leave preprocessor space").</p>
<p>Dilip Kumar and Robert Haas traded patches to implement parallel bitmap heap scan.</p>
<p>Masahiko Sawada sent in two revisions of a patch to stop the apply worker after DROP SUBSCRIPTION is committed.</p>
<p>Peter Eisentraut sent in a patch to systematically trim the trailing newlines off PQerrorMessage() results in backend uses (dblink, postgres_fdw, libpqwalreceiver).</p>
<p>Peter Eisentraut sent in a patch to implement CREATE COLLATION IF NOT EXISTS.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to implement SASLprep(), or NFKC if you want for UTF-8 strings.</p>
<p>Kyle Gearhart sent in a patch to implement an alternate row processor for libpq which is faster for certain use cases than the default one.</p>
<p>Amit Langote sent in two revisions of a patch to implement a check partition strategy in ATExecDropNotNull.</p>
<p>Andres Freund sent in a patch to speed up expression processing, including several JIT PoCs.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in two revisions of a patch to enable specifying a template database for pg_regress.</p>
<p>Petr Jel&Atilde;&shy;nek sent in another revision of a patch to enable existing data copy for logical replication.</p>
<p>Amit Kapila sent in two more revisions of a patch to implement parallel index scans.</p>
<p>Amit Kapila sent in another revision of a patch to implement WAL for hash indexes.</p>
<p>Amit Langote sent in a patch to optimize partitioned tables by noting that top-level tables are always empty and avoiding that anything that might write to them can't.</p>
<p>Amit Langote sent in a patch to add relkind checks to certain contrib modules.</p>
<p>Peter Geoghegan sent in a patch to add parallel B-tree index build sorting with some testing tools.</p>
<p>Ashutosh Bapat sent in three more revisions of a patch to speed up partition-wise joins on declaratively partitioned tables.</p>
<p>Amit Kapila sent in another revision of a patch to parallelize queries containing initplans.</p>
<p>Simon Riggs sent in a patch to make log_autovacuum_min_duration log the durations of vacuums whether or not they were launched by autovacuum workers.</p>
<p>Simon Riggs sent in a patch to enable reporting xmin from VACUUMs.</p>
<p>Peter Geoghegan sent in a patch to add amcheck extension to contrib.</p>
<p>Michael Banck sent in three revisions of a patch to better document pg_basebackup's behavior in certain corner cases.</p>
<p>Andreas Karlsson sent in another revision of a patch to implement REINDEX CONCURRENTLY.</p>
<p>Tom Lane sent in a patch to preprocess join OR clauses that might be better handled as UNIONs.</p>
<p>Magnus Hagander sent in a patch to enable having fallback servers RADIUS auth.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/02/22/Nouvelles-hebdomadaires-de-PostgreSQL-12-f%C3%A9vrier-2017">par chl le mercredi 22 février 2017 à 00h39</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi  9 février 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:86cb0d37dc343d8fc5ab6eba747eebc1" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/02/09/Nouvelles-hebdomadaires-de-PostgreSQL-5-f%C3%A9vrier-2017">Nouvelles hebdomadaires de PostgreSQL - 5 février 2017</a></h4>
<div class="entry">
<div class="content">
<p>Le premier pgDay Israel 2017 aura lieu le 2 mars 2017. Les inscriptions sont ouvertes&nbsp;: <a target="_blank" href="http://pgday.org.il/">http://pgday.org.il/</a></p>
<p>Postgres Vision aura lieu &agrave; Boston du 26 au 28 juin 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 24 f&eacute;vrier 2017 : &eacute;crire &agrave; CFP AT PostgresVision DOT com&nbsp;: <a target="_blank" href="http://postgresvision.com/">http://postgresvision.com/</a></p>
<p>[ndt: Meetup &agrave; Nantes le 8 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Nantes/</a>]</p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>Ora2PG 18.0, un outil de migration de bases Oracle vers PostgreSQL&nbsp;: <a target="_blank" href="http://ora2pg.darold.net/">http://ora2pg.darold.net/</a></li>
<li>psqlODBC 09.06.0100&nbsp;: <a target="_blank" href="https://odbc.postgresql.org/docs/release.html">https://odbc.postgresql.org/docs/release.html</a></li>
<li>PostGIS 2.2.5 and 2.3.2, the industry standard geographic information system package for PostgreSQL, released. <a target="_blank" href="http://postgis.net/2017/01/30/postgis-2.2.5/">http://postgis.net/2017/01/30/postgis-2.2.5/</a> <a target="_blank" href="http://postgis.net/2017/01/31/postgis-2.3.2/">http://postgis.net/2017/01/31/postgis-2.3.2/</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en f&eacute;vrier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-02/">http://archives.postgresql.org/pgsql-jobs/2017-02/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Lyon le 21 février&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</li>
<li>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170205221731.GA32585@fetter.org">http://www.postgresql.org/message-id/20170205221731.GA32585@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Stephen Frost pushed:</p>
<ul>
<li>Handle ALTER EXTENSION ADD/DROP with pg_init_privs. In commit 6c268df, pg_init_privs was added to track the initial privileges of catalog objects and extensions. Unfortunately, that commit didn't include understanding of ALTER EXTENSION ADD/DROP, which allows the objects associated with an extension to be changed after the initial CREATE EXTENSION script has been run. The result of this meant that ACLs for objects added through ALTER EXTENSION ADD were not recorded into pg_init_privs and we would end up including those ACLs in pg_dump when we shouldn't have. This commit corrects that by making sure to have pg_init_privs updated when ALTER EXTENSION ADD/DROP is run, recording the permissions as they are at ALTER EXTENSION ADD time, and removing any if/when ALTER EXTENSION DROP is called. This issue was pointed out by Moshe Jacobson as commentary on bug #14456 (which was actually a bug about versions prior to 9.6 not handling custom ACLs on extensions correctly, an issue now addressed with pg_init_privs in 9.6). Back-patch to 9.6 where pg_init_privs was introduced. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e54f75722c720b596ec5e72154cc899da199de5b">http://git.postgresql.org/pg/commitdiff/e54f75722c720b596ec5e72154cc899da199de5b</a></li>
<li>test_pg_dump TAP test whitespace cleanup. The formatting of the perl hashes used in the TAP tests for test_pg_dump was rather horribly inconsistent and made it more difficult than it really should have been to add new tests or adjust what tests are for what runs, etc. Reformat to clean that all up. Whitespace-only changes. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fb94ca77f1400e236b00d432dccfbe4f1124971c">http://git.postgresql.org/pg/commitdiff/fb94ca77f1400e236b00d432dccfbe4f1124971c</a></li>
<li>test_pg_dump: perltidy cleanup. As pointed out by Alvaro, we actually use perltidy on the perl scripts in the source tree, so go back to the results of a perltidy run for the test_pg_dump TAP script. To make it look slightly less tragic, I changed most of the independent arguments into long-form single arguments (eg: -f file.sql changed to be --file=file.sql) to avoid having them confusingly split across lines due to perltidy. Back-patch to 9.6, as the last patch was. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/58da8334308c26107ebb7ee06c99589e14bd882b">http://git.postgresql.org/pg/commitdiff/58da8334308c26107ebb7ee06c99589e14bd882b</a></li>
<li>perltidy pg_dump TAP tests. The pg_dump TAP tests have gotten pretty far from what perltidy thinks they should be, so fix that, and in passing use long-form argument names with arguments passed via "=" in a similar vein to 58da833. No functional changes here, just whitespace and changing runs from "-f" to "--file=", and similar. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6af8b89adba16f97bee0d3b01256861e10d0e4f1">http://git.postgresql.org/pg/commitdiff/6af8b89adba16f97bee0d3b01256861e10d0e4f1</a></li>
<li>pg_dump: Fix handling of ALTER DEFAULT PRIVILEGES. In commit 23f34fa, we changed how ACLs were handled to use the new pg_init_privs catalog and to dump out the ACL commands as REVOKE+GRANT combinations instead of trying to REVOKE all rights always and then GRANT back just the ones which were in place. Unfortunately, the DEFAULT PRIVILEGES system didn't quite get the correct treatment with this change and ended up (incorrectly) only including positive GRANTs instead of both the REVOKEs and GRANTs necessary to preserve the correct privileges. There are only a couple cases where such REVOKEs are possible because, generally speaking, there's few rights which exist on objects by default to be revoked. Examples of REVOKEs which weren't being correctly preserved are when privileges are REVOKE'd from the creator/owner, like so: ALTER DEFAULT PRIVILEGES FOR ROLE myrole REVOKE SELECT ON TABLES FROM myrole; or when other default privileges are being revoked, such as EXECUTE rights granted to public for functions: ALTER DEFAULT PRIVILEGES FOR ROLE myrole REVOKE EXECUTE ON FUNCTIONS FROM PUBLIC; Fix this by correctly working out what the correct REVOKE statements are (if any) and dump them out, just as we do for everything else. Noticed while developing additional regression tests for pg_dump, which will be landing shortly. Back-patch to 9.6 where the bug was introduced. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e2090d9d20d8091c9478a674d9c22fc8006909ce">http://git.postgresql.org/pg/commitdiff/e2090d9d20d8091c9478a674d9c22fc8006909ce</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Remove leftover reference to "indirect blocks" in comment. Peter Geoghegan <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dbeca61c3535af2613000c4492848ca6da8a902f">http://git.postgresql.org/pg/commitdiff/dbeca61c3535af2613000c4492848ca6da8a902f</a></li>
<li>Small fixes to the Perl scripts to create unicode conversion tables. Add missing semicolons in UCS_to_* perl scripts. For consistency, use "$hashref-&gt;{key}" style everywhere. Kyotaro Horiguchi Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20170130.153738.139030994.horiguchi.kyotaro@lab.ntt.co.jp">https://www.postgresql.org/message-id/20170130.153738.139030994.horiguchi.kyotaro@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bc1686f3f653d30847736f2b71d694b98ba5c31d">http://git.postgresql.org/pg/commitdiff/bc1686f3f653d30847736f2b71d694b98ba5c31d</a></li>
<li>Don't create "holes" in BufFiles, in the new logtape code. The "Simplify tape block format" commit ignored the rule that blocks returned by ltsGetFreeBlock() must be written out in the same order, at least in the first write pass. To fix, relax that requirement, by making ltsWriteBlock() to detect if it's about to create a "hole" in the underlying BufFile, and fill it with zeros instead. Reported, analysed, and reviewed by Peter Geoghegan. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAM3SWZRWdNtkhiG0GyiX_1mUAypiK3dV6-6542pYe2iEL-foTA@mail.gmail.com">https://www.postgresql.org/message-id/CAM3SWZRWdNtkhiG0GyiX_1mUAypiK3dV6-6542pYe2iEL-foTA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7ac4a389a7dbddaa8b19deb228f0a988e79c5795">http://git.postgresql.org/pg/commitdiff/7ac4a389a7dbddaa8b19deb228f0a988e79c5795</a></li>
<li>Replace isMD5() with a more future-proof way to check if pw is encrypted. The rule is that if pg_authid.rolpassword begins with "md5" and has the right length, it's an MD5 hash, otherwise it's a plaintext password. The idiom has been to use isMD5() to check for that, but that gets awkward, when we add new kinds of verifiers, like the verifiers for SCRAM authentication in the pending SCRAM patch set. Replace isMD5() with a new get_password_type() function, so that when new verifier types are added, we don't need to remember to modify every place that currently calls isMD5(), to also recognize the new kinds of verifiers. Also, use the new plain_crypt_verify function in passwordcheck, so that it doesn't need to know about MD5, or in the future, about other kinds of hashes or password verifiers. Reviewed by Michael Paquier and Peter Eisentraut. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/2d07165c-1793-e243-a2a9-e45b624c7580@iki.fi">https://www.postgresql.org/message-id/2d07165c-1793-e243-a2a9-e45b624c7580@iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dbd69118c05d73969a1bd52ead6702c6e40b0fee">http://git.postgresql.org/pg/commitdiff/dbd69118c05d73969a1bd52ead6702c6e40b0fee</a></li>
<li>Silence compiler warning. Not all compilers understand that the elog(ERROR) never returns. David Rowley <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cb695ae993a38a0600a907154cfcc71285a9b9ef">http://git.postgresql.org/pg/commitdiff/cb695ae993a38a0600a907154cfcc71285a9b9ef</a></li>
<li>Add KOI8-U map files to Makefile. These were left out by mistake back when support for KOI8-U encoding was added. Extracted from Kyotaro Horiguchi's larger patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/53dd2da257fb5904b087b97dd9c2867390d309c1">http://git.postgresql.org/pg/commitdiff/53dd2da257fb5904b087b97dd9c2867390d309c1</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Update time zone data files to tzdata release 2016j. DST law changes in northern Cyprus (new zone Asia/Famagusta), Russia (new zone Europe/Saratov), Tonga, Antarctica/Casey. Historical corrections for Asia/Aqtau, Asia/Atyrau, Asia/Gaza, Asia/Hebron, Italy, Malta. Replace invented zone abbreviation "TOT" for Tonga with numeric UTC offset; but as in the past, we'll keep accepting "TOT" for input. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/308d8682740391cf6e94fdbadcdbbecfa02ea208">http://git.postgresql.org/pg/commitdiff/308d8682740391cf6e94fdbadcdbbecfa02ea208</a></li>
<li>Make psql reject attempts to set special variables to invalid values. Previously, if the user set a special variable such as ECHO to an unrecognized value, psql would bleat but store the new value anyway, and then fall back to a default setting for the behavior controlled by the variable. This was agreed to be a not particularly good idea. With this patch, invalid values result in an error message and no change in state. (But this applies only to variables that affect psql's behavior; purely informational variables such as ENCODING can still be set to random values.) To do this, modify the API for psql's assign-hook functions so that they can return an OK/not OK result, and give them the responsibility for printing error messages when they reject a value. Adjust the APIs for ParseVariableBool and ParseVariableNum to support the new behavior conveniently. In passing, document the variable VERSION, which had somehow escaped that. And improve the quite-inadequate commenting in psql/variables.c. Daniel V&Atilde;&copy;rit&Atilde;&copy;, reviewed by Rahila Syed, some further tweaking by me Discussion: <a target="_blank" href="https://postgr.es/m/7356e741-fa59-4146-a8eb-cf95fd6b21fb@mm">https://postgr.es/m/7356e741-fa59-4146-a8eb-cf95fd6b21fb@mm</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/511ae628f31b4e791cd5c7836e46cb84dcf145fd">http://git.postgresql.org/pg/commitdiff/511ae628f31b4e791cd5c7836e46cb84dcf145fd</a></li>
<li>Add a regression test script dedicated to exercising system views. Quite a few of our built-in system views were not exercised anywhere in the regression tests. This is perhaps not so exciting for the ones that are simple projections/joins of system catalogs, but for the ones that are wrappers for set-returning C functions, the omission translates directly to lack of test coverage for those functions. In many cases, the reason for the omission is that the view doesn't have much to do with any specific SQL feature, so there's no natural place to test it. To remedy that, invent a new script sysviews.sql that's dedicated to testing SRF-based views. Move a couple of tests that did fit this charter into the new script, and add simple "count(*)" based tests of other views within the charter. That's enough to ensure we at least exercise the main code path through the SRF, although it does little to prove that the output is sane. More could be done here, no doubt, and I hope someone will think about how we can test these views more thoroughly. But this is a starting point. Discussion: <a target="_blank" href="https://postgr.es/m/19359.1485723741@sss.pgh.pa.us">https://postgr.es/m/19359.1485723741@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d002f16c6ec38f76d1ee97367ba6af3000d441d0">http://git.postgresql.org/pg/commitdiff/d002f16c6ec38f76d1ee97367ba6af3000d441d0</a></li>
<li>Invent pg_hba_file_rules view to show the content of pg_hba.conf. This view is designed along the same lines as pg_file_settings, to wit it shows what is currently in the file, not what the postmaster has loaded as the active settings. That allows it to be used to pre-vet edits before issuing SIGHUP. As with the earlier view, go out of our way to allow errors in the file to be reflected in the view, to assist that use-case. (We might at some point invent a view to show the current active settings, but this is not that patch; and it's not trivial to do.) Haribabu Kommi, reviewed by Ashutosh Bapat, Michael Paquier, Simon Riggs, and myself Discussion: <a target="_blank" href="https://postgr.es/m/CAJrrPGerH4jiwpcXT1-46QXUDmNp2QDrG9+-Tek_xC8APHShYw@mail.gmail.com">https://postgr.es/m/CAJrrPGerH4jiwpcXT1-46QXUDmNp2QDrG9+-Tek_xC8APHShYw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/de16ab7238888b16825ad13f0bbe123632915e9b">http://git.postgresql.org/pg/commitdiff/de16ab7238888b16825ad13f0bbe123632915e9b</a></li>
<li>Simplify some long-obsolete code in hba.c's next_token(). next_token() oddly set its buffer space consumption limit to one before the last char position in the buffer, not the last as you'd expect. The reason is there was once an ugly kluge to mark keywords by appending a newline to them, potentially requiring one more byte. Commit e5e2fc842 removed that kluge, but failed to notice that the length limit could be increased. Also, remove some vestigial handling of newline characters in the buffer. That was left over from when this function read the file directly using getc(). Commit 7f49a67f9 changed it to read from a buffer, from which tokenize_file had already removed the only possible occurrence of newline, but did not simplify this function in consequence. Also, ensure that we don't return with *lineptr set to someplace past the terminating '\0'; that would be catastrophic if a caller were to ask for another token from the same line. This is just latent since no callers actually do call again after a "false" return; but considering that it was actually costing us extra code to do it wrong, we might as well make it bulletproof. Noted while reviewing pg_hba_file_rules patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e5a5d03da14ba9b734c6a2a1a822dcd8af110eb">http://git.postgresql.org/pg/commitdiff/1e5a5d03da14ba9b734c6a2a1a822dcd8af110eb</a></li>
<li>Make psql's \set display variables in alphabetical order. "\set" with no arguments displays all defined variables, but it does so in the order that they appear in variables.c's list, which previously was mostly creation order. That makes the list ugly and hard to find things in, and it exposes some psql implementation details to users. (For instance, ordinary variables will move to the bottom of the list if unset and set again, but variables that have hooks won't.) Fix that by keeping the list in alphabetical order at all times, which isn't much more complicated than breaking out of the insertion search loops once we reach an entry that should be after the one to be inserted. Discussion: <a target="_blank" href="https://postgr.es/m/31785.1485900786@sss.pgh.pa.us">https://postgr.es/m/31785.1485900786@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c3e3844a92fe42109e4106314f7d229f784a7d0a">http://git.postgresql.org/pg/commitdiff/c3e3844a92fe42109e4106314f7d229f784a7d0a</a></li>
<li>Improve psql's behavior for \set and \unset of its control variables. This commit improves on the results of commit 511ae628f in two ways: 1. It restores the historical behavior that "\set FOO" is interpreted as setting FOO to "on", if FOO is a boolean control variable. We already found one test script that was expecting that behavior, and the psql documentation certainly does nothing to discourage people from assuming that would work, since it often says just "if FOO is set" when describing the effects of a boolean variable. However, now this case will result in actually setting FOO to "on", not an empty string. 2. It arranges for an "\unset" of a control variable to set the value back to its default value, rather than becoming apparently undefined. The control variables are also initialized that way at psql startup. In combination, these things guarantee that a control variable always has a displayable value that reflects what psql is actually doing. That is a pretty substantial usability improvement. The implementation involves adding a second type of variable hook function that is able to replace a proposed new value (including NULL) with another one. We could alternatively have complicated the API of the assign hook, but this way seems better since many variables can share the same substitution hook function. Also document the actual behavior of these variables more fully, including covering assorted behaviors that were there before but never documented. This patch also includes some minor cleanup that should have been in 511ae628f but was missed. Patch by me, but it owes a lot to discussions with Daniel V&Atilde;&copy;rit&Atilde;&copy;. Discussion: <a target="_blank" href="https://postgr.es/m/9572.1485821620@sss.pgh.pa.us">https://postgr.es/m/9572.1485821620@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/86322dc7e013b4062393dcbb74043db003e23ec5">http://git.postgresql.org/pg/commitdiff/86322dc7e013b4062393dcbb74043db003e23ec5</a></li>
<li>Provide CatalogTupleDelete() as a wrapper around simple_heap_delete(). This extends the work done in commit 2f5c9d9c9 to provide a more nearly complete abstraction layer hiding the details of index updating for catalog changes. That commit only invented abstractions for catalog inserts and updates, leaving nearby code for catalog deletes still calling the heap-level routines directly. That seems rather ugly from here, and it does little to help if we ever want to shift to a storage system in which indexing work is needed at delete time. Hence, create a wrapper function CatalogTupleDelete(), and replace calls of simple_heap_delete() on catalog tuples with it. There are now very few direct calls of [simple_]heap_delete remaining in the tree. Discussion: <a target="_blank" href="https://postgr.es/m/462.1485902736@sss.pgh.pa.us">https://postgr.es/m/462.1485902736@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ab02896510e26e46b830c87eef2c03dd3c52c09e">http://git.postgresql.org/pg/commitdiff/ab02896510e26e46b830c87eef2c03dd3c52c09e</a></li>
<li>Fix CatalogTupleInsert/Update abstraction for case of shared indstate. Add CatalogTupleInsertWithInfo and CatalogTupleUpdateWithInfo to let callers use the CatalogTupleXXX abstraction layer even in cases where we want to share the results of CatalogOpenIndexes across multiple inserts/updates for efficiency. This finishes the job begun in commit 2f5c9d9c9, by allowing some remaining simple_heap_insert/update calls to be replaced. The abstraction layer is now complete enough that we don't have to export CatalogIndexInsert at all anymore. Also, this fixes several places in which 2f5c9d9c9 introduced performance regressions by using retail CatalogTupleInsert or CatalogTupleUpdate even though the previous coding had been able to amortize CatalogOpenIndexes work across multiple tuples. A possible future improvement is to arrange for the indexing.c functions to cache the CatalogIndexState somewhere, maybe in the relcache, in which case we could get rid of CatalogTupleInsertWithInfo and CatalogTupleUpdateWithInfo again. But that's a task for another day. Discussion: <a target="_blank" href="https://postgr.es/m/27502.1485981379@sss.pgh.pa.us">https://postgr.es/m/27502.1485981379@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aedd554f84bb3cedb32e6e2a954a70537a4da6b9">http://git.postgresql.org/pg/commitdiff/aedd554f84bb3cedb32e6e2a954a70537a4da6b9</a></li>
<li>Fix mishandling of tSRFs at different nesting levels. Given a targetlist like "srf(x), f(srf(x))", split_pathtarget_at_srfs() decided that it needed two levels of ProjectSet nodes, failing to notice that the two SRF calls are textually equal(). Because of that, setrefs.c would convert the upper ProjectSet's tlist to "Var1, f(Var1)" (where Var1 represents a reference to the srf(x) output of the lower ProjectSet). This triggered an assertion in nodeProjectSet.c complaining that it found no SRFs to evaluate, as reported by Erik Rijkers. What we want in such a case is to evaluate srf(x) only once and use a plain Result node to compute "Var1, f(Var1)"; that gives results similar to what previous versions produced, whereas allowing srf(x) to be evaluated again in an upper ProjectSet would square the number of rows emitted. Furthermore, even if the SRF calls aren't textually identical, we want them to be evaluated in lockstep, because that's what happened in the old implementation. But split_pathtarget_at_srfs() got this completely wrong, using two levels of ProjectSet for a case like "srf(x), f(srf(y))". Hence, rewrite split_pathtarget_at_srfs() from the ground up so that it groups SRFs according to the depth of nesting of SRFs in their arguments. This is pretty much how we envisioned that working originally, but I blew it when it came to implementation. In passing, optimize the case of target == input_target, which I noticed is not only possible but quite common. Discussion: <a target="_blank" href="https://postgr.es/m/dcbd2853c05d22088766553d60dc78c6@xs4all.nl">https://postgr.es/m/dcbd2853c05d22088766553d60dc78c6@xs4all.nl</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c82d4e658eff287846fe6243966d110ff4ae9025">http://git.postgresql.org/pg/commitdiff/c82d4e658eff287846fe6243966d110ff4ae9025</a></li>
<li>Fix placement of initPlans when forcibly materializing a subplan. If we forcibly place a Material node atop a finished subplan, we need to move any initPlans attached to the subplan up to the Material node, in order to keep SS_finalize_plan() happy. I'd figured this out in commit 7b67a0a49 for the case of materializing a cursor plan, but out of an abundance of caution, I put the initPlan movement hack at the call site for that case, rather than inside materialize_finished_plan(). That was the wrong thing, because it turns out to also be necessary for the only other caller of materialize_finished_plan(), ie subselect.c. We lacked any test cases that exposed the mistake, but bug#14524 from Wei Congrui shows that it's possible to get an initPlan reference into the top tlist in that case too, and then SS_finalize_plan() complains. Hence, move the hack into materialize_finished_plan(). In HEAD, also relocate some recently-added tests in subselect.sql, which I'd unthinkingly dropped into the middle of a sequence of related tests. Report: <a target="_blank" href="https://postgr.es/m/20170202060020.1400.89021@wrigleys.postgresql.org">https://postgr.es/m/20170202060020.1400.89021@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/555494d1bc119173bbf712940da823303644d4de">http://git.postgresql.org/pg/commitdiff/555494d1bc119173bbf712940da823303644d4de</a></li>
<li>Avoid improbable null pointer dereference in pgpassfileWarning(). Coverity complained that we might pass a null pointer to strcmp() if PQresultErrorField were to return NULL. That shouldn't be possible, since the server is supposed to always provide some SQLSTATE or other in an error message. But we usually defend against such hazards, and it only takes a little more code to do so here. There's no good reason to think this is a live bug, so no back-patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8ac0365c22f20dcd2a6b6752b95b665ada83e858">http://git.postgresql.org/pg/commitdiff/8ac0365c22f20dcd2a6b6752b95b665ada83e858</a></li>
<li>Clean up psql's behavior for a few more control variables. Modify FETCH_COUNT to always have a defined value, like other control variables, mainly so it will always appear in "\set" output. Add hooks to force HISTSIZE to be defined and require it to have an integer value. (I don't see any point in allowing it to be set to non-integral values.) Add hooks to force IGNOREEOF to be defined and require it to have an integer value. Unlike the other cases, here we're trying to be bug-compatible with a rather bogus externally-defined behavior, so I think we need to continue to allow "\set IGNOREEOF whatever". Fix it so that the substitution hook silently replace non-numeric values with "10", so that the stored value always reflects what we're really doing. Add a dummy assign hook for HISTFILE, just so it's always in variables.c's list. We can't require it to be defined always, because that would break the interaction with the PSQL_HISTORY environment variable, so there isn't any change in visible behavior here. Remove tab-complete.c's private list of known variable names, since that's really a maintenance nuisance. Given the preceding changes, there are no control variables it won't show anyway. This does mean that if for some reason you've unset one of the status variables (DBNAME, HOST, etc), that variable would not appear in tab completion for \set. But I think that's fine, for at least two reasons: we shouldn't be encouraging people to use those variables as regular variables, and if someone does do so anyway, why shouldn't it act just like a regular variable? Remove ugly and no-longer-used-anywhere GetVariableNum(). In general, future additions of integer-valued control variables should follow the paradigm of adding an assign hook using ParseVariableNum(), so there's no reason to expect we'd need this again later. Discussion: <a target="_blank" href="https://postgr.es/m/17516.1485973973@sss.pgh.pa.us">https://postgr.es/m/17516.1485973973@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fd6cd698031d3dbeccafde49a8b118cb840312aa">http://git.postgresql.org/pg/commitdiff/fd6cd698031d3dbeccafde49a8b118cb840312aa</a></li>
<li>Fix a bunch more portability bugs in commit 08bf6e529. It seems like somebody used a dartboard while choosing integer widths for the various values taken and returned by these functions ... and then threw a fresh set of darts while writing the SQL declarations. This patch brings the C code into line with what the SQL declarations say, which is enough to make it not dump core on the particular 32-bit machine I'm testing on. But I think we could do with another round of looking at what the datum widths *should* be. For instance, it's not all that sensible that hash_bitmap_info decided to use int64 to represent a BlockNumber input when get_raw_page doesn't do it that way. There's also a remaining problem that the expected outputs from the test script are platform-dependent, but I'll leave that issue for somebody else. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c6eeb67dcc3b3f7aa94335e18a1075863d808a7c">http://git.postgresql.org/pg/commitdiff/c6eeb67dcc3b3f7aa94335e18a1075863d808a7c</a></li>
<li>In pageinspect/hashfuncs.c, avoid crashes on alignment-picky machines. On machines with MAXALIGN = 8, the payload of a bytea is not maxaligned, since it will start 4 bytes into a palloc'd value. On alignment-picky hardware, this will cause failures in accesses to 8-byte-wide values within the page. We already encountered this problem when we introduced GIN index inspection functions, and fixed it in commit 84ad68d64. Make use of the same function for hash indexes. A small difficulty is that up to now contrib/pageinspect has not shared any functions at all across files. To support that, introduce a common header file "pageinspect.h" for the module. Also, move get_page_from_raw() out of ginfuncs.c, where it didn't especially belong, and put it in rawpage.c which seems a more natural home. Per buildfarm. Discussion: <a target="_blank" href="https://postgr.es/m/17311.1486134714@sss.pgh.pa.us">https://postgr.es/m/17311.1486134714@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/14e9b18fed289e483ed28daec60fdab95da9cc48">http://git.postgresql.org/pg/commitdiff/14e9b18fed289e483ed28daec60fdab95da9cc48</a></li>
<li>First-draft release notes for 9.6.2. As usual, the release notes for other branches will be made by cutting these down, but put them up for community review first. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9863017b87f3592ff663d03fc663a4f1f8fdb8b2">http://git.postgresql.org/pg/commitdiff/9863017b87f3592ff663d03fc663a4f1f8fdb8b2</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Additional test coverage for sequences. Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d711532b2eb70cf2f56d95efcc608d474266d769">http://git.postgresql.org/pg/commitdiff/d711532b2eb70cf2f56d95efcc608d474266d769</a></li>
<li>Fix sequence test in cs_CZ locale. Rename some objects so that sorted output becomes less locale-dependent. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/46aae5949f56580281a0f487c785c745d8856a04">http://git.postgresql.org/pg/commitdiff/46aae5949f56580281a0f487c785c745d8856a04</a></li>
<li>doc: Document result set of CREATE_REPLICATION_SLOT. From: Marko Tiikkaja &lt;marko@joh.to&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ecb814b5cef4971e50ee177eff320d416aa0b882">http://git.postgresql.org/pg/commitdiff/ecb814b5cef4971e50ee177eff320d416aa0b882</a></li>
<li>doc: Add missing include in example code. It's not broken because the header file is included via other headers, but for better style we should be more explicit. Reported-by: mthrockmorton@hme.com <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aa09b9dcd57cbf18516332bf8310c12ef6f83715">http://git.postgresql.org/pg/commitdiff/aa09b9dcd57cbf18516332bf8310c12ef6f83715</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Tweak catalog indexing abstraction for upcoming WARM. Split the existing CatalogUpdateIndexes into two different routines, CatalogTupleInsert and CatalogTupleUpdate, which do both the heap insert/update plus the index update. This removes over 300 lines of boilerplate code all over src/backend/catalog/ and src/backend/commands. The resulting code is much more pleasing to the eye. Also, by encapsulating what happens in detail during an UPDATE, this facilitates the upcoming WARM patch, which is going to add a few more lines to the update case making the boilerplate even more boring. The original CatalogUpdateIndexes is removed; there was only one use left, and since it's just three lines, we can as well expand it in place there. We could keep it, but WARM is going to break all the UPDATE out-of-core callsites anyway, so there seems to be no benefit in doing so. Author: Pavan Deolasee Discussion: <a target="_blank" href="https://www.postgr.es/m/CABOikdOcFYSZ4vA2gYfs=M2cdXzXX4qGHeEiW3fu9PCfkHLa2A@mail.gmail.com">https://www.postgr.es/m/CABOikdOcFYSZ4vA2gYfs=M2cdXzXX4qGHeEiW3fu9PCfkHLa2A@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2f5c9d9c9cec436e55847ec580606d7e88067df6">http://git.postgresql.org/pg/commitdiff/2f5c9d9c9cec436e55847ec580606d7e88067df6</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Move comment about test slightly closer to test. The addition of a TestForOldSnapshot() call here has made the referent of this comment slightly less clear, so move the comment to compensate. Amit Kapila (as part of the parallel index scan patch) <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8a815e3fc318b441a5e8a37e4129660d81e1e012">http://git.postgresql.org/pg/commitdiff/8a815e3fc318b441a5e8a37e4129660d81e1e012</a></li>
<li>Refactor other replication commands to use DestRemoteSimple. Commit a84069d9350400c860d5e932b50dfd337aa407b0 added a new type of DestReceiver to avoid duplicating the existing code for the SHOW command, but it turns out we can leverage that new DestReceiver type in a few more places, saving some code. Michael Paquier, reviewed by Andres Freund and by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAB7nPqSdFOQC0evc0r1nJeQyGBqjBrR41MC4rcMqUUpoJaZbtQ%40mail.gmail.com">http://postgr.es/m/CAB7nPqSdFOQC0evc0r1nJeQyGBqjBrR41MC4rcMqUUpoJaZbtQ%40mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/CAB7nPqT2K4XFT1JgqufFBjsOc-NUKXg5qBDucHPMbk6Xi1kYaA@mail.gmail.com">http://postgr.es/m/CAB7nPqT2K4XFT1JgqufFBjsOc-NUKXg5qBDucHPMbk6Xi1kYaA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bbd8550bce146f86e5e883f1232292a975c314fb">http://git.postgresql.org/pg/commitdiff/bbd8550bce146f86e5e883f1232292a975c314fb</a></li>
<li>Increase upper bound for bgwriter_lru_maxpages. There is no particularly good reason to limit this value to 1000, so increase the limit to INT_MAX / 2, the same limit we use for shared_buffers. It's not clear how much practical effect larger settings will have, but there seems no harm in letting people try it. Jim Nasby, less a comment change I stripped out. Discussion: <a target="_blank" href="http://postgr.es/m/f6e58a22-030b-eb8a-5457-f62fb08d701c@BlueTreble.com">http://postgr.es/m/f6e58a22-030b-eb8a-5457-f62fb08d701c@BlueTreble.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/14ca9abfbe4643408ad6ed3279f2f6366cafb3f1">http://git.postgresql.org/pg/commitdiff/14ca9abfbe4643408ad6ed3279f2f6366cafb3f1</a></li>
<li>pageinspect: Support hash indexes. Patch by Jesper Pedersen and Ashutosh Sharma, with some error handling improvements by me. Tests from Peter Eisentraut. Reviewed by &Atilde;lvaro Herrera, Michael Paquier, Jesper Pedersen, Jeff Janes, Peter Eisentraut, Amit Kapila, Mithun Cy, and me. Discussion: <a target="_blank" href="http://postgr.es/m/e2ac6c58-b93f-9dd9-f4e6-d6d30add7fdf@redhat.com">http://postgr.es/m/e2ac6c58-b93f-9dd9-f4e6-d6d30add7fdf@redhat.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/08bf6e529587e1e9075d013d859af2649c32a511">http://git.postgresql.org/pg/commitdiff/08bf6e529587e1e9075d013d859af2649c32a511</a></li>
<li>pageinspect: Try to fix some bugs in previous commit. Commit 08bf6e529587e1e9075d013d859af2649c32a511 seems not to have used the correct *GetDatum and PG_GETARG_* macros for the SQL types in some cases, and some of the SQL types seem to have been poorly chosen, too. Try to fix it. I'm not sure if this is the reason why the buildfarm is currently unhappy with this code, but it seems like a good place to start. Buildfarm unhappiness reported by Tom Lane. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ed807fda6d5102537daa5d725e716555cbc49f44">http://git.postgresql.org/pg/commitdiff/ed807fda6d5102537daa5d725e716555cbc49f44</a></li>
<li>pageinspect: Remove platform-dependent values from hash tests. Per a report from Tom Lane, the ffactor reported by hash_metapage_info and the free_size reported by hash_page_stats vary by platform. Ashutosh Sharma and Robert Haas <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/29e312bc1301061ae9f897ff39f3b230c421a5fb">http://git.postgresql.org/pg/commitdiff/29e312bc1301061ae9f897ff39f3b230c421a5fb</a></li>
<li>pgstattuple: Add pgstathashindex. Since pgstattuple v1.5 hasn't been released yet, no need for a new extension version. The new function exposes statistics about hash indexes similar to what other pgstatindex functions return for other index types. Ashutosh Sharma, reviewed by Kuntal Ghosh. Substantial further revisions by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e759854a09d49725a9519c48a0d71a32bab05a01">http://git.postgresql.org/pg/commitdiff/e759854a09d49725a9519c48a0d71a32bab05a01</a></li>
<li>pageinspect: More type-sanity surgery on the new hash index code. Uniformly expose unsigned quantities using the next-wider signed integer type (since we have no unsigned types at the SQL level). At the SQL level, this results a change to report itemoffset as int4 rather than int2. Also at the SQL level, report one value that is an OID as type oid. Under the hood, uniformly use macros that match the SQL output type as to both width and signedness. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/871ec0e33673ad9719760131b71a02ecbda82e12">http://git.postgresql.org/pg/commitdiff/871ec0e33673ad9719760131b71a02ecbda82e12</a></li>
<li>Improve grammar of message about two-phase state files. When there's only one two-phase state file, there's also only one long-running prepared transaction. Adjust the message text accordingly. Nikhil Sontakke Discussion: <a target="_blank" href="http://postgr.es/m/CAMGcDxcmR_DWZXXndGoPzVQx=B17A5=RviEA1qNaF=FWLy5Whw@mail.gmail.com">http://postgr.es/m/CAMGcDxcmR_DWZXXndGoPzVQx=B17A5=RviEA1qNaF=FWLy5Whw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/38c363adf497c0a05858dc00bc49ea42023bd572">http://git.postgresql.org/pg/commitdiff/38c363adf497c0a05858dc00bc49ea42023bd572</a></li>
<li>Remove redundant comment. Rafia Sabih <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6f4b4ceefa673dff6563d2d17e2039248f16fe1d">http://git.postgresql.org/pg/commitdiff/6f4b4ceefa673dff6563d2d17e2039248f16fe1d</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Don't count background workers against a user's connection limit. Doing so doesn't seem to be within the purpose of the per user connection limits, and has particularly unfortunate effects in conjunction with parallel queries. Backpatch to 9.6 where parallel queries were introduced. David Rowley, reviewed by Robert Haas and Albe Laurenz. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f1169ab501ce90e035a7c6489013a1d4c250ac92">http://git.postgresql.org/pg/commitdiff/f1169ab501ce90e035a7c6489013a1d4c250ac92</a></li>
</ul>
<p>Noah Misch pushed:</p>
<ul>
<li>Code review for avoidance of direct cross-module links. Remove $(pkglibdir) from $(rpathdir), since commits d51924be886c2a05e691fa05b16cb6b30ab8370f and eda04886c1e048d695728206504ab4198462168e removed direct linkage to objects stored there. Users are unlikely to notice the difference. Accompany every $(python_libspec) with $(python_additional_libs); this doesn't fix a demonstrated bug, but it might do so on rare Python configurations. With these changes, AIX ceases to be a special case. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/acd73ad1a17f7aed6a914dd9c331f1043d89988d">http://git.postgresql.org/pg/commitdiff/acd73ad1a17f7aed6a914dd9c331f1043d89988d</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Be sure to release LogicalRepLauncherLock in DROP SUBSCRIPTION command. Previously DROP SUBSCRIPTION command forgot to release the lock at all. Original patches by Kyotaro Horiguchi and Michael Paquier, but I didn't use them. Discussion: <a target="_blank" href="http://postgr.es/m/20170201.173623.66249355.horiguchi.kyotaro@lab.ntt.co.jp">http://postgr.es/m/20170201.173623.66249355.horiguchi.kyotaro@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/39b8cc991fe31ee8df8b0fee467bbd9800fcc1c5">http://git.postgresql.org/pg/commitdiff/39b8cc991fe31ee8df8b0fee467bbd9800fcc1c5</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Takayuki Tsunakawa sent in another revision of a patch to support huge pages on Windows.</p>
<p>Nikita Glukhov sent in three revisions of a patch to fix a bug in SP-GiST box_ops.</p>
<p>Kyotaro HORIGUCHI sent in two more revisions of a patch to implement character conversion with radix trees.</p>
<p>Alexander Korotkov sent in another revision of a patch to cacheline align PGXACT.</p>
<p>Nikita Glukhov sent in a patch to implement kNN searches for SP-GiST.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to allow interrupts on waiting standby.</p>
<p>Rushabh Lathia sent in a patch to extend the existing wait event infrastructure to implement the wait events for the disk I/O.</p>
<p>Etsuro Fujita sent in another revision of a patch to push down more full joins to the PostgreSQL FDW.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two more revisions of a patch to refactor replication commands using printsimple.</p>
<p>David Rowley sent in two more revisions of a patch to for improve performance for outer joins where outer side is unique.</p>
<p>Daisuke Higuchi and Ashutosh Bapat traded patches to fix a bug where PQgetResult is not called until PQgetResult has returned a null pointer.</p>
<p>Heikki Linnakangas sent in two more revisions of a patch to fix an issue which produced a deadlock in XLogInsert on AIX.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to implement asynchronous execution.</p>
<p>Tomas Vondra sent in another revision of a patch to implement multivariate statistics.</p>
<p>Amit Kapila sent in two more revisions of a patch to implement parallel index scans.</p>
<p>Claudio Freire sent in two more revisions of a patch to enable VACUUM to use more than 1GB of work_mem.</p>
<p>Pavan Deolasee, &Atilde;lvaro Herrera, and Tom Lane traded patches to fix an issue where CREATE INDEX CONCURRENTLY could cause index corruption.</p>
<p>Amit Kapila sent in another revision of a patch to parallelize queries containing initplans.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to implement xmltable().</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to forbid newline and carriage return characters in database and role names, and ensure clean-up of data directory even with restricted path applied.</p>
<p>Haribabu Kommi sent in another revision of a patch to add a macaddr 64 bit (EUI-64) datatype.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement a set of SEQUENCE data types.</p>
<p>Pavan Deolasee sent in three more revisions of a patch to implement WARM.</p>
<p>Kyotaro HORIGUCHI sent in two more revisions of a patch to fix a bug in physical replication slots.</p>
<p>Kyotaro HORIGUCHI sent in two more revisions of a patch to enable logical replication between databases with different encodings.</p>
<p>Dilip Kumar sent in two more revisions of a patch to implement parallel bitmap heap scan.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to enable PL/pgsql to force a custom or generic plan.</p>
<p>Anastasia Lubennikova sent in a patch to allow casting from the appropriate jsonb objects to numeric, int, float, bool.</p>
<p>Dagfinn Ilmari Manns&Atilde;&yen;ker sent in two revisions of a patch to add tab completion for DEALLOCATE.</p>
<p>Rushabh Lathia sent in two more revisions of a patch to implement Gather Merge.</p>
<p>Nikhil Sontakke sent in two more revisions of a patch to speed up two-phase transactions.</p>
<p>David Rowley sent in a patch to fix a compiler warning in dbd69118.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two revisions of a patch to provide list of subscriptions and publications in psql's completion.</p>
<p>Corey Huinker sent in three more revisions of a patch to add \if and friends to psql.</p>
<p>Peter Moser sent in another revision of a patch to add temporal query primitives.</p>
<p>Alexey Bashtanov sent in a patch to optimize the query used to produce information_schema.constraint_column_usage.</p>
<p>Simon Riggs sent in a patch to introduce the concept of a "superowner".</p>
<p>Andres Freund sent in a patch to implement a basic lockless single producer, multiple consumer ringbuffer, and a rewrite of the bgwriter to use same.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to refactor tab completion in psql and use same to add some tab completion features.</p>
<p>Amit Langote sent in a patch to improve the documentation about partitioned tables.</p>
<p>Andreas Karlsson sent in a patch to add psql tab completion for \help DROP|ALTER.</p>
<p>Alexander Korotkov sent in a patch to implement low-level locking on PowerPC in assembly.</p>
<p>Boris Muratshin sent in a patch to implement 3D Z-curve spatial indexes.</p>
<p>Fabien COELHO sent in another revision of a patch to add more operators and functions to pgbench.</p>
<p>Alexander Korotkov sent in a patch to re-add strategy to PinBuffer.</p>
<p>Masahiko Sawada sent in a patch to fix a typo in a variable name in launcher.c.</p>
<p>Noah Misch sent in a patch to ignore tablespace ACLs when ignoring schema ACLs.</p>
<p>Brandur Leach sent in another revision of a patch to implement SortSupport for macaddr data type.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/02/09/Nouvelles-hebdomadaires-de-PostgreSQL-5-f%C3%A9vrier-2017">par chl le jeudi  9 février 2017 à 00h34</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi  7 février 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.ng.pe/" title="postgresql - Nicolas GOLLET">Nicolas Gollet</a></h3>


<div class="entrygroup" id="http://blog.ng.pe/tag/postgresql/rss/77a72f35-bffd-4567-8e13-226d1fba1358">
<h4><a href="http://blog.ng.pe/backends-generant-des-fichiers-temporaires/">Backends générant des fichiers temporaires</a></h4>
<div class="entry">
<div class="content">
<p>Dans certain cas il est peut être utile d'obtenir en temps réel la liste des backends générant des fichiers temporaire sur disque.</p>

<p>Lors de certaines opérations (trie, hachages...), PostgreSQL écrit dans des fichiers temporaires. Ces fichiers sont placés dans le sous-répertoire <em>pgsql_tmp</em> et sont nommés de la façon suivante : <br />
<strong>pgsql_tmpXXXX.Y</strong> où <strong>XXXX</strong> correspond au PID du processus qui a créé le fichier et <strong>Y</strong> au numéro de fichier créé. Par exemple voici deux fichiers temporaires : <em>pgsql_tmp90630.8</em> et <em>pgsql_tmp90630.9</em>.
Lorsque vous utilisez des <em>tablespaces</em> ces fichiers temporaires sont stockés dans l'emplacement disque définit par ceux-ci ceux qui rajoute une complexité supplémentaire pour récupéré ces fichiers.</p>

<p>Une fois le <em>PID</em> identifié, vous pouvez obtenir les informations depuis la vue <em>pg_stat_activity</em> afin d'obtenir les informations sur le backend générant des fichiers temporaires : <br />
<code>select * from pg_stat_activity where pid = &lt;PID&gt;;</code></p>

<p>Afin de simplifier la récupération de ces informations vous pouvez obtenir ces informations de façon automatique en utilisant la requête SQL ci-dessous :</p>



<p>Cette requête adaptée du projet <a href="https://github.com/gleu/pgstats/">pgstats</a> permet d'obtenir l'ensemble des requêtes en cours d’exécution générant des fichiers temporaires tout en prenant en compte les éventuelles <em>tablespace</em>.</p>

<p>Vous pouvez aussi utiliser le script bash <a href="https://github.com/ng-pe/pgsql-scripts/blob/master/psql_show_tempfiles.bash">psql_show_tempfiles.bash</a> présent sur mon Gitub. </p>

<p><img src="http://blog.ng.pe/content/images/2017/02/demo_script.gif" alt="" /></p></div>







<p class="date">
<a href="http://blog.ng.pe/backends-generant-des-fichiers-temporaires/">par Nicolas GOLLET le mardi  7 février 2017 à 15h44</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>dimanche  5 février 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.taadeem.net/" title="- PGFR">Damien Clochard</a></h3>
<img class="face" src="images/damien.jpg" width="80" height="80" alt="">


<div class="entrygroup" id="http://blog.taadeem.net///french/2017/02/05/PostgreSQL_Temboard_Guide_de_demarrage">
<h4><a href="http://blog.taadeem.net///french/2017/02/05/PostgreSQL_Temboard_Guide_de_demarrage">PostgreSQL Temboard : Guide de Démarrage</a></h4>
<div class="entry">
<div class="content">
<p>Le prochain défi pour la communauté PostgreSQL est de produire des outils graphiques riches et bien conçus.
C’est un domain dans lequel nous avons une grande marge de progression et 
<a href="https://github.com/dalibo/temboard">Temboard</a> est un des projets (parmi d’autres) qui a l’ambition de 
devenir un outil graphique pour PostgreSQL.</p>

<!-- More -->

<p><img src="http://temboard.readthedocs.io/en/latest/temboard.png" alt="Temboard : PostgreSQL Remote Control" /></p>

<p>Puisque que nous parlons d’un outil graphique, allons directement jetez un coup d’oeuil ! 
Voici 3 étapes pour déployer un environement de test composé de 3 instances Postgres et un serveur central Temboard.</p>

<p>1- <a href="https://docs.docker.com/engine/installation/">Installer docker</a> 
   et <a href="https://docs.docker.com/compose/install/">Installer docker-compose</a></p>

<p>2- Récuperer fichier <code class="highlighter-rouge">docker compose</code> pré-configuré et le lancer</p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget https://raw.githubusercontent.com/dalibo/docker/master/temboard/docker-compose.yml
docker-compose up
</code></pre>
</div>

<p>3- Aller sur <a href="https://127.0.0.1:8888">https://127.0.0.1:8888</a></p>

<ul>
  <li>Connectez-vous sur le serveur Temboard avec les codes <code class="highlighter-rouge">admin / admin</code></li>
  <li>Connectez-vous sur chaque instance Postgres avec <code class="highlighter-rouge">alice / alice</code></li>
</ul>

<p>Vous devriez voir apparaitre quelque chose comme ça :</p>

<p><img src="https://github.com/dalibo/temboard/raw/master/doc/demo_dashboard.gif" alt="Temboard PostgreSQL Dashboard" /></p>

<p>C’est tout pour aujourd’hui ! Je ferai un autre article prochainement pour présenter les fonctionnalités de Temboard 
notamment le tableau de bord, la versionnement des fichiers <code class="highlighter-rouge">postgresql.conf</code>, comment tuer une transaction, etc.</p>

<p>En attendant si vous prenez le temps de tester cet outil, envoyez nous un message à 
<a href="mailto:contact@dalibo.com">contact@dalibo.com</a> et dites-nous ce que vous en pensez, quelle fonctionnalités vous manquent !</p>

<p>Temboard est encore un projet très jeune et nous avons prévu d’ajouter plus de plugins dans les mois à venir !</p></div>







<p class="date">
<a href="http://blog.taadeem.net///french/2017/02/05/PostgreSQL_Temboard_Guide_de_demarrage">par Damien Clochard le dimanche  5 février 2017 à 10h17</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi  2 février 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:7dcfdee762b3434c15f1bd4cb22747c3" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/02/02/Nouvelles-hebdomadaires-de-PostgreSQL-29-janvier-2017">Nouvelles hebdomadaires de PostgreSQL - 29 janvier 2017</a></h4>
<div class="entry">
<div class="content">
<p>Vous pouvez b&eacute;n&eacute;ficier de 50% de remise pour le SCALE 15x avec le code PGDAY&nbsp;: <a target="_blank" href="https://www.socallinuxexpo.org/scale/15x">https://www.socallinuxexpo.org/scale/15x</a></p>
<p>[ndt: Meetup &agrave; Lyon le 21 février&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pgFormatter 1.6, un outil de formatage/coloration syntaxique pour le code SQL&nbsp;: <a target="_blank" href="http://sqlformat.darold.net/">http://sqlformat.darold.net/</a></li>
<li>Les paquets RPM et les Dockerfiles pour PostgreSQL 10 sont disponibles&nbsp;: <a target="_blank" href="https://yum.postgresql.org/news10snapshot-ready-for-testing.php">https://yum.postgresql.org/news10snapshot-ready-for-testing.php</a> <a target="_blank" href="https://git.postgresql.org/gitweb/?p=pgrpms.git;a=blob;f=docker/README">https://git.postgresql.org/gitweb/?p=pgrpms.git;a=blob;f=docker/README</a></li>
<li>pgBadger v9.1, un analyseur de log PostgreSQL et un g&eacute;n&eacute;rateur de graphe en Perl&nbsp;: <a target="_blank" href="https://github.com/dalibo/pgbadger/releases/">https://github.com/dalibo/pgbadger/releases/</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en janvier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-01/">http://archives.postgresql.org/pgsql-jobs/2017-01/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170129225258.GC17445@fetter.org">http://www.postgresql.org/message-id/20170129225258.GC17445@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/56549129079465a9d25fd6e5abc1439363922b7c">http://git.postgresql.org/pg/commitdiff/56549129079465a9d25fd6e5abc1439363922b7c</a></li>
<li>pg_dump: Fix minor memory leak. Missing a destroyPQExpBuffer() in the early exit branch. The early exits aren't really necessary. Most similar functions just proceed running the rest of the code zero times and clean up at the end. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/366d2a3d8808ad92436a830c32e73ce17affe5b6">http://git.postgresql.org/pg/commitdiff/366d2a3d8808ad92436a830c32e73ce17affe5b6</a></li>
<li>Fix memory leaks in libpqwalreceiver. The results of the libpq functions PQescapeIdentifier() and PQescapeLiteral() must be freed explicitly. Also handle errors in these functions better. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/16a61884b5956778cae64a5746f4cdd9ae1ae01b">http://git.postgresql.org/pg/commitdiff/16a61884b5956778cae64a5746f4cdd9ae1ae01b</a></li>
<li>Fix pointer confusion. get_object_address_publication_rel() needed to check *relation, not relation. Rename the variables to match style used nearby to avoid the confusion. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6cffe54aef0a02a52692e32125eb3a5e135e7359">http://git.postgresql.org/pg/commitdiff/6cffe54aef0a02a52692e32125eb3a5e135e7359</a></li>
<li>Fix NULL pointer access in logical replication workers. From: Petr Jelinek &lt;pjmodos@pjmodos.net&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/70c56a014e1813b5ab0f91581833bc7cb6c02958">http://git.postgresql.org/pg/commitdiff/70c56a014e1813b5ab0f91581833bc7cb6c02958</a></li>
<li>Don't error when no system locales were found. initdb used to warn about that, but it was changed to an error in pg_import_system_locales, but some build farm members failed because of that. Change it back to a warning. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/46d482814cd4a9c474540a9c4f040ce1cd514f46">http://git.postgresql.org/pg/commitdiff/46d482814cd4a9c474540a9c4f040ce1cd514f46</a></li>
<li>Fix default minimum value for descending sequences. For some reason that is lost in history, a descending sequence would default its minimum value to -2^63+1 (-PG_INT64_MAX) instead of -2^63 (PG_INT64_MIN), even though explicitly specifying a minimum value of -2^63 would work. Fix this inconsistency by using the full range by default. Reported-by: Daniel Verite &lt;daniel@manitou-mail.org&gt; Reviewed-by: Michael Paquier &lt;michael.paquier@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0bc1207aeb3de951bf95a9e9899b1256216d65f5">http://git.postgresql.org/pg/commitdiff/0bc1207aeb3de951bf95a9e9899b1256216d65f5</a></li>
<li>Fix parallel make issue with new fmgrprotos.h. The make rules needed further refinement so that we don't run multiple generations per build. reported by Tom Lane <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1a2d9a655a5de1c8c9d479c77d6351b878094606">http://git.postgresql.org/pg/commitdiff/1a2d9a655a5de1c8c9d479c77d6351b878094606</a></li>
<li>pg_dump: Fix some schema issues when dumping sequences. In the new code for selecting sequence data from pg_sequence, set the schema to pg_catalog instead of the sequences own schema, and refer to the sequence by OID instead of name, which was missing a schema qualification. Reported-by: Stephen Frost &lt;sfrost@snowman.net&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/da4d1c0c15ab9afdfeee8bad9a1a9989b6bd59b5">http://git.postgresql.org/pg/commitdiff/da4d1c0c15ab9afdfeee8bad9a1a9989b6bd59b5</a></li>
<li>doc: Update ALTER SEQUENCE documentation to match. Update documentation to match change in 0bc1207aeb3de951bf95a9e9899b1256216d65f5. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/123f03ba2c6e2d85a5a900e79dd5f216bfb37e25">http://git.postgresql.org/pg/commitdiff/123f03ba2c6e2d85a5a900e79dd5f216bfb37e25</a></li>
<li>doc: Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/87ecf2d14fa236e894267ef5e702ff08b8965f9d">http://git.postgresql.org/pg/commitdiff/87ecf2d14fa236e894267ef5e702ff08b8965f9d</a></li>
<li>Close replication connection when slot creation errors. From: Petr Jelinek &lt;pjmodos@pjmodos.net&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/65df150a18d4a24e6870eb4a3db28ac8a6c23603">http://git.postgresql.org/pg/commitdiff/65df150a18d4a24e6870eb4a3db28ac8a6c23603</a></li>
<li>Update copyright years in some recently added files. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3d9e73ea5f5bb280be438a81fbe91936f4ff0601">http://git.postgresql.org/pg/commitdiff/3d9e73ea5f5bb280be438a81fbe91936f4ff0601</a></li>
<li>doc: Logical replication documentation improvements. From: Erik Rijkers &lt;er@xs4all.nl&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/98cc5db27c97cccd19c4e67e8e623f2d260a5c35">http://git.postgresql.org/pg/commitdiff/98cc5db27c97cccd19c4e67e8e623f2d260a5c35</a></li>
<li>doc: Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/049ac809a790a9bde478e371da2b68d6b18c5df7">http://git.postgresql.org/pg/commitdiff/049ac809a790a9bde478e371da2b68d6b18c5df7</a></li>
<li>Fix typo: pg_statistics -&gt; pg_statistic. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5a366b4ff4ceceb9793fcc13c3f097ee0d32c56d">http://git.postgresql.org/pg/commitdiff/5a366b4ff4ceceb9793fcc13c3f097ee0d32c56d</a></li>
<li>Add object_address tests for publications and subscriptions. Add test cases to object_address.sql to test the new logical replication related object classes, and fix some small bugs discovered by that. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2a2bdcab2c5c6081a8f53fce8741bc0717b7d2d0">http://git.postgresql.org/pg/commitdiff/2a2bdcab2c5c6081a8f53fce8741bc0717b7d2d0</a></li>
<li>Simplify sequence test. We maintained two separate expected files because log_cnt could be one of two values. Rewrite the test so that we only need one file. Reviewed-by: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9c18104c7448a0cdaa46aed1b9504439879f327e">http://git.postgresql.org/pg/commitdiff/9c18104c7448a0cdaa46aed1b9504439879f327e</a></li>
<li>doc: Update privileges documentation. The CREATE privilege on databases now also enables creating publications. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cdcad6b788a8651af2e48bf7d4160ae591e1f4d7">http://git.postgresql.org/pg/commitdiff/cdcad6b788a8651af2e48bf7d4160ae591e1f4d7</a></li>
<li>Fill in no_priv_msg for publications and subscriptions. Even though these messages are not used yet, we should keep the list complete. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e630faacd8a0c998db105a7d3fca063eb29b0eea">http://git.postgresql.org/pg/commitdiff/e630faacd8a0c998db105a7d3fca063eb29b0eea</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Volatile-ize some plperl variables that must survive into PG_CATCH blocks. This appears to be necessary to fix a failure seen on buildfarm member sittella. It shouldn't be necessary according to the letter of the C standard, because we don't change the values of these variables within the PG_TRY blocks; but somehow gcc 4.7.2 is dropping the ball. Discussion: <a target="_blank" href="https://postgr.es/m/17555.1485179975@sss.pgh.pa.us">https://postgr.es/m/17555.1485179975@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c0ef456b9714215cae0ce3561c7c83629a7301cf">http://git.postgresql.org/pg/commitdiff/c0ef456b9714215cae0ce3561c7c83629a7301cf</a></li>
<li>Fix example plan in optimizer/README. Joining three tables only takes two join nodes. I think when I (tgl) wrote this, I was envisioning possible additional joins; but since the example doesn't show any fourth table, it's just confusing to write a third join node. Etsuro Fujita Discussion: <a target="_blank" href="https://postgr.es/m/e6cfbaa3-af02-1abc-c25e-8fa5c6bc4e21@lab.ntt.co.jp">https://postgr.es/m/e6cfbaa3-af02-1abc-c25e-8fa5c6bc4e21@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3c821466abcdb8120ab0dfbce02f3bbae3b62025">http://git.postgresql.org/pg/commitdiff/3c821466abcdb8120ab0dfbce02f3bbae3b62025</a></li>
<li>Allow password file name to be specified as a libpq connection parameter. Formerly an alternate password file could only be selected via the environment variable PGPASSFILE; now it can also be selected via a new connection parameter "passfile", corresponding to the conventions for most other connection parameters. There was some concern about this creating a security weakness, but it was agreed that that argument was pretty thin, and there are clear use-cases for handling password files this way. Julian Markwort, reviewed by Fabien Coelho, some adjustments by me Discussion: <a target="_blank" href="https://postgr.es/m/a4b4f4f1-7b58-a0e8-5268-5f7db8e8ccaa@uni-muenster.de">https://postgr.es/m/a4b4f4f1-7b58-a0e8-5268-5f7db8e8ccaa@uni-muenster.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ba005f193d88a8404e81db3df223cf689d64d75e">http://git.postgresql.org/pg/commitdiff/ba005f193d88a8404e81db3df223cf689d64d75e</a></li>
<li>Use non-conflicting table names in new regression test case. Commit 587cda35c added a test to updatable_views.sql that created tables named the same as tables used by the concurrent inherit.sql script. Unsurprisingly, this results in random failures. Pick different names. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7fa7bf18e493e130147e62cf7dc33010f164126c">http://git.postgresql.org/pg/commitdiff/7fa7bf18e493e130147e62cf7dc33010f164126c</a></li>
<li>Improve speed of contrib/postgres_fdw regression tests. Commit 7012b132d added some tests that consumed an excessive amount of time, more than tripling the time needed for "make installcheck" for this module. Add filter conditions to reduce the number of rows scanned, bringing the runtime down to within hailing distance of what it was before. Jeevan Chalke and Ashutosh Bapat, per a gripe from me Discussion: <a target="_blank" href="https://postgr.es/m/16565.1478104765@sss.pgh.pa.us">https://postgr.es/m/16565.1478104765@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aa7f593b1ffa9717bd5570174944c06c482d1c1f">http://git.postgresql.org/pg/commitdiff/aa7f593b1ffa9717bd5570174944c06c482d1c1f</a></li>
<li>Change unknown-type literals to type text in SELECT and RETURNING lists. Previously, we left such literals alone if the query or subquery had no properties forcing a type decision to be made (such as an ORDER BY or DISTINCT clause using that output column). This meant that "unknown" could be an exposed output column type, which has never been a great idea because it could result in strange failures later on. For example, an outer query that tried to do any operations on an unknown-type subquery output would generally fail with some weird error like "failed to find conversion function from unknown to text" or "could not determine which collation to use for string comparison". Also, if the case occurred in a CREATE VIEW's query then the view would have an unknown-type column, causing similar failures in queries trying to use the view. To fix, at the tail end of parse analysis of a query, forcibly convert any remaining "unknown" literals in its SELECT or RETURNING list to type text. However, provide a switch to suppress that, and use it in the cases of SELECT inside a set operation or INSERT command. In those cases we already had type resolution rules that make use of context information from outside the subquery proper, and we don't want to change that behavior. Also, change creation of an unknown-type column in a relation from a warning to a hard error. The error should be unreachable now in CREATE VIEW or CREATE MATVIEW, but it's still possible to explicitly say "unknown" in CREATE TABLE or CREATE (composite) TYPE. We want to forbid that because it's nothing but a foot-gun. This change creates a pg_upgrade failure case: a matview that contains an unknown-type column can't be pg_upgraded, because reparsing the matview's defining query will now decide that the column is of type text, which doesn't match the cstring-like storage that the old materialized column would actually have. Add a checking pass to detect that. While at it, we can detect tables or composite types that would fail, essentially for free. Those would fail safely anyway later on, but we might as well fail earlier. This patch is by me, but it owes something to previous investigations by Rahila Syed. Also thanks to Ashutosh Bapat and Michael Paquier for review. Discussion: <a target="_blank" href="https://postgr.es/m/CAH2L28uwwbL9HUM-WR=hromW1Cvamkn7O-g8fPY2m=_7muJ0oA@mail.gmail.com">https://postgr.es/m/CAH2L28uwwbL9HUM-WR=hromW1Cvamkn7O-g8fPY2m=_7muJ0oA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e7c4bb0049732ece651d993d03bb6772e5d281a">http://git.postgresql.org/pg/commitdiff/1e7c4bb0049732ece651d993d03bb6772e5d281a</a></li>
<li>Make UNKNOWN into an actual pseudo-type. Previously, type "unknown" was labeled as a base type in pg_type, which perhaps had some sense to it because you were allowed to create tables with unknown-type columns. But now that we don't allow that, it makes more sense to label it a pseudo-type. This has the additional effects of forbidding use of "unknown" as a domain base type, cast source or target type, PL function argument or result type, or plpgsql local variable type; all of which seem like good holes to plug. Discussion: <a target="_blank" href="https://postgr.es/m/CAH2L28uwwbL9HUM-WR=hromW1Cvamkn7O-g8fPY2m=_7muJ0oA@mail.gmail.com">https://postgr.es/m/CAH2L28uwwbL9HUM-WR=hromW1Cvamkn7O-g8fPY2m=_7muJ0oA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d8d32d9a56a3cecfb14e8f47ebd50b780edffe60">http://git.postgresql.org/pg/commitdiff/d8d32d9a56a3cecfb14e8f47ebd50b780edffe60</a></li>
<li>Remove vestigial resolveUnknown arguments from transformSortClause etc. There's really no situation where we don't want these unknown-to-text conversions to happen. The alternative is failure anyway, and the one caller that was passing "false" did so only because it expected the case could not arise. Might as well simplify the code. Discussion: <a target="_blank" href="https://postgr.es/m/CAH2L28uwwbL9HUM-WR=hromW1Cvamkn7O-g8fPY2m=_7muJ0oA@mail.gmail.com">https://postgr.es/m/CAH2L28uwwbL9HUM-WR=hromW1Cvamkn7O-g8fPY2m=_7muJ0oA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aebeb4790c750dc808c1c5afb3cb435116244e36">http://git.postgresql.org/pg/commitdiff/aebeb4790c750dc808c1c5afb3cb435116244e36</a></li>
<li>Introduce convenience macros to hide JsonbContainer header accesses better. This improves readability a bit and may make future improvements easier. In passing, make sure that the JB_ROOT_IS_XXX macros deliver boolean (0/1) results; the previous coding was a bug hazard, though no actual bugs are known. Nikita Glukhov, extended a bit by me Discussion: <a target="_blank" href="https://postgr.es/m/9e21a39c-c1d7-b9b5-44a0-c5345a5029f6@postgrespro.ru">https://postgr.es/m/9e21a39c-c1d7-b9b5-44a0-c5345a5029f6@postgrespro.ru</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f7c62462402972b13d10e43f104ca0c0fecb6d08">http://git.postgresql.org/pg/commitdiff/f7c62462402972b13d10e43f104ca0c0fecb6d08</a></li>
<li>Ensure that a tsquery like '!foo' matches empty tsvectors. !foo means "the tsvector does not contain foo", and therefore it should match an empty tsvector. ts_match_vq() overenthusiastically supposed that an empty tsvector could never match any query, so it forcibly returned FALSE, the wrong answer. Remove the premature optimization. Our behavior on this point was inconsistent, because while seqscans and GIST index searches both failed to match empty tsvectors, GIN index searches would find them, since GIN scans don't rely on ts_match_vq(). That makes this certainly a bug, not a debatable definition disagreement, so back-patch to all supported branches. Report and diagnosis by Tom Dunstan (bug #14515); added test cases by me. Discussion: <a target="_blank" href="https://postgr.es/m/20170126025524.1434.97828@wrigleys.postgresql.org">https://postgr.es/m/20170126025524.1434.97828@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9d4ca01314ba0c571139c5560a40ef764ad0feee">http://git.postgresql.org/pg/commitdiff/9d4ca01314ba0c571139c5560a40ef764ad0feee</a></li>
<li>Use castNode() in a bunch of statement-list-related code. When I wrote commit ab1f0c822, I really missed the castNode() macro that Peter E. had proposed shortly before. This back-fills the uses I would have put it to. It's probably not all that significant, but there are more assertions here than there were before, and conceivably they will help catch any bugs associated with those representation changes. I left behind a number of usages like "(Query *) copyObject(query_var)". Those could have been converted as well, but Peter has proposed another notational improvement that would handle copyObject cases automatically, so I let that be for now. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7afd56c3c6d8360a5bfdfb2de30038b239fd756b">http://git.postgresql.org/pg/commitdiff/7afd56c3c6d8360a5bfdfb2de30038b239fd756b</a></li>
<li>Orthography fixes for new castNode() macro. Clean up hastily-composed comment. Normalize whitespace. Erik Rijkers and myself <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fefb86b14776321ac153836398eadde867ff31af">http://git.postgresql.org/pg/commitdiff/fefb86b14776321ac153836398eadde867ff31af</a></li>
<li>Improve comments about ProcessUtility's queryString parameter. Per discussion with Craig Ringer. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fde5c037925b01b937923606c39460d94965672e">http://git.postgresql.org/pg/commitdiff/fde5c037925b01b937923606c39460d94965672e</a></li>
<li>Restructure hba.c to replace 3 parallel lists with single list of structs. tokenize_file() now returns a single list of TokenizedLine structs, carrying the same information as before. We were otherwise going to grow a fourth list to deal with error messages, and that was getting a bit silly. Haribabu Kommi, revised a bit by me Discussion: <a target="_blank" href="https://postgr.es/m/CAJrrPGfbgbKsjYp=bgZXhMcgxoaGSoBb9fyjrDoOW_YymXv1Kw@mail.gmail.com">https://postgr.es/m/CAJrrPGfbgbKsjYp=bgZXhMcgxoaGSoBb9fyjrDoOW_YymXv1Kw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/350cb921ae2ced8674e098d0645f2493e5757ad1">http://git.postgresql.org/pg/commitdiff/350cb921ae2ced8674e098d0645f2493e5757ad1</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Prefetch blocks during lazy vacuum's truncation scan. Vacuum truncation scan can be sped up on rotating media by prefetching blocks in forward direction. That makes the blocks already present in memory by the time they are needed, while also letting OS read-ahead kick in. The truncate scan has been measured to be five times faster than without this patch (that was on a slow disk, but it shouldn't hurt on fast disks.) Author: &Atilde;lvaro Herrera, loosely based on a submission by Claudio Freire Discussion: <a target="_blank" href="https://postgr.es/m/CAGTBQpa6NFGO_6g_y_7zQx8L9GcHDSQKYdo1tGuh791z6PYgEg@mail.gmail.com">https://postgr.es/m/CAGTBQpa6NFGO_6g_y_7zQx8L9GcHDSQKYdo1tGuh791z6PYgEg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7e26e02eec90370dd222f35f00042f8188488ac4">http://git.postgresql.org/pg/commitdiff/7e26e02eec90370dd222f35f00042f8188488ac4</a></li>
<li>Remove test for COMMENT ON DATABASE. Our current DDL only allows a database name to be specified in COMMENT ON DATABASE, which Andrew Dunstan reports to make this test fail on the buildfarm. Remove the line until we gain a DDL command that allows the current database to be operated on without having the specify it by name. Backpatch to 9.5, where these tests appeared. Discussion: <a target="_blank" href="https://postgr.es/m/e6084b89-07a7-7e57-51ee-d7b8fc9ec864@2ndQuadrant.com">https://postgr.es/m/e6084b89-07a7-7e57-51ee-d7b8fc9ec864@2ndQuadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/331f8c311b7ba4b24158071ab2fb2e07bb8377b0">http://git.postgresql.org/pg/commitdiff/331f8c311b7ba4b24158071ab2fb2e07bb8377b0</a></li>
</ul>
<p>Tatsuo Ishii pushed:</p>
<ul>
<li>Fix comments in StrategyNotifyBgWriter(). The interface for the function was changed in d72731a70450b5e7084991b9caa15cb58a2820df but the comments of the function was not updated. Patch by Yugo Nagata. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/73293ebae2e48782804029211622d16ed39952ae">http://git.postgresql.org/pg/commitdiff/73293ebae2e48782804029211622d16ed39952ae</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Be sure to release the lock on failure to launch logical replication worker. Petr Jelinek <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dc82f5a6406dfef21ae1668b1c69a32c8a68c670">http://git.postgresql.org/pg/commitdiff/dc82f5a6406dfef21ae1668b1c69a32c8a68c670</a></li>
<li>Mention logical replication tests in src/test/README. Craig Ringer <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3eaf03b5d331b7a06d79e5ad2be7e36c4a9c3d72">http://git.postgresql.org/pg/commitdiff/3eaf03b5d331b7a06d79e5ad2be7e36c4a9c3d72</a></li>
<li>Fix typo in description for pg_replication_origin_advance function. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bdadf36eb40e88f93a9daf20ecd005595ebec1cd">http://git.postgresql.org/pg/commitdiff/bdadf36eb40e88f93a9daf20ecd005595ebec1cd</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Fix interaction of partitioned tables with BulkInsertState. When copying into a partitioned table, the target heap may change from one tuple to next. We must ask ReadBufferBI() to get a new buffer every time such change occurs. To do that, use new function ReleaseBulkInsertStatePin(). This fixes the bug that tuples ended up being inserted into the wrong partition, which occurred exactly because the wrong buffer was used. Amit Langote, per a suggestion from Robert Haas. Some cosmetic adjustments by me. Reports by &eacute;&laquo;&tilde;&aring;&cent;&#382;&ccedil;&brvbar; (Gao Zengqi), Venkata B Nagothi, and Ragnar Ouchterlony. Discussion: <a target="_blank" href="http://postgr.es/m/CAFmBtr32FDOqofo8yG-4mjzL1HnYHxXK5S9OGFJ%3D%3DcJpgEW4vA%40mail.gmail.com">http://postgr.es/m/CAFmBtr32FDOqofo8yG-4mjzL1HnYHxXK5S9OGFJ%3D%3DcJpgEW4vA%40mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/CAEyp7J9WiX0L3DoiNcRrY-9iyw%3DqP%2Bj%3DDLsAnNFF1xT2J1ggfQ%40mail.gmail.com">http://postgr.es/m/CAEyp7J9WiX0L3DoiNcRrY-9iyw%3DqP%2Bj%3DDLsAnNFF1xT2J1ggfQ%40mail.gmail.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/16d73804-c9cd-14c5-463e-5caad563ff77%40agama.tv">http://postgr.es/m/16d73804-c9cd-14c5-463e-5caad563ff77%40agama.tv</a> Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoaiZpDVUUN8LZ4jv1qFE_QyR+H9ec+79f5vNczYarg5Zg@mail.gmail.com">http://postgr.es/m/CA+TgmoaiZpDVUUN8LZ4jv1qFE_QyR+H9ec+79f5vNczYarg5Zg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b1ecb9b3fcfb76edb3461ce561d049c8fb9e710d">http://git.postgresql.org/pg/commitdiff/b1ecb9b3fcfb76edb3461ce561d049c8fb9e710d</a></li>
<li>Don't invoke arbitrary code inside a possibly-aborted transaction. The code here previously tried to call the partitioning operator, but really the right thing to do (and the safe thing to do) is use datumIsEqual(). Amit Langote, but I expanded the comment and fixed a compiler warning. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/289992c462b504ffa289202ce8fc34a56b4048c3">http://git.postgresql.org/pg/commitdiff/289992c462b504ffa289202ce8fc34a56b4048c3</a></li>
<li>Remove unused variable. This was intended to be included in the previous commit, but I goofed. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/52df3420cd241b1411da3e4b24318db12bf22cba">http://git.postgresql.org/pg/commitdiff/52df3420cd241b1411da3e4b24318db12bf22cba</a></li>
<li>Fix incorrect comment: pgtime's tm_mon is 1-based, not 0-based. The comments in formatting.c already said that tm_mon was 1-based not 0-based, but the comments here disagreed. Dmitry Fedin <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/96e0ccc2b589eda26585ed2a8dabf34b16747c1a">http://git.postgresql.org/pg/commitdiff/96e0ccc2b589eda26585ed2a8dabf34b16747c1a</a></li>
<li>Reindent table partitioning code. We've accumulated quite a bit of stuff with which pgindent is not quite happy in this code; clean it up to provide a less-annoying base for future pgindent runs. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/27cdb3414b3fb4c8fcc069572568390450bb04c9">http://git.postgresql.org/pg/commitdiff/27cdb3414b3fb4c8fcc069572568390450bb04c9</a></li>
<li>Set ecxt_scantuple correctly for tuple routing. In 2ac3ef7a01df859c62d0a02333b646d65eaec5ff, we changed things so that it's possible for a different TupleTableSlot to be used for partitioned tables at successively lower levels. If we do end up changing the slot from the original, we must update ecxt_scantuple to point to the new one for partition key of the tuple to be computed correctly. Reported by Rajkumar Raghuwanshi. Patch by Amit Langote. Discussion: <a target="_blank" href="http://postgr.es/m/CAKcux6%3Dm1qyqB2k6cjniuMMrYXb75O-MB4qGQMu8zg-iGGLjDw%40mail.gmail.com">http://postgr.es/m/CAKcux6%3Dm1qyqB2k6cjniuMMrYXb75O-MB4qGQMu8zg-iGGLjDw%40mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/132488bfee687865375b5410f18a78fb55bd7015">http://git.postgresql.org/pg/commitdiff/132488bfee687865375b5410f18a78fb55bd7015</a></li>
<li>Fix things so that updatable views work with partitioned tables. Previously, ExecInitModifyTable was missing handling for WITH CHECK OPTION, and view_query_is_auto_updatable was missing handling for RELKIND_PARTITIONED_TABLE. Amit Langote, reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/587cda35ca331128db6c61d406d312654572834a">http://git.postgresql.org/pg/commitdiff/587cda35ca331128db6c61d406d312654572834a</a></li>
<li>Extend index AM API for parallel index scans. This patch doesn't actually make any index AM parallel-aware, but it provides the necessary functions at the AM layer to do so. Rahila Syed, Amit Kapila, Robert Haas <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7b4ac19982a77a1a2a6f096c4a11ee7325a14d2c">http://git.postgresql.org/pg/commitdiff/7b4ac19982a77a1a2a6f096c4a11ee7325a14d2c</a></li>
<li>Add a new DestReceiver for printing tuples without catalog access. If you create a DestReciver of type DestRemote and try to use it from a replication connection that is not bound to a specific daabase, or any other hypothetical type of backend that is not bound to a specific database, it will fail because it doesn't have a pg_proc catalog to look up properties of the types being printed. In general, that's an unavoidable problem, but we can hardwire the properties of a few builtin types in order to support utility commands. This new DestReceiver of type DestRemoteSimple does just that. Patch by me, reviewed by Michael Paquier. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmobNo4qz06wHEmy9DszAre3dYx-WNhHSCbU9SAwf+9Ft6g@mail.gmail.com">http://postgr.es/m/CA+TgmobNo4qz06wHEmy9DszAre3dYx-WNhHSCbU9SAwf+9Ft6g@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a84069d9350400c860d5e932b50dfd337aa407b0">http://git.postgresql.org/pg/commitdiff/a84069d9350400c860d5e932b50dfd337aa407b0</a></li>
<li>Add a SHOW command to the replication command language. This is useful infrastructure for an upcoming proposed patch to allow the WAL segment size to be changed at initdb time; tools like pg_basebackup need the ability to interrogate the server setting. But it also doesn't seem like a bad thing to have independently of that; it may find other uses in the future. Robert Haas and Beena Emerson. (The original patch here was by Beena, but I rewrote it to such a degree that most of the code being committed here is mine.) Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmobNo4qz06wHEmy9DszAre3dYx-WNhHSCbU9SAwf+9Ft6g@mail.gmail.com">http://postgr.es/m/CA+TgmobNo4qz06wHEmy9DszAre3dYx-WNhHSCbU9SAwf+9Ft6g@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d1ecd539477fe640455dc890216a7c1561e047b4">http://git.postgresql.org/pg/commitdiff/d1ecd539477fe640455dc890216a7c1561e047b4</a></li>
<li>Be more aggressive in avoiding tuple conversion. According to the comments in tupconvert.c, it's necessary to perform tuple conversion when either table has OIDs, and this was previously checked by ensuring that the tdtypeid value matched between the tables in question. However, that's overly stringent: we have access to tdhasoid and can test directly whether OIDs are present, which lets us avoid conversion in cases where the type OIDs are different but the tuple descriptors are entirely the same (and neither has OIDs). This is useful to the partitioning code, which can thereby avoid converting tuples when inserting into a partition whose columns appear in the same order as the parent columns, the normal case. It's possible for the tuple routing code to avoid some additional overhead in this case as well, so do that, too. It's not clear whether it would be OK to skip this when both tables have OIDs: do callers count on this to build a new tuple (losing the previous OID) in such instances? Until we figure it out, leave the behavior in that case alone. Amit Langote, reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3838074f864eda344677fba39c6141ccbcd4104b">http://git.postgresql.org/pg/commitdiff/3838074f864eda344677fba39c6141ccbcd4104b</a></li>
<li>Refactor bitmap heap scan estimation of heap pages fetched. Currently, we only need this logic in order to cost a Bitmap Heap Scan. But a pending patch for Parallel Bitmap Heap Scan also uses it to help figure out how many workers to use for the scan, which has to be determined prior to costing. So, move the logic to a separate function to make that easier. Dilip Kumar. The patch series of which this is a part has been reviewed by Andres Freund, Amit Khendekar, Tushar Ahuja, Rafia Sabih, Haribabu Kommi, and me; it is not clear from the email discussion which of those people have looked specifically at this part. Discussion: <a target="_blank" href="http://postgr.es/m/CAFiTN-v3QYNJEZnnmKCeATuLbN-h9tMVfeEF0+BrouYDqjXgwg@mail.gmail.com">http://postgr.es/m/CAFiTN-v3QYNJEZnnmKCeATuLbN-h9tMVfeEF0+BrouYDqjXgwg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/da08a659897347859fdfe258c67e9d2bf680d4dd">http://git.postgresql.org/pg/commitdiff/da08a659897347859fdfe258c67e9d2bf680d4dd</a></li>
<li>Fix typo in comment. Etsuro Fujita <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4bf371cf2a894abeda672996f24dc6603ceddc3c">http://git.postgresql.org/pg/commitdiff/4bf371cf2a894abeda672996f24dc6603ceddc3c</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Reset hot standby xmin on master after restart. Hot_standby_feedback could be reset by reload and worked correctly, but if the server was restarted rather than reloaded the xmin was not reset. Force reset always if hot_standby_feedback is enabled at startup. Ants Aasma, Craig Ringer Reported-by: Ants Aasma <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ec4b975016b873292ba5e3d645b414acf1b96c06">http://git.postgresql.org/pg/commitdiff/ec4b975016b873292ba5e3d645b414acf1b96c06</a></li>
<li>Check interrupts during hot standby waits. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e8ee3d6b859a18d7f7375ceb9e04d256eb18aaec">http://git.postgresql.org/pg/commitdiff/e8ee3d6b859a18d7f7375ceb9e04d256eb18aaec</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Add castNode(type, ptr) for safe casting between NodeTag based types. The new function allows to cast from one NodeTag based type to another, while asserting that the conversion is valid. This replaces the common pattern of doing a cast and a Assert(IsA(ptr, type)) close-by. As this seems likely to be used pervasively, we decided to backpatch this change the addition of this macro. Otherwise backpatched fixes are more likely not to work on back-branches. On branches before 9.6, where we do not yet rely on inline functions being available, the type assertion is only performed if PG_USE_INLINE support is detected. The cast obviously is performed regardless. For the benefit of verifying the macro compiles in the back-branches, this commit contains a single use of the new macro. On master, a somewhat larger conversion will be committed separately. Author: Peter Eisentraut and Andres Freund. Reviewed-By: Tom Lane. Discussion: <a target="_blank" href="https://postgr.es/m/c5d387d9-3440-f5e0-f9d4-71d53b9fbe52@2ndquadrant.com">https://postgr.es/m/c5d387d9-3440-f5e0-f9d4-71d53b9fbe52@2ndquadrant.com</a> Backpatch: 9.2- <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5bcab111426e5aae659a97a66d5de4ab9fe40edf">http://git.postgresql.org/pg/commitdiff/5bcab111426e5aae659a97a66d5de4ab9fe40edf</a></li>
<li>Use the new castNode() macro in a number of places. This is far from a pervasive conversion, but it's a good starting point. Author: Peter Eisentraut, with some minor changes by me Reviewed-By: Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/c5d387d9-3440-f5e0-f9d4-71d53b9fbe52@2ndquadrant.com">https://postgr.es/m/c5d387d9-3440-f5e0-f9d4-71d53b9fbe52@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9ba8a9ce4548bb34b7136b7463a61b2c499979a3">http://git.postgresql.org/pg/commitdiff/9ba8a9ce4548bb34b7136b7463a61b2c499979a3</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to enable replication connections by default in pg_hba.conf.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to ensure that pg_dump and pg_dumpall sync their output to disk by default.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to ensure that launching replication workers is a NOOP when wal_level &lt; logical, and to set the default number of such workers to 0.</p>
<p>Craig Ringer sent in three more revisions of a patch to fix a race between clog truncation and lookup, and introduce txid_status(bigint) to get status of an xact.</p>
<p>Petr Jel&Atilde;&shy;nek sent in two more revisions of a patch to use the asynchronous connect API in libpqwalreceiver, close the replication connection when slot creation gets canceled, ensure that stringinfo buffers in walsender are always initialized, fix after trigger execution in logical replication, and add RENAME support for PUBLICATIONs and SUBSCRIPTIONs.</p>
<p>Amit Kapila sent in another revision of a patch to implement parallel index scans.</p>
<p>Dilip Kumar sent in three more revisions of a patch to implement parallel bitmap heap scans.</p>
<p>Beena Emerson sent in another revision of a patch to enable increasing the default WAL segment size.</p>
<p>Corey Huinker sent in three more revisions of a patch to add \if and friends to psql.</p>
<p>Etsuro Fujita sent in another revision of a patch to fix a bug in the PostgreSQL FDW.</p>
<p>Ivan Kartyshov sent in another revision of a patch to make async slave to wait for lsn to be replayed.</p>
<p>Dagfinn Ilmari Manns&Atilde;&yen;ker sent in another revision of a patch to add GUCs for predicate lock promotion thresholds.</p>
<p>Craig Ringer sent in another revision of a patch to implement logical decoding on standby.</p>
<p>Nico Williams sent in a patch to implement an expanded version of materialized views and a contrib extension.</p>
<p>Nico Williams sent in a patch to implement pqasyncnotifier.c, a shell command client for LISTEN.</p>
<p>Amit Langote sent in a patch to add relkind checks to certain contrib modules.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to clean up the negative cache of pg_statistic when dropping a relation and of pg_class when dropping a schema.</p>
<p>Amit Kapila sent in another revision of a patch to parallelize queries containing subplans.</p>
<p>Ashutosh Sharma sent in two more revisions of a patch to add pgstathashindex() to pgstattuple extension.</p>
<p>Jim Nasby sent in another revision of a patch to add faster methods for getting SPI results.</p>
<p>Claudio Freire sent in two more revisions of a patch to allow usage of more than 1GB of work mem in VACUUM.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in two revisions of a patch to enable forcing a custom or generic plan in PL/pgsql.</p>
<p>Stas Kelvich and Nikhil Sontakke traded patches to speed up two-phase transactions.</p>
<p>Haribabu Kommi sent in three more revisions of a patch to implement a 64-bit (EUI-64) macaddr data type.</p>
<p>Haribabu Kommi and Tom Lane traded patches to implement a pg_hba_file_settings view.</p>
<p>Peter Eisentraut sent in another revision of a patch to add ICU support.</p>
<p>Beena Emerson sent in a patch to add tab completion to ALTER in psql.</p>
<p>Daniel V&Atilde;&copy;rit&Atilde;&copy; sent in another revision of a patch to improve psql hooks for variables.</p>
<p>Nikita Glukhov sent in another revision of a patch to make a recursive version of json_populate_record().</p>
<p>&Atilde;lvaro Herrera sent in another revision of a patch to implement xmltable().</p>
<p>Fabien COELHO sent in two more revisions of a patch to add more functions and operators to pgbench.</p>
<p>Pavan Deolasee sent in another revision of a patch to implement WARM.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in three revisions of a patch to refactor the replication commands output.</p>
<p>Vladimir Rusinov sent in a patch to rename the sql-callable functions with xlog to have wal instead.</p>
<p>Etsuro Fujita sent in another revision of a patch to push down more UPDATEs/DELETEs in postgres_fdw.</p>
<p>Ashutosh Bapat sent in another revision of a patch to speed up aggregate pushdown tests.</p>
<p>Julian Markwort sent in a patch to extended the functionality of pg_stat_statements so it can track worst and best case execution plans.</p>
<p>Fabien COELHO sent in a patch to fix an infelicity between pgbench's --connect and --rate options.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to use a radix tree for character conversion.</p>
<p>Peter Eisentraut sent in two more revisions of a patch to add test coverage for sequences.</p>
<p>David Fetter and Corey Huinker traded patches to add copy_srf(), a set-returning function corresponding to COPY IN.</p>
<p>Masahiko Sawada sent in two more revisions of a patch to support 2PC in FDWs.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two revisions of a patch to remove race conditions between the checkpointer and the init fork creations by making index init forks go through the shared buffers instead of having their empty() routines handle the flush of the page created.</p>
<p>Robert Haas sent in a patch to remove some hard-coded superuser checks.</p>
<p>Robert Haas sent in another revision of a patch to rename things *xlog* to the corresponding *wal*.</p>
<p>Mithun Cy sent in two more revisions of a patch to cache hash index meta pages.</p>
<p>David Rowley sent in three more revisions of a patch to improve performance where for joins where the outer side is unique.</p>
<p>Venkata B Nagothi sent in a patch to generate an error by aborting the recovery process instead of starting up the cluster if the intended recovery target point is not reached, and give an option to DBA to resume the recovery process from exactly where it stopped.</p>
<p>Ashutosh Sharma sent in another revision of a patch to add microvacuum support for hash indexes.</p>
<p>Noah Misch sent in another revision of a patch to remove link-time cross-module refs in contrib.</p>
<p>Christoph Berg sent in a patch to use \G to use expanded output for a query or current query buffer.</p>
<p>Robert Haas and &Atilde;lvaro Herrera traded patches to add hash index support to to the pageinspect contrib extension.</p>
<p>Thomas Munro sent in another revision of a patch to implement parallel shared hash.</p>
<p>David Rowley sent in another revision of a patch to fix an infelicity between CONNECTION LIMIT and Parallel Query.</p>
<p>Tom Lane sent in a patch to create a separate test file for exercising system views.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/02/02/Nouvelles-hebdomadaires-de-PostgreSQL-29-janvier-2017">par chl le jeudi  2 février 2017 à 01h53</a>
</p>
</div>
</div>




<div class="entrygroup" id="urn:md5:0bbd778920a3e80e52fc3be9070bf9f3" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/02/02/Nouvelles-hebdomadaires-de-PostgreSQL-22-janvier-2017">Nouvelles hebdomadaires de PostgreSQL - 22 janvier 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Offres d'emplois autour de PostgreSQL en janvier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-01/">http://archives.postgresql.org/pgsql-jobs/2017-01/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 est programm&eacute; les 17 et 18 mars &agrave; Singapour&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/">https://2017.nordicpgday.org/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017&nbsp;: <a target="_blank" href="http://2017.pgday.paris/">http://2017.pgday.paris/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai. Les propositions seront attendues jusqu'au 19 janvier 2017&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170122232424.GA6120@fetter.org">http://www.postgresql.org/message-id/20170122232424.GA6120@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Fujii Masao pushed:</p>
<ul>
<li>Fix typos in comments. Masahiko Sawada <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8fa6019b405f9d39539a77c6f5f11fe640ddf955">http://git.postgresql.org/pg/commitdiff/8fa6019b405f9d39539a77c6f5f11fe640ddf955</a></li>
<li>Fix an assertion failure related to an exclusive backup. Previously multiple sessions could execute pg_start_backup() and pg_stop_backup() to start and stop an exclusive backup at the same time. This could trigger the assertion failure of "FailedAssertion("!(XLogCtl-&gt;Insert.exclusiveBackup)". This happend because, even while pg_start_backup() was starting an exclusive backup, other session could run pg_stop_backup() concurrently and mark the backup as not-in-progress unconditionally. This patch introduces ExclusiveBackupState indicating the state of an exclusive backup. This state is used to ensure that there is only one session running pg_start_backup() or pg_stop_backup() at the same time, to avoid the assertion failure. Back-patch to all supported versions. Author: Michael Paquier Reviewed-By: Kyotaro Horiguchi and me Reported-By: Andreas Seltenreich Discussion: &lt;87mvktojme.fsf@credativ.de&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/974ece58bbb3c0ef185a9d44b1cedae51cd56b04">http://git.postgresql.org/pg/commitdiff/974ece58bbb3c0ef185a9d44b1cedae51cd56b04</a></li>
<li>Add description of temporary column into pg_replication_slots doc. Ayumi Ishii <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/954737095061e5b5f1d87fb8cc43f7f8afff64c6">http://git.postgresql.org/pg/commitdiff/954737095061e5b5f1d87fb8cc43f7f8afff64c6</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Make pg_basebackup use temporary replication slots. Temporary replication slots will be used by default when wal streaming is used and no slot name is specified with -S. If a slot name is specified, then a permanent slot with that name is used. If --no-slot is specified, then no permanent or temporary slot will be used. Temporary slots are only used on 10.0 and newer, of course. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e7b020f786bf3b344f81d70aa423525fd4f44dfa">http://git.postgresql.org/pg/commitdiff/e7b020f786bf3b344f81d70aa423525fd4f44dfa</a></li>
<li>Fix incorrect comparison due to bad merge. Noted by Fujii Masao <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fcf708623e860b7a1efef11a5d5661900307b6fc">http://git.postgresql.org/pg/commitdiff/fcf708623e860b7a1efef11a5d5661900307b6fc</a></li>
<li>Add compression support to pg_receivexlog. Author: Michael Paquier, review and small changes by me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cada1af31d769a6b607018d68894f2c879ff275f">http://git.postgresql.org/pg/commitdiff/cada1af31d769a6b607018d68894f2c879ff275f</a></li>
<li>Implement array version of jsonb_delete and operator. This makes it possible to delete multiple keys from a jsonb value by passing in an array of text values, which makes the operaiton much faster than individually deleting the keys (which would require copying the jsonb structure over and over again. Reviewed by Dmitry Dolgov and Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d00ca333c338b40911e89939c3cc771025978595">http://git.postgresql.org/pg/commitdiff/d00ca333c338b40911e89939c3cc771025978595</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Fix NULL pointer dereference in tuplesort.c. Oversight in commit e94568ecc. This could cause a crash when an external datum tuplesort of a pass-by-value type required multiple passes. Per report from Mithun Cy. Peter Geoghegan Discussion: <a target="_blank" href="https://postgr.es/m/CAD__OujuhfWFULGFSt1fyHqUb8N-XafjJhudwt88V0Qs2o84qg@mail.gmail.com">https://postgr.es/m/CAD__OujuhfWFULGFSt1fyHqUb8N-XafjJhudwt88V0Qs2o84qg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4e46c97fde42fa8ca57d29b9b47f2ebd11ab8105">http://git.postgresql.org/pg/commitdiff/4e46c97fde42fa8ca57d29b9b47f2ebd11ab8105</a></li>
<li>Fix check_srf_call_placement() to handle VALUES cases correctly. INSERT ... VALUES with a single VALUES row is implemented quite differently from the general VALUES case. A user-visible implication of that is that we accept SRFs in the single-row case, but not in the multi-row case. That's a historical artifact no doubt, but in view of the lack of field complaints, I'm not excited about fixing it right now. However, check_srf_call_placement() needs to know about this, first because it should throw an error in the unsupported case, and second because it should set p_hasTargetSRFs in the single-row case (because we treat that like a SELECT tlist). That's an oversight in commit a4c35ea1c. To fix, split EXPR_KIND_VALUES into two values. So far as I can see, this is the only place where we need to distinguish the two cases at present; but there might be more later. Patch by me, per report from Andres Freund. Discussion: <a target="_blank" href="https://postgr.es/m/20170116081548.zg63zltblwimpfgp@alap3.anarazel.de">https://postgr.es/m/20170116081548.zg63zltblwimpfgp@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d43a619c60405ecda275ca9e3ac9ead242e20ecb">http://git.postgresql.org/pg/commitdiff/d43a619c60405ecda275ca9e3ac9ead242e20ecb</a></li>
<li>Improve RLS planning by marking individual quals with security levels. In an RLS query, we must ensure that security filter quals are evaluated before ordinary query quals, in case the latter contain "leaky" functions that could expose the contents of sensitive rows. The original implementation of RLS planning ensured this by pushing the scan of a secured table into a sub-query that it marked as a security-barrier view. Unfortunately this results in very inefficient plans in many cases, because the sub-query cannot be flattened and gets planned independently of the rest of the query. To fix, drop the use of sub-queries to enforce RLS qual order, and instead mark each qual (RestrictInfo) with a security_level field establishing its priority for evaluation. Quals must be evaluated in security_level order, except that "leakproof" quals can be allowed to go ahead of quals of lower security_level, if it's helpful to do so. This has to be enforced within the ordering of any one list of quals to be evaluated at a table scan node, and we also have to ensure that quals are not chosen for early evaluation (i.e., use as an index qual or TID scan qual) if they're not allowed to go ahead of other quals at the scan node. This is sufficient to fix the problem for RLS quals, since we only support RLS policies on simple tables and thus RLS quals will always exist at the table scan level only. Eventually these qual ordering rules should be enforced for join quals as well, which would permit improving planning for explicit security-barrier views; but that's a task for another patch. Note that FDWs would need to be aware of these rules --- and not, for example, send an insecure qual for remote execution --- but since we do not yet allow RLS policies on foreign tables, the case doesn't arise. This will need to be addressed before we can allow such policies. Patch by me, reviewed by Stephen Frost and Dean Rasheed. Discussion: <a target="_blank" href="https://postgr.es/m/8185.1477432701@sss.pgh.pa.us">https://postgr.es/m/8185.1477432701@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/215b43cdc8d6b4a1700886a39df1ee735cb0274d">http://git.postgresql.org/pg/commitdiff/215b43cdc8d6b4a1700886a39df1ee735cb0274d</a></li>
<li>Avoid conflicts with collation aliases generated by stripping. This resulted in failures depending on the order of "locale -a" output. The original coding in initdb sorted the results, but that should be unnecessary as long as "locale -a" doesn't print duplicate names. The original entries will then all be non-dups, and while we might generate duplicate aliases by stripping, they should be for different encodings and thus not conflict. Even if the latter assumption fails somehow, it won't be fatal because we're using if_not_exists mode for the aliases. Discussion: <a target="_blank" href="https://postgr.es/m/26116.1484751196%40sss.pgh.pa.us">https://postgr.es/m/26116.1484751196%40sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0333a7340054c3356940759b1ab2391eed572171">http://git.postgresql.org/pg/commitdiff/0333a7340054c3356940759b1ab2391eed572171</a></li>
<li>Disable transforms that replaced AT TIME ZONE with RelabelType. These resulted in wrong answers if the relabeled argument could be matched to an index column, as shown in bug #14504 from Evgeniy Kozlov. We might be able to resurrect these optimizations by adjusting the planner's treatment of RelabelType, or by adjusting btree's rules for selecting comparison functions, but either solution will take careful analysis and does not sound like a fit candidate for backpatching. I left the catalog infrastructure in place and just reduced the transform functions to always-return-NULL. This would be necessary anyway in the back branches, and it doesn't seem important to be more invasive in HEAD. Bug introduced by commit b8a18ad48. Back-patch to 9.5 where that came in. Report: <a target="_blank" href="https://postgr.es/m/20170118144828.1432.52823@wrigleys.postgresql.org">https://postgr.es/m/20170118144828.1432.52823@wrigleys.postgresql.org</a> Discussion: <a target="_blank" href="https://postgr.es/m/18771.1484759439@sss.pgh.pa.us">https://postgr.es/m/18771.1484759439@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c22ecc6562aac895f0f0529707d7bdb460fd2a49">http://git.postgresql.org/pg/commitdiff/c22ecc6562aac895f0f0529707d7bdb460fd2a49</a></li>
<li>Reset the proper GUC in create_index test. Thinko in commit a4523c5aa. It doesn't really affect anything at present, but it would be a problem if any tests added later in this file ought to get index-only-scan plans. Back-patch, like the previous commit, just to avoid surprises in case we add such a test and then back-patch it. Nikita Glukhov Discussion: <a target="_blank" href="https://postgr.es/m/8b70135d-ad38-bdd8-ac92-71e2b3c273cf@postgrespro.ru">https://postgr.es/m/8b70135d-ad38-bdd8-ac92-71e2b3c273cf@postgrespro.ru</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1586317c3f57e619e0cde674c6da406f9d73aaff">http://git.postgresql.org/pg/commitdiff/1586317c3f57e619e0cde674c6da406f9d73aaff</a></li>
<li>Doc: improve documentation of new SRF-in-tlist behavior. Correct a misstatement about how things used to work: we did allow nested SRFs before, as long as no function had more than one set-returning input. Also, attempt to document the fact that the new implementation changes the behavior for SRFs within conditional constructs (eg CASE): the conditional construct no longer gates whether the SRF is run, and thus cannot affect the number of rows emitted. We might want to change this behavior, but first it behooves us to see if we can explain it. Minor other wordsmithing on what I wrote yesterday, too. Discussion: <a target="_blank" href="https://postgr.es/m/20170118214702.54b2mdbxce5piwv5@alap3.anarazel.de">https://postgr.es/m/20170118214702.54b2mdbxce5piwv5@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f13a1277aa2df301583c6db9c2989d2e9d7f6483">http://git.postgresql.org/pg/commitdiff/f13a1277aa2df301583c6db9c2989d2e9d7f6483</a></li>
<li>Fix Assert failure induced by commit 215b43cdc. I'd somehow talked myself into believing that set_append_rel_size doesn't need to worry about getting back an AND clause when it applies eval_const_expressions to the result of adjust_appendrel_attrs (that is, transposing the appendrel parent's restriction clauses for one child). But that is nonsense, and Andreas Seltenreich's fuzz tester soon turned up a counterexample. Put back the make_ands_implicit step that was there before, and add a regression test covering the case. Report: <a target="_blank" href="https://postgr.es/m/878tq6vja6.fsf@ansel.ydns.eu">https://postgr.es/m/878tq6vja6.fsf@ansel.ydns.eu</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d479e37e3d20efad8b178e0f1e468c086a7519a8">http://git.postgresql.org/pg/commitdiff/d479e37e3d20efad8b178e0f1e468c086a7519a8</a></li>
<li>Avoid core dump for empty prepared statement in an aborted transaction. Brown-paper-bag bug in commit ab1f0c822: the old code here coped with null CachedPlanSource.raw_parse_tree, the new code not so much. Per report from Dave Cramer. No regression test, because our core testing infrastructure doesn't provide any easy way to exercise this path. Fortunately, the JDBC crew test it regularly. Discussion: <a target="_blank" href="https://postgr.es/m/CADK3HH+Ug3xCysKqw_dZOnaNnytZ1Rh5yP05hjO-e4NoyRxVvA@mail.gmail.com">https://postgr.es/m/CADK3HH+Ug3xCysKqw_dZOnaNnytZ1Rh5yP05hjO-e4NoyRxVvA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ba61a04bc7fefeee03416d9911eb825c4897c223">http://git.postgresql.org/pg/commitdiff/ba61a04bc7fefeee03416d9911eb825c4897c223</a></li>
<li>Allow backslash line continuations in pgbench's meta commands. A pgbench meta command can now be continued onto additional line(s) of a script file by writing backslash-return. The continuation marker is equivalent to white space in that it separates tokens. Eventually it'd be nice to have the same thing in psql, but that will be a much larger project. Fabien Coelho, reviewed by Rafia Sabih Discussion: <a target="_blank" href="https://postgr.es/m/alpine.DEB.2.20.1610031049310.19411@lancre">https://postgr.es/m/alpine.DEB.2.20.1610031049310.19411@lancre</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cdc2a70470bdbe3663dc464deb753d6d931bba61">http://git.postgresql.org/pg/commitdiff/cdc2a70470bdbe3663dc464deb753d6d931bba61</a></li>
<li>Try to fix non-MSVC Windows builds in the wake of logical replication. pgoutput evidently needs to be built without -DBUILDING_DLL. (It seems like a pretty bad idea that these makefiles need to know exactly where all the shlibs are in the tree, or maybe what's bad is putting them under src/backend/. But right now is not the time to redesign that.) Also, remove "override CPPFLAGS" in pgoutput's Makefile. I don't think that that actually has any bad consequences, but it's certainly useless in a directory that has no .h files, and it might be contributing to the failure somehow. Per buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0502e854640bd024f349c0df46b7dd6812b8c05c">http://git.postgresql.org/pg/commitdiff/0502e854640bd024f349c0df46b7dd6812b8c05c</a></li>
<li>Fix cross-shlib linking in temporary installs on HPUX 10. Turns out this has been broken for years and we'd not noticed. The one case that was getting exercised in the buildfarm, or probably anywhere else, was postgres_fdw.sl's reference to libpq.sl; and it turns out that that was always going to libpq.sl in the actual installation directory not the temporary install. We'd not noticed because the buildfarm script does "make install" before it tests contrib. However, the recent addition of a logical-replication test to the core regression scripts resulted in trying to use libpqwalreceiver.sl before "make install" happens, and that failed for lack of finding libpq.sl, as shown by failures on buildfarm members gaur and pademelon. There are two changes needed to fix it: the magic environment variable to specify shlib search path at runtime is SHLIB_PATH not LD_LIBRARY_PATH, and the shlib link command needs to specify the +s switch else the library will not honor SHLIB_PATH. I'm not quite sure why buildfarm members anole and gharial (HPUX 11) didn't show the same failure. Consulting man pages on the web says that HPUX 11 honors both LD_LIBRARY_PATH and SHLIB_PATH, which would explain half of it, and the rather confusing wording I've been able to find suggests that +s might effectively be the default in HPUX 11. But it seems at least as likely that there's just a libpq.so installed in /usr/lib on that machine; as long as it's not too ancient, that would satisfy the test. In any case I do not think this patch will break HPUX 11. At the moment I don't see a need to back-patch this, since it only matters for testing purposes, not to mention that HPUX 10 is probably dead in the real world anyway. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d2ab1176160e30543da1e48f7e0d17564852b693">http://git.postgresql.org/pg/commitdiff/d2ab1176160e30543da1e48f7e0d17564852b693</a></li>
<li>Remove no-longer-needed loop in ExecGather(). Coverity complained quite properly that commit ea15e1867 had introduced unreachable code into ExecGather(); to wit, it was no longer possible to iterate the final for-loop more or less than once. So remove the for(). In passing, clean up a couple of comments, and make better use of a local variable. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0a8b9d3b2c57028f7100078cd711370f396d5a81">http://git.postgresql.org/pg/commitdiff/0a8b9d3b2c57028f7100078cd711370f396d5a81</a></li>
<li>Relocate static function declarations to be after typedefs in jsonfuncs.c. Project style is to put things in this order, for the good and sufficient reason that you often need the typedefs in the function declarations. There already was one function declaration that needed a typedef, which was randomly placed away from all the other static function declarations in consequence. And the submitted patch for better json_populate_record functionality jumped through even more hoops in order to preserve this bad idea. This patch only moves lines from point A to point B, no other changes. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/90992e0e2f9fc4aa0f6402f0327604e5fef4630c">http://git.postgresql.org/pg/commitdiff/90992e0e2f9fc4aa0f6402f0327604e5fef4630c</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>doc: Update URL for Microsoft download site. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6181c34da882544c4842e7442189a7ea1dd03032">http://git.postgresql.org/pg/commitdiff/6181c34da882544c4842e7442189a7ea1dd03032</a></li>
<li>Rename C symbols for backend lo_ functions. Rename the C symbols for lo_* to be_lo_*, so they don't conflict with libpq prototypes. Reviewed-by: Pavel Stehule &lt;pavel.stehule@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6fc547960dbe0b8bd6cefae5ab7ec3605a5c46fc.">http://git.postgresql.org/pg/commitdiff/6fc547960dbe0b8bd6cefae5ab7ec3605a5c46fc.</a></li>
<li>Register missing money operators in system catalogs. The operators money*int8, int8*money, and money/int8 were implemented in code but not registered in pg_operator or pg_proc. Reviewed-by: Pavel Stehule &lt;pavel.stehule@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/323b96aa34239b5a8fe773d614a6ee50d731a683.">http://git.postgresql.org/pg/commitdiff/323b96aa34239b5a8fe773d614a6ee50d731a683.</a></li>
<li>Remove unnecessary prototypes in loadable modules. Reviewed-by: Pavel Stehule &lt;pavel.stehule@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5d7c9c906a0b888dcfd3b0a2f2170e1f5ca366c4">http://git.postgresql.org/pg/commitdiff/5d7c9c906a0b888dcfd3b0a2f2170e1f5ca366c4</a></li>
<li>Add more tests for money type. Add tests for functions currently not covered at all. Reviewed-by: Pavel Stehule &lt;pavel.stehule@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/09e35315ccafb83c52da2e0fd6a0a9be410ce6a4">http://git.postgresql.org/pg/commitdiff/09e35315ccafb83c52da2e0fd6a0a9be410ce6a4</a></li>
<li>Remove unnecessary include. Between 6eeb95f0f56bb5e8a0a9328aeec04c9e6de87272 and 7b1c2a0f2066672b24f6257ec9b8d78a1754f494, builtins.h contained additional prototypes that have now been moved elsewhere, so we don't need to include nodes/parsenodes.h anymore. Fix some files that were relying on builtins.h implicitly pulling in some unrelated stuff they needed. Reviewed-by: Pavel Stehule &lt;pavel.stehule@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/30b9a4495a8ec1f20ba518b34d679c700eadab16">http://git.postgresql.org/pg/commitdiff/30b9a4495a8ec1f20ba518b34d679c700eadab16</a></li>
<li>Correct include file path. Mistake in 352a24a1f9d6f7d4abb1175bfd22acc358f43140, not clear why it worked for some before. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/063ef8308b148e3581ddb626fdb397f7a5a48303">http://git.postgresql.org/pg/commitdiff/063ef8308b148e3581ddb626fdb397f7a5a48303</a></li>
<li>Generate fmgr prototypes automatically. Gen_fmgrtab.pl creates a new file fmgrprotos.h, which contains prototypes for all functions registered in pg_proc.h. This avoids having to manually maintain these prototypes across a random variety of header files. It also automatically enforces a correct function signature, and since there are warnings about missing prototypes, it will detect functions that are defined but not registered in pg_proc.h (or otherwise used). Reviewed-by: Pavel Stehule &lt;pavel.stehule@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/352a24a1f9d6f7d4abb1175bfd22acc358f43140">http://git.postgresql.org/pg/commitdiff/352a24a1f9d6f7d4abb1175bfd22acc358f43140</a></li>
<li>initdb: Fix for mixed-case superuser names. The previous coding did not properly quote the user name before casting it to regrole. To avoid all that, just pass in BOOTSTRAP_SUPERUSERID numerically. Also fix one place where the BOOTSTRAP_SUPERUSERID was hardcoded as 10. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8b0fec93ecc788c8d8b329d41ab795712d8dcc5a">http://git.postgresql.org/pg/commitdiff/8b0fec93ecc788c8d8b329d41ab795712d8dcc5a</a></li>
<li>Add function to import operating system collations. Move this logic out of initdb into a user-callable function. This simplifies the code and makes it possible to update the standard collations later on if additional operating system collations appear. Reviewed-by: Andres Freund &lt;andres@anarazel.de&gt; Reviewed-by: Euler Taveira &lt;euler@timbira.com.br&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/aa17c06fb58533d09c79c68a4d34a6f56687ee38">http://git.postgresql.org/pg/commitdiff/aa17c06fb58533d09c79c68a4d34a6f56687ee38</a></li>
<li>Bump catversion. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e4c27f5befbfc80a1bf96fc93256dce08b148238">http://git.postgresql.org/pg/commitdiff/e4c27f5befbfc80a1bf96fc93256dce08b148238</a></li>
<li>Paper over pg_upgrade test failure. The publication test didn't drop all the publications it was creating when it was probably intending to do that. There is still a bug with dependency tracking in there, but this should at least quiet down the build farm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6c488ea13634897df5f9b5769eb26bbc3d926ce0">http://git.postgresql.org/pg/commitdiff/6c488ea13634897df5f9b5769eb26bbc3d926ce0</a></li>
<li>Move some things from builtins.h to new header files. This avoids that builtins.h has to include additional header files. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f21a563d25dbae153937aec062161184189478b8">http://git.postgresql.org/pg/commitdiff/f21a563d25dbae153937aec062161184189478b8</a></li>
<li>Logical replication. - Add PUBLICATION catalogs and DDL. - Add SUBSCRIPTION catalog and DDL. - Define logical replication protocol and output plugin. - Add logical replication workers. From: Petr Jelinek &lt;petr@2ndquadrant.com&gt; Reviewed-by: Steve Singer &lt;steve@ssinger.info&gt; Reviewed-by: Andres Freund &lt;andres@anarazel.de&gt; Reviewed-by: Erik Rijkers &lt;er@xs4all.nl&gt; Reviewed-by: Peter Eisentraut &lt;peter.eisentraut@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/665d1fad99e7b11678b0d5fa24d2898424243cd6">http://git.postgresql.org/pg/commitdiff/665d1fad99e7b11678b0d5fa24d2898424243cd6</a></li>
<li>Add more includes so header files are self-contained. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b48008676002895c284c9a7a3d4fc7210b58044d">http://git.postgresql.org/pg/commitdiff/b48008676002895c284c9a7a3d4fc7210b58044d</a></li>
<li>Add missing break. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8f164e1eeaf31438f6706ed45efee607a2c7a21b">http://git.postgresql.org/pg/commitdiff/8f164e1eeaf31438f6706ed45efee607a2c7a21b</a></li>
</ul>
<p>&Aacute;lvaro Herrera pushed:</p>
<ul>
<li>Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dda7c34555ca3696fd2a8b93d9aabad333c6cb4e">http://git.postgresql.org/pg/commitdiff/dda7c34555ca3696fd2a8b93d9aabad333c6cb4e</a></li>
<li>Fix typo. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/593c75d5c38a47096f11e318cdb3321a5780753f">http://git.postgresql.org/pg/commitdiff/593c75d5c38a47096f11e318cdb3321a5780753f</a></li>
<li>Remove dead code in bootstrap. The bootstrap scanner/parser contains code to parse floating point values, but this is not exercised anywhere, so remove it. Reviewed-by: Jim Nasby Discussion: <a target="_blank" href="https://postgr.es/m/20170110051119.b5h7i3z5qagy35rb@alvherre.pgsql">https://postgr.es/m/20170110051119.b5h7i3z5qagy35rb@alvherre.pgsql</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/193a7d791ebe2adf32b36d5538e4602a90c3e0fb">http://git.postgresql.org/pg/commitdiff/193a7d791ebe2adf32b36d5538e4602a90c3e0fb</a></li>
<li>Make messages mentioning type names more uniform. This avoids additional translatable strings for each distinct type, as well as making our quoting style around type names more consistent (namely, that we don't quote type names). This continues what started as f402b9950120. Discussion: <a target="_blank" href="https://postgr.es/m/20160401170642.GA57509@alvherre.pgsql">https://postgr.es/m/20160401170642.GA57509@alvherre.pgsql</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9a34123bc315e55b33038464422ef1cd2b67dab2">http://git.postgresql.org/pg/commitdiff/9a34123bc315e55b33038464422ef1cd2b67dab2</a></li>
<li>Change some test macros to return true booleans. These macros work fine when they are used directly in an "if" test or similar, but as soon as the return values are assigned to boolean variables (or passed as boolean arguments to some function), they become bugs, hopefully caught by compiler warnings. To avoid future problems, fix the definitions so that they return actual booleans. To further minimize the risk that somebody uses them in back-patched fixes that only work correctly in branches starting from the current master and not in old ones, back-patch the change to supported branches as appropriate. See also commit af4472bcb88ab36b9abbe7fd5858e570a65a2d1a, and the long discussion (and larger patch) in the thread mentioned in its commit message. Discussion: <a target="_blank" href="https://postgr.es/m/18672.1483022414@sss.pgh.pa.us">https://postgr.es/m/18672.1483022414@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/594e61a1de03ab93779e7e3d853edb7859d5c3cf">http://git.postgresql.org/pg/commitdiff/594e61a1de03ab93779e7e3d853edb7859d5c3cf</a></li>
<li>Allow negative years in make_date to represent BC years. There doesn't seem to be any reason not to allow negative years to be interpreted as BC, so do that. The documentation is pretty vague on the details of this function, so nothing needs to change there. Reported-by: Andy Abelisto, in bug #14446 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/30bcebbdcf23eb8b78e553c4b3b5eb847410ef19">http://git.postgresql.org/pg/commitdiff/30bcebbdcf23eb8b78e553c4b3b5eb847410ef19</a></li>
<li>Fix race condition in reading commit timestamps. If a user requests the commit timestamp for a transaction old enough that its data is concurrently being truncated away by vacuum at just the right time, they would receive an ugly internal file-not-found error message from slru.c rather than the expected NULL return value. In a primary server, the window for the race is very small: the lookup has to occur exactly between the two calls by vacuum, and there's not a lot that happens between them (mostly just a multixact truncate). In a standby server, however, the window is larger because the truncation is executed as soon as the WAL record for it is replayed, but the advance of the oldest-Xid is not executed until the next checkpoint record. To fix in the primary, simply reverse the order of operations in vac_truncate_clog. To fix in the standby, augment the WAL truncation record so that the standby is aware of the new oldest-XID value and can apply the update immediately. WAL version bumped because of this. No backpatch, because of the low importance of the bug and its rarity. Author: Craig Ringer Reviewed-By: Petr Jel&iacute;nek, Peter Eisentraut Discussion: <a target="_blank" href="https://postgr.es/m/CAMsr+YFhVtRQT1VAwC+WGbbxZZRzNou=N9Ed-FrCqkwQ8H8oJQ@mail.gmail.com">https://postgr.es/m/CAMsr+YFhVtRQT1VAwC+WGbbxZZRzNou=N9Ed-FrCqkwQ8H8oJQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8eace46d34ab6ac0d887aa4d3504bc4222c2e448">http://git.postgresql.org/pg/commitdiff/8eace46d34ab6ac0d887aa4d3504bc4222c2e448</a></li>
<li>tests: Use the right Perl operator. We were using != to compare strings, for which "ne" is the right thing. It's not clear why it works everywhere except on Pavan's machine, but it's clearly bogus anyway. Author and reporter: Pavan Deolasee Discussion: <a target="_blank" href="https://postgr.es/m/CABOikdPhsHM+pX8skoEY1_T0OtKdO1udzUj4VCjU5VEt+bj4eA@mail.gmail.com">https://postgr.es/m/CABOikdPhsHM+pX8skoEY1_T0OtKdO1udzUj4VCjU5VEt+bj4eA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a600ee9e3fcc43d4497d18d837f1e86148ca7580">http://git.postgresql.org/pg/commitdiff/a600ee9e3fcc43d4497d18d837f1e86148ca7580</a></li>
<li>Record dependencies on owners for logical replication objects. This was forgotten in 665d1fad99e7b11678b0d5fa24d2898424243cd6 and caused the whole buildfarm to become red for a little while. Author: Petr Jel&iacute;nek. Also fix a typo in a nearby error message. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/50cf1c80e6be80cc620749824fe9e3cd7f6c118e">http://git.postgresql.org/pg/commitdiff/50cf1c80e6be80cc620749824fe9e3cd7f6c118e</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Factor out logic for computing number of parallel workers. Forthcoming patches to allow other types of parallel scans will need this logic, or something like it. Dilip Kumar <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/716c7d4b242f0a64ad8ac4dc48c6fed6557ba12c">http://git.postgresql.org/pg/commitdiff/716c7d4b242f0a64ad8ac4dc48c6fed6557ba12c</a></li>
<li>Update information_schema queries and system views for new relkind. The original table partitioning patch overlooked this. Discussion: <a target="_blank" href="http://postgr.es/m/CAG1_KcDJiZB=L6yOUO_bVufj2q2851_xdkfhw0JdcD_2VtKssw@mail.gmail.com">http://postgr.es/m/CAG1_KcDJiZB=L6yOUO_bVufj2q2851_xdkfhw0JdcD_2VtKssw@mail.gmail.com</a> Keith Fiske and Amit Langote, adjusted by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/262e821deced47337d6d807515997567bb45fd7d">http://git.postgresql.org/pg/commitdiff/262e821deced47337d6d807515997567bb45fd7d</a></li>
<li>Add some more tests for tuple routing. Commit a25665088d812d08bb888e961f208eaebf522050 fixed some issues with how PartitionDispatch related code handled multi-level partitioned tables, but didn't add any tests. Discussion: <a target="_blank" href="http://postgr.es/m/CA%2BTgmoZ86v1G%2Bzx9etMiSQaBBvYMKfU-iitqZArSh5z0n8Q4cA%40mail.gmail.com">http://postgr.es/m/CA%2BTgmoZ86v1G%2Bzx9etMiSQaBBvYMKfU-iitqZArSh5z0n8Q4cA%40mail.gmail.com</a> Amit Langote, per a complaint from me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d26fa4fd47ae5f09c214e954ae9cf8a890bd3c35">http://git.postgresql.org/pg/commitdiff/d26fa4fd47ae5f09c214e954ae9cf8a890bd3c35</a></li>
<li>Avoid use of DROP TABLE .. CASCADE in partitioning tests. This isn't really guaranteed to always produce exactly the same output; the order can change from run to run. See related cleanup in 257d8157205a7be5f9799e8941b922521d678a25. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e509e7f9e3c565043e1186f5a83122d71653d111">http://git.postgresql.org/pg/commitdiff/e509e7f9e3c565043e1186f5a83122d71653d111</a></li>
<li>Improve comment in hashsearch.c. Typo fix from Mithun Cy; other improvements by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e37360d5df240443bb6e997d26d54f59146283fc">http://git.postgresql.org/pg/commitdiff/e37360d5df240443bb6e997d26d54f59146283fc</a></li>
<li>Fix failure to enforce partitioning contraint for internal partitions. When a tuple is inherited into a partitioning root, no partition constraints need to be enforced; when it is inserted into a leaf, the parent's partitioning quals needed to be enforced. The previous coding got both of those cases right. When a tuple is inserted into an intermediate level of the partitioning hierarchy (i.e. a table which is both a partition itself and in turn partitioned), it must enforce the partitioning qual inherited from its parent. That case got overlooked; repair. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/39162b2030fb0a35a6bb28dc636b5a71b8df8d1c">http://git.postgresql.org/pg/commitdiff/39162b2030fb0a35a6bb28dc636b5a71b8df8d1c</a></li>
<li>Fix RETURNING to work correctly with partition tuple routing. In ExecInsert(), do not switch back to the root partitioned table ResultRelInfo until after we finish ExecProcessReturning(), so that RETURNING projection is done using the partition's descriptor. For the projection to work correctly, we must initialize the same for each leaf partition during ModifyTableState initialization. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/05bd889904e03479a7169b1c36e0e1db13fff7cb">http://git.postgresql.org/pg/commitdiff/05bd889904e03479a7169b1c36e0e1db13fff7cb</a></li>
<li>Fix some problems in check_new_partition_bound(). Account for the fact that the highest bound less than or equal to the upper bound might be either the lower or the upper bound of the overlapping partition, depending on whether the proposed partition completely contains the existing partition or merely overlaps it. Also, we need not continue searching for even greater bound in partition_bound_bsearch() once we find the first bound that is *equal* to the probe, because we don't have duplicate datums. That spends cycles needlessly. Amit Langote, per a report from Amul Sul. Cosmetic changes by me. Discussion: <a target="_blank" href="http://postgr.es/m/CAAJ_b94XgbqVoXMyxxs63CaqWoMS1o2gpHiU0F7yGnJBnvDc_A%40mail.gmail.com">http://postgr.es/m/CAAJ_b94XgbqVoXMyxxs63CaqWoMS1o2gpHiU0F7yGnJBnvDc_A%40mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8a8afe2f54c27dbb47df3853803158c5205d41ce">http://git.postgresql.org/pg/commitdiff/8a8afe2f54c27dbb47df3853803158c5205d41ce</a></li>
<li>Avoid some code duplication in map_partition_varattnos(). Code to map attribute numbers in map_partition_varattnos() duplicates what convert_tuples_by_name_map() does. Avoid that. Amit Langote, per a report from &Aacute;lvaro Herrera. Discussion: <a target="_blank" href="http://postgr.es/m/9ce97382-54c8-deb3-9ee9-a2ec271d866b%40lab.ntt.co.jp">http://postgr.es/m/9ce97382-54c8-deb3-9ee9-a2ec271d866b%40lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cc144155f7cdd51e19984f82da6625dc75de9fda">http://git.postgresql.org/pg/commitdiff/cc144155f7cdd51e19984f82da6625dc75de9fda</a></li>
<li>Teach partitioning tests not to use DROP TABLE ... CASCADE. This occasionally causes failures; the order in which the affected objects are listed is not 100% consistent. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c3978149536a9c3fb837524407c58dec2b103c60">http://git.postgresql.org/pg/commitdiff/c3978149536a9c3fb837524407c58dec2b103c60</a></li>
<li>Fix comparison logic in partition_bounds_equal for non-finite bounds. If either bound is infinite, then we shouldn't even try to perform a comparison of the values themselves. Rearrange the logic so that we don't. Per buildfarm member skink and Tom Lane. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6546ffb35db78365d9f0011d75d16625e6040437">http://git.postgresql.org/pg/commitdiff/6546ffb35db78365d9f0011d75d16625e6040437</a></li>
<li>Avoid useless respawining the autovacuum launcher at high speed. When (1) autovacuum = off and (2) there's at least one database with an XID age greater than autovacuum_freeze_max_age and (3) all tables in that database that need vacuuming are already being processed by a worker and (4) the autovacuum launcher is started, a kind of infinite loop occurs. The launcher starts a worker and immediately exits. The worker, finding no worker to do, immediately starts the launcher, supposedly so that the next database can be processed. But because datfrozenxid for that database hasn't been advanced yet, the new worker gets put right back into the same database as the old one, where it once again starts the launcher and exits. High-speed ping pong ensues. There are several possible ways to break the cycle; this seems like the safest one. Amit Khandekar (code) and Robert Haas (comments), reviewed by &Aacute;lvaro Herrera. Discussion: <a target="_blank" href="http://postgr.es/m/CAJ3gD9eWejf72HKquKSzax0r+epS=nAbQKNnykkMA0E8c+rMDg@mail.gmail.com">http://postgr.es/m/CAJ3gD9eWejf72HKquKSzax0r+epS=nAbQKNnykkMA0E8c+rMDg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c6a389792e08980e395055ac219303cf4357ba33">http://git.postgresql.org/pg/commitdiff/c6a389792e08980e395055ac219303cf4357ba33</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Move targetlist SRF handling from expression evaluation to new executor node. Evaluation of set returning functions (SRFs_ in the targetlist (like SELECT generate_series(1,5)) so far was done in the expression evaluation (i.e. ExecEvalExpr()) and projection (i.e. ExecProject/ExecTargetList) code. This meant that most executor nodes performing projection, and most expression evaluation functions, had to deal with the possibility that an evaluated expression could return a set of return values. That's bad because it leads to repeated code in a lot of places. It also, and that's my (Andres's) motivation, made it a lot harder to implement a more efficient way of doing expression evaluation. To fix this, introduce a new executor node (ProjectSet) that can evaluate targetlists containing one or more SRFs. To avoid the complexity of the old way of handling nested expressions returning sets (e.g. having to pass up ExprDoneCond, and dealing with arguments to functions returning sets etc.), those SRFs can only be at the top level of the node's targetlist. The planner makes sure (via split_pathtarget_at_srfs()) that SRF evaluation is only necessary in ProjectSet nodes and that SRFs are only present at the top level of the node's targetlist. If there are nested SRFs the planner creates multiple stacked ProjectSet nodes. The ProjectSet nodes always get input from an underlying node. We also discussed and prototyped evaluating targetlist SRFs using ROWS FROM(), but that turned out to be more complicated than we'd hoped. While moving SRF evaluation to ProjectSet would allow to retain the old "least common multiple" behavior when multiple SRFs are present in one targetlist (i.e. continue returning rows until all SRFs are at the end of their input at the same time), we decided to instead only return rows till all SRFs are exhausted, returning NULL for already exhausted ones. We deemed the previous behavior to be too confusing, unexpected and actually not particularly useful. As a side effect, the previously prohibited case of multiple set returning arguments to a function, is now allowed. Not because it's particularly desirable, but because it ends up working and there seems to be no argument for adding code to prohibit it. Currently the behavior for COALESCE and CASE containing SRFs has changed, returning multiple rows from the expression, even when the SRF containing "arm" of the expression is not evaluated. That's because the SRFs are evaluated in a separate ProjectSet node. As that's quite confusing, we're likely to instead prohibit SRFs in those places. But that's still being discussed, and the code would reside in places not touched here, so that's a task for later. There's a lot of, now superfluous, code dealing with set return expressions around. But as the changes to get rid of those are verbose largely boring, it seems better for readability to keep the cleanup as a separate commit. Author: Tom Lane and Andres Freund Discussion: <a target="_blank" href="https://postgr.es/m/20160822214023.aaxz5l4igypowyri@alap3.anarazel.de">https://postgr.es/m/20160822214023.aaxz5l4igypowyri@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/69f4b9c85f168ae006929eec44fc44d569e846b9">http://git.postgresql.org/pg/commitdiff/69f4b9c85f168ae006929eec44fc44d569e846b9</a></li>
<li>Adapt python regression tests to 69f4b9c85f16. Hopefully this'll unbreak the buildfarm. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8b07aee8c5d803801c00103f0d61e32356aaf29c">http://git.postgresql.org/pg/commitdiff/8b07aee8c5d803801c00103f0d61e32356aaf29c</a></li>
<li>Remove obsoleted code relating to targetlist SRF evaluation. Since 69f4b9c plain expression evaluation (and thus normal projection) can't return sets of tuples anymore. Thus remove code dealing with that possibility. This will require adjustments in external code using ExecEvalExpr()/ExecProject() - that should neither be hard nor very common. Author: Andres Freund and Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/20160822214023.aaxz5l4igypowyri@alap3.anarazel.de">https://postgr.es/m/20160822214023.aaxz5l4igypowyri@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ea15e18677fc2eff3135023e27f69ed8821554ed">http://git.postgresql.org/pg/commitdiff/ea15e18677fc2eff3135023e27f69ed8821554ed</a></li>
<li>Fix platform dependant regression output triggered by 69f4b9c85f16. Due to the changed costing in that commit hash-aggregates started to be used, which results in big-endian vs. little-endian output differences. Disable hash-aggs for those tests. Author: Andres Freund, with input from Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/22891.1484791792@sss.pgh.pa.us">https://postgr.es/m/22891.1484791792@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/182200531a92204b0547d337f50b665d222af168">http://git.postgresql.org/pg/commitdiff/182200531a92204b0547d337f50b665d222af168</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Dump sequence data based on the TableDataInfo flag. When considering a sequence's Data entry in dumpSequenceData, we were actually looking at the sequence definition's dump flag to decide if we should dump the data or not. That's generally fine, except for when the sequence data entry was created by processExtensionTables() because it's a config sequence. In that case, the sequence itself won't be marked as dumping data because it's part of an extension, leading to the need for processExtensionTables() to create the sequence data entry. This leads to extension config sequence data not being included in the dump when it should be. Fix this by looking at the sequence data's dump flag instead, just as dumpTableData() was doing for tables (which is why config tables were correctly being handled), and add a regression test to make sure we don't break it moving forward. All of this is a bit round-about since we can now represent which components of a given dump item should be dumped out through the dump flag. A future improvement might be to change checkExtensionMembership() to check for config sequences/tables and set the dump flag based on that directly, possibly removing the need for processExtensionTables(). Bug found by Daniele Varrazzo. Discussion: <a target="_blank" href="https://postgr.es/m/CA+mi_8ZmxQM7+nZ7pJ8uyfxc9V3o=UAG14dVqvftdmvw8OJ3gQ@mail.gmail.com">https://postgr.es/m/CA+mi_8ZmxQM7+nZ7pJ8uyfxc9V3o=UAG14dVqvftdmvw8OJ3gQ@mail.gmail.com</a> Patch by Michael Paquier, with some tweaking of the regression tests by me. Back-patch to 9.6 where the bug was introduced. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/bec96c82f8ff4fcf7ef0f070f6f7447edf106de3">http://git.postgresql.org/pg/commitdiff/bec96c82f8ff4fcf7ef0f070f6f7447edf106de3</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Micha&euml;l Paquier and Karl O. Pinc traded patches to implement pg_current_logfile().</p>
<p>Micha&euml;l Paquier sent in another revision of a patch to rename pg_clog to pg_xact and pg_subtrans to pg_subxact.</p>
<p>Masahiko Sawada sent in two more revisions of a patch to support FDW transactions.</p>
<p>Amit Kapila sent in another revision of a patch to parallelize queries containing subplans.</p>
<p>Haribabu Kommi sent in four more revisions of a patch to implement a pg_hba_file_settings view.</p>
<p>Beena Emerson and Robert Haas traded patches to enable increasing WAL segment size.</p>
<p>Amit Kapila and Robert Haas traded patches to enable parallel index scans.</p>
<p>Micha&euml;l Paquier sent in a flock of back-patches for an issue in backups on standbys uncovered by sqlsmith.</p>
<p>Mithun Cy sent in another revision of a patch to cache hash index meta pages.</p>
<p>Nikita Glukhov sent in a patch to implement K-nearest-neighbor for B-Tree indexes.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel bitmap heap scan.</p>
<p>Magnus Hagander and Micha&euml;l Paquier traded patches to implement a version of jsonb_delete which takes arrays as input.</p>
<p>Haribabu Kommi sent in another revision of a patch to implement a pg_stat_sql view.</p>
<p>Etsuro Fujita sent in another revision of a patch to fix a bug in foreign joins.</p>
<p>David Rowley sent in two more revisions of a patch to improve performance for outer joins where the outer side is unique.</p>
<p>Haribabu Kommi sent in another revision of a patch to implement a 64-bit macaddr type.</p>
<p>Ashutosh Sharma sent in another revision of a patch to add pgstathashindex to the pgstattuple extension.</p>
<p>Ashutosh Sharma and Jesper Pedersen traded patches to add hash index support to pageinspect.</p>
<p>Petr Jel&iacute;nek sent in two more revisions of a patch to enable logical replication support for the initial data copy.</p>
<p>Petr Jel&iacute;nek sent in another revision of a patch to add RENAME support for PUBLICATIONs and SUBSCRIPTIONs.</p>
<p>Petr Jel&iacute;nek sent in a flock of patches to fix issues in logical replication.</p>
<p>Rafia Sabih sent in another revision of a patch to implement parallel index-only scans.</p>
<p>Pavan Deolasee sent in another revision of a patch to implement WARM.</p>
<p>Dmitry Fedin sent in a patch to change a misleading comment in pgtime.h.</p>
<p>Yugo Nagata sent in a patch to fix a comment in freelist.c.</p>
<p>Erik Rijkers sent in a patch to improve the logical replication documentation.</p>
<p>Jim Nasby sent in a patch to protect syscache from bloating with negative cache entries.</p>
<p>Petr Jel&iacute;nek sent in a patch to fix AFTER trigger execution in logical replication.</p>
<p>Tom Lane sent in another revision of a patch to prevent the possibility of UNKNOWN output columns.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/02/02/Nouvelles-hebdomadaires-de-PostgreSQL-22-janvier-2017">par chl le jeudi  2 février 2017 à 01h43</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi 19 janvier 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:f779c46232146513b78eb6f915d8bf99" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/01/19/Nouvelles-hebdomadaires-de-PostgreSQL-15-janvier-2017">Nouvelles hebdomadaires de PostgreSQL - 15 janvier 2017</a></h4>
<div class="entry">
<div class="content">
<p>[ndt: Meetup &agrave; Toulouse le 2 mars&nbsp;:<a href="https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/">https://www.meetup.com/fr-FR/PostgreSQL-User-Group-Toulouse/</a>]</p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>postgresql-unit 2.0, une extension impl&eacute;mentant les types de donn&eacute;es correspondant aux unit&eacute;s SI, &agrave; quelques unit&eacute;s non-SI et aux octets&nbsp;: <a target="_blank" href="https://github.com/ChristophBerg/postgresql-unit">https://github.com/ChristophBerg/postgresql-unit</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en janvier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-01/">http://archives.postgresql.org/pgsql-jobs/2017-01/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 s'&eacute;tendra du 17 au 18 mars &agrave; Singapour. L'appel &agrave; conf&eacute;renciers s'&eacute;teindra le 16 janvier 2017&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017. L'appel &agrave; conf&eacute;renciers expire le 9 janvier 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/cfp/">https://2017.nordicpgday.org/cfp/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 9 janvier&nbsp;: <a target="_blank" href="http://2017.pgday.paris/callforpapers/">http://2017.pgday.paris/callforpapers/</a></li>
<li>La <em>PGConf US 2017</em> aura lieu &agrave; Jersey City (New Jersey, USA) du 28 au 31 mars&nbsp;: <a target="_blank" href="http://www.pgconf.us/2017/">http://www.pgconf.us/2017/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai. Les propositions seront attendues jusqu'au 19 janvier 2017&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170116044539.GA14726@fetter.org">http://www.postgresql.org/message-id/20170116044539.GA14726@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Use an enum instead of two bools to indicate wal inclusion in base backups. This makes the code easier to read as it becomes more explicit what the different allowed combinations really are. Suggested by Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/534b6f3ef29a11d19deeef6cef3bc8d4984de3c8">http://git.postgresql.org/pg/commitdiff/534b6f3ef29a11d19deeef6cef3bc8d4984de3c8</a></li>
<li>Fix some typos in comments. Masahiko Sawada <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/268f9e3d9292af1d6ca9aa66b42daac2ef1a0987">http://git.postgresql.org/pg/commitdiff/268f9e3d9292af1d6ca9aa66b42daac2ef1a0987</a></li>
<li>Change default values for backup and replication parameters. This changes the default values of the following parameters: wal_level = replica, max_wal_senders = 10, max_replication_slots = 10, in order to make it possible to make a backup and set up simple replication on the default settings, without requiring a system restart. Discussion: <a target="_blank" href="https://postgr.es/m/CABUevEy4PR_EAvZEzsbF5s+V0eEvw7shJ2t-AUwbHOjT+yRb3A@mail.gmail.com">https://postgr.es/m/CABUevEy4PR_EAvZEzsbF5s+V0eEvw7shJ2t-AUwbHOjT+yRb3A@mail.gmail.com</a> Reviewed by Peter Eisentraut. Benchmark help from Tomas Vondra. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f6d6d2920d2cddc4b381cbbf2915db9d985d20a9">http://git.postgresql.org/pg/commitdiff/f6d6d2920d2cddc4b381cbbf2915db9d985d20a9</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Expand the regression tests for PL/Tcl. This raises the test coverage (by line count) in pltcl.c from about 70% to 86%. Karl Lehenbauer and Jim Nasby Discussion: <a target="_blank" href="https://postgr.es/m/92a1670d-21b6-8f03-9c13-e4fb2207ab7b@BlueTreble.com">https://postgr.es/m/92a1670d-21b6-8f03-9c13-e4fb2207ab7b@BlueTreble.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/961bed0208912a929a47c5a30190ff76748f3a03">http://git.postgresql.org/pg/commitdiff/961bed0208912a929a47c5a30190ff76748f3a03</a></li>
<li>Fix error handling in pltcl_returnnext. We can't throw elog(ERROR) out of a Tcl command procedure; we have to catch the error and return TCL_ERROR to the Tcl interpreter. pltcl_returnnext failed to meet this requirement, so that errors detected by pltcl_build_tuple_result or other functions called here led to longjmp'ing out of the Tcl interpreter and thereby leaving it in a bad state. Use the existing subtransaction support to prevent that. Oversight in commit 26abb50c4, found more or less accidentally by the buildfarm thanks to the tests added in 961bed020. Report: <a target="_blank" href="https://postgr.es/m/30647.1483989734@sss.pgh.pa.us">https://postgr.es/m/30647.1483989734@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8c5722948e831c1862a39da2bb5d793a6f2aabab">http://git.postgresql.org/pg/commitdiff/8c5722948e831c1862a39da2bb5d793a6f2aabab</a></li>
<li>Fix field order in struct catcache. Somebody failed to grasp the point of having the #ifdef CATCACHE_STATS fields at the end of the struct. Put that back the way it should be, and add a comment making it more explicit why it should be that way. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e2117e4ab0d7fcb76f20cbf2e52541998d639d9e">http://git.postgresql.org/pg/commitdiff/e2117e4ab0d7fcb76f20cbf2e52541998d639d9e</a></li>
<li>In PL/Tcl tests, don't choke if optional error fields are missing. This fixes a portability issue introduced by commit 961bed020: with a compiler that doesn't support PG_FUNCNAME_MACRO, the "funcname" field of errorCode won't be provided, leading to a failure of the unset command. I added -nocomplain to the unset commands for filename and lineno too, just in case, though I know of no platform that wouldn't populate those fields. (BTW, -nocomplain is new in Tcl 8.4, but fortunately we dropped support for pre-8.4 Tcl some time ago.) Per buildfarm member pademelon. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5b29e6b688d1e783a098aa24f9e795f8de798a87">http://git.postgresql.org/pg/commitdiff/5b29e6b688d1e783a098aa24f9e795f8de798a87</a></li>
<li>Fix some more regression test row-order-instability issues. Commit 0563a3a8b just introduced another instance of the same unsafe testing methodology that appeared in 2ac3ef7a0, which I corrected in 257d81572. Robert/Amit, please stop doing that. Also look through the rest of f0e44751d's test cases, and correct some other queries with underdetermined ordering of results from the system catalogs. These haven't failed in the buildfarm yet, but I don't have any confidence in that staying true. Per multiple buildfarm members. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5ad966ab1c50e829462f2b3e3ffa59e2d95479e6">http://git.postgresql.org/pg/commitdiff/5ad966ab1c50e829462f2b3e3ffa59e2d95479e6</a></li>
<li>Throw suitable error for COPY TO STDOUT/FROM STDIN in a SQL function. A client copy can't work inside a function because the FE/BE wire protocol doesn't support nesting of a COPY operation within query results. (Maybe it could, but the protocol spec doesn't suggest that clients should support this, and libpq for one certainly doesn't.) In most PLs, this prohibition is enforced by spi.c, but SQL functions don't use SPI. A comparison of _SPI_execute_plan() and init_execution_state() shows that rejecting client COPY is the only discrepancy in what they allow, so there's no other similar bugs. This is an astonishingly ancient oversight, so back-patch to all supported branches. Report: <a target="_blank" href="https://postgr.es/m/BY2PR05MB2309EABA3DEFA0143F50F0D593780@BY2PR05MB2309.namprd05.prod.outlook.com">https://postgr.es/m/BY2PR05MB2309EABA3DEFA0143F50F0D593780@BY2PR05MB2309.namprd05.prod.outlook.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/75abb955dfef064f2fbc5c043f37fff8d0262ffe">http://git.postgresql.org/pg/commitdiff/75abb955dfef064f2fbc5c043f37fff8d0262ffe</a></li>
<li>Change representation of statement lists, and add statement location info. This patch makes several changes that improve the consistency of representation of lists of statements. It's always been the case that the output of parse analysis is a list of Query nodes, whatever the types of the individual statements in the list. This patch brings similar consistency to the outputs of raw parsing and planning steps: * The output of raw parsing is now always a list of RawStmt nodes; the statement-type-dependent nodes are one level down from that. * The output of pg_plan_queries() is now always a list of PlannedStmt nodes, even for utility statements. In the case of a utility statement, "planning" just consists of wrapping a CMD_UTILITY PlannedStmt around the utility node. This list representation is now used in Portal and CachedPlan plan lists, replacing the former convention of intermixing PlannedStmts with bare utility-statement nodes. Now, every list of statements has a consistent head-node type depending on how far along it is in processing. This allows changing many places that formerly used generic "Node *" pointers to use a more specific pointer type, thus reducing the number of IsA() tests and casts needed, as well as improving code clarity. Also, the post-parse-analysis representation of DECLARE CURSOR is changed so that it looks more like EXPLAIN, PREPARE, etc. That is, the contained SELECT remains a child of the DeclareCursorStmt rather than getting flipped around to be the other way. It's now true for both Query and PlannedStmt that utilityStmt is non-null if and only if commandType is CMD_UTILITY. That allows simplifying a lot of places that were testing both fields. (I think some of those were just defensive programming, but in many places, it was actually necessary to avoid confusing DECLARE CURSOR with SELECT.) Because PlannedStmt carries a canSetTag field, we're also able to get rid of some ad-hoc rules about how to reconstruct canSetTag for a bare utility statement; specifically, the assumption that a utility is canSetTag if and only if it's the only one in its list. While I see no near-term need for relaxing that restriction, it's nice to get rid of the ad-hocery. The API of ProcessUtility() is changed so that what it's passed is the wrapper PlannedStmt not just the bare utility statement. This will affect all users of ProcessUtility_hook, but the changes are pretty trivial; see the affected contrib modules for examples of the minimum change needed. (Most compilers should give pointer-type-mismatch warnings for uncorrected code.) There's also a change in the API of ExplainOneQuery_hook, to pass through cursorOptions instead of expecting hook functions to know what to pick. This is needed because of the DECLARE CURSOR changes, but really should have been done in 9.6; it's unlikely that any extant hook functions know about using CURSOR_OPT_PARALLEL_OK. Finally, teach gram.y to save statement boundary locations in RawStmt nodes, and pass those through to Query and PlannedStmt nodes. This allows more intelligent handling of cases where a source query string contains multiple statements. This patch doesn't actually do anything with the information, but a follow-on patch will. (Passing this information through cleanly is the true motivation for these changes; while I think this is all good cleanup, it's unlikely we'd have bothered without this end goal.) catversion bump because addition of location fields to struct Query affects stored rules. This patch is by me, but it owes a good deal to Fabien Coelho who did a lot of preliminary work on the problem, and also reviewed the patch. Discussion: <a target="_blank" href="https://postgr.es/m/alpine.DEB.2.20.1612200926310.29821@lancre">https://postgr.es/m/alpine.DEB.2.20.1612200926310.29821@lancre</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ab1f0c8225714aaa18d2f9ca4f80cd009f145421">http://git.postgresql.org/pg/commitdiff/ab1f0c8225714aaa18d2f9ca4f80cd009f145421</a></li>
<li>Teach contrib/pg_stat_statements to handle multi-statement commands better. Make use of the statement boundary info added by commit ab1f0c822 to let pg_stat_statements behave more sanely when multiple SQL queries are jammed into one query string. It now records just the relevant part of the source string, not the whole thing, for each individual query. Even when no multi-statement strings are involved, users may notice small changes in the output: leading and trailing whitespace and semicolons will be stripped from statements, which did not happen before. Also, significantly expand pg_stat_statements' regression test script. Fabien Coelho, reviewed by Craig Ringer and Kyotaro Horiguchi, some mods by me Discussion: <a target="_blank" href="https://postgr.es/m/alpine.DEB.2.20.1612200926310.29821@lancre">https://postgr.es/m/alpine.DEB.2.20.1612200926310.29821@lancre</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/83f2061dd037477ec8479ee160367840e203a722">http://git.postgresql.org/pg/commitdiff/83f2061dd037477ec8479ee160367840e203a722</a></li>
<li>Fix matching of boolean index columns to sort ordering. Normally, if we have a WHERE clause like "indexcol = constant", the planner will figure out that that index column can be ignored when determining whether the index has a desired sort ordering. But this failed to work for boolean index columns, because a condition like "boolcol = true" is canonicalized to just "boolcol" which does not give rise to an EquivalenceClass. Add a check to allow the same type of deduction to be made in this case too. Per a complaint from Dima Pavlov. Arguably this is a bug, but given the limited impact and the small number of complaints so far, I won't risk destabilizing plans in stable branches by back-patching. Patch by me, reviewed by Michael Paquier Discussion: <a target="_blank" href="https://postgr.es/m/1788.1481605684@sss.pgh.pa.us">https://postgr.es/m/1788.1481605684@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0777f7a2e8e0a51f0f60cfe164d538bb459bf9f2">http://git.postgresql.org/pg/commitdiff/0777f7a2e8e0a51f0f60cfe164d538bb459bf9f2</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>BRIN revmap pages are not standard pages, and therefore we ought not to tell XLogRegisterBuffer the opposite, when writing XLog for a brin update that moves the index tuple to a different page. Otherwise, xlog insertion would try to "compress the hole" when producing a full-page image for it; but since we don't update pd_lower/upper, the hole covers the whole page. On WAL replay, the revmap page becomes empty and so the entire portion of the index is useless and needs to be recomputed. This is low-probability: a BRIN update only moves an index tuple to a different page when the summary tuple is larger than the existing one, which doesn't happen with fixed-width datatypes. Also, the revmap page must be first after a checkpoint. Report and patch: Kuntal Ghosh Bug is alleged to have detected by a WAL-consistency-checking tool. Discussion: <a target="_blank" href="https://postgr.es/m/CAGz5QCJ=00UQjScSEFbV=0qO5ShTZB9WWz_Fm7+Wd83zPs9Geg@mail.gmail.com">https://postgr.es/m/CAGz5QCJ=00UQjScSEFbV=0qO5ShTZB9WWz_Fm7+Wd83zPs9Geg@mail.gmail.com</a> I posted a test case demonstrating the problem, but I'm refraining from adding it to the test suite; if the WAL consistency tool makes it in, that will be a better way to catch this from regressing. (We should definitely have someting that causes not-same-page updates, though.) <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7403561c0f6a8c62b79b6ddf0364ae6c01719068">http://git.postgresql.org/pg/commitdiff/7403561c0f6a8c62b79b6ddf0364ae6c01719068</a></li>
<li>Fix ALTER TABLE / SET TYPE for irregular inheritance. If inherited tables don't have exactly the same schema, the USING clause in an ALTER TABLE / SET DATA TYPE misbehaves when applied to the children tables since commit 9550e8348b79. Starting with that commit, the attribute numbers in the USING expression are fixed during parse analysis. This can lead to bogus errors being reported during execution, such as: ERROR: attribute 2 has wrong type DETAIL: Table has type smallint, but query expects integer. Since it wouldn't do to revert to the original coding, we now apply a transformation to map the attribute numbers to the correct ones for each child. Reported by Justin Pryzby Analysis by Tom Lane; patch by me. Discussion: <a target="_blank" href="https://postgr.es/m/20170102225618.GA10071@telsasoft.com">https://postgr.es/m/20170102225618.GA10071@telsasoft.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3957b58b8885441c8d03bc1cfc00e47cf8cd7975">http://git.postgresql.org/pg/commitdiff/3957b58b8885441c8d03bc1cfc00e47cf8cd7975</a></li>
<li>Fix overflow check in StringInfo; add missing casts. A few thinkos I introduced in fa2fa9955280. Also, amend a similarly broken comment. Report by Daniel V&Atilde;&copy;rit&Atilde;&copy;. Authors: Daniel V&Atilde;&copy;rit&Atilde;&copy;, &Atilde;lvaro Herrera Discussion: <a target="_blank" href="https://postgr.es/m/1706e85e-60d2-494e-8a64-9af1e1b2186e@manitou-mail.org">https://postgr.es/m/1706e85e-60d2-494e-8a64-9af1e1b2186e@manitou-mail.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/42f50cb8fa9848bbbc6776bcea03293a6b28b2d4">http://git.postgresql.org/pg/commitdiff/42f50cb8fa9848bbbc6776bcea03293a6b28b2d4</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Fix invalid-parallel-jobs error message. Including the program name twice is not helpful: -&gt; pg_dump -j -1 pg_dump: pg_dump: invalid number of parallel jobs Correct by removing the progname from the exit_horribly() call used when validating the number of parallel jobs. Noticed while testing various pg_dump error cases. Back-patch to 9.3 where parallel pg_dump was added. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2ef6fe9cbae9fe7789a35cbc5fa1bbf78c163d42">http://git.postgresql.org/pg/commitdiff/2ef6fe9cbae9fe7789a35cbc5fa1bbf78c163d42</a></li>
<li>pg_dump: Strict names with no matching schema. When using pg_dump --strict-names and a schema pattern which doesn't match any schemas (eg: --schema='nonexistant*'), we were incorrectly throwing an error claiming no tables were found when, really, there were no schemas found: -&gt; pg_dump --strict-names --schema='nonexistant*' pg_dump: no matching tables were found for pattern "nonexistant*" Fix that by changing the error message to say 'schemas' instead, since that is what we are actually complaining about. Noticed while testing pg_dump error cases. Back-patch to 9.6 where --strict-names and this error message were introduced. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/abfd0095c1e1a2e3fad2696516b64871895334ec">http://git.postgresql.org/pg/commitdiff/abfd0095c1e1a2e3fad2696516b64871895334ec</a></li>
<li>pg_restore: Don't allow non-positive number of jobs. pg_restore will currently accept invalid values for the number of parallel jobs to run (eg: -1), unlike pg_dump which does check that the value provided is reasonable. Worse, '-1' is actually a valid, independent, parameter (as an alias for --single-transaction), leading to potentially completely unexpected results from a command line such as: -&gt; pg_restore -j -1 Where a user would get neither parallel jobs nor a single-transaction. Add in validity checking of the parallel jobs option, as we already have in pg_dump, before we try to open up the archive. Also move the check that we haven't been asked to run more parallel jobs than possible on Windows to the same place, so we do all the option validity checking before opening the archive. Back-patch all the way, though for 9.2 we're adding the Windows-specific check against MAXIMUM_WAIT_OBJECTS as that check wasn't back-patched originally. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20170110044815.GC18360%40tamriel.snowman.net">https://www.postgresql.org/message-id/20170110044815.GC18360%40tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e72059f3757594c5530ce321acdbe67f0da5da13">http://git.postgresql.org/pg/commitdiff/e72059f3757594c5530ce321acdbe67f0da5da13</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Improve coding in _hash_addovflpage. Instead of relying on the page contents to know whether we have advanced from the primary bucket page to an overflow page, track that explicitly. Amit Kapila, per a complaint by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e898437460f55b49623d1aea435cd92e0011d54d">http://git.postgresql.org/pg/commitdiff/e898437460f55b49623d1aea435cd92e0011d54d</a></li>
<li>Fix incorrect function name in comment. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/76568d37865c5c21ae154008b2c681e3e32ac880">http://git.postgresql.org/pg/commitdiff/76568d37865c5c21ae154008b2c681e3e32ac880</a></li>
<li>Fix cardinality estimates for parallel joins. For a partial path, the cardinality estimate needs to reflect the number of rows we think each worker will see, rather than the total number of rows; otherwise, costing will go wrong. The previous coding got this completely wrong for parallel joins. Unfortunately, this change may destabilize plans for users of 9.6 who have enabled parallel query, but since 9.6 is still fairly new I'm hoping expectations won't be too settled yet. Also, this is really a brown-paper-bag bug, so leaving it unfixed for the entire lifetime of 9.6 seems unwise. Related reports (whose import I initially failed to recognize) by Tomas Vondra and Tom Lane. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoaDxZ5z5Kw_oCQoymNxNoVaTCXzPaODcOuao=CzK8dMZw@mail.gmail.com">http://postgr.es/m/CA+TgmoaDxZ5z5Kw_oCQoymNxNoVaTCXzPaODcOuao=CzK8dMZw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0c2070cefa0e5d097b715c9a3b9b5499470019aa">http://git.postgresql.org/pg/commitdiff/0c2070cefa0e5d097b715c9a3b9b5499470019aa</a></li>
<li>Fix a bug in how we generate partition constraints. Move the code for doing parent attnos to child attnos mapping for Vars in partition constraint expressions to a separate function map_partition_varattnos() and call it from the appropriate places. Doing it in get_qual_from_partbound(), as is now, would produce wrong result in certain multi-level partitioning cases, because it only considers the current pair of parent-child relations. In certain multi-level partitioning cases, attnums for the same key attribute(s) might differ between various levels causing the same attribute to be numbered differently in different instances of the Var corresponding to a given attribute. With this commit, in generate_partition_qual(), we first generate the the whole partition constraint (considering all levels of partitioning) and then do the mapping, so that Vars in the final expression are numbered according the leaf relation (to which it is supposed to apply). Amit Langote, reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0563a3a8b59150bf3cc8b2b7077f684e0eaf8aff">http://git.postgresql.org/pg/commitdiff/0563a3a8b59150bf3cc8b2b7077f684e0eaf8aff</a></li>
</ul>
<p>Bruce Momjian pushed:</p>
<ul>
<li>pg_xlogdump: document --path behavior. The previous --path documentation and --help output were wrong in both its meaning and the defaults. Reviewed-by: Michael Paquier Backpatch-through: 9.6 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/73f8d7331343cefaaa97a0039421158fc8462c81">http://git.postgresql.org/pg/commitdiff/73f8d7331343cefaaa97a0039421158fc8462c81</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Make whitespace consistent inside some script files. I don't know what the global standard might be, but at least adjacent code should use the same whitespace. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/da0dbea9c30e7c91e9e78d72ab3dbee77d7ca0cd">http://git.postgresql.org/pg/commitdiff/da0dbea9c30e7c91e9e78d72ab3dbee77d7ca0cd</a></li>
<li>Fix mistake in comment. The node-&gt;restart() function doesn't take a mode argument. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/750c59d7ec573f9443af2eb7d9186946bc7e008c">http://git.postgresql.org/pg/commitdiff/750c59d7ec573f9443af2eb7d9186946bc7e008c</a></li>
<li>pg_upgrade: Fix for changed pg_ctl default stop mode. In 9.5, the default pg_ctl stop mode was changed from "smart" to "fast". pg_upgrade still thought the default mode was "smart" and only specified the mode when "fast" was asked for. This results in using "fast" all the time. It's not clear what the effect in practice is, but fix it nonetheless to restore the previous behavior. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7f5b043d69a83e44e22a6b42f902e3e268b80a24">http://git.postgresql.org/pg/commitdiff/7f5b043d69a83e44e22a6b42f902e3e268b80a24</a></li>
<li>Updates to reflect that pg_ctl stop -m fast is the default. Various example and test code used -m fast explicitly, but since it's the default, this can be omitted now or should be replaced by a better example. pg_upgrade is not touched, so it can continue to operate with older installations. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e574f15d6295b12c03ef8810c00976b65933711a">http://git.postgresql.org/pg/commitdiff/e574f15d6295b12c03ef8810c00976b65933711a</a></li>
<li>pg_ctl: Change default to wait for all actions. The different actions in pg_ctl had different defaults for -w and -W, mostly for historical reasons. Most users will want the -w behavior, so make that the default. Remove the -w option in most example and test code, so avoid confusion and reduce verbosity. pg_upgrade is not touched, so it can continue to work with older installations. Reviewed-by: Beena Emerson &lt;memissemerson@gmail.com&gt; Reviewed-by: Ryan Murphy &lt;ryanfmurphy@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/05cd12ed5bc74c853a161c5a138a0cb6f9b0cb8a">http://git.postgresql.org/pg/commitdiff/05cd12ed5bc74c853a161c5a138a0cb6f9b0cb8a</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Amul Sul sent in two more revisions of a patch to implement pg_background.</p>
<p>Dilip Kumar sent in four more revisions of a patch to implement parallel bitmap heap scan.</p>
<p>Euler Taveira de Oliveira sent in another revision of a patch to move collation import to the backend.</p>
<p>Anastasia Lubennikova and Erik Rijkers traded patches to implement covering + unique indexes.</p>
<p>Takayuki Tsunakawa sent in another revision of a patch to support huge pages on Windows.</p>
<p>Jon Nelson sent in another revision of a patch to guc-ify the formerly hard-coded MAX_SEND_SIZE to max_wal_send.</p>
<p>&Atilde;lvaro Herrera sent in another revision of a patch to help fix pg_dump and COPY bugs around big lines.</p>
<p>David Fetter sent in three more revisions of a patch to add an extension that disallows simple UPDATEs and DELETEs that lack any WHERE clause.</p>
<p>&Atilde;lvaro Herrera sent in a patch to remove floats from the bootstrap scanner and parser.</p>
<p>Antonin Houska sent in two revisions of a patch to implement grouped base relation, which is infrastructure for distributed aggregation.</p>
<p>Vladimir Rusinov sent in four more revisions of a patch to rename things *xlog* to things *wal*.</p>
<p>Keith Fiske and Amit Langote traded patches to fix up declarative partitioning.</p>
<p>Haribabu Kommi sent in another revision of a patch to add macaddr 64 bit (EUI-64) datatype support.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two more revisions of a patch to add compression-level adjustment to pg_receivelog.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to implement radix trees for character conversion.</p>
<p>Ashutosh Sharma sent in another revision of a patch to add microvacuum support for hash indexes.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to implement \gstore and friends in psql.</p>
<p>Matheus de Oliveira sent in another revision of a patch to add ALTER DEFAULT PRIVILEGES with GRANT/REVOKE ON SCHEMAS.</p>
<p>Rafia Sabih sent in two revisions of a patch to enable passing query string to workers.</p>
<p>Jesper Pedersen and Ashutosh Sharma traded patches to add hash index support to the pageinspect contrib extension.</p>
<p>Nikita Glukhovs sent in another revision of a patch to add a recursive version of json_populate_record().</p>
<p>David Rowley sent in a patch to make connection_limit ignore bgworkers.</p>
<p>Peter Eisentraut sent in a patch to factor out the many copies of atooid.</p>
<p>Robert Haas sent in another revision of a patch to implement gather merge.</p>
<p>Etsuro Fujita sent in a patch to rearrange some function declarations for correctness.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add some checks to PL/pgsql.</p>
<p>Fabien COELHO and Rafia Sabih traded patches to give pgbench a way to use backslash as a continuation character.</p>
<p>&Atilde;lvaro Herrera and Pavel St&Auml;&rsaquo;hule traded patches to implement xmltable().</p>
<p>Amit Kapila sent in another revision of a patch to add WAL logging for hash indexes.</p>
<p>Mithun Cy sent in another revision of a patch to cache hash index meta pages.</p>
<p>Etsuro Fujita sent in another revision of a patch to push more FULL JOINs down to FDWs.</p>
<p>Ashutosh Bapat sent in a patch to remove an unused member root in foreign_glob_cxt.</p>
<p>Dmitry Dolgov sent in another revision of a patch to implement generic type subscripts.</p>
<p>Gilles Darold and Karl O. Pinc traded patches to implement pg_current_logfile().</p>
<p>Rafia Sabih sent in another revision of a patch to add parallel index-only scan.</p>
<p>Mithun Cy sent in a patch to fix a typo in a comment in hashsearch.c.</p>
<p>Ants Aasma sent in another revision of a patch to send hot standby feedback on first connect.</p>
<p>Anastasia Lubennikova sent in a patch to implement IF NOT EXISTS option for CREATE SERVER and CREATE USER MAPPING statements.</p>
<p>Amit Khandekar sent in a patch to prevent useless VACUUMs.</p>
<p>Peter Moser sent in another revision of a patch to implement temporal query processing with range types.</p>
<p>Etsuro Fujita sent in another revision of a patch to fix a bug in the Postgres FDW.</p>
<p>Amit Kapila sent in another revision of a patch to parallelize queries containing subplans.</p>
<p>Petr Jel&Atilde;&shy;nek sent in two more revisions of a patch to implement logical replication.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/01/19/Nouvelles-hebdomadaires-de-PostgreSQL-15-janvier-2017">par chl le jeudi 19 janvier 2017 à 23h47</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>dimanche 15 janvier 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:8a65793dbb3a306a3e806d199ac35e93" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/01/15/Nouvelles-hebdomadaires-de-PostgreSQL-8-janvier-2017">Nouvelles hebdomadaires de PostgreSQL - 8 janvier 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>barman 2.1, un gestionnaire de sauvegarde et restauration pour PostgreSQL&nbsp;: <a target="_blank" href="http://docs.pgbarman.org/release/2.1/">http://docs.pgbarman.org/release/2.1/</a></li>
<li>repmgr 3.3, un gestionnaire de r&eacute;plication pour PostgreSQL&nbsp;: <a target="_blank" href="http://repmgr.org/release-notes-3.3.html">http://repmgr.org/release-notes-3.3.html</a></li>
<li>pgquarrel 0.2.0, un outil comparant des sch&eacute;mas de BD PostgreSQL et produisant un ensemble de commandes pour convertir l'un des sch&eacute;mas vers le second&nbsp;: <a target="_blank" href="http://eulerto.github.io/pgquarrel">http://eulerto.github.io/pgquarrel</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en janvier</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2017-01/">http://archives.postgresql.org/pgsql-jobs/2017-01/</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 s'&eacute;tendra du 17 au 18 mars &agrave; Singapour. L'appel &agrave; conf&eacute;renciers s'&eacute;teindra le 16 janvier 2017&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017. L'appel &agrave; conf&eacute;renciers expire le 9 janvier 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/cfp/">https://2017.nordicpgday.org/cfp/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 9 janvier&nbsp;: <a target="_blank" href="http://2017.pgday.paris/callforpapers/">http://2017.pgday.paris/callforpapers/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai. Les propositions seront attendues jusqu'au 19 janvier 2017&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170109204928.GA13529@fetter.org">http://www.postgresql.org/message-id/20170109204928.GA13529@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>In pgbench logging, avoid assuming that instr_times match Unix timestamps. For aggregated logging, pg_bench supposed that printing the integer part of INSTR_TIME_GET_DOUBLE() would produce a Unix timestamp. That was already broken on Windows, and it's about to get broken on most other platforms as well. As in commit 74baa1e3b, we can remove the entanglement at the price of one extra syscall per transaction; though here it seems more convenient to use time(NULL) instead of gettimeofday(), since we only need integral-second precision. I took the time to do some wordsmithing on the documentation about pgbench's logging features, too. Discussion: <a target="_blank" href="https://postgr.es/m/8837.1483216839@sss.pgh.pa.us">https://postgr.es/m/8837.1483216839@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/67a875355e4a6db294e9652af5a883876ddeb4a5">http://git.postgresql.org/pg/commitdiff/67a875355e4a6db294e9652af5a883876ddeb4a5</a></li>
<li>Use clock_gettime(), if available, in instr_time measurements. The advantage of clock_gettime() is that the API allows the result to be precise to nanoseconds, not just microseconds as in gettimeofday(). Now that it's routinely possible to do tens of plan node executions in 1us, we really need more precision than gettimeofday() can offer for EXPLAIN ANALYZE to accumulate statistics with. Some research shows that clock_gettime() is available on pretty nearly every modern Unix-ish platform, and as far as I have been able to test, it has about the same execution time as gettimeofday(), so there's no loss in switching over. (By the same token, this doesn't do anything to fix the fact that we really wish clock readings were faster. But there's enough win here to justify changing anyway.) A small side benefit is that on most platforms, we can use CLOCK_MONOTONIC instead of CLOCK_REALTIME and thereby render EXPLAIN impervious to concurrent resets of the system clock. (This means that code must not assume that the contents of struct instr_time have any well-defined interpretation as timestamps, but really that was true before.) Some platforms offer nonstandard clock IDs that might be of interest. This patch knows we should use CLOCK_MONOTONIC_RAW on macOS, because it provides more precision and is faster to read than their CLOCK_MONOTONIC. If there turn out to be many more cases where we need special rules, it might be appropriate to handle the selection of clock ID in configure, but for the moment that doesn't seem worth the trouble. Discussion: <a target="_blank" href="https://postgr.es/m/31856.1400021891@sss.pgh.pa.us">https://postgr.es/m/31856.1400021891@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1d63f7d2d180c8708bc12710254eb7b45823440f">http://git.postgresql.org/pg/commitdiff/1d63f7d2d180c8708bc12710254eb7b45823440f</a></li>
<li>Allow SSL configuration to be updated at SIGHUP. It is no longer necessary to restart the server to enable, disable, or reconfigure SSL. Instead, we just create a new SSL_CTX struct (by re-reading all relevant files) whenever we get SIGHUP. Testing shows that this is fast enough that it shouldn't be a problem. In conjunction with that, downgrade the logic that complains about pg_hba.conf "hostssl" lines when SSL isn't active: now that's just a warning condition not an error. An issue that still needs to be addressed is what shall we do with passphrase-protected server keys? As this stands, the server would demand the passphrase again on every SIGHUP, which is certainly impractical. But the case was only barely supported before, so that does not seem a sufficient reason to hold up committing this patch. Andreas Karlsson, reviewed by Michael Banck and Michael Paquier Discussion: <a target="_blank" href="https://postgr.es/m/556A6E8A.9030400@proxel.se">https://postgr.es/m/556A6E8A.9030400@proxel.se</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/de41869b64d57160f58852eab20a27f248188135">http://git.postgresql.org/pg/commitdiff/de41869b64d57160f58852eab20a27f248188135</a></li>
<li>Disable prompting for passphrase while (re)loading SSL config files. OpenSSL's default behavior when loading a passphrase-protected key file is to open /dev/tty and demand the password from there. It was kinda sorta okay to allow that to happen at server start, but really that was never workable in standard daemon environments. And it was a complete fail on Windows, where the same thing would happen at every backend launch. Yesterday's commit de41869b6 put the final nail in the coffin by causing that to happen at every SIGHUP; even if you've still got a terminal acting as the server's TTY, having the postmaster freeze until you enter the passphrase again isn't acceptable. Hence, override the default behavior with a callback that returns an empty string, ensuring failure. Change the documentation to say that you can't have a passphrase-protected server key, period. If we can think of a production-grade way of collecting a passphrase from somewhere, we might do that once at server startup and use this callback to feed it to OpenSSL, but it's far from clear that anyone cares enough to invest that much work in the feature. The lack of complaints about the existing fractionally-baked behavior suggests nobody's using it anyway. Discussion: <a target="_blank" href="https://postgr.es/m/29982.1483412575@sss.pgh.pa.us">https://postgr.es/m/29982.1483412575@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1e942c7474d7b5e4bfa04918d2f68d95902f17b3">http://git.postgresql.org/pg/commitdiff/1e942c7474d7b5e4bfa04918d2f68d95902f17b3</a></li>
<li>Re-allow SSL passphrase prompt at server start, but not thereafter. Leave OpenSSL's default passphrase collection callback in place during the first call of secure_initialize() in server startup. Although that doesn't work terribly well in daemon contexts, some people feel we should not break it for anyone who was successfully using it before. We still block passphrase demands during SIGHUP, meaning that you can't adjust SSL configuration on-the-fly if you used a passphrase, but this is no worse than what it was before commit de41869b6. And we block passphrase demands during EXEC_BACKEND reloads; that behavior wasn't useful either, but at least now it's documented. Tweak some related log messages for more readability, and avoid issuing essentially duplicate messages about reload failure caused by a passphrase. Discussion: <a target="_blank" href="https://postgr.es/m/29982.1483412575@sss.pgh.pa.us">https://postgr.es/m/29982.1483412575@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6667d9a6d77b9a6eac89638ac363b6d03da253c1">http://git.postgresql.org/pg/commitdiff/6667d9a6d77b9a6eac89638ac363b6d03da253c1</a></li>
<li>Prefer int-wide pg_atomic_flag over char-wide when using gcc intrinsics. configure can only probe the existence of gcc intrinsics, not how well they're implemented, and unfortunately the answer is sometimes "badly". In particular we've found that multiple compilers fail to implement char-width __sync_lock_test_and_set() correctly on PPC; and even a correct implementation would necessarily be pretty inefficient, since that hardware has only a word-wide primitive to work with. Given the knowledge we've accumulated in s_lock.h, it appears that it's best to rely on int-width TAS operations on most non-Intel architectures. Hence, pick int not char when both are nominally available to us in generic-gcc.h (note that that code is not used for x86[_64]). Back-patch to fix regression test failures on FreeBSD/PPC. Ordinarily back-patching a change like this would be verboten because of ABI breakage. But since pg_atomic_flag is not yet used in any Postgres data structure, there's no ABI to break. It seems safer to back-patch to avoid possible gotchas, if someday we do back-patch something that uses pg_atomic_flag. Discussion: <a target="_blank" href="https://postgr.es/m/25414.1483076673@sss.pgh.pa.us">https://postgr.es/m/25414.1483076673@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/698127a4a9bc3c74659bf0e5383b1ed99aeb1570">http://git.postgresql.org/pg/commitdiff/698127a4a9bc3c74659bf0e5383b1ed99aeb1570</a></li>
<li>Handle OID column inheritance correctly in ALTER TABLE ... INHERIT. Inheritance operations must treat the OID column, if any, much like regular user columns. But MergeAttributesIntoExisting() neglected to do that, leading to weird results after a table with OIDs is associated to a parent with OIDs via ALTER TABLE ... INHERIT. Report and patch by Amit Langote, reviewed by Ashutosh Bapat, some adjustments by me. It's been broken all along, so back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/cb13cfe7-a48c-5720-c383-bb843ab28298@lab.ntt.co.jp">https://postgr.es/m/cb13cfe7-a48c-5720-c383-bb843ab28298@lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d86f40009b6b019f794819a9af9038cff0cac6f3">http://git.postgresql.org/pg/commitdiff/d86f40009b6b019f794819a9af9038cff0cac6f3</a></li>
<li>Fix handling of empty arrays in array_fill(). array_fill(..., array[0]) produced an empty array, which is probably what users expect, but it was a one-dimensional zero-length array which is not our standard representation of empty arrays. Also, for no very good reason, it rejected empty input arrays; that case should be allowed and produce an empty output array. In passing, remove the restriction that the input array(s) have lower bound 1. That seems rather pointless, and it would have needed extra complexity to make the check deal with empty input arrays. Per bug #14487 from Andrew Gierth. It's been broken all along, so back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/20170105152156.10135.64195@wrigleys.postgresql.org">https://postgr.es/m/20170105152156.10135.64195@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/82f8107b92c9104ec9d9465f3f6a4c6dab4c124a">http://git.postgresql.org/pg/commitdiff/82f8107b92c9104ec9d9465f3f6a4c6dab4c124a</a></li>
<li>Invalidate cached plans on FDW option changes. This fixes problems where a plan must change but fails to do so, as seen in a bug report from Rajkumar Raghuwanshi. For ALTER FOREIGN TABLE OPTIONS, do this through the standard method of forcing a relcache flush on the table. For ALTER FOREIGN DATA WRAPPER and ALTER SERVER, just flush the whole plan cache on any change in pg_foreign_data_wrapper or pg_foreign_server. That matches the way we handle some other low-probability cases such as opclass changes, and it's unclear that the case arises often enough to be worth working harder. Besides, that gives a patch that is simple enough to back-patch with confidence. Back-patch to 9.3. In principle we could apply the code change to 9.2 as well, but (a) we lack postgres_fdw to test it with, (b) it's doubtful that anyone is doing anything exciting enough with FDWs that far back to need this desperately, and (c) the patch doesn't apply cleanly. Patch originally by Amit Langote, reviewed by Etsuro Fujita and Ashutosh Bapat, who each contributed substantial changes as well. Discussion: <a target="_blank" href="https://postgr.es/m/CAKcux6m5cA6rRPTKkqVdJ-R=KKDfe35Q_ZuUqxDSV_4hwga=og@mail.gmail.com">https://postgr.es/m/CAKcux6m5cA6rRPTKkqVdJ-R=KKDfe35Q_ZuUqxDSV_4hwga=og@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c52d37c8b3674f1ca9ead297480ade0ac9c54174">http://git.postgresql.org/pg/commitdiff/c52d37c8b3674f1ca9ead297480ade0ac9c54174</a></li>
<li>Merge two copies of tuple-building code in pltcl.c. Make pltcl_trigger_handler() construct modified tuples using pltcl_build_tuple_result(), rather than its own copy of essentially the same logic. This results in slightly different message wording for the error cases, and in one case a different SQLSTATE, but it seems unlikely that any existing applications are depending on any of those details. While at it, fix a typo in commit 26abb50c4: pltcl_build_tuple_result was applying encoding conversion in the wrong direction. That would be a back-patchable bug fix, except the code hasn't shipped yet. Jim Nasby, reviewed by me Discussion: <a target="_blank" href="https://postgr.es/m/d2c6425a-d9e0-f034-f774-4a872c234d89@BlueTreble.com">https://postgr.es/m/d2c6425a-d9e0-f034-f774-4a872c234d89@BlueTreble.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/de5fed0d0c704e3d1a928bf420663319d898cee4">http://git.postgresql.org/pg/commitdiff/de5fed0d0c704e3d1a928bf420663319d898cee4</a></li>
<li>Get rid of ParseState.p_value_substitute; use a columnref hook instead. I noticed that p_value_substitute, which is a single-purpose kluge I added in 2002 (commit b0422b215), could be replaced by having domainAddConstraint install a parser hook that looks for the name "value". The parser hook code only dates back to 2009, so it's not surprising that we had to kluge this in 2002, but we can do it more cleanly now. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7c3abe3c92fd3a14a70bc2f888f936cd6fe28c0f">http://git.postgresql.org/pg/commitdiff/7c3abe3c92fd3a14a70bc2f888f936cd6fe28c0f</a></li>
<li>Improve documentation of struct ParseState. I got annoyed about how some fields of ParseState were documented in the struct's block comment and some weren't; not all of the latter are trivial. Fix that. Also reorder a couple of fields that seem to have been placed rather randomly, or maybe with an idea of avoiding padding space; but there are never so many ParseStates in existence at one time that we ought to value pad space over readability. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3c40594e6eeabb3a8ad22aee93de3a19c41efdc2">http://git.postgresql.org/pg/commitdiff/3c40594e6eeabb3a8ad22aee93de3a19c41efdc2</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Remove bogus notice that older clients might not work with MD5 passwords. That was written when we still had "crypt" authentication, and it was referring to the fact that an older client might support "crypt" authentication but not "md5". But we haven't supported "crypt" for years. (As soon as we add a new authentication mechanism that doesn't work with MD5 hashes, we'll need a similar notice again. But this text as it's worded now is just wrong.) Backpatch to all supported versions. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/9a7263eb-0980-2072-4424-440bb2513dc7@iki.fi">https://www.postgresql.org/message-id/9a7263eb-0980-2072-4424-440bb2513dc7@iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/31c54096a18f5ae4ebf8ac9e86963b2b36f2abb5">http://git.postgresql.org/pg/commitdiff/31c54096a18f5ae4ebf8ac9e86963b2b36f2abb5</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Fix hot standby tests for sequence catalog change. From: Kuntal Ghosh &lt;kuntalghosh.2007@gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3d54c16c24d7fd73c9fdfa4b2f946899f7f85e58">http://git.postgresql.org/pg/commitdiff/3d54c16c24d7fd73c9fdfa4b2f946899f7f85e58</a></li>
<li>Better fix for sequence access in hot standby test. The purpose of the test was to check access to the sequence relation on a hot standby, so change the test to read a different column from the sequence, instead of just reading the catalog. From: Andreas Karlsson &lt;andreas@proxel.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/579f700911794d33d95628266f8ed700f113ee16">http://git.postgresql.org/pg/commitdiff/579f700911794d33d95628266f8ed700f113ee16</a></li>
<li>Use 'use strict' in all Perl programs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/933b46644c787ed0b763532951961361e9304095">http://git.postgresql.org/pg/commitdiff/933b46644c787ed0b763532951961361e9304095</a></li>
</ul>
<p>Bruce Momjian pushed:</p>
<ul>
<li>Update copyright for 2017. Backpatch-through: certain files through 9.2 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7090eed3b3e476d6ac20ba8e5f6e3914f18f9632">http://git.postgresql.org/pg/commitdiff/7090eed3b3e476d6ac20ba8e5f6e3914f18f9632</a></li>
<li>Update manual set of copyright files for 2017 <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/60f1e514ad0db017bc583b0e15d056b777bd9626">http://git.postgresql.org/pg/commitdiff/60f1e514ad0db017bc583b0e15d056b777bd9626</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Make wal streaming the default mode for pg_basebackup. Since streaming is now supported for all output formats, make this the default as this is what most people want. To get the old behavior, the parameter -X none can be specified to turn it off. This also removes the parameter -x for fetch, now requiring -X fetch to be specified to use that. Reviewed by Vladimir Rusinov, Michael Paquier and Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9a4d51077c96c10322582211781bb969b51822ff">http://git.postgresql.org/pg/commitdiff/9a4d51077c96c10322582211781bb969b51822ff</a></li>
<li>Attempt to handle pending-delete files on Windows. These files are deleted but not yet gone from the filesystem. Operations on them will return ERROR_DELETE_PENDING. With this we start treating that as ENOENT, meaning files does not exist (which is the state it will soon reach). This should be safe in every case except when we try to recreate a file with exactly the same name. This is an operation that PostgreSQL does very seldom, so hopefully that won't happen much -- and even if it does, this treatment should be no worse than treating it as an unhandled error. We've been un able to reproduce the bug reliably, so pushing this to master to get buildfarm coverage and other testing. Once it's proven to be stable, it should be considered for backpatching. Discussion: <a target="_blank" href="https://postgr.es/m/20160712083220.1426.58667%40wrigleys.postgresql.org">https://postgr.es/m/20160712083220.1426.58667%40wrigleys.postgresql.org</a> Patch by me and Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9951741bbeb3ec37ca50e9ce3df1808c931ff6a6">http://git.postgresql.org/pg/commitdiff/9951741bbeb3ec37ca50e9ce3df1808c931ff6a6</a></li>
</ul>
<p>Simon Riggs pushed:</p>
<ul>
<li>Allow PostgresNode.pm tests to wait for catchup. Add methods to the core test framework PostgresNode.pm to allow us to test that standby nodes have caught up with the master, as well as basic LSN handling. Used in tests recovery/t/001_stream_rep.pl and recovery/t/004_timeline_switch.pl Craig Ringer, reviewed by Aleksander Alekseev and Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fb093e4cb36fe40a1c3f87618fb8362845dae0f0">http://git.postgresql.org/pg/commitdiff/fb093e4cb36fe40a1c3f87618fb8362845dae0f0</a></li>
<li>Add 18 new recovery TAP tests. Add new tests for physical repl slots and hot standby feedback. Craig Ringer, reviewed by Aleksander Alekseev and Simon Riggs <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0813216cb416bf9173ddc7ff3cf495755d943743">http://git.postgresql.org/pg/commitdiff/0813216cb416bf9173ddc7ff3cf495755d943743</a></li>
<li>Add pg_recvlogical &acirc;&euro;&rdquo;-endpos=LSN. Allow pg_recvlogical to specify an ending LSN, complementing the existing -&acirc;&euro;&rdquo;startpos=LSN option. Craig Ringer, reviewed by Euler Taveira and Naoki Okano <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7c030783a5bd07cadffc2a1018bc33119a4c7505">http://git.postgresql.org/pg/commitdiff/7c030783a5bd07cadffc2a1018bc33119a4c7505</a></li>
<li>Add new TAP tests for pg_recvlogical. Craig Ringer, reviewed by Euler Taveira and Naoki Okano <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3e353a7bc2dd6a9edfffe7e045c810b421f7ecc4">http://git.postgresql.org/pg/commitdiff/3e353a7bc2dd6a9edfffe7e045c810b421f7ecc4</a></li>
<li>Fix format for TAP test docs. Small number of fixes to perl docs for TAP tests. Plus two comments that use "xlog" rather than WAL Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2e44f379bc0219f6864dbfb901129796e6feec44">http://git.postgresql.org/pg/commitdiff/2e44f379bc0219f6864dbfb901129796e6feec44</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Update obsolete comments in lwlock.h. The typical size of an LWLock is now 16 bytes even on 64-bit platforms, and the size of slock_t is now irrelevant. But pg_atomic_uint32 can (perhaps surprisingly) still be larger than 4 bytes, so there's still some marginal point to allowing LWLOCK_MINIMAL_SIZE == 64. Commit 008608b9d51061b1f598c197477b3dc7be9c4a64 made the changes that led to the need for these updates. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0fad355beca9f73687c0b27647ea570ce10c7ae3">http://git.postgresql.org/pg/commitdiff/0fad355beca9f73687c0b27647ea570ce10c7ae3</a></li>
<li>Move partition_tuple_slot out of EState. Commit 2ac3ef7a01df859c62d0a02333b646d65eaec5ff added a TupleTapleSlot for partition tuple slot to EState (es_partition_tuple_slot) but it's more logical to have it as part of ModifyTableState (mt_partition_tuple_slot) and CopyState (partition_tuple_slot). Discussion: <a target="_blank" href="http://postgr.es/m/1bd459d9-4c0c-197a-346e-e5e59e217d97@lab.ntt.co.jp">http://postgr.es/m/1bd459d9-4c0c-197a-346e-e5e59e217d97@lab.ntt.co.jp</a> Amit Langote, per a gripe from me <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/345b2dcf070bd8fbccde643b1b2856027623e9e5">http://git.postgresql.org/pg/commitdiff/345b2dcf070bd8fbccde643b1b2856027623e9e5</a></li>
<li>Fix reporting of constraint violations for table partitioning. After a tuple is routed to a partition, it has been converted from the root table's row type to the partition's row type. ExecConstraints needs to report the failure using the original tuple and the parent's tuple descriptor rather than the ones for the selected partition. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f1b4c771ea74f42447dccaed42ffcdcccf3aa694">http://git.postgresql.org/pg/commitdiff/f1b4c771ea74f42447dccaed42ffcdcccf3aa694</a></li>
<li>Remove unnecessary arguments from partitioning functions. RelationGetPartitionQual() and generate_partition_qual() are always called with recurse = true, so we don't need an argument for that. Extracted by me from a larger patch by Amit Langote. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/18fc5192a631441a73e6a3b911ecb14765140389">http://git.postgresql.org/pg/commitdiff/18fc5192a631441a73e6a3b911ecb14765140389</a></li>
<li>Assorted code improvements for table partitioning. Michael Paquier, per Coverity. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3633b3f65686d3e74ab868e33bc25bec8bcdc7c6">http://git.postgresql.org/pg/commitdiff/3633b3f65686d3e74ab868e33bc25bec8bcdc7c6</a></li>
<li>Improve documentation of timestamp internal representation. Be more clear that we represent timestamps in microseconds when integer timestamps are used, and in fractional seconds when floating-point timestamps are used. Discussion: <a target="_blank" href="http://postgr.es/m/20161212135045.GB15488@e733.localdomain">http://postgr.es/m/20161212135045.GB15488@e733.localdomain</a> Report by Alexander Alekseev. Wording by me with a suggestion from Tom Lane. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/44f7afba79348883da110642d230a13003b75f62">http://git.postgresql.org/pg/commitdiff/44f7afba79348883da110642d230a13003b75f62</a></li>
<li>Fix possible crash reading pg_stat_activity. With the old code, a backend that read pg_stat_activity without ever having executed a parallel query might see a backend in the midst of executing one waiting on a DSA LWLock, resulting in a crash. The solution is for backends to register the tranche at startup time, not the first time a parallel query is executed. Report by Andreas Seltenreich. Patch by me, reviewed by Thomas Munro. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/175ff6598e014b2fe84c06fa443161294fc2eed0">http://git.postgresql.org/pg/commitdiff/175ff6598e014b2fe84c06fa443161294fc2eed0</a></li>
<li>Fix possible leak of semaphore count. Commit 4aec49899e5782247e134f94ce1c6ee926f88e1c reorganized the order of operations here so that we no longer increment the number of "extra waits" before locking the semaphore, but it did not change the starting value of extraWaits from 0 to -1 to compensate. In the worst case, this could leak a semaphore count, but that seems to be unlikely in practice. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1JyVqXiMba+-a589Rk0pyHsyKkGxeumVKjU6Y74hdrVLQ@mail.gmail.com">http://postgr.es/m/CAA4eK1JyVqXiMba+-a589Rk0pyHsyKkGxeumVKjU6Y74hdrVLQ@mail.gmail.com</a> Amit Kapila, per an off-list report by Dilip Kumar. Reviewed by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e5b7451ea36d52815085cc2d9f2434c35b837978">http://git.postgresql.org/pg/commitdiff/e5b7451ea36d52815085cc2d9f2434c35b837978</a></li>
<li>Repair commit b81b5a96f424531b97cdd1dba97d9d1b9c9d372e. This commit purported to use a variable hash seed for Partial HashAggregate, but actually did the opposite - it made us use a variable seed for any HashAggregate that is NOT partial. Woops. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0355e6f3107a5be9b5f0873f08527bad361d9d8f">http://git.postgresql.org/pg/commitdiff/0355e6f3107a5be9b5f0873f08527bad361d9d8f</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Protect against NULL-dereference in pg_dump. findTableByOid() is allowed to return NULL and we should therefore be checking for that case. getOwnedSeqs() and dumpSequence() shouldn't ever actually see this happen, but given odd circumstances it might and commit f9e439b1 probably shouldn't have removed that check. Pointed out by Coverity. Initial patch from Michael Paquier. Back-patch to 9.6, where that commit had removed the check. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d74ecbc8d85eb7a2aa1d5516c5c38d6ab0cbbd82">http://git.postgresql.org/pg/commitdiff/d74ecbc8d85eb7a2aa1d5516c5c38d6ab0cbbd82</a></li>
<li>Add basic pg_dumpall/pg_restore TAP tests. For reasons unknown, pg_dumpall and pg_restore managed to escape the basic set of TAP tests that were added for pg_dump in 6bd356c3, so let's get them added now. A few minor adjustments are also made to the dump/restore tests to improve code coverage for pg_restore/pg_dumpall. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9b815a8ff227e62442259e0fbabc5cf37e433df9">http://git.postgresql.org/pg/commitdiff/9b815a8ff227e62442259e0fbabc5cf37e433df9</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Thomas Munro sent in a patch to add an isolation test for SERIALIZABLE READ ONLY DEFERRABLE.</p>
<p>Ashutosh Bapat sent in another revision of a patch to support partition-wise join between multi-level partitioned tables.</p>
<p>Thomas Munro sent in another revision of a patch to implement causal reads.</p>
<p>Pavan Deolasee sent in two more revisions of a patch to implement WARM.</p>
<p>Ashutosh Bapat sent in a patch to cast nodes more safely.</p>
<p>Thomas Munro sent in another revision of a patch to help measure replay lag.</p>
<p>KaiGai Kohei sent in another revision of a patch to add PassDownLimitBound for ForeignScan/CustomScan.</p>
<p>Mithun Cy sent in two more revisions of a patch to cache hash index meta page.</p>
<p>Amit Kapila sent in another revision of a patch to parallelize queries containing subplans.</p>
<p>Peter Geoghegan sent in another revision of a patch to implement parallel tuplesort.</p>
<p>Tom Lane sent in a patch to expand the existing API to allow the AM to return either a heap or index tuple.</p>
<p>Tomas Vondra sent in another revision of a patch to implement multivariate statistics.</p>
<p>Heikki Linnakangas sent in a patch to replace isMD5() with a more future-proof way to check if password is encrypted and use "plain:" prefix for plaintext passwords stored in pg_authid.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel bitmap heap scan.</p>
<p>Craig Ringer sent in two more revisions of a patch to implement logical decoding on standbys.</p>
<p>Peter Eisentraut sent in two revisions of a patch to fix some infelicities in the logical replication protocol and output plugin.</p>
<p>Peter Eisentraut sent in another revision of a patch to add logical replication workers.</p>
<p>Peter Eisentraut and Petr Jel&Atilde;&shy;nek traded patches to add PUBLICATION catalogs and DDL.</p>
<p>&Atilde;lvaro Herrera sent in three revisions of a patch to fix and error in ALTER TABLE ... ALTER TYPE.</p>
<p>Haribabu Kommi sent in another revision of a patch to implement a pg_hba_file_settings view and add TAP tests for same.</p>
<p>David Fetter sent in two more revisions of a patch to disable simple UPDATEs and DELETEs which lack any WHERE clause.</p>
<p>Peter Eisentraut sent in another revision of a patch to fix some infelicities between pg_basebackups and slots.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel merge join.</p>
<p>Kuntal Ghosh sent in another revision of a patch to implement a WAL consistency check facility.</p>
<p>Craig Ringer sent in another revision of a patch to add PostgresNode methods to wait for node catchup and expand streaming replication tests to cover hot standby feedback and physical replication slots.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to bring the TAP test docs for PostgresNode up to date.</p>
<p>Peter Eisentraut sent in another revision of a patch to generate fmgr prototypes automatically.</p>
<p>Masahiko Sawada sent in a patch to add a GUC for cleanup indexes threshold.</p>
<p>Ashutosh Bapat sent in a patch to add an option to EXPLAIN: SUMMARY option which behaves as: SUMMARY when ON prints planning time, and prints planning time in EXPLAIN EXECUTE output.</p>
<p>Takayuki Tsunakawa sent in two more revisions of a patch to support huge pages on Windows.</p>
<p>Haribabu Kommi sent in another revision of a patch to add macaddr 64 bit (EUI-64) datatype support.</p>
<p>Ashutosh Sharma sent in two more revisions of a patch to add microvacuum support for hash indexes.</p>
<p>Jesper Pedersen sent in another revision of a patch to add support for hash index in pageinspect contrib module.</p>
<p>Tatsuo Ishii sent in a patch to fix a mistaken tag in the documentation for user name maps.</p>
<p>Vitaly Burovoy sent in another revision of a patch to add check for overflow to 'interval' functions.</p>
<p>Andrew Gierth sent in a patch to add hash support for grouping sets.</p>
<p>Jim Nasby sent in another revision of a patch to implement faster methods for getting SPI results in PL/PythonU.</p>
<p>Vladimir Rusinov sent in another revision of a patch to rename things xlog to things wal.</p>
<p>Jonathon Nelson sent in a patch to guc-ify the formerly hard-coded MAX_SEND_SIZE to max_wal_send.</p>
<p>Takeshi Ideriha sent in another revision of a patch to add DECLARE STATEMENT setting up a connection in ECPG.</p>
<p>Amit Langote sent in a patch to fix up some infelicities in declarative partitioning.</p>
<p>Ashutosh Sharma sent in another revision of a patch to add pgstathashindex() to get hash index table statistics.</p>
<p>Thomas Munro sent in another revision of a patch to implement barriers.</p>
<p>Thomas Munro sent in another revision of a patch to add parallel shared hash.</p>
<p>Peter Geoghegan sent in a patch to fix a subtle bug in "Simplify tape block format" commit.</p>
<p>Masahiko Sawada sent in another revision of a patch to enable block level parallel vacuum.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to add compression levels to pg_receivexlog.</p>
<p>Amul Sul sent in two more revisions of a patch to add a pg_background contrib module.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add pragmas to PL/pgsql.</p>
<p>Fabien COELHO sent in another revision of a patch to enable pgbench to store select results into variables.</p>
<p>Tom Lane sent in a patch to disallow output columns of type UNKNOWN.</p>
<p>Ryan Murphy sent in a patch to show type name and constraints for errors in inherited tables.</p>
<p>Jim Nasby sent in two more revisions of a patch to add more test coverage for PL/Tcl.</p>
<p>Victor Wagner sent in two revisions of a patch to add explicit subtransactions to PL/Tcl.</p>
<p>Haribabu Kommi sent in a patch to fix a bug in the patch to add a pg_hba_settings view.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/01/15/Nouvelles-hebdomadaires-de-PostgreSQL-8-janvier-2017">par chl le dimanche 15 janvier 2017 à 11h46</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>samedi  7 janvier 2017</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:ccdf111735982add84acecd5bb8c4bd1" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/01/07/Nouvelles-hebdomadaires-de-PostgreSQL-1er-janvier-2017">Nouvelles hebdomadaires de PostgreSQL - 1er janvier 2017</a></h4>
<div class="entry">
<div class="content">
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>pgpool-II versions 3.6.1, 3.5.5, 3.4.9, 3.3.13, 3.2.18 et 3.1.21 publi&eacute;es. Pgpool-II 3.1.21 est la derni&egrave;re version de la s&eacute;rie 3.1.x&nbsp;: <a target="_blank" href="http://www.pgpool.net/docs/latest/en/html/release.html">http://www.pgpool.net/docs/latest/en/html/release.html</a></li>
<li>PL/Proxy 2.7, un syst&egrave;me de partitionnement de base de donn&eacute;es impl&eacute;ment&eacute; comme un langage proc&eacute;dural&nbsp;: <a target="_blank" href="https://plproxy.github.io">https://plproxy.github.io</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde)&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 s'&eacute;tendra du 17 au 18 mars &agrave; Singapour. L'appel &agrave; conf&eacute;renciers s'&eacute;teindra le 16 janvier 2017&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017. L'appel &agrave; conf&eacute;renciers expire le 9 janvier 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/cfp/">https://2017.nordicpgday.org/cfp/</a></li>
<li>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 9 janvier&nbsp;: <a target="_blank" href="http://2017.pgday.paris/callforpapers/">http://2017.pgday.paris/callforpapers/</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai. Les propositions seront attendues jusqu'au 19 janvier 2017&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20170101214521.GA22193@fetter.org">http://www.postgresql.org/message-id/20170101214521.GA22193@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Tom Lane pushed:</p>
<ul>
<li>Remove triggerable Assert in hashname(). hashname() asserted that the key string it is given is shorter than NAMEDATALEN. That should surely always be true if the input is in fact a regular value of type "name". However, for reasons of coding convenience, we allow plain old C strings to be treated as "name" values in many places. Some SQL functions accept arbitrary "text" inputs, convert them to C strings, and pass them otherwise-untransformed to syscache lookups for name columns, allowing an overlength input value to trigger hashname's Assert. This would be a DOS problem, except that it only happens in assert-enabled builds which aren't recommended for production. In a production build, you'll just get a name lookup error, since regardless of the hash value computed by hashname, the later equality comparison checks can't match. Likewise, if the catalog lookup is done by seqscan or indexscan searches, there will just be a lookup error, since the name comparison functions don't contain any similar length checks, and will see an overlength input as unequal to any stored entry. After discussion we concluded that we should simply remove this Assert. It's inessential to hashname's own functionality, and having such an assertion in only some paths for name lookup is more of a foot-gun than a useful check. There may or may not be a case for the affected callers to do something other than let the name lookup fail, but we'll consider that separately; in any case we probably don't want to change such behavior in the back branches. Per report from Tushar Ahuja. Back-patch to all supported branches. Report: <a target="_blank" href="https://postgr.es/m/7d0809ee-6f25-c9d6-8e74-5b2967830d49@enterprisedb.com">https://postgr.es/m/7d0809ee-6f25-c9d6-8e74-5b2967830d49@enterprisedb.com</a> Discussion: <a target="_blank" href="https://postgr.es/m/17691.1482523168@sss.pgh.pa.us">https://postgr.es/m/17691.1482523168@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/54386f3578258caa5a1de97c434eee2c9ee2ab06">http://git.postgresql.org/pg/commitdiff/54386f3578258caa5a1de97c434eee2c9ee2ab06</a></li>
<li>Fix interval_transform so it doesn't throw away non-no-op casts. interval_transform() contained two separate bugs that caused it to sometimes mistakenly decide that a cast from interval to restricted interval is a no-op and throw it away. First, it was wrong to rely on dt.h's field type macros to have an ordering consistent with the field's significance; in one case they do not. This led to mistakenly treating YEAR as less significant than MONTH, so that a cast from INTERVAL MONTH to INTERVAL YEAR was incorrectly discarded. Second, fls(1&lt;&lt;k) produces k+1 not k, so comparing its output directly to SECOND was wrong. This led to supposing that a cast to INTERVAL MINUTE was really a cast to INTERVAL SECOND and so could be discarded. To fix, get rid of the use of fls(), and make a function based on intervaltypmodout to produce a field ID code adapted to the need here. Per bug #14479 from Piotr Stefaniak. Back-patch to 9.2 where transform functions were introduced, because this code was born broken. Discussion: <a target="_blank" href="https://postgr.es/m/20161227172307.10135.7747@wrigleys.postgresql.org">https://postgr.es/m/20161227172307.10135.7747@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f0774abde868e0b5a2acbe75b5028884752f739d">http://git.postgresql.org/pg/commitdiff/f0774abde868e0b5a2acbe75b5028884752f739d</a></li>
<li>Remove manual breaks in NodeTag assignments to fix duplicate tag numbers. Commit f0e44751d added new node tags at a place in the tag numbering where there was no daylight left before the next hard-coded number, resulting in some duplicate tag assignments. This doesn't seem to have caused any big problem so far, but it's surely trouble waiting to happen. We could adjust the manually assigned breakpoints to make more room, but that just leaves the same hazard waiting to strike again in future. What seems like a better idea is to get rid of the manual assignments and leave NodeTags to be automatically assigned, consecutively from one on up. This means that any change in the tag list forces a backend-wide recompile, but realistically that's usually needed anyway. Discussion: <a target="_blank" href="https://postgr.es/m/29670.1482942811@sss.pgh.pa.us">https://postgr.es/m/29670.1482942811@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/80a7298b9eb7f108ef20be6ee00d9513a43c61a0">http://git.postgresql.org/pg/commitdiff/80a7298b9eb7f108ef20be6ee00d9513a43c61a0</a></li>
<li>Fix unstable regression test results. Commit 2ac3ef7a0 added a query with an underdetermined output row order; it has failed multiple times in the buildfarm since then. Add an ORDER BY to fix. Also, don't rely on a DROP CASCADE to drop in a well-determined order; that hasn't failed yet but I don't trust it much, and we're not saving any typing by using CASCADE anyway. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/257d8157205a7be5f9799e8941b922521d678a25">http://git.postgresql.org/pg/commitdiff/257d8157205a7be5f9799e8941b922521d678a25</a></li>
<li>Avoid assuming that instr_time == struct timeval in pgbench logging. This code was presuming undue familiarity with the contents of the instr_time struct. That was already broken on Windows, and it's about to get broken on most other platforms as well. The simplest solution that preserves the current output definition is to just do our own gettimeofday() call here. Realistically, the extra cost is probably negligible in comparison to everything else that's going on in a pgbench transaction, so it's not worth sweating over. On Windows, the precision delivered by gettimeofday() is lower than one could wish, but this is still a big improvement over printing zeroes, as the code did before. Discussion: <a target="_blank" href="https://postgr.es/m/8837.1483216839@sss.pgh.pa.us">https://postgr.es/m/8837.1483216839@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/74baa1e3b89c1651ade1afeffc715cac24041e2f">http://git.postgresql.org/pg/commitdiff/74baa1e3b89c1651ade1afeffc715cac24041e2f</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix typo comments. Erik Rijkers <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6cfa54e384700d4a2124e5c4d7a1eb91e8e0eeb7">http://git.postgresql.org/pg/commitdiff/6cfa54e384700d4a2124e5c4d7a1eb91e8e0eeb7</a></li>
<li>Don't rename .partial files in pg_receivexlog if an error occured. In 56c7d8d the behavior to keep .partial segments around (considered corrupt) in case an connection failure occurs was accidentally removed. This would lead to an incomplete segment being considered complete. Author: Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3ea56fffd66fe2c5857f36359ae16d4cabcdeef6">http://git.postgresql.org/pg/commitdiff/3ea56fffd66fe2c5857f36359ae16d4cabcdeef6</a></li>
</ul>
<p>Andrew Dunstan pushed:</p>
<ul>
<li>Explain unaccounted for space in pgstattuple. In addition to space accounted for by tuple_len, dead_tuple_len and free_space, the table_len includes page overhead, the item pointers table and padding bytes. Backpatch to live branches. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/71f996d22125eb6cfdbee6094f44370aa8dec610">http://git.postgresql.org/pg/commitdiff/71f996d22125eb6cfdbee6094f44370aa8dec610</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Make more use of RoleSpec struct. Most code was casting this through a generic Node. By declaring everything as RoleSpec appropriately, we can remove a bunch of casts and ad-hoc node type checking. Reviewed-by: Alvaro Herrera &lt;alvherre@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2e254130d1d3f16575f2d72952ab23b4e27d035a">http://git.postgresql.org/pg/commitdiff/2e254130d1d3f16575f2d72952ab23b4e27d035a</a></li>
<li>Expand ad-hoc unit abbreviations in function descriptions. There is no need to use abbreviations here, so just write it out for consistency. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/27866bd1e88c7b564b42394a0d5b069b015666c4">http://git.postgresql.org/pg/commitdiff/27866bd1e88c7b564b42394a0d5b069b015666c4</a></li>
<li>Fix typo in comment <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/db779d941e0a05ea4647455d0b386b38ef58983b">http://git.postgresql.org/pg/commitdiff/db779d941e0a05ea4647455d0b386b38ef58983b</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Pavan Deolasee sent in another revision of a patch to fix some issues in WARM.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to clean up negative cache of pg_statistic when dropping a relation and clean up negative cache of pg_class when dropping a schema.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to redesign psql's tab completion and use that infrastructure to implement IF (NOT) EXISTS completion.</p>
<p>Ashutosh Bapat sent in another revision of a patch to imlement partition-wise join for join between (declaratively) partitioned tables.</p>
<p>Amit Kapila sent in another revision of a patch to implement WAL for hash indexes.</p>
<p>Dmitry Dolgov sent in another revision of a patch to implement generic type subscripting.</p>
<p>Amit Langote sent in five more revisions of a patch to implement declarative partitioning.</p>
<p>Amit Langote sent in a patch to fix an infelicity between OID columns and table inheritance.</p>
<p>Mithun Cy sent in two more revisions of a patch to cache hash index meta pages.</p>
<p>Etsuro Fujita sent in another revision of a patch to push more FULL joins to the PostgreSQL FDW.</p>
<p>Amit Kapila sent in another revision of a patch to implement parallel index scans.</p>
<p>Nikita Glukhov sent in another revision of a patch to implement recursive json_populate_record().</p>
<p>Peter Eisentraut sent in another revision of a patch to add ICU support.</p>
<p>Rafia Sabih sent in another revision of a patch to implement parallel index-only scans.</p>
<p>Amit Kapila sent in a patch to parallelize queries containing subplans.</p>
<p>Thomas Munro sent in a patch to fix dsa tranche registration.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two more revisions of a patch to enable pg_receivelog to enable adjusting compression for tar format.</p>
<p>Peter Eisentraut sent in a patch to add some information about the systemd RemoveIPC issue to the documentation.</p>
<p>Ideriha Takeshi sent in a patch to add a DECLARE STATEMENT command in ECPG.</p>
<p>Craig Ringer sent in another revision of a patch to introduce txid_status(bigint) to get status of an xact.</p>
<p>Thomas Munro sent in another revision of a patch to allow measuring replay lag.</p>
<p>Claudio Freire sent in another revision of a patch to enable VACUUM to use more than 1GB of work mem.</p>
<p>Craig Ringer sent in two revisions of a patch to fix a minor race between commit_ts slru truncation and lookups.</p>
<p>Tom Lane sent in another revision of a patch to improve RLS planning.</p>
<p>&Atilde;lvaro Herrera sent in two revisions of a patch to rewrite HeapSatisfiesHOTAndKey.</p>
<p>&Atilde;lvaro Herrera sent in two more revisions of a patch to implement indirect indexes.</p>
<p>Vik Fearing sent in a patch to change the encoding of the French translation encoding from ISO-8859-1 to UTF-8.</p>
<p>Jim Nasby sent in another revision of a patch to increase pltcl test coverage.</p>
<p>Peter Eisentraut sent in another revision of a patch to add background sessions.</p>
<p>Tom Lane sent in a patch to eliminate gettimeofday() on platforms where better options are available.</p>
<p>Haribabu Kommi sent in a patch to implement a columnar storage extension.</p>
<p>Fabien COELHO sent in another revision of a patch to fix some pg_stat_statements query normalization issues with combined queries.</p>
<p>Yury Zhuravlev sent in another revision of a patch to implement a CMake-based build system.</p>
<p>Petr Jel&Atilde;&shy;nek sent in another revision of a patch to implement logical replication.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to fix a potential data loss of 2PC files.</p>
<p>Fabr&Atilde;&shy;zio de Royes Mello sent in another revision of a patch to implement COMMENT ON CURRENT DATABASE.</p>
<p>Amit Kapila sent in another revision of a patch to speed up clog Access by increasing CLOG buffers.</p>
<p>Amit Kapila sent in a patch to fix an issue where group clear xid can leak semaphore count.</p>
<p>Peter Eisentraut sent in a patch to generate fmgr prototypes automatically.</p>
<p>Peter Eisentraut sent in another revision of a patch to implement sequence data types.</p>
<p>Peter Eisentraut sent in a patch to put "use strict" in all Perl programs.</p>
<p>Peter Eisentraut sent in a patch to create the INSTALL file via XSLT and Pandoc. This is one more step on the way to replacing the old tool chain of jade and lynx.</p>
<p>Peter Eisentraut sent in a patch to automatically casts the result of copyNode() back to the input type, if the compiler supports something like typeof().</p>
<p>Stas Kelvich sent in another revision of a patch to implement logical decoding of two-phase transactions.</p>
<p>Magnus Hagander sent in another revision of a patch to support huge pages on Windows.</p>
<p>Peter Eisentraut sent in another revision of a patch to add identity columns per the SQL standard.</p>
<p>Magnus Hagander sent in a patch to change the backup and replication defaults to something more useful.</p>
<p>Peter Eisentraut sent in another revision of a patch to allow DROP FUNCTION to drop multiple functions in one command.</p>
<p>Peter Eisentraut sent in a patch to implement safer node casting.</p>
<p>Magnus Hagander sent in another revision of a patch to make streaming the pg_basebackup default.</p>
<p>David Fetter sent in another revision of a patch to add a hook which allows disabling simple UPDATEs and DELETEs without a WHERE clause.</p>
<p>Thomas Munro sent in a patch to add an isolation test for SERIALIZABLE READ ONLY DEFERRABLE.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add some runtime checks to PL/pgsql.</p>
<p>Simon Riggs sent in another revision of a patch to make some changes to the recovery.conf API.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/01/07/Nouvelles-hebdomadaires-de-PostgreSQL-1er-janvier-2017">par chl le samedi  7 janvier 2017 à 13h46</a>
</p>
</div>
</div>




<div class="entrygroup" id="urn:md5:de6d98f8ab02d23b3c3eb2a3c65193c8" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2017/01/07/Nouvelles-hebdomadaires-de-PostgreSQL-25-d%C3%A9cembre-2016">Nouvelles hebdomadaires de PostgreSQL - 25 décembre 2016</a></h4>
<div class="entry">
<div class="content">
<p>Le pgDay Paris 2017 aura lieu &agrave; Paris (France) le 23 mars 2017. L'appel &agrave; conf&eacute;renciers court jusqu'au 9 janvier&nbsp;: <a target="_blank" href="http://2017.pgday.paris/callforpapers/">http://2017.pgday.paris/callforpapers/</a></p>
<p>Le PGDay nordique se tiendra &agrave; Stockholm (Su&egrave;de) au Sheraton Hotel, le 21 mars 2017. L'appel &agrave; conf&eacute;renciers expire le 9 janvier 2017&nbsp;: <a target="_blank" href="https://2017.nordicpgday.org/cfp/">https://2017.nordicpgday.org/cfp/</a></p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>PostgreSQL Automatic Failover (PAF) v2.1.0&nbsp;: <a target="_blank" href="https://github.com/dalibo/PAF/releases/tag/v2.1.0">https://github.com/dalibo/PAF/releases/tag/v2.1.0</a></li>
<li>Postgre.app 2.0, un paquetage de PostgreSQL pour OS X&nbsp;: <a target="_blank" href="https://github.com/PostgresApp/PostgresApp/releases/v2.0.1/">https://github.com/PostgresApp/PostgresApp/releases/v2.0.1/</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en d&eacute;cembre</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2016-12/threads.php">http://archives.postgresql.org/pgsql-jobs/2016-12/threads.php</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde). Les propositions sont attendues sur &lt;papers AT pgconf DOT in&gt; jusqu'au 31 d&eacute;cembre 2016&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
<li>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></li>
<li>Le PGDay Asia 2017 s'&eacute;tendra du 17 au 18 mars &agrave; Singapour. L'appel &agrave; conf&eacute;renciers s'&eacute;teindra le 16 janvier 2017&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></li>
<li>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai. Les propositions seront attendues jusqu'au 19 janvier 2017&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20161225225258.GA21777@fetter.org">http://www.postgresql.org/message-id/20161225225258.GA21777@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Fix base backup rate limiting in presence of slow i/o When source i/o on disk was too slow compared to the rate limiting specified, the system could end up with a negative value for sleep that it never got out of, which caused rate limiting to effectively be turned off. Discussion: <a target="_blank" href="https://postgr.es/m/CABUevEy_-e0YvL4ayoX8bH_Ja9w%2BBHoP6jUgdxZuG2nEj3uAfQ%40mail.gmail.com">https://postgr.es/m/CABUevEy_-e0YvL4ayoX8bH_Ja9w%2BBHoP6jUgdxZuG2nEj3uAfQ%40mail.gmail.com</a> Analysis by me, patch by Antonin Houska <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/10238fad0389175f71739bc9b4d00bb24d9b8c44">http://git.postgresql.org/pg/commitdiff/10238fad0389175f71739bc9b4d00bb24d9b8c44</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Support quorum-based synchronous replication. This feature is also known as "quorum commit" especially in discussion on pgsql-hackers. This commit adds the following new syntaxes into synchronous_standby_names GUC. By using FIRST and ANY keywords, users can specify the method to choose synchronous standbys from the listed servers. FIRST num_sync (standby_name [, ...]) ANY num_sync (standby_name [, ...]) The keyword FIRST specifies a priority-based synchronous replication which was available also in 9.6 or before. This method makes transaction commits wait until their WAL records are replicated to num_sync synchronous standbys chosen based on their priorities. The keyword ANY specifies a quorum-based synchronous replication and makes transaction commits wait until their WAL records are replicated to *at least* num_sync listed standbys. In this method, the values of sync_state.pg_stat_replication for the listed standbys are reported as "quorum". The priority is still assigned to each standby, but not used in this method. The existing syntaxes having neither FIRST nor ANY keyword are still supported. They are the same as new syntax with FIRST keyword, i.e., a priorirty-based synchronous replication. Author: Masahiko Sawada Reviewed-By: Michael Paquier, Amit Kapila and me Discussion: &lt;CAD21AoAACi9NeC_ecm+Vahm+MMA6nYh=Kqs3KB3np+MBOS_gZg@mail.gmail.com&gt; Many thanks to the various individuals who were involved in discussing and developing this feature. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3901fd70cc7ccacef1b0549a6835bb7d8dcaae43">http://git.postgresql.org/pg/commitdiff/3901fd70cc7ccacef1b0549a6835bb7d8dcaae43</a></li>
<li>Forbid invalid combination of options in pg_basebackup. Commit 56c7d8d4552180fd66fe48423bb2a9bb767c2d87 allowed pg_basebackup to stream WAL in tar mode. But there is the restriction that WAL streaming in tar mode works only when the value - (dash) is not specified as output directory. This means that the combination of three options "-D -", "-F t" and "-X stream" is invalid. However, previously, even when those options were specified at the same time, pg_basebackup background process unexpectedly started streaming WAL. And then it exited with an error. This commit changes pg_basebackup so that it errors out on such invalid combination of options at the beginning. Reviewed by Magnus Hagander, and patch by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ecbdc4c555f43b1ac284c734752b00c2ea6f277b">http://git.postgresql.org/pg/commitdiff/ecbdc4c555f43b1ac284c734752b00c2ea6f277b</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>Remove unused file. This was added in 105409746499657acdffc109db9d343b464bda1f, but has never been used for anything as far as I can tell. There seems to be no reason to keep it. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/668dbbec27da05b35a6972e9d833115dce0b6ccc">http://git.postgresql.org/pg/commitdiff/668dbbec27da05b35a6972e9d833115dce0b6ccc</a></li>
<li>Fix locking problem in _hash_squeezebucket() / _hash_freeovflpage(). A bucket squeeze operation needs to lock each page of the bucket before releasing the prior page, but the previous coding fumbled the locking when freeing an overflow page during a bucket squeeze operation. Commit 6d46f4783efe457f74816a75173eb23ed8930020 introduced this bug. Amit Kapila, with help from Kuntal Ghosh and Dilip Kumar, after an initial trouble report by Jeff Janes. Reviewed by me. I also fixed a problem with a comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dd728826c538f000220af98de025c00114ad0631">http://git.postgresql.org/pg/commitdiff/dd728826c538f000220af98de025c00114ad0631</a></li>
<li>Provide a DSA area for all parallel queries. This will allow future parallel query code to dynamically allocate storage shared by all participants. Thomas Munro, with assorted changes by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e13029a5ce353574516c64fd1ec9c50201e705fd">http://git.postgresql.org/pg/commitdiff/e13029a5ce353574516c64fd1ec9c50201e705fd</a></li>
<li>Invalid parent's relcache after CREATE TABLE .. PARTITION OF. Otherwise, subsequent commands in the same transaction see the wrong partition descriptor. Amit Langote. Reported by Tomas Vondra and David Fetter. Reviewed by me. Discussion: <a target="_blank" href="http://postgr.es/m/22dd313b-d7fd-22b5-0787-654845c8f849%402ndquadrant.com">http://postgr.es/m/22dd313b-d7fd-22b5-0787-654845c8f849%402ndquadrant.com</a> Discussion: <a target="_blank" href="http://postgr.es/m/20161215090916.GB20659%40fetter.org">http://postgr.es/m/20161215090916.GB20659%40fetter.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7cd0fd655d681e0ed5f7269fa421d977f1df0889">http://git.postgresql.org/pg/commitdiff/7cd0fd655d681e0ed5f7269fa421d977f1df0889</a></li>
<li>Refactor merge path generation code. This shouldn't change the set of paths that get generated in any way, but it is preparatory work for further changes to allow a partial path to be merge-joined witih a non-partial path to produce a partial join path. Dilip Kumar, with cosmetic adjustments by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/59649c3f1cbd536314c0060dcabd234deab148b2">http://git.postgresql.org/pg/commitdiff/59649c3f1cbd536314c0060dcabd234deab148b2</a></li>
<li>Fix corner-case bug in WaitEventSetWaitBlock on Windows. If we do not reset the FD_READ event, WaitForMultipleObjects won't return it again again unless we've meanwhile read from the socket, which is generally true but not guaranteed. WaitEventSetWaitBlock itself may fail to return the event to the caller if the latch is also set, and even if we changed that, the caller isn't obliged to handle all returned events at once. On non-Windows systems, the socket-read event is purely level-triggered, so this issue does not exist. To fix, make Windows reset the event when needed. This bug was introduced by 98a64d0bd713cb89e61bef6432befc4b7b5da59e, and causes hangs when trying to use the pldebugger extension. Patch by Amit Kapial. Reported and tested by Ashutosh Sharma, who also provided some analysis. Further analysis by Michael Paquier. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3b790d256f8489d0765c3389d6860f1c6b4a9b2d">http://git.postgresql.org/pg/commitdiff/3b790d256f8489d0765c3389d6860f1c6b4a9b2d</a></li>
<li>Refactor partition tuple routing code to reduce duplication. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1fc5c4945047e8e8c7aa1644b52dd0187b729181">http://git.postgresql.org/pg/commitdiff/1fc5c4945047e8e8c7aa1644b52dd0187b729181</a></li>
<li>Convert elog() to ereport() and do some wordsmithing. It's not entirely clear that we should log a message here at all, but it's certainly wrong to use elog() for a message that should clearly be translatable. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd510f04137a1436ad6029da4998f5224395a08d">http://git.postgresql.org/pg/commitdiff/cd510f04137a1436ad6029da4998f5224395a08d</a></li>
<li>Code review for ATExecAttachPartition. Amit Langote. Most of this reported by &Atilde;lvaro Herrera. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3ee80672847c4100d5f9efdb9ea19cb96506d089">http://git.postgresql.org/pg/commitdiff/3ee80672847c4100d5f9efdb9ea19cb96506d089</a></li>
<li>Fix broken error check in _hash_doinsert. You can't just cast a HashMetaPage to a Page, because the meta page data is stored after the page header, not at offset 0. Fortunately, this didn't break anything because it happens to find hashm_bsize at the offset at which it expects to find pd_pagesize_version, and the values are close enough to the same that this works out. Still, it's a bug, so back-patch to all supported versions. Mithun Cy, revised a bit by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/097e41439d69e11fb870e009b1ac64dda4f01c3d">http://git.postgresql.org/pg/commitdiff/097e41439d69e11fb870e009b1ac64dda4f01c3d</a></li>
<li>Fix tuple routing in cases where tuple descriptors don't match. The previous coding failed to work correctly when we have a multi-level partitioned hierarchy where tables at successive levels have different attribute numbers for the partition key attributes. To fix, have each PartitionDispatch object store a standalone TupleTableSlot initialized with the TupleDesc of the corresponding partitioned table, along with a TupleConversionMap to map tuples from the its parent's rowtype to own rowtype. After tuple routing chooses a leaf partition, we must use the leaf partition's tuple descriptor, not the root table's. To that end, a dedicated TupleTableSlot for tuple routing is now allocated in EState. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2ac3ef7a01df859c62d0a02333b646d65eaec5ff">http://git.postgresql.org/pg/commitdiff/2ac3ef7a01df859c62d0a02333b646d65eaec5ff</a></li>
<li>Remove _hash_chgbufaccess(). This is basically for the same reasons I got rid of _hash_wrtbuf() in commit 25216c98938495fd741bf585dcbef45b3a9ffd40: it's not convenient to have a function which encapsulates MarkBufferDirty(), especially as we move towards having hash indexes be WAL-logged. Patch by me, reviewed (but not entirely endorsed) by Amit Kapila. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7819ba1ef6c5297b7e27878d2b3d30c5bcef8939">http://git.postgresql.org/pg/commitdiff/7819ba1ef6c5297b7e27878d2b3d30c5bcef8939</a></li>
<li>Remove sql_inheritance GUC. This backward-compatibility GUC is long overdue for removal. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYe+EG7LdYX6pkcNxr4ygkP4+A=jm9o-CPXyOvRiCNwaQ@mail.gmail.com">http://postgr.es/m/CA+TgmoYe+EG7LdYX6pkcNxr4ygkP4+A=jm9o-CPXyOvRiCNwaQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e13486eba05cc46951a34263d19b65d1eca0176b">http://git.postgresql.org/pg/commitdiff/e13486eba05cc46951a34263d19b65d1eca0176b</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Fix handling of phrase operator removal while removing tsquery stopwords. The distance of a removed phrase operator should propagate up to a parent phrase operator if there is one, but this only worked correctly in left-deep trees. Throwing in a few parentheses confused it completely, as indeed was illustrated by bizarre results in existing regression test cases. To fix, track unaccounted-for distances that should propagate to the left and to the right of the current node, rather than trying to make it work with only one returned distance. Also make some adjustments to behave as well as we can for cases of intermixed phrase and regular (AND/OR) operators. I don't think it's possible to be 100% correct for that without a rethinking of the tsquery representation; for example, maybe we should just not drop stopword nodes at all underneath phrase operators. But this is better than it was, and changing tsquery representation wouldn't be safely back-patchable. While at it, I simplified the API of the clean_fakeval_intree function a bit by getting rid of the "char *result" output parameter; that wasn't doing anything that wasn't redundant with whether the result node is NULL or not, and testing for NULL seems a lot clearer/safer. This is part of a larger project to fix various infelicities in the phrase-search implementation, but this part seems comittable on its own. Back-patch to 9.6 where phrase operators were introduced. Discussion: <a target="_blank" href="https://postgr.es/m/28215.1481999808@sss.pgh.pa.us">https://postgr.es/m/28215.1481999808@sss.pgh.pa.us</a> Discussion: <a target="_blank" href="https://postgr.es/m/26706.1482087250@sss.pgh.pa.us">https://postgr.es/m/26706.1482087250@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2604438472c897fbbd1568b1a8ee177ba8cdb6e3">http://git.postgresql.org/pg/commitdiff/2604438472c897fbbd1568b1a8ee177ba8cdb6e3</a></li>
<li>Fix minor error message style violation. Primary error messages should not end with a period, since they're generally not written as full sentences. Oversight in 41493bac3. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7d41a2bd3eef4de64ae8f6f683457f12f9407c5d">http://git.postgresql.org/pg/commitdiff/7d41a2bd3eef4de64ae8f6f683457f12f9407c5d</a></li>
<li>Fix minor oversights in nodeAgg.c. aggstate-&gt;evalproj is always set up by ExecInitAgg, so there's no need to test. Doing so led Coverity to think that we might be intending "slot" to be possibly NULL here, and it quite properly complained that the rest of combine_aggregates() wasn't prepared for that. Also fix a couple of obvious thinkos in Asserts checking that "inputoff" isn't past the end of the slot. Errors introduced in commit 8ed3f11bb, so no need for back-patch. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c080b223a7a3991524a5287416a0ad756c15a098">http://git.postgresql.org/pg/commitdiff/c080b223a7a3991524a5287416a0ad756c15a098</a></li>
<li>Fix strange behavior (and possible crashes) in full text phrase search. In an attempt to simplify the tsquery matching engine, the original phrase search patch invented rewrite rules that would rearrange a tsquery so that no AND/OR/NOT operator appeared below a PHRASE operator. But this approach had numerous problems. The rearrangement step was missed by ts_rewrite (and perhaps other places), allowing tsqueries to be created that would cause Assert failures or perhaps crashes at execution, as reported by Andreas Seltenreich. The rewrite rules effectively defined semantics for operators underneath PHRASE that were buggy, or at least unintuitive. And because rewriting was done in tsqueryin() rather than at execution, the rearrangement was user-visible, which is not very desirable --- for example, it might cause unexpected matches or failures to match in ts_rewrite. As a somewhat independent problem, the behavior of nested PHRASE operators was only sane for left-deep trees; queries like "x &lt;-&gt; (y &lt;-&gt; z)" did not behave intuitively at all. To fix, get rid of the rewrite logic altogether, and instead teach the tsquery execution engine to manage AND/OR/NOT below a PHRASE operator by explicitly computing the match location(s) and match widths for these operators. This requires introducing some additional fields into the publicly visible ExecPhraseData struct; but since there's no way for third-party code to pass such a struct to TS_phrase_execute, it shouldn't create an ABI problem as long as we don't move the offsets of the existing fields. Another related problem was that index searches supposed that "!x &lt;-&gt; y" could be lossily approximated as "!x &amp; y", which isn't correct because the latter will reject, say, "x q y" which the query itself accepts. This required some tweaking in TS_execute_ternary along with the main tsquery engine. Back-patch to 9.6 where phrase operators were introduced. While this could be argued to change behavior more than we'd like in a stable branch, we have to do something about the crash hazards and index-vs-seqscan inconsistency, and it doesn't seem desirable to let the unintuitive behaviors induced by the rewriting implementation stand as precedent. Discussion: <a target="_blank" href="https://postgr.es/m/28215.1481999808@sss.pgh.pa.us">https://postgr.es/m/28215.1481999808@sss.pgh.pa.us</a> Discussion: <a target="_blank" href="https://postgr.es/m/26706.1482087250@sss.pgh.pa.us">https://postgr.es/m/26706.1482087250@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/89fcea1ace40bc025beea2758a80bcd56a319a6f">http://git.postgresql.org/pg/commitdiff/89fcea1ace40bc025beea2758a80bcd56a319a6f</a></li>
<li>Fix detection of unfinished Unicode surrogate pair at end of string. The U&amp;'...' and U&amp;"..." syntaxes silently discarded a surrogate pair start (that is, a code between U+D800 and U+DBFF) if it occurred at the very end of the string. This seems like an obvious oversight, since we throw an error for every other invalid combination of surrogate characters, including the very same situation in E'...' syntax. This has been wrong since the pair processing was added (in 9.0), so back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/19113.1482337898@sss.pgh.pa.us">https://postgr.es/m/19113.1482337898@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a8ae12322ae056ebbe9d83cf16b4c92e86a6ac28">http://git.postgresql.org/pg/commitdiff/a8ae12322ae056ebbe9d83cf16b4c92e86a6ac28</a></li>
<li>Give a useful error message if uuid-ossp is built without preconfiguration. Before commit b8cc8f947, it was possible to build contrib/uuid-ossp without having told configure you meant to; you could just cd into that directory and "make". That no longer works because the code depends on configure to have done header and library probes, but the ensuing error messages are not so easy to interpret if you're not an old C hand. We've gotten a couple of complaints recently from people trying to do this the low-tech way, so add an explicit #error directing the user to use --with-uuid. (In principle we might want to do something similar in the other optionally-built contrib modules; but I don't think any of the others have ever worked without preconfiguration, so there are no bad habits to break people of.) Back-patch to 9.4 where the previous commit came in. Report: <a target="_blank" href="https://postgr.es/m/CAHeEsBf42AWTnk=1qJvFv+mYgRFm07Knsfuc86Ono8nRjf3tvQ@mail.gmail.com">https://postgr.es/m/CAHeEsBf42AWTnk=1qJvFv+mYgRFm07Knsfuc86Ono8nRjf3tvQ@mail.gmail.com</a> Report: <a target="_blank" href="https://postgr.es/m/CAKYdkBrUaZX+F6KpmzoHqMtiUqCtAW_w6Dgvr6F0WTiopuGxow@mail.gmail.com">https://postgr.es/m/CAKYdkBrUaZX+F6KpmzoHqMtiUqCtAW_w6Dgvr6F0WTiopuGxow@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b86515da1a73d0a2e23aca728f18b5f9e809e89f">http://git.postgresql.org/pg/commitdiff/b86515da1a73d0a2e23aca728f18b5f9e809e89f</a></li>
<li>Fix handling of expanded objects in CoerceToDomain and CASE execution. When the input value to a CoerceToDomain expression node is a read-write expanded datum, we should pass a read-only pointer to any domain CHECK expressions and then return the original read-write pointer as the expression result. Previously we were blindly passing the same pointer to all the consumers of the value, making it possible for a function in CHECK to modify or even delete the expanded value. (Since a plpgsql function will absorb a passed-in read-write expanded array as a local variable value, it will in fact delete the value on exit.) A similar hazard of passing the same read-write pointer to multiple consumers exists in domain_check() and in ExecEvalCase, so fix those too. The fix requires adding MakeExpandedObjectReadOnly calls at the appropriate places, which is simple enough except that we need to get the data type's typlen from somewhere. For the domain cases, solve this by redefining DomainConstraintRef.tcache as okay for callers to access; there wasn't any reason for the original convention against that, other than not wanting the API of typcache.c to be any wider than it had to be. For CASE, there's no good solution except to add a syscache lookup during executor start. Per bug #14472 from Marcos Castedo. Back-patch to 9.5 where expanded values were introduced. Discussion: <a target="_blank" href="https://postgr.es/m/15225.1482431619@sss.pgh.pa.us">https://postgr.es/m/15225.1482431619@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cd1b215692d2cadf499936dba05f1f60bce59344">http://git.postgresql.org/pg/commitdiff/cd1b215692d2cadf499936dba05f1f60bce59344</a></li>
<li>Fix CREATE TABLE ... LIKE ... WITH OIDS. Having a WITH OIDS specification should result in the creation of an OID column, but commit b943f502b broke that in the case that there were LIKE tables without OIDS. Commentary in that patch makes it look like this was intentional, but if so it was based on a faulty reading of what inheritance does: the parent tables can add an OID column, but they can't subtract one. AFAICS, the behavior ought to be that you get an OID column if any of the inherited tables, LIKE tables, or WITH clause ask for one. Also, revert that patch's unnecessary split of transformCreateStmt's loop over the tableElts list into two passes. That seems to have been based on a misunderstanding as well: we already have two-pass processing here, we don't need three passes. Per bug #14474 from Jeff Dafoe. Back-patch to 9.6 where the misbehavior was introduced. Report: <a target="_blank" href="https://postgr.es/m/20161222145304.25620.47445@wrigleys.postgresql.org">https://postgr.es/m/20161222145304.25620.47445@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1ead0208b2178089b024caa2d1465a3f3056a45c">http://git.postgresql.org/pg/commitdiff/1ead0208b2178089b024caa2d1465a3f3056a45c</a></li>
<li>Spellcheck: s/descendent/descendant/g. I got a little annoyed by reading documentation paragraphs containing both spellings within a few lines of each other. My dictionary says "descendant" is the preferred spelling, and it's certainly the majority usage in our tree, so standardize on that. For one usage in parallel.sgml, I thought it better to rewrite to avoid the term altogether. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ff33d1456ea098e160cbbc74b332656c06abc2ab">http://git.postgresql.org/pg/commitdiff/ff33d1456ea098e160cbbc74b332656c06abc2ab</a></li>
<li>Doc: improve index entry for "median". We had an index entry for "median" attached to the percentile_cont function entry, which was pretty useless because a person following the link would never realize that that function was the one they were being hinted to use. Instead, make the index entry point at the example in syntax-aggregates, and add a &lt;seealso&gt; link to "percentile". Also, since that example explicitly claims to be calculating the median, make it use percentile_cont not percentile_disc. This makes no difference in terms of the larger goals of that section, but so far as I can find, nearly everyone thinks that "median" means the continuous not discrete calculation. Per gripe from Steven Winfield. Back-patch to 9.4 where we introduced percentile_cont. Discussion: <a target="_blank" href="https://postgr.es/m/20161223102056.25614.1166@wrigleys.postgresql.org">https://postgr.es/m/20161223102056.25614.1166@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3c9d398484fb6e188e665be8299d6e5e89924c94">http://git.postgresql.org/pg/commitdiff/3c9d398484fb6e188e665be8299d6e5e89924c94</a></li>
<li>Replace enum InhOption with simple boolean. Now that it has only INH_NO and INH_YES values, it's just weird that it's not a plain bool, so make it that way. Also rename RangeVar.inhOpt to "inh", to be like RangeTblEntry.inh. My recollection is that we gave it a different name specifically because it had a different representation than the derived bool value, but it no longer does. And this is a good forcing function to be sure we catch any places that are affected by the change. Bump catversion because of possible effect on stored RangeVar nodes. I'm not exactly convinced that we ever store RangeVar on disk, but we have a readfuncs function for it, so be cautious. (If we do do so, then commit e13486eba was in error not to bump catversion.) Follow-on to commit e13486eba. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYe+EG7LdYX6pkcNxr4ygkP4+A=jm9o-CPXyOvRiCNwaQ@mail.gmail.com">http://postgr.es/m/CA+TgmoYe+EG7LdYX6pkcNxr4ygkP4+A=jm9o-CPXyOvRiCNwaQ@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fe591f8bf68db9bf81f278acce6239ee68cd4ed6">http://git.postgresql.org/pg/commitdiff/fe591f8bf68db9bf81f278acce6239ee68cd4ed6</a></li>
<li>Fix incorrect error reporting for duplicate data in \crosstabview. \crosstabview's complaint about multiple entries for the same crosstab cell quoted the wrong row and/or column values. It would accidentally appear to work if the data had been in strcmp() order to start with, which probably explains how we missed noticing this during development. This could be fixed in more than one way, but the way I chose was to hang onto both result pointers from bsearch() and use those to get at the value names. In passing, avoid casting away const in the bsearch comparison functions. No bug there, just poor style. Per bug #14476 from Tomonari Katsumata. Back-patch to 9.6 where \crosstabview was introduced. Report: <a target="_blank" href="https://postgr.es/m/20161225021519.10139.45460@wrigleys.postgresql.org">https://postgr.es/m/20161225021519.10139.45460@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a3aef88e6a9c5822eb4a5ad0744b15dc6e8a5d86">http://git.postgresql.org/pg/commitdiff/a3aef88e6a9c5822eb4a5ad0744b15dc6e8a5d86</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Fix sharing Agg transition state of DISTINCT or ordered aggs. If a query contained two aggregates that could share the transition value, we would correctly collect the input into a tuplesort only once, but incorrectly run the transition function over the accumulated input twice, in finalize_aggregates(). That caused a crash, when we tried to call tuplesort_performsort() on an already-freed NULL tuplestore. Backport to 9.6, where sharing of transition state and this bug were introduced. Analysis by Tom Lane. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/ac5b0b69-744c-9114-6218-8300ac920e61@iki.fi">https://www.postgresql.org/message-id/ac5b0b69-744c-9114-6218-8300ac920e61@iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/db80acfc9d50ac56811d22802ab3d822ab313055">http://git.postgresql.org/pg/commitdiff/db80acfc9d50ac56811d22802ab3d822ab313055</a></li>
<li>Simplify tape block format. No more indirect blocks. The blocks form a linked list instead. This saves some memory, because we don't need to have a buffer in memory to hold the indirect block (or blocks). To reflect that, TAPE_BUFFER_OVERHEAD is reduced from 3 to 1 buffer, which allows using more memory for building the initial runs. Reviewed by Peter Geoghegan and Robert Haas. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/34678beb-938e-646e-db9f-a7def5c44ada%40iki.fi">https://www.postgresql.org/message-id/34678beb-938e-646e-db9f-a7def5c44ada%40iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/01ec25631fe0eae6af67c29c61a358dc6b92ed3c">http://git.postgresql.org/pg/commitdiff/01ec25631fe0eae6af67c29c61a358dc6b92ed3c</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Add pg_sequence system catalog. Move sequence metadata (start, increment, etc.) into a proper system catalog instead of storing it in the sequence heap object. This separates the metadata from the sequence data. Sequence metadata is now operated on transactionally by DDL commands, whereas previously rollbacks of sequence-related DDL commands would be ignored. Reviewed-by: Andreas Karlsson &lt;andreas@proxel.se&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1753b1b027035029c2a2a1649065762fafbf63f3">http://git.postgresql.org/pg/commitdiff/1753b1b027035029c2a2a1649065762fafbf63f3</a></li>
<li>Reorder pg_sequence columns to avoid alignment issue. On AIX, doubles are aligned at 4 bytes, but int64 is aligned at 8 bytes. Our code assumes that doubles have alignment that can also be applied to int64, but that fails in this case. One effect is that heap_form_tuple() writes tuples in a different layout than Form_pg_sequence expects. Rather than rewrite the whole alignment code, work around the issue by reordering the columns in pg_sequence so that the first int64 column naturally comes out at an 8-byte boundary. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f3b421da5f4addc95812b9db05a24972b8fd9739">http://git.postgresql.org/pg/commitdiff/f3b421da5f4addc95812b9db05a24972b8fd9739</a></li>
<li>doc: Further speed improvements for HTML XSLT build <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/909cb78a8cce73c9678ddb3269b56e31b56e084b">http://git.postgresql.org/pg/commitdiff/909cb78a8cce73c9678ddb3269b56e31b56e084b</a></li>
<li>Update sequence_1.out for recent changes <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/22434dd06bbc5774c7bbffa5bf2bef3ead50c2f2">http://git.postgresql.org/pg/commitdiff/22434dd06bbc5774c7bbffa5bf2bef3ead50c2f2</a></li>
<li>pg_dump: Remove obsolete handling of sequence names. There was code that attempted to check whether the sequence name stored inside the sequence was the same as the name in pg_class. But that code was already ifdef'ed out, and now that the sequence no longer stores its own name, it's altogether obsolete, so remove it. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3e6639a465a5702d0aa98fc756b5ab8c7f97cde8">http://git.postgresql.org/pg/commitdiff/3e6639a465a5702d0aa98fc756b5ab8c7f97cde8</a></li>
<li>Remove unnecessary casts of makeNode() result. makeNode() is already a macro that has the right result pointer type, so casting it again to the same type is unnecessary. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/158df30359025d74daee74a3b927fd07c3b1a413">http://git.postgresql.org/pg/commitdiff/158df30359025d74daee74a3b927fd07c3b1a413</a></li>
</ul>
<p>Dean Rasheed pushed:</p>
<ul>
<li>Fix order of operations in CREATE OR REPLACE VIEW. When CREATE OR REPLACE VIEW acts on an existing view, don't update the view options until after the view query has been updated. This is necessary in the case where CREATE OR REPLACE VIEW is used on an existing view that is not updatable, and the new view is updatable and specifies the WITH CHECK OPTION. In this case, attempting to apply the new options to the view before updating its query fails, because the options are applied using the ALTER TABLE infrastructure which checks that WITH CHECK OPTION is only applied to an updatable view. If new columns are being added to the view, that is also done using the ALTER TABLE infrastructure, but it is important that that still be done before updating the view query, because the rules system checks that the query columns match those on the view relation. Added a comment to explain that, in case someone is tempted to move that to where the view options are now being set. Back-patch to 9.4 where WITH CHECK OPTION was added. Report: <a target="_blank" href="https://postgr.es/m/CAEZATCUp%3Dz%3Ds4SzZjr14bfct_bdJNwMPi-gFi3Xc5k1ntbsAgQ%40mail.gmail.com">https://postgr.es/m/CAEZATCUp%3Dz%3Ds4SzZjr14bfct_bdJNwMPi-gFi3Xc5k1ntbsAgQ%40mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/58b1362642d47bd7a7ed1157035a38671555e860">http://git.postgresql.org/pg/commitdiff/58b1362642d47bd7a7ed1157035a38671555e860</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Fix dumping of casts and transforms using built-in functions. In pg_dump.c dumpCast() and dumpTransform(), we would happily ignore the cast or transform if it happened to use a built-in function because we weren't including the information about built-in functions when querying pg_proc from getFuncs(). Modify the query in getFuncs() to also gather information about functions which are used by user-defined casts and transforms (where "user-defined" means "has an OID &gt;= FirstNormalObjectId"). This also adds to the TAP regression tests for 9.6 and master to cover these types of objects. Back-patch all the way for casts, back to 9.5 for transforms. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/flat/20160504183952.GE10850%40tamriel.snowman.net">https://www.postgresql.org/message-id/flat/20160504183952.GE10850%40tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2259bf672cb45b4104dcb835354beeb1c6105b0e">http://git.postgresql.org/pg/commitdiff/2259bf672cb45b4104dcb835354beeb1c6105b0e</a></li>
<li>For 8.0 servers, get last built-in oid from pg_database. We didn't start ensuring that all built-in objects had OIDs less than 16384 until 8.1, so for 8.0 servers we still need to query the value out of pg_database. We need this, in particular, to distinguish which casts were built-in and which were user-defined. For HEAD, we only worry about going back to 8.0, for the back-branches, we also ensure that 7.0-7.4 work. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/flat/20160504183952.GE10850%40tamriel.snowman.net">https://www.postgresql.org/message-id/flat/20160504183952.GE10850%40tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/19990918d3fa2a445561627ed415b5891602f7fe">http://git.postgresql.org/pg/commitdiff/19990918d3fa2a445561627ed415b5891602f7fe</a></li>
<li>Improve ALTER TABLE documentation. The ALTER TABLE documentation wasn't terribly clear when it came to which commands could be combined together and what it meant when they were. In particular, SET TABLESPACE *can* be combined with other commands, when it's operating against a single table, but not when multiple tables are being moved with ALL IN TABLESPACE. Further, the actions are applied together but not really in 'parallel', at least today. Pointed out by: Amit Langote. Improved wording from Tom. Back-patch to 9.4, where the ALL IN TABLESPACE option was added. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/14c535b4-13ef-0590-1b98-76af355a0763%40lab.ntt.co.jp">https://www.postgresql.org/message-id/14c535b4-13ef-0590-1b98-76af355a0763%40lab.ntt.co.jp</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2d1018ca56f5ddaf0bfb5b4d0133283f3e823301">http://git.postgresql.org/pg/commitdiff/2d1018ca56f5ddaf0bfb5b4d0133283f3e823301</a></li>
<li>Use TSConfigRelationId in AlterTSConfiguration(). When we are altering a text search configuration, we are getting the tuple from pg_ts_config and using its OID, so use TSConfigRelationId when invoking any post-alter hooks and setting the object address. Further, in the functions called from AlterTSConfiguration(), we're saving information about the command via EventTriggerCollectAlterTSConfig(), so we should be setting commandCollected to true. Also add a regression test to test_ddl_deparse for ALTER TEXT SEARCH CONFIGURATION. Author: Artur Zakirov, a few additional comments by me Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/57a71eba-f2c7-e7fd-6fc0-2126ec0b39bd%40postgrespro.ru">https://www.postgresql.org/message-id/57a71eba-f2c7-e7fd-6fc0-2126ec0b39bd%40postgrespro.ru</a> Back-patch the fix for the InvokeObjectPostAlterHook() call to 9.3 where it was introduced, and the fix for the ObjectAddressSet() call and setting commandCollected to true to 9.5 where those changes to ProcessUtilitySlow() were introduced. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/12bd7dd317e8f4346fb3507578aca790ede6ebea">http://git.postgresql.org/pg/commitdiff/12bd7dd317e8f4346fb3507578aca790ede6ebea</a></li>
<li>Fix tab completion in psql for ALTER DEFAULT PRIVILEGES. When providing tab completion for ALTER DEFAULT PRIVILEGES, we are including the list of roles as possible options for completion after the GRANT or REVOKE. Further, we accept FOR ROLE/IN SCHEMA at the same time and in either order, but the tab completion was only working for one or the other. Lastly, we weren't using the actual list of allowed kinds of objects for default privileges for completion after the 'GRANT X ON' but instead were completeing to what 'GRANT X ON' supports, which isn't the ssame at all. Address these issues by improving the forward tab-completion for ALTER DEFAULT PRIVILEGES and then constrain and correct how the tail completion is done when it is for ALTER DEFAULT PRIVILEGES. Back-patch the forward/tail tab-completion to 9.6, where we made it easy to handle such cases. For 9.5 and earlier, correct the initial tab-completion to at least be correct as far as it goes and then add a check for GRANT/REVOKE to only tab-complete when the GRANT/REVOKE is the start of the command, so we don't try to do tab-completion after we get to the GRANT/REVOKE part of the ALTER DEFAULT PRIVILEGES command, which is better than providing incorrect completions. Initial patch for master and 9.6 by Gilles Darold, though I cleaned it up and added a few comments. All bugs in the 9.5 and earlier patch are mine. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/1614593c-e356-5b27-6dba-66320a9bc68b@dalibo.com">https://www.postgresql.org/message-id/1614593c-e356-5b27-6dba-66320a9bc68b@dalibo.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f3fd531a51df2a73d8517a542e6999e0186e586b">http://git.postgresql.org/pg/commitdiff/f3fd531a51df2a73d8517a542e6999e0186e586b</a></li>
<li>pg_dumpall: Include --verbose option in --help output. The -v/--verbose option was not included in the output from --help for pg_dumpall even though it's in the pg_dumpall documentation and has apparently been around since pg_dumpall was reimplemented in C in 2002. Fix that by adding it. Pointed out by Daniel Westermann. Back-patch to all supported branches. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/2020970042.4589542.1482482101585.JavaMail.zimbra%40dbi-services.com">https://www.postgresql.org/message-id/2020970042.4589542.1482482101585.JavaMail.zimbra%40dbi-services.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/86d216c77549e200b95bed487b6fb87d99a1e789">http://git.postgresql.org/pg/commitdiff/86d216c77549e200b95bed487b6fb87d99a1e789</a></li>
</ul>
<p>Joe Conway pushed:</p>
<ul>
<li>Improve dblink error message when remote does not provide it. When dblink or postgres_fdw detects an error on the remote side of the connection, it will try to construct a local error message as best it can using libpq's PQresultErrorField(). When no primary message is available, it was bailing out with an unhelpful "unknown error". Make that message better and more style guide compliant. Per discussion on hackers. Backpatch to 9.2 except postgres_fdw which didn't exist before 9.3. Discussion: <a target="_blank" href="https://postgr.es/m/19872.1482338965%40sss.pgh.pa.us">https://postgr.es/m/19872.1482338965%40sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ea0aa9698cfa74bb04cf53d813924fe67f278c30">http://git.postgresql.org/pg/commitdiff/ea0aa9698cfa74bb04cf53d813924fe67f278c30</a></li>
<li>Protect dblink from invalid options when using postgres_fdw server. When dblink uses a postgres_fdw server name for its connection, it is possible for the connection to have options that are invalid with dblink (e.g. "updatable"). The recommended way to avoid this problem is to use dblink_fdw servers instead. However there are use cases for using postgres_fdw, and possibly other FDWs, for dblink connection options, therefore protect against trying to use any options that do not apply by using is_valid_dblink_option() when building the connection string from the options. Back-patch to 9.3. Although 9.2 supports FDWs for connection info, is_valid_dblink_option() did not yet exist, and neither did postgres_fdw, at least in the postgres source tree. Given the lack of previous complaints, fixing that seems too invasive/not worth it. Author: Corey Huinker Reviewed-By: Joe Conway Discussion: <a target="_blank" href="https://postgr.es/m/CADkLM%3DfWyXVEyYcqbcRnxcHutkP45UHU9WD7XpdZaMfe7S%3DRwA%40mail.gmail.com">https://postgr.es/m/CADkLM%3DfWyXVEyYcqbcRnxcHutkP45UHU9WD7XpdZaMfe7S%3DRwA%40mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c4448683893bd37b59003603bc9075d362e81b5a">http://git.postgresql.org/pg/commitdiff/c4448683893bd37b59003603bc9075d362e81b5a</a></li>
<li>Make dblink try harder to form useful error messages. When libpq encounters a connection-level error, e.g. runs out of memory while forming a result, there will be no error associated with PGresult, but a message will be placed into PGconn's error buffer. postgres_fdw takes care to use the PGconn error message when PGresult does not have one, but dblink has been negligent in that regard. Modify dblink to mirror what postgres_fdw has been doing. Back-patch to all supported branches. Author: Joe Conway Reviewed-By: Tom Lane Discussion: <a target="_blank" href="https://postgr.es/m/02fa2d90-2efd-00bc-fefc-c23c00eb671e%40joeconway.com">https://postgr.es/m/02fa2d90-2efd-00bc-fefc-c23c00eb671e%40joeconway.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2f802d95b4904dbed3dfdca1b3a607cd085d2e20">http://git.postgresql.org/pg/commitdiff/2f802d95b4904dbed3dfdca1b3a607cd085d2e20</a></li>
<li>Improve RLS documentation with respect to COPY. Documentation for pg_restore said COPY TO does not support row security when in fact it should say COPY FROM. Fix that. While at it, make it clear that "COPY FROM" does not allow RLS to be enabled and INSERT should be used instead. Also that SELECT policies will apply to COPY TO statements. Back-patch to 9.5 where RLS first appeared. Author: Joe Conway Reviewed-By: Dean Rasheed and Robert Haas Discussion: <a target="_blank" href="https://postgr.es/m/5744FA24.3030008%40joeconway.com">https://postgr.es/m/5744FA24.3030008%40joeconway.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0a85c102254b72ec7ce16bc504206a1a5c84bd76">http://git.postgresql.org/pg/commitdiff/0a85c102254b72ec7ce16bc504206a1a5c84bd76</a></li>
</ul>
<p>Michael Meskes pushed:</p>
<ul>
<li>Fix buffer overflow on particularly named files and clarify documentation about output file naming. Patch by Tsunakawa, Takayuki &lt;tsunakawa.takay@jp.fujitsu.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4032ef18d06aa7a3db515926ddebe8af04e533fe">http://git.postgresql.org/pg/commitdiff/4032ef18d06aa7a3db515926ddebe8af04e533fe</a></li>
</ul>
<p>Andres Freund pushed:</p>
<ul>
<li>Skip checkpoints, archiving on idle systems. Some background activity (like checkpoints, archive timeout, standby snapshots) is not supposed to happen on an idle system. Unfortunately so far it was not easy to determine when a system is idle, which defeated some of the attempts to avoid redundant activity on an idle system. To make that easier, allow to make individual WAL insertions as not being "important". By checking whether any important activity happened since the last time an activity was performed, it now is easy to check whether some action needs to be repeated. Use the new facility for checkpoints, archive timeout and standby snapshots. The lack of a facility causes some issues in older releases, but in my opinion the consequences (superflous checkpoints / archived segments) aren't grave enough to warrant backpatching. Author: Michael Paquier, editorialized by Andres Freund Reviewed-By: Andres Freund, David Steele, Amit Kapila, Kyotaro HORIGUCHI Bug: #13685 Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20151016203031.3019.72930@wrigleys.postgresql.org">https://www.postgresql.org/message-id/20151016203031.3019.72930@wrigleys.postgresql.org</a> <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqQcPqxEM3S735Bd2RzApNqSNJVietAC=6kfkYv_45dKwA@mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqQcPqxEM3S735Bd2RzApNqSNJVietAC=6kfkYv_45dKwA@mail.gmail.com</a> Backpatch: - <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6ef2eba3f57f17960b7cd4958e18aa79e357de2f">http://git.postgresql.org/pg/commitdiff/6ef2eba3f57f17960b7cd4958e18aa79e357de2f</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Thomas Munro sent in a patch to add support for delta relations in AFTER triggers to PL/PythonU.</p>
<p>Petr Jel&Atilde;&shy;nek sent in four more revisions of a patch to add logical replication.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to enable logical replication of data which was there before logical replication was turned on.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to change detection of corrupted 2PC files as FATAL and minimize window between history file and end-of-recovery record.</p>
<p>Kyotaro HORIGUCHI sent in a patch to protect syscache from bloating with negative cache entries.</p>
<p>Thomas Munro sent in another revision of a patch to allow measuring replay lag.</p>
<p>Beena Emerson sent in a patch to make wal segment size initdb configurable.</p>
<p>Ashutosh Sharma sent in another revision of a patch to add support for hash index in pageinspect contrib module.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in two revisions of a patch to add tests for authentication and pg_hba.conf.</p>
<p>Heikki Linnakangas sent in a patch to use the "plain:" prefix for plaintext passwords stored in pg_authid.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel bitmap heap scan.</p>
<p>Ants Aasma and Craig Ringer traded patches to fix an issue where the replication slot xmin is not reset if HS feedback is turned off while the standby is shut down.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to implement asynchronous query execution.</p>
<p>Heikki Linnakangas sent in another revision of a patch to add logical tape pause/resume.</p>
<p>Ashutosh Sharma sent in a patch to create a pgstathashindex() function to get hash index table statistics.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel merge join.</p>
<p>Andrea Urbani sent in a patch to add --custom-fetch-table and --custom-fetch-value parameters to pg_dump.</p>
<p>Etsuro Fujita and Ashutosh Bapat traded patches to fix a FDW bug.</p>
<p>Artur Zakirov sent in another revision of a patch to output pg_ts_config_map entries with pg_event_trigger_ddl_commands().</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to fix a potential data loss of 2PC files.</p>
<p>Ashutosh Bapat sent in a patch to translate partition hierarchy into inheritance hierarchy.</p>
<p>Craig Ringer sent in three revisions of a patch to introduce txid_status(bigint) to get status of an xact.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to add xmltable().</p>
<p>Kuntal Ghosh sent in a patch to reduce WALWriteLock contention.</p>
<p>Amul Sul sent in another revision of a patch to add a pg_background contrib extension.</p>
<p>Amit Khandekar sent in a patch to implement parallel append.</p>
<p>Claudio Freire sent in a patch to prefetch buffers on backward scan and allow using more than 1GB work mem in VACUUM.</p>
<p>&Atilde;lvaro Herrera sent in two more revisions of a patch to implement indirect indexes.</p>
<p>Craig Ringer sent in a patch to add a new CREATE_REPLICATION_SLOT option.</p>
<p>Daniel V&Atilde;&copy;rit&Atilde;&copy; sent in another revision of a patch to improve some of the psql variable hooks.</p>
<p>Jerry Yu sent in a patch to push down quals into EXCEPT.</p>
<p>Fabien COELHO sent in two more revisions of a patch to fix the handling of compound/combined queries by pg_stat_statements.</p>
<p>Joel Jacobson sent in a patch to implement seconds resolution for wait_start.</p>
<p>Rafia Sabih sent in another revision of a patch to implement parallel index-only scans.</p>
<p>Erik Rijkers sent in a patch to fix a typo in a comment in tablecmds.c.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2017/01/07/Nouvelles-hebdomadaires-de-PostgreSQL-25-d%C3%A9cembre-2016">par chl le samedi  7 janvier 2017 à 13h17</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi 20 décembre 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:b754ca10d69c8ba88f9bbd51a5ced735" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2016/12/20/Nouvelles-hebdomadaires-de-PostgreSQL-18-d%C3%A9cembre-2016">Nouvelles hebdomadaires de PostgreSQL - 18 décembre 2016</a></h4>
<div class="entry">
<div class="content">
<p>[ndt: Meetup du PLUG à Lyon ce mardi 20 décembre&nbsp;: <a href="https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/" target="_blank">https://www.meetup.com/fr-FR/PostgreSQL-Lyon-User-Group/</a>]</p>
<p>PGCon 2017 aura lieu &agrave; Ottawa du 23 au 26 mai. Les propositions seront attendues jusqu'au 19 janvier 2017&nbsp;: <a target="_blank" href="http://www.pgcon.org/2017/papers.php">http://www.pgcon.org/2017/papers.php</a></p>
<p>PgConf.Russia 2017 se d&eacute;roulera du 15 au 17 mars 2017 &agrave; Moscou&nbsp;: <a target="_blank" href="https://pgconf.ru/en">https://pgconf.ru/en</a></p>
<p>Le PGDay Asia 2017 s'&eacute;tendra du 17 au 18 mars &agrave; Singapour. L'appel &agrave; conf&eacute;renciers s'&eacute;teindra le 16 janvier 2017&nbsp;: <a target="_blank" href="http://tinyurl.com/pgDay-Asia-2017-Cfp">http://tinyurl.com/pgDay-Asia-2017-Cfp</a></p>
<p>Les inscriptions pour le PGDay du FOSDEM 2017 &agrave; Bruxelles sont &agrave; pr&eacute;sent ouvertes&nbsp;: <a target="_blank" href="https://2017.fosdempgday.org/">https://2017.fosdempgday.org/</a></p>
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<h2>Offres d'emplois autour de PostgreSQL en d&eacute;cembre</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2016-12/threads.php">http://archives.postgresql.org/pgsql-jobs/2016-12/threads.php</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde). Les propositions sont attendues sur &lt;papers AT pgconf DOT in&gt; jusqu'au 31 d&eacute;cembre 2016&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20161219002906.GA8714@fetter.org">http://www.postgresql.org/message-id/20161219002906.GA8714@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Fix broken autoconf test for random number source. Hopefully this fixes buildfarm member jacana. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/be25aa16-2f06-b7d1-8810-c69489a0e70b@dunslane.net">https://www.postgresql.org/message-id/be25aa16-2f06-b7d1-8810-c69489a0e70b@dunslane.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/ad365b2f91dc57ed1f18839f9f59a2799d276c8d">http://git.postgresql.org/pg/commitdiff/ad365b2f91dc57ed1f18839f9f59a2799d276c8d</a></li>
<li>Fix two thinkos related to strong random keys. pg_backend_random() is used for MD5 salt generation, but it can fail, and no checks were done on its status code. Fix memory leak, if generating a random number for a cancel key failed. Both issues were spotted by Coverity. Fix by Michael Paquier. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/41493bac36575c93172644d0eab7045aed8dcc17">http://git.postgresql.org/pg/commitdiff/41493bac36575c93172644d0eab7045aed8dcc17</a></li>
<li>Fix pgcrypto compilation with OpenSSL 1.1.0. Was broken by the switch to using OpenSSL's EVP interface for ciphers, in commit 5ff4a67f. Reported by Andres Freund. Fix by Michael Paquier with some kibitzing by me. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20161201014826.ic72tfkahmevpwz7@alap3.anarazel.de">https://www.postgresql.org/message-id/20161201014826.ic72tfkahmevpwz7@alap3.anarazel.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9bbbf029dded76d7d86053ebad1c5f9ab2948904">http://git.postgresql.org/pg/commitdiff/9bbbf029dded76d7d86053ebad1c5f9ab2948904</a></li>
<li>Further cleanup from the strong-random patch. Also use the new facility for generating RADIUS authenticator requests, and salt in chkpass extension. Reword the error messages to be nicer. Fix bogus error code used in the message in BackendStartup. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/58445c5c8d1424038d654ad9ee8af3724c60105e">http://git.postgresql.org/pg/commitdiff/58445c5c8d1424038d654ad9ee8af3724c60105e</a></li>
<li>Refactor the code for verifying user's password. Split md5_crypt_verify() into three functions: * get_role_password() to fetch user's password from pg_authid, and check its expiration. * md5_crypt_verify() to check an MD5 authentication challenge * plain_crypt_verify() to check a plaintext password. get_role_password() will be needed as a separate function by the upcoming SCRAM authentication patch set. Most of the remaining functionality in md5_crypt_verify() was different for MD5 and plaintext authentication, so split that for readability. While we're at it, simplify the *_crypt_verify functions by using stack-allocated buffers to hold the temporary MD5 hashes, instead of pallocing. Reviewed by Michael Paquier. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/3029e460-d47c-710e-507e-d8ba759d7cbb@iki.fi">https://www.postgresql.org/message-id/3029e460-d47c-710e-507e-d8ba759d7cbb@iki.fi</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/e7f051b8f9a6341f6d3bf80b29c1dbc1837be9ab">http://git.postgresql.org/pg/commitdiff/e7f051b8f9a6341f6d3bf80b29c1dbc1837be9ab</a></li>
<li>Fix off-by-one in memory allocation for quote_literal_cstr(). The calculation didn't take into account the NULL terminator. That lead to overwriting the palloc'd buffer by one byte, if the input consists entirely of backslashes. For example "format('%L', E'\\')". Fixes bug #14468. Backpatch to all supported versions. Report: <a target="_blank" href="https://www.postgresql.org/message-id/20161216105001.13334.42819%40wrigleys.postgresql.org">https://www.postgresql.org/message-id/20161216105001.13334.42819%40wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4f5182e18d3ec7b84c24ceba2c436ea890c95e25">http://git.postgresql.org/pg/commitdiff/4f5182e18d3ec7b84c24ceba2c436ea890c95e25</a></li>
</ul>
<p>Robert Haas pushed:</p>
<ul>
<li>psql: Fix incorrect version check for table partitioning. Table partitioning was added in 10, not 9.6. Fabr&Atilde;&shy;zio de Royes Mello, per report from Jeff Janes <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/06e184876bc07c2b1d7144957dcf02c5b4f709c2">http://git.postgresql.org/pg/commitdiff/06e184876bc07c2b1d7144957dcf02c5b4f709c2</a></li>
<li>doc: Fix purported type of pg_am.amhandler to match reality. Joel Jacobson <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b4630e01fd4c73c195025b7307ebc13d489b9ef9">http://git.postgresql.org/pg/commitdiff/b4630e01fd4c73c195025b7307ebc13d489b9ef9</a></li>
<li>Remove should_free arguments to tuplesort routines. Since commit e94568ecc10f2638e542ae34f2990b821bbf90ac, the answer is always "false", and we do not need to complicate the API by arranging to return a constant value. Peter Geoghegan Discussion: <a target="_blank" href="http://postgr.es/m/CAM3SWZQWZZ_N=DmmL7tKy_OUjGH_5mN=N=A6h7kHyyDvEhg2DA@mail.gmail.com">http://postgr.es/m/CAM3SWZQWZZ_N=DmmL7tKy_OUjGH_5mN=N=A6h7kHyyDvEhg2DA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3856cf9607f41245ec9462519c53f1109e781fc5">http://git.postgresql.org/pg/commitdiff/3856cf9607f41245ec9462519c53f1109e781fc5</a></li>
<li>doc: Improve documentation related to table partitioning feature. Commit f0e44751d7175fa3394da2c8f85e3ceb3cdbfe63 implemented table partitioning, but failed to mention the "no row movement" restriction in the documentation. Fix that and a few other issues. Amit Langote, with some additional wordsmithing by me. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a1a4459c299a86f909c27e391a10d7b9b05ea697">http://git.postgresql.org/pg/commitdiff/a1a4459c299a86f909c27e391a10d7b9b05ea697</a></li>
<li>Update typedefs.list. So developers can more easily run pgindent locally <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/acddbe221b084956a0efd6e4b6c6586e8fd994d7">http://git.postgresql.org/pg/commitdiff/acddbe221b084956a0efd6e4b6c6586e8fd994d7</a></li>
<li>Clean up code, comments, and formatting for table partitioning. Amit Langote, plus pgindent-ing by me. Inspired in part by review comments from Tomas Vondra. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4b9a98e154cec81849af24091443747a6057c968">http://git.postgresql.org/pg/commitdiff/4b9a98e154cec81849af24091443747a6057c968</a></li>
<li>Fix bug in hashbulkdelete. Commit 6d46f4783efe457f74816a75173eb23ed8930020 failed to account for the possibility that hashbulkdelete() might encounter a bucket that has been split since it began scanning the bucket array. Repair. Extracted from a larger pathc by Amit Kapila; I rewrote the comment. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/501c7b94bcb00cfa0faad60135cf6af82fd56a3a">http://git.postgresql.org/pg/commitdiff/501c7b94bcb00cfa0faad60135cf6af82fd56a3a</a></li>
<li>Fix bugs in RelationGetPartitionDispatchInfo. The previous coding was not quite right for cases involving multiple levels of partitioning. Amit Langote <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a25665088d812d08bb888e961f208eaebf522050">http://git.postgresql.org/pg/commitdiff/a25665088d812d08bb888e961f208eaebf522050</a></li>
<li>Remove _hash_wrtbuf() in favor of calling MarkBufferDirty(). The whole concept of _hash_wrtbuf() is that we need to know at the time we're releasing the buffer lock (and pin) whether we dirtied the buffer, but this is easy to get wrong. This patch actually fixes one non-obvious bug of that form: hashbucketcleanup forgot to signal _hash_squeezebucket, which gets the primary bucket page already locked, as to whether it had already dirtied the page. Calling MarkBufferDirty() at the places where we dirty the buffer is more intuitive and lets us simplify the code in various places as well. On top of all that, the ultimate goal here is to make hash indexes WAL-logged, and as the comments to _hash_wrtbuf() note, it should go away when that happens. Making it go away a little earlier than that seems like a good preparatory step. Report by Jeff Janes. Diagnosis by Amit Kapila, Kuntal Ghosh, and Dilip Kumar. Patch by me, after studying an alternative patch submitted by Amit Kapila. Discussion: <a target="_blank" href="http://postgr.es/m/CAA4eK1Kf6tOY0oVz_SEdngiNFkeXrA3xUSDPPORQvsWVPdKqnA@mail.gmail.com">http://postgr.es/m/CAA4eK1Kf6tOY0oVz_SEdngiNFkeXrA3xUSDPPORQvsWVPdKqnA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/25216c98938495fd741bf585dcbef45b3a9ffd40">http://git.postgresql.org/pg/commitdiff/25216c98938495fd741bf585dcbef45b3a9ffd40</a></li>
<li>Fix more hash index bugs around marking buffers dirty. In _hash_freeovflpage(), if we're freeing the overflow page that immediate follows the page to which tuples are being moved (the confusingly-named "write buffer"), don't forget to mark that page dirty after updating its hasho_nextblkno. In _hash_squeezebucket(), it's not necessary to mark the primary bucket page dirty if there are no overflow pages, because there's nothing to squeeze in that case. Amit Kapila, with help from Kuntal Ghosh and Dilip Kumar, after an initial trouble report by Jeff Janes. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/6a4fe1127c5a0ea1515589e416aa29e088170c0e">http://git.postgresql.org/pg/commitdiff/6a4fe1127c5a0ea1515589e416aa29e088170c0e</a></li>
<li>Unbreak Finalize HashAggregate over Partial HashAggregate. Commit 5dfc198146b49ce7ecc8a1fc9d5e171fb75f6ba5 introduced the use of a new type of hash table with linear reprobing for hash aggregates. Such a hash table behaves very poorly if keys are inserted in hash order, which does in fact happen in the case where a query use a Finalize HashAggregate node fed (via Gather) by a Partial HashAggregate node. In fact, queries with this type of plan tend to run effectively forever. Fix that by seeding the hash value differently in each worker (and in the leader, if it participates). Andres Freund and Robert Haas <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b81b5a96f424531b97cdd1dba97d9d1b9c9d372e">http://git.postgresql.org/pg/commitdiff/b81b5a96f424531b97cdd1dba97d9d1b9c9d372e</a></li>
<li>Simplify LWLock tranche machinery by removing array_base/array_stride. array_base and array_stride were added so that we could identify the offset of an LWLock within a tranche, but this facility is only very marginally used apart from the main tranche. So, give every lock in the main tranche its own tranche ID and get rid of array_base, array_stride, and all that's attached. For debugging facilities (Trace_lwlocks and LWLOCK_STATS) print the pointer address of the LWLock using %p instead of the offset. This is arguably more useful, and certainly a lot cheaper. Drop the offset-within-tranche from the information reported to dtrace and from one can't-happen message inside lwlock.c. The main user-visible impact of this change is that pg_stat_activity will now report all waits for LWLocks as "LWLock" rather than reporting some as "LWLockTranche" and others as "LWLockNamed". The main motivation for this change is that the need to specify an array_base and an array_stride is awkward for parallel query. There is only a very limited supply of tranche IDs so we can't just keep allocating new ones, and if we try to use the same tranche IDs every time then we run into trouble when multiple parallel contexts are use simultaneously. So if we didn't get rid of this mechanism we'd have to make it even more complicated. By simplifying it in this way, we instead reduce the size of the generated code for lwlock.c by about 5%. Discussion: <a target="_blank" href="http://postgr.es/m/CA+TgmoYsFn6NUW1x0AZtupJGUAs1UDY4dJtCN47_Q6D0sP80PA@mail.gmail.com">http://postgr.es/m/CA+TgmoYsFn6NUW1x0AZtupJGUAs1UDY4dJtCN47_Q6D0sP80PA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3761fe3c20bb040b15f0e8da58d824631da00caa">http://git.postgresql.org/pg/commitdiff/3761fe3c20bb040b15f0e8da58d824631da00caa</a></li>
<li>Fix outdated comment in lwlock.c Commit 3761fe3c20bb040b15f0e8da58d824631da00caa should have made this change, but didn't. Reported by &Atilde;lvaro Herrera. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/591ccb66d24258f6d1084343b3c33c96e3e2b36d">http://git.postgresql.org/pg/commitdiff/591ccb66d24258f6d1084343b3c33c96e3e2b36d</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Make the different Unix-y semaphore implementations ABI-compatible. Previously, the "sem" field of PGPROC varied in size depending on which kernel semaphore API we were using. That was okay as long as there was only one likely choice per platform, but in the wake of commit ecb0d20a9, that assumption seems rather shaky. It doesn't seem out of the question anymore that an extension compiled against one API choice might be loaded into a postmaster built with another choice. Moreover, this prevents any possibility of selecting the semaphore API at postmaster startup, which might be something we want to do in future. Hence, change PGPROC.sem to be PGSemaphore (i.e. a pointer) for all Unix semaphore APIs, and turn the pointed-to data into an opaque struct whose contents are only known within the responsible modules. For the SysV and unnamed-POSIX APIs, the pointed-to data has to be allocated elsewhere in shared memory, which takes a little bit of rejiggering of the InitShmemAllocation code sequence. (I invented a ShmemAllocUnlocked() function to make that a little cleaner than it used to be. That function is not meant for any uses other than the ones it has now, but it beats having InitShmemAllocation() know explicitly about allocation of space for semaphores and spinlocks.) This change means an extra indirection to access the semaphore data, but since we only touch that when blocking or awakening a process, there shouldn't be any meaningful performance penalty. Moreover, at least for the unnamed-POSIX case on Linux, the sem_t type is quite a bit wider than a pointer, so this reduces sizeof(PGPROC) which seems like a good thing. For the named-POSIX API, there's effectively no change: the PGPROC.sem field was and still is a pointer to something returned by sem_open() in the postmaster's memory space. Document and check the pre-existing limitation that this case can't work in EXEC_BACKEND mode. It did not seem worth unifying the Windows semaphore ABI with the Unix cases, since there's no likelihood of needing ABI compatibility much less runtime switching across those cases. However, we can simplify the Windows code a bit if we define PGSemaphore as being directly a HANDLE, rather than pointer to HANDLE, so let's do that while we're here. (This also ends up being no change in what's physically stored in PGPROC.sem. We're just moving the HANDLE fetch from callees to callers.) It would take a bunch of additional code shuffling to get to the point of actually choosing a semaphore API at postmaster start, but the effects of that would now be localized in the port/XXX_sema.c files, so it seems like fit material for a separate patch. The need for it is unproven as yet, anyhow, whereas the ABI risk to extensions seems real enough. Discussion: <a target="_blank" href="https://postgr.es/m/4029.1481413370@sss.pgh.pa.us">https://postgr.es/m/4029.1481413370@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/be7b2848c6d8bdbfb63ab403c535713708c4af52">http://git.postgresql.org/pg/commitdiff/be7b2848c6d8bdbfb63ab403c535713708c4af52</a></li>
<li>Fix race condition in test_decoding "slot" test. This test, just added in commit a924c327e, sometimes fails because the old backend hasn't finished dropping the temporary replication slot when the new backend looks. Borrow the previously-invented methodology for waiting for the old process to disappear from pg_stat_activity. Petr Jelinek Discussion: <a target="_blank" href="https://postgr.es/m/62935e6f-4f1b-c433-e0fa-7f936a38b3e5@2ndquadrant.com">https://postgr.es/m/62935e6f-4f1b-c433-e0fa-7f936a38b3e5@2ndquadrant.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/23f722ba8e19ca1a7c2ada9d6e687989b6e8f4d1">http://git.postgresql.org/pg/commitdiff/23f722ba8e19ca1a7c2ada9d6e687989b6e8f4d1</a></li>
<li>Catversion bump for temporary replication slots. Missed in commit a924c327e2793d2025b19e18de7917110dc8afd8. Per Fujii Masao. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9b3d02c2a9eb93cc4754857361abee449a3fe0cb">http://git.postgresql.org/pg/commitdiff/9b3d02c2a9eb93cc4754857361abee449a3fe0cb</a></li>
<li>Fix creative, but unportable, spelling of "ptr != NULL". Or at least I suppose that's what was really meant here. But even aside from the not-per-project-style use of "0" to mean "NULL", I doubt it's safe to assume that all valid pointers are &gt; NULL. Per buildfarm member pademelon. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/563d575fd73361f6118c13f2816988eba8e1f657">http://git.postgresql.org/pg/commitdiff/563d575fd73361f6118c13f2816988eba8e1f657</a></li>
<li>Prevent planagg.c from failing on queries containing CTEs. The existing tests in preprocess_minmax_aggregates() usually prevent it from trying to do anything with queries containing CTEs, but there's an exception: a CTE could be present as a member of an appendrel, if we flattened a UNION ALL that contains CTE references. If it did try to generate an optimized path for a query using a CTE, it failed with "could not find plan for CTE", as reported by Torsten F&Atilde;&para;rtsch. The proximate cause is an unwise decision in commit 3fc6e2d7f to clear subroot-&gt;cte_plan_ids in build_minmax_path(). That left the subroot's cte_plan_ids list out of step with its parse-&gt;cteList. Removing the "subroot-&gt;cte_plan_ids = NIL;" assignment is enough to let the case work again, but really it's pretty silly to be expending any cycles at all in this module when there are CTEs: we always treat their outputs as unordered so there's no way for the optimization to win. Hence, also add an early-exit test so we don't waste time like that. Back-patch to 9.6 where the misbehavior was introduced. Report: <a target="_blank" href="https://postgr.es/m/CAKkG4_=gjY5QiHtqSZyWMwDuTd_CftKoTaCqxjJ7uUz1-Gw=qw@mail.gmail.com">https://postgr.es/m/CAKkG4_=gjY5QiHtqSZyWMwDuTd_CftKoTaCqxjJ7uUz1-Gw=qw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/1f542a2eacca030c676cbb594f3b362d43f2f857">http://git.postgresql.org/pg/commitdiff/1f542a2eacca030c676cbb594f3b362d43f2f857</a></li>
<li>Improve handling of array elements as getdiag_targets and cursor_variables. There's no good reason why plpgsql's GET DIAGNOSTICS statement can't support an array element as target variable, since the execution code already uses the generic exec_assign_value() function to assign to it. Hence, refactor the grammar to allow that, by making getdiag_target depend on the assign_var production. Ideally we'd also let a cursor_variable expand to an element of a refcursor[] array, but that's substantially harder since those statements also have to handle bound-cursor-variable cases. For now, just make sure the reported error is sensible, ie "cursor variable must be a simple variable" not "variable must be of type cursor or refcursor". The latter was quite confusing from the user's viewpoint, since what he wrote satisfies the claimed restriction. Per bug #14463 from Zhou Digoal. Given the lack of previous complaints, I see no need for a back-patch. Discussion: <a target="_blank" href="https://postgr.es/m/20161213152548.14897.81245@wrigleys.postgresql.org">https://postgr.es/m/20161213152548.14897.81245@wrigleys.postgresql.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/55caaaeba877eac1feb6481fb413fa04ae9046ac">http://git.postgresql.org/pg/commitdiff/55caaaeba877eac1feb6481fb413fa04ae9046ac</a></li>
<li>Sync our copy of the timezone library with IANA release tzcode2016j. This is a trivial update (consisting in fact only in the addition of a comment). The point is just to get back to being synced with an official release of tzcode, rather than some ad-hoc point in their commit history, which is where commit 1f87181e1 left it. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/93513d1b6559b2d0805f0b02d312ee550e3d010b">http://git.postgresql.org/pg/commitdiff/93513d1b6559b2d0805f0b02d312ee550e3d010b</a></li>
<li>Improve documentation around TS_execute(). I got frustrated by the lack of commentary in this area, so here is some reverse-engineered documentation, along with minor stylistic cleanup. No code changes more significant than removal of unused variables. Back-patch to 9.6, not because that's useful in itself, but because we have some bugs to fix in phrase search and this would cause merge failures if it's only in HEAD. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/23c75b55aaccddea79545ffaf1cbfc9f1edeaa8c">http://git.postgresql.org/pg/commitdiff/23c75b55aaccddea79545ffaf1cbfc9f1edeaa8c</a></li>
<li>Fix FK-based join selectivity estimation for semi/antijoins. This case wasn't thought through sufficiently in commit 100340e2d. It's true that the FK proves that every outer row has a match in the inner table, but we forgot that some of the inner rows might be filtered away by WHERE conditions located within the semijoin's RHS. If the RHS is just one table, we can reasonably take the semijoin selectivity as equal to the fraction of the referenced table's rows that are expected to survive its restriction clauses. If the RHS is a join, it's not clear how much of the referenced table might get through the join, so fall back to the same rule we were already using for other outer-join cases: use the minimum of the regular per-clause selectivity estimates. This gives the same result as if we hadn't considered the FK at all when there's a single FK column, but it should still help for multi-column FKs, which is the case that 100340e2d is really meant to help with. Back-patch to 9.6 where the previous commit came in. Discussion: <a target="_blank" href="https://postgr.es/m/16149.1481835103@sss.pgh.pa.us">https://postgr.es/m/16149.1481835103@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7fa93eec4e0c9c3e801e3c51aa4bae3a38aaa218">http://git.postgresql.org/pg/commitdiff/7fa93eec4e0c9c3e801e3c51aa4bae3a38aaa218</a></li>
<li>In contrib/uuid-ossp, #include headers needed for ntohl() and ntohs(). Oversight in commit b8cc8f947. I just noticed this causes compiler warnings on FreeBSD, and it really ought to cause warnings elsewhere too: all references I can find say that &lt;arpa/inet.h&gt; is required for these. We have a lot of code elsewhere that thinks that both &lt;netinet/in.h&gt; and &lt;arpa/inet.h&gt; should be included for these functions, so do it that way here too, even though &lt;arpa/inet.h&gt; ought to be sufficient according to the references I consulted. Back-patch to 9.4 where the previous commit landed. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4a0a34b5b678f0292d3a85a85fb10c79c393be26">http://git.postgresql.org/pg/commitdiff/4a0a34b5b678f0292d3a85a85fb10c79c393be26</a></li>
</ul>
<p>Peter Eisentraut pushed:</p>
<ul>
<li>Various temporary slots test improvements. Fix the tests on slow machines (per buildfarm). Add test for dropping on error. And also try to consume real changes from temporary slots. From: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fdf71389dd5da949cb305ace9a0347d50ef0f020">http://git.postgresql.org/pg/commitdiff/fdf71389dd5da949cb305ace9a0347d50ef0f020</a></li>
<li>Add support for temporary replication slots. This allows creating temporary replication slots that are removed automatically at the end of the session or on error. From: Petr Jelinek &lt;petr.jelinek@2ndquadrant.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a924c327e2793d2025b19e18de7917110dc8afd8">http://git.postgresql.org/pg/commitdiff/a924c327e2793d2025b19e18de7917110dc8afd8</a></li>
<li>doc: Remove some trailing whitespace. Per discussion, we will not at this time remove trailing whitespace in psql output displays where it is part of the actual psql output. From: Vladimir Rusinov &lt;vrusinov@google.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b645a05fc6112a4857ceac574d4aa24174a70417">http://git.postgresql.org/pg/commitdiff/b645a05fc6112a4857ceac574d4aa24174a70417</a></li>
</ul>
<p>Magnus Hagander pushed:</p>
<ul>
<li>Add missing newline in message <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/8cb545bfd485e91fdd981e0381f82077ebfd9f82">http://git.postgresql.org/pg/commitdiff/8cb545bfd485e91fdd981e0381f82077ebfd9f82</a></li>
<li>Fix typos in comments. Michael Paquier <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/01776a07b3fe48ad48b0d9194301438399dfe597">http://git.postgresql.org/pg/commitdiff/01776a07b3fe48ad48b0d9194301438399dfe597</a></li>
</ul>
<p>Fujii Masao pushed:</p>
<ul>
<li>Add missing documentation for effective_io_concurrency tablespace option. The description of effective_io_concurrency option was missing in ALTER TABLESPACE docs though it's included in CREATE TABLESPACE one. Back-patch to 9.6 where effective_io_concurrency tablespace option was added. Michael Paquier, reported by Marc-Olaf Jaschke <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/4e344c2cf4ff00ca38ea0035bc137dab95fdd0c0">http://git.postgresql.org/pg/commitdiff/4e344c2cf4ff00ca38ea0035bc137dab95fdd0c0</a></li>
<li>Ensure that num_sync is greater than zero in synchronous_standby_names. Previously num_sync could be set to zero and this setting caused an assertion failure. This means that multiple synchronous standbys code should assume that num_sync is greater than zero. Also setting num_sync to zero is nonsense because it's basically the configuration for synchronous replication. If users want not to make transaction commits wait for any standbys, synchronous_standby_names should be emptied to disable synchronous replication instead of setting num_sync to zero. This patch forbids users from setting num_sync to zero in synchronous_standby_names. If zero is specified, an error will happen during processing the parameter settings. Back-patch to 9.6 where multiple synchronous standbys feature was added. Patch by me. Reviewed by Tom Lane. Discussion: &lt;CAHGQGwHWB3izc6cXuFLh5kOcAbFXaRhhgwd-X5PeN9TEjxqXwg@mail.gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/93eb619cd35b8adcfe6c86e34ea45d2e8edd322b">http://git.postgresql.org/pg/commitdiff/93eb619cd35b8adcfe6c86e34ea45d2e8edd322b</a></li>
</ul>
<p>Noah Misch pushed:</p>
<ul>
<li>MSVC: Position MSBFLAGS after flags it might override. Christian Ullrich <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cc07e06b1eac538328b5d8e31e77fdd079135864">http://git.postgresql.org/pg/commitdiff/cc07e06b1eac538328b5d8e31e77fdd079135864</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Pavel St&Auml;&rsaquo;hule sent in two more revisions of a patch to implement \g[b]store commands for psql.</p>
<p>Rafia Sabih sent in a patch to implement parallel index-only scans.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to fix an issue with strong random on Win32.</p>
<p>Micha&Atilde;&laquo;l Paquier, Amit Kapila and Ashutosh Sharma traded patches to fix an issue that manifested as a hang in pldebugger.</p>
<p>Amit Kapila sent in another revision of a patch to fix some hash index issues.</p>
<p>Tomas Vondra sent in another revision of a patch to implement multivariate statistics.</p>
<p>Nikita Glukhov sent in a patch to implement recursive processing of nested objects and arrays in json[b]_populate_record[set](), json[b]_to_record[set]().</p>
<p>Tomas Vondra sent in two more revisions of a patch to implement two slab-like memory allocators.</p>
<p>Kyotaro HORIGUCHI sent in another revision of a patch to implement character conversion with radix trees.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel bitmap heap scan.</p>
<p>Tom Lane sent in a patch to fix matching of boolean index columns to sort ordering.</p>
<p>Aleksander Alekseev sent in a patch to fix documentation of the timestamp type.</p>
<p>Gilles Darold sent in another revision of a patch to implement pg_current_logfile().</p>
<p>Andrew Borodin sent in a patch to add a sleep sort test for pg_background.</p>
<p>Masahiko Sawada and Fujii Masao traded patches to add quorum commit.</p>
<p>Dilip Kumar sent in another revision of a patch to implement parallel merge join.</p>
<p>Robert Haas sent in a patch to refactor tstate serialization in preparation for making CURRENT_* parallel safe.</p>
<p>Jesper Pedersen sent in a patch to create a pg_catversion() builtin function.</p>
<p>Micha&Atilde;&laquo;l Paquier, Fujii Masao, and Kyotaro HORIGUCHI traded patches to fix a pg_basebackup crash.</p>
<p>Vladimir Rusinov sent in a patch to rename pg_switch_xlog to pg_switch_wal.</p>
<p>Robert Haas sent in a patch to remove _hash_wrtbuf() and cause those functions which previously called it to do MarkBufferDirty() directly.</p>
<p>Peter Eisentraut, Petr Jel&Atilde;&shy;nek, and Steve Singer traded patches to implement logical replication.</p>
<p>Rahila Syed sent in another revision of a patch to turn the types columns with unknown type in views to text.</p>
<p>Dagfinn Ilmari Manns&Atilde;&yen;ker sent in a patch to add GUCs for predicate lock promotion thresholds.</p>
<p>Magnus Hagander sent in a patch to remove the -X option from pg_basebackup.</p>
<p>Magnus Hagander sent in a patch to add missing newlines to error messages in pg_basebackup.</p>
<p>Wesley Massuda sent in a patch to implement composite type NOT NULL constraints.</p>
<p>Alexander Law sent in a patch to speed up documentation builds.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in two more revisions of a patch to implement server-side session variables.</p>
<p>Dmitry Ivanov sent in a patch to fix an infelicity between the ancient sql_inheritance GUC and the new native partitions.</p>
<p>Heikki Linnakangas sent in a patch to shorten the window between writing the timeline history file and writing the end-of-recovery record.</p>
<p>Magnus Hagander sent in two revisions of a patch to add a --no-slot option to pg_basebackup.</p>
<p>Heikki Linnakangas sent in a patch to use the "plain:" prefix for plaintext passwords stored in pg_authid.</p>
<p>Amit Kapila sent in two revisions of a patch to fix dirty marking and lock chaining for hash indexes.</p>
<p>Mithun Cy sent in another revision of a patch to cache meta page for hash indexes.</p>
<p>Antonin Houska sent in a patch to simplify some code in basebackup.</p>
<p>Peter Moser sent in another revision of a patch to implement temporal query processing with range types.</p>
<p>Fujii Masao sent in a patch to fix a bug in synchronous replication where there were an invalid number of sync standbys in synchronous_standby_names.</p>
<p>Stephen Frost sent in a patch to fix some infelicities between pg_dump and TRANSFORMs, in passing fixing pg_dump for some ancient versions of PostgreSQL.</p>
<p>Robert Haas sent in a patch to remove the sql_inheritance GUC.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in a patch to fix some typos in waldender.c and slot.c.</p>
<p>Dmitry Dolgov sent in a patch to implement jsonb_delete with arrays.</p>
<p>Dean Rasheed sent in a patch to fix a CREATE OR REPLACE VIEW bug.</p>
<p>Stas Kelvich sent in a patch to speed up two-phase transactions via a twophase recovery list.</p>
<p>Kevin Grittner sent in another revision of a patch to add transition tables for, among other things, materialized view maintenance and row access in per-statement triggers.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in another revision of a patch to implement xmltable().</p>
<p>Peter Eisentraut sent in a patch to add a function to import operation system collations.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2016/12/20/Nouvelles-hebdomadaires-de-PostgreSQL-18-d%C3%A9cembre-2016">par chl le mardi 20 décembre 2016 à 02h10</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi 13 décembre 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a></h3>


<div class="entrygroup" id="urn:md5:072c0c089fa52d0d4a0600ee893f823f" lang="fr">
<h4><a href="http://blog.postgresql.fr/index.php?post/2016/12/13/Nouvelles-hebdomadaires-de-PostgreSQL-11-d%C3%A9cembre-2016">Nouvelles hebdomadaires de PostgreSQL - 11 décembre 2016</a></h4>
<div class="entry">
<div class="content">
<h2>Les nouveaut&eacute;s des produits d&eacute;riv&eacute;s</h2>
<ul>
<li>PyGreSQL 5.0.3, un connecteur Python pour PostgreSQL&nbsp;: <a target="_blank" href="http://www.pygresql.org/contents/changelog.html">http://www.pygresql.org/contents/changelog.html</a></li>
</ul>
<h2>Offres d'emplois autour de PostgreSQL en d&eacute;cembre</h2>
<ul>
<li>Internationales : <a target="_blank" href="http://archives.postgresql.org/pgsql-jobs/2016-12/threads.php">http://archives.postgresql.org/pgsql-jobs/2016-12/threads.php</a></li>
<li>Francophones : <a target="_blank" href="http://forums.postgresql.fr/viewforum.php?id=4">http://forums.postgresql.fr/viewforum.php?id=4</a></li>
</ul>
<h2>PostgreSQL Local</h2>
<ul>
<li>Le PGDay.IT 2016 aura lieu &agrave; Prato le 13 d&eacute;cembre 2016&nbsp;: <a target="_blank" href="http://pgday.it">http://pgday.it</a></li>
<li>La <em>PGConf India 2017</em> aura lieu les 2 &amp; 3 mars 2017 &agrave; Bengalore (&Eacute;tat du Karnataka en Inde). Les propositions sont attendues sur &lt;papers AT pgconf DOT in&gt; jusqu'au 31 d&eacute;cembre 2016&nbsp;: <a target="_blank" href="http://pgconf.in/">http://pgconf.in/</a></li>
<li>PostgreSQL@SCaLE aura lieu les 2 &amp; 3 mars 2017 au centre des conventions de Pasadena, comme partie du SCaLE 15X&nbsp;: <a target="_blank" href="http://www.socallinuxexpo.org/scale/15x/">http://www.socallinuxexpo.org/scale/15x/</a></li>
</ul>
<h2>PostgreSQL dans les m&eacute;dia</h2>
<ul>
<li>Planet PostgreSQL : <a target="_blank" href="http://planet.postgresql.org/">http://planet.postgresql.org/</a></li>
<li>Planet PostgreSQLFr : <a target="_blank" href="http://planete.postgresql.fr/">http://planete.postgresql.fr/</a></li>
</ul>
<p>PostgreSQL Weekly News / les nouvelles hebdomadaires vous sont offertes cette semaine par David Fetter. Traduction par l'&eacute;quipe PostgreSQLFr sous licence CC BY-NC-SA. La version originale se trouve &agrave; l'adresse suivante : <a target="_blank" href="http://www.postgresql.org/message-id/20161211224221.GB8506@fetter.org">http://www.postgresql.org/message-id/20161211224221.GB8506@fetter.org</a></p>
<p>Proposez vos articles ou annonces avant dimanche 15:00 (heure du Pacifique). Merci de les envoyer en anglais &agrave; david (a) fetter.org, en allemand &agrave; pwn (a) pgug.de, en italien &agrave; pwn (a) itpug.org et en espagnol &agrave; pwn (a) arpug.com.ar.</p>    <h2>Correctifs appliqu&eacute;s</h2>
<p>Fujii Masao pushed:</p>
<ul>
<li>Fix incorrect output from gin_desc(). Previously gin_desc() displayed incorrect output "unknown action 0" for XLOG_GIN_INSERT and XLOG_GIN_VACUUM_DATA_LEAF_PAGE records with valid actions. The cause of this problem was that gin_desc() wrongly used XLogRecGetData() to extract data from those records. Since they were registered by XLogRegisterBufData(), gin_desc() should have used XLogRecGetBlockData(), instead, like gin_redo(). Also there were other differences about how to treat XLOG_GIN_INSERT record between gin_desc() and gin_redo(). This commit fixes gin_desc() routine so that it treats those records in the same way as gin_redo(). Batch-patch to 9.5 where WAL record format was revamped and XLogRegisterBufData() was added. Reported-By: Andres Freund Reviewed-By: Tom Lane Discussion: &lt;20160509194645.7lewnpw647zegx2m@alap3.anarazel.de&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/5dc851afde8d9ef9947f21799f7a1b08bf0bf812">http://git.postgresql.org/pg/commitdiff/5dc851afde8d9ef9947f21799f7a1b08bf0bf812</a></li>
<li>Fix typo in docs. Reported-by: Darko Prelec <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/daac8e30eb7874722f277ae3461abe46a39e56ed">http://git.postgresql.org/pg/commitdiff/daac8e30eb7874722f277ae3461abe46a39e56ed</a></li>
<li>Improve documentation about pg_stat_replication view. Add the descriptions of possible values in "state" and "sync_state" columns of pg_stat_replication view. Author: Michael Paquier, slightly modified by me Discussion: &lt;CAB7nPqT7APWrvPFZrcjKEHoq4=g3z2ErxtTdojSf+sDALzuemA@mail.gmail.com&gt; <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/dfe530a09226a9de80f2b4c3d5f667bf51481c49">http://git.postgresql.org/pg/commitdiff/dfe530a09226a9de80f2b4c3d5f667bf51481c49</a></li>
</ul>
<p>Heikki Linnakangas pushed:</p>
<ul>
<li>Fix creation of stand-alone INSTALL.html file. I missed the notice at the top of the file, that plain xref must not be used in installation.sgml. Per buildfarm member guaibasaurus. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/7dd8eb39bd2b9e06eeef038f80ae327efb4a7d55">http://git.postgresql.org/pg/commitdiff/7dd8eb39bd2b9e06eeef038f80ae327efb4a7d55</a></li>
<li>Fix typo in new message in configure. Remove spurious "of", and reformat to fit on a 80 chars wide line. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/44a977f55f33834a2fe0d1d9bd5eeb29ce67e914">http://git.postgresql.org/pg/commitdiff/44a977f55f33834a2fe0d1d9bd5eeb29ce67e914</a></li>
<li>Fix whitespace. Thomas Munro <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9790b87f594565c11599b2004466169b8c2fd4af">http://git.postgresql.org/pg/commitdiff/9790b87f594565c11599b2004466169b8c2fd4af</a></li>
<li>Fix query cancellation. In commit fe0a0b59, the datatype used for MyCancelKey and other variables that store cancel keys were changed from long to uint32, but I missed this one. That broke query cancellation on platforms where long is wider than 32 bits. Report by Andres Freund, fix by Michael Paquier. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/81f2e514a9b2d813bb5fd6b62523757aa7a6517f">http://git.postgresql.org/pg/commitdiff/81f2e514a9b2d813bb5fd6b62523757aa7a6517f</a></li>
<li>Replace PostmasterRandom() with a stronger source, second attempt. This adds a new routine, pg_strong_random() for generating random bytes, for use in both frontend and backend. At the moment, it's only used in the backend, but the upcoming SCRAM authentication patches need strong random numbers in libpq as well. pg_strong_random() is based on, and replaces, the existing implementation in pgcrypto. It can acquire strong random numbers from a number of sources, depending on what's available: OpenSSL RAND_bytes(), if built with OpenSSL, on Windows, the native cryptographic functions are used, and finally /dev/urandom. Unlike the current pgcrypto function, the source is chosen by configure. That makes it easier to test different implementations, and ensures that we don't accidentally fall back to a less secure implementation, if the primary source fails. All of those methods are quite reliable, it would be pretty surprising for them to fail, so we'd rather find out by failing hard. If no strong random source is available, we fall back to using erand48(), seeded from current timestamp, like PostmasterRandom() was. That isn't cryptographically secure, but allows us to still work on platforms that don't have any of the above stronger sources. Because it's not very secure, the built-in implementation is only used if explicitly requested with --disable-strong-random. This replaces the more complicated Fortuna algorithm we used to have in pgcrypto, which is unfortunate, but all modern platforms have /dev/urandom, so it doesn't seem worth the maintenance effort to keep that. pgcrypto functions that require strong random numbers will be disabled with --disable-strong-random. Original patch by Magnus Hagander, tons of further work by Michael Paquier and me. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqRy3krN8quR9XujMVVHYtXJ0_60nqgVc6oUk8ygyVkZsA@mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqRy3krN8quR9XujMVVHYtXJ0_60nqgVc6oUk8ygyVkZsA@mail.gmail.com</a> Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/CAB7nPqRWkNYRRPJA7-cF+LfroYV10pvjdz6GNvxk-Eee9FypKA@mail.gmail.com">https://www.postgresql.org/message-id/CAB7nPqRWkNYRRPJA7-cF+LfroYV10pvjdz6GNvxk-Eee9FypKA@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fe0a0b5993dfe24e4b3bcf52fa64ff41a444b8f1">http://git.postgresql.org/pg/commitdiff/fe0a0b5993dfe24e4b3bcf52fa64ff41a444b8f1</a></li>
<li>Clean up password authentication code a bit. Commit fe0a0b59, which moved code to do MD5 authentication to a separate CheckMD5Auth() function, left behind a comment that really belongs inside the function, too. Also move the check for db_user_namespace inside the function, seems clearer that way. Now that the md5 salt is passed as argument to md5_crypt_verify, it's a bit silly that it peeks into the Port struct to see if MD5 authentication was used. Seems more straightforward to treat it as an MD5 authentication, if the md5 salt argument is given. And after that, md5_crypt_verify only used the Port argument to look at port-&gt;user_name, but that is redundant, because it is also passed as a separate 'role' argument. So remove the Port argument altogether. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/fe7bdf0bf67d8ac360d67fa9740074a2c70e88a4">http://git.postgresql.org/pg/commitdiff/fe7bdf0bf67d8ac360d67fa9740074a2c70e88a4</a></li>
<li>Fix quoting and a compiler warning in dumping partitions. Partition name needs to be quoted in the ATTACH PARTITION command constructed in binary-upgrade mode. Silence compiler warning about set but unused variable, without --enable-cassert. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/2560d244b4c9fc08f1d076b3c40913bec5f7e31f">http://git.postgresql.org/pg/commitdiff/2560d244b4c9fc08f1d076b3c40913bec5f7e31f</a></li>
<li>Fix thinko in safeguard for negative availMem. Also, use pass read_buffer_size * numInputTapes rather than just availMem to USEMEM, to be neat. Peter Geoghegan. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/64bc26f90d342ca343f5ba383a97691a58991204">http://git.postgresql.org/pg/commitdiff/64bc26f90d342ca343f5ba383a97691a58991204</a></li>
<li>Fix accounting of memory needed for merge heap. We allegedly allocated all remaining memory for the read buffers of the sort tapes, but we allocated the merge heap only after that. That means that the allocation of the merge heap was guaranteed to go over the memory limit. Fix by allocating the merge heap first. This makes little difference in practice, because the merge heap is tiny, but let's tidy. While we're at it, add a safeguard for the case that we are already over the limit when allocating the read buffers. That shouldn't happen, but better safe than sorry. The memory accounting error was reported off-list by Peter Geoghegan. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/f7d54f4f7ddf72bf4db1783890b058e758b4b894">http://git.postgresql.org/pg/commitdiff/f7d54f4f7ddf72bf4db1783890b058e758b4b894</a></li>
</ul>
<p>Tom Lane pushed:</p>
<ul>
<li>Remove extraneous semicolon from uses of relptr_declare(). If we're going to write a semicolon after calls of relptr_declare(), then we don't need one inside the macro, and removing it suppresses "empty declaration" warnings from pickier compilers (eg pademelon). While at it, we might as well use relptr() inside relptr_declare(), because otherwise that macro would likely go unused altogether. Also improve the comment, which I for one found unclear, and provide a specific example of intended usage. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/3ebf2b45454a5fb74e6516ab4915f7a3d44d544f">http://git.postgresql.org/pg/commitdiff/3ebf2b45454a5fb74e6516ab4915f7a3d44d544f</a></li>
<li>Put AC_MSG_RESULT() call in the right place. Thinko in ecb0d20a9 --- this needs to go one level further out in the "if" nest. As it stood, nothing got printed in the case of selecting named POSIX semaphores. Cosmetic issue only, but a bug. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/c648f058319a59ad591dd9d1b0c48dfd655d063a">http://git.postgresql.org/pg/commitdiff/c648f058319a59ad591dd9d1b0c48dfd655d063a</a></li>
<li>Fix unsafe assumption that struct timeval.tv_sec is a "long". It typically is a "long", but it seems possible that on some platforms it wouldn't be. In any case, this silences a compiler warning on OpenBSD (cf buildfarm member curculio). While at it, use snprintf not sprintf. This format string couldn't possibly overrun the supplied buffer, but that doesn't seem like a good reason not to use the safer style. Oversight in commit f828654e1. Back-patch to 9.6 where that came in. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0645dacc371da6169b06934e3bd238c5f770fe25">http://git.postgresql.org/pg/commitdiff/0645dacc371da6169b06934e3bd238c5f770fe25</a></li>
<li>Handle empty or all-blank PAGER setting more sanely in psql. If the PAGER environment variable is set but contains an empty string, psql would pass it to "sh" which would silently exit, causing whatever query output we were printing to vanish entirely. This is quite mystifying; it took a long time for us to figure out that this was the cause of Joseph Brenner's trouble report. Rather than allowing that to happen, we should treat this as another way to specify "no pager". (We could alternatively treat it as selecting the default pager, but it seems more likely that the former is what the user meant to achieve by setting PAGER this way.) Nonempty, but all-white-space, PAGER values have the same behavior, and it's pretty easy to test for that, so let's handle that case the same way. Most other cases of faulty PAGER values will result in the shell printing some kind of complaint to stderr, which should be enough to diagnose the problem, so we don't need to work harder than this. (Note that there's been an intentional decision not to be very chatty about apparent failure returns from the pager process, since that may happen if, eg, the user quits the pager with control-C or some such. I'd just as soon not start splitting hairs about which exit codes might merit making our own report.) libpq's old PQprint() function was already on board with ignoring empty PAGER values, but for consistency, make it ignore all-white-space values as well. It's been like this a long time, so back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/CAFfgvXWLOE2novHzYjmQK8-J6TmHz42G8f3X0SORM44+stUGmw@mail.gmail.com">https://postgr.es/m/CAFfgvXWLOE2novHzYjmQK8-J6TmHz42G8f3X0SORM44+stUGmw@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/18f8f784cbbf96ef77eb8943b466b26605824c14">http://git.postgresql.org/pg/commitdiff/18f8f784cbbf96ef77eb8943b466b26605824c14</a></li>
<li>Restore psql's SIGPIPE setting if popen() fails. Ancient oversight in PageOutput(): if popen() fails, we'd better reset the SIGPIPE handler before returning stdout, because ClosePager() won't. Noticed while fixing the empty-PAGER issue. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/b7e1ae2328f7d5a88d8916d78b4561d8ef16f99b">http://git.postgresql.org/pg/commitdiff/b7e1ae2328f7d5a88d8916d78b4561d8ef16f99b</a></li>
<li>Fix reporting of column typmods for multi-row VALUES constructs. expandRTE() and get_rte_attribute_type() reported the exprType() and exprTypmod() values of the expressions in the first row of the VALUES as being the column type/typmod returned by the VALUES RTE. That's fine for the data type, since we coerce all expressions in a column to have the same common type. But we don't coerce them to have a common typmod, so it was possible for rows after the first one to return values that violate the claimed column typmod. This leads to the incorrect result seen in bug #14448 from Hassan Mahmood, as well as some other corner-case misbehaviors. The desired behavior is the same as we use in other type-unification cases: report the common typmod if there is one, but otherwise return -1 indicating no particular constraint. It's cheap for transformValuesClause to determine the common typmod while transforming a multi-row VALUES, but it'd be less cheap for expandRTE() and get_rte_attribute_type() to re-determine that info every time they're asked --- possibly a lot less cheap, if the VALUES has many rows. Therefore, the best fix is to record the common typmods explicitly in a list in the VALUES RTE, as we were already doing for column collations. This looks quite a bit like what we're doing for CTE RTEs, so we can save a little bit of space and code by unifying the representation for those two RTE types. They both now share coltypes/coltypmods/colcollations fields. (At some point it might seem desirable to populate those fields for all RTE types; but right now it looks like constructing them for other RTE types would add more code and cycles than it would save.) The RTE change requires a catversion bump, so this fix is only usable in HEAD. If we fix this at all in the back branches, the patch will need to look quite different. Report: <a target="_blank" href="https://postgr.es/m/20161205143037.4377.60754@wrigleys.postgresql.org">https://postgr.es/m/20161205143037.4377.60754@wrigleys.postgresql.org</a> Discussion: <a target="_blank" href="https://postgr.es/m/27429.1480968538@sss.pgh.pa.us">https://postgr.es/m/27429.1480968538@sss.pgh.pa.us</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0b78106cd4651ad7867036a463ec743f6d3d2e86">http://git.postgresql.org/pg/commitdiff/0b78106cd4651ad7867036a463ec743f6d3d2e86</a></li>
<li>Be more careful about Python refcounts while creating exception objects. PLy_generate_spi_exceptions neglected to do Py_INCREF on the new exception objects, evidently supposing that PyModule_AddObject would do that --- but it doesn't. This left us in a situation where a Python garbage collection cycle could result in deletion of exception object(s), causing server crashes or wrong answers if the exception objects are used later in the session. In addition, PLy_generate_spi_exceptions didn't bother to test for a null result from PyErr_NewException, which at best is inconsistent with the code in PLy_add_exceptions. And PLy_add_exceptions, while it did do Py_INCREF on the exceptions it makes, waited to do that till after some PyModule_AddObject calls, creating a similar risk for failure if garbage collection happened within those calls. To fix, refactor to have just one piece of code that creates an exception object and adds it to the spiexceptions module, bumping the refcount first. Also, let's add an additional refcount to represent the pointer we're going to store in a C global variable or hash table. This should only matter if the user does something weird like delete the spiexceptions Python module, but lack of paranoia has caused us enough problems in PL/Python already. The fact that PyModule_AddObject doesn't do a Py_INCREF of its own explains the need for the Py_INCREF added in commit 4c966d920, so we can improve the comment about that; also, this means we really want to do that before not after the PyModule_AddObject call. The missing Py_INCREF in PLy_generate_spi_exceptions was reported and diagnosed by Rafa de la Torre; the other fixes by me. Back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/CA+Fz15kR1OXZv43mDrJb3XY+1MuQYWhx5kx3ea6BRKQp6ezGkg@mail.gmail.com">https://postgr.es/m/CA+Fz15kR1OXZv43mDrJb3XY+1MuQYWhx5kx3ea6BRKQp6ezGkg@mail.gmail.com</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/9cda81f0056ca488dbd6cded64db1238aed816b2">http://git.postgresql.org/pg/commitdiff/9cda81f0056ca488dbd6cded64db1238aed816b2</a></li>
<li>Prevent crash when ts_rewrite() replaces a non-top-level subtree with null. When ts_rewrite()'s replacement argument is an empty tsquery, it's supposed to simplify any operator nodes whose operand(s) become NULL; but it failed to do that reliably, because dropvoidsubtree() only examined the top level of the result tree. Rather than make a second recursive pass, let's just give the responsibility to dofindsubquery() to simplify while it's doing the main replacement pass. Per report from Andreas Seltenreich. Artur Zakirov, with some cosmetic changes by me. Back-patch to all supported branches. Discussion: <a target="_blank" href="https://postgr.es/m/8737i01dew.fsf@credativ.de">https://postgr.es/m/8737i01dew.fsf@credativ.de</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/0eaaaf00e296c2048b868b7c1d3c12c0eae6dd12">http://git.postgresql.org/pg/commitdiff/0eaaaf00e296c2048b868b7c1d3c12c0eae6dd12</a></li>
</ul>
<p>Stephen Frost pushed:</p>
<ul>
<li>Bump catversion for restrictive RLS changes. Mea culpa. Pointed out by Andres. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/cb9dcbc1eebd8cccf98d7236b2c9bb82caf8b45d">http://git.postgresql.org/pg/commitdiff/cb9dcbc1eebd8cccf98d7236b2c9bb82caf8b45d</a></li>
<li>Add support for restrictive RLS policies. We have had support for restrictive RLS policies since 9.5, but they were only available through extensions which use the appropriate hooks. This adds support into the grammer, catalog, psql and pg_dump for restrictive RLS policies, thus reducing the cases where an extension is necessary. In passing, also move away from using "AND"d and "OR"d in comments. As pointed out by Alvaro, it's not really appropriate to attempt to make verbs out of "AND" and "OR", so reword those comments which attempted to. Reviewed By: Jeevan Chalke, Dean Rasheed Discussion: <a target="_blank" href="https://postgr.es/m/20160901063404.GY4028@tamriel.snowman.net">https://postgr.es/m/20160901063404.GY4028@tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/093129c9d9fc231649b3cc27b8086443ccbbbc22">http://git.postgresql.org/pg/commitdiff/093129c9d9fc231649b3cc27b8086443ccbbbc22</a></li>
<li>Silence compiler warnings. Rearrange a bit of code to ensure that 'mode' in LWLockRelease is obviously always set, which seems a bit cleaner and avoids a compiler warning (thanks to Robert for the suggestion!). In GetCachedPlan(), initialize 'plan' to silence a compiler warning, but also add an Assert() to make sure we don't ever actually fall through with 'plan' still being set to NULL, since we are about to dereference it. Neither of these appear to be live bugs but at least gcc 5.4.0-6ubuntu1~16.04.4 doesn't quite have the smarts to realize that. Discussion: <a target="_blank" href="https://www.postgresql.org/message-id/20161129152102.GR13284%40tamriel.snowman.net">https://www.postgresql.org/message-id/20161129152102.GR13284%40tamriel.snowman.net</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/d97b14ddab2059e1d73c0cd17f26bac4ef13e682">http://git.postgresql.org/pg/commitdiff/d97b14ddab2059e1d73c0cd17f26bac4ef13e682</a></li>
<li>Use "%option prefix" to set API names in ecpg's lexer. Clean up some technical debt left behind by commit 72b1e3a21: instead of quickly hacking the name of base_yylex() with a #define, set it properly with "%option prefix". This causes the names of pgc.l's other exported symbols to change as well, so run around and modify the outside references to them as needed. Similarly, make pgc.l's external references to base_yylval use that variable's true name instead of a macro. The reason for doing this now is that the quick-hack solution will fail with future versions of flex, as reported by &ETH;&rdquo;&ETH;&cedil;&ETH;&raquo;&Ntilde;&ETH;&frac12; &ETH;&Yuml;&ETH;&deg;&ETH;&raquo;&ETH;&deg;&Ntilde;&fnof;&ETH;&middot;&ETH;&frac34;&ETH;&sup2;. Hence, back-patch into 9.6 where the previous commit appeared, since it's likely people will build 9.6 with newer flex versions during its lifetime. Discussion: <a target="_blank" href="https://postgr.es/m/d845c1af-e18d-6651-178f-9f08cdf37e10@aegee.org">https://postgr.es/m/d845c1af-e18d-6651-178f-9f08cdf37e10@aegee.org</a> <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/92fb649837e36944bd0e9eed6c90b4b01b7deb18">http://git.postgresql.org/pg/commitdiff/92fb649837e36944bd0e9eed6c90b4b01b7deb18</a></li>
</ul>
<p>&Atilde;lvaro Herrera pushed:</p>
<ul>
<li>Fix crasher bug in array_position(s) array_position and its cousin array_positions were caching the element type equality function's FmgrInfo without being careful enough to put it in a long-lived context. This is obviously broken but it didn't matter in most cases; only when using arrays of records (involving record_eq) it becomes a problem. The fix is to ensure that the type's equality function's FmgrInfo is cached in the array_position's flinfo-&gt;fn_mcxt rather than the current memory context. Apart from record types, the only other case that seems complex enough to possibly cause the same problem are range types. I didn't find a way to reproduce the problem with those, so I only include the test case submitted with the bug report as regression test. Bug report and patch: Junseok Yang Discussion: <a target="_blank" href="https://postgr.es/m/CAE+byMupUURYiZ6bKYgMZb9pgV1CYAijJGqWj-90W=nS7uEOeA@mail.gmail.com">https://postgr.es/m/CAE+byMupUURYiZ6bKYgMZb9pgV1CYAijJGqWj-90W=nS7uEOeA@mail.gmail.com</a> Backpatch to 9.5, where array_position appeared. <a target="_blank" href="http://git.postgresql.org/pg/commitdiff/a73491e5fee88f5db70d69e81fa45060b6ed3682">http://git.postgresql.org/pg/commitdiff/a73491e5fee88f5db70d69e81fa45060b6ed3682</a></li>
</ul>
<h2>Correctifs en attente</h2>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to enable SIGHUP to reload SSL certificates.</p>
<p>Amit Kapila sent in another revision of a patch to enable write-ahead logging (WAL) for hash indexes.</p>
<p>KaiGai Kohei sent in another revision of a patch to pass down limit bounds for ForeignScan and CustomScan.</p>
<p>Pavel St&Auml;&rsaquo;hule and &Atilde;lvaro Herrera traded patches to add xmltable().</p>
<p>Micha&Atilde;&laquo;l Paquier sent in three more revisions of a patch to fix a pgcrypto compilation error caused by stack-allocated EVP_CIPHER_CTX.</p>
<p>Kyotaro HORIGUCHI sent in a patch to change the type for map files not to be void * any more, and in passing clean up convutils.pm.</p>
<p>Masahiko Sawada sent in a patch to reduce the maximum autovacuum_vacuum and analyze_scale_factor from 100 to 1.</p>
<p>Mithun Cy sent in a patch to fix an issue with SSL vs. multi-host URLs in libpq.</p>
<p>Mithun Cy sent in another revision of a patch to cache hash index meta pages.</p>
<p>Andres Freund sent in a WIP patch to use, among other techniques, JIT compilation, to speed up expression processing and tuple deforming.</p>
<p>Craig Ringer sent in another revision of a patch to enable logical decoding on standby.</p>
<p>Rahila Syed sent in a patch to assign valid collations for SET operations on queries with UNKNOWN types.</p>
<p>Heikki Linnakangas sent in a flock of patches to create the infrastructure for, and implement, SCRAM auth.</p>
<p>Gilles Darold and Karl O. Pinc traded patches to implement pg_current_logfile().</p>
<p>Peter Moser sent in another revision of a patch to implement temporal query processing with range types.</p>
<p>Stephen Frost sent in a patch to fix some infelicities between pg_dump and both TRANSFORMs and CASTs.</p>
<p>Micha&Atilde;&laquo;l Paquier sent in another revision of a patch to fix how unlogged tables are cleaned up.</p>
<p>Etsuro Fujita sent in another revision of a patch to push more FULL JOINs down when using foreign data wrappers.</p>
<p>Aleksander Alekseev sent in two revisions of a patch to clarify some code by using pg_str_containsonly.</p>
<p>Ashutosh Sharma sent in a patch to fix a bug that cause pldebugger to hang.</p>
<p>Peter Eisentraut and Petr Jel&Atilde;&shy;nek traded patches to support logical replication in core.</p>
<p>Masahiko Sawada sent in another revision of a patch to implement quorum commit for multiple synchronous replication.</p>
<p>Amit Langote sent in a patch to document the behavior of UPDATE and DELETE under built-in partitioning.</p>
<p>Fabr&Atilde;&shy;zio de Royes Mello sent in a patch to fix a breakage of psql's \d when connecting to older versions of PostgreSQL.</p>
<p>Peter Geoghegan sent in a patch to remove should_free tuplesort routine arguments, avoid copying within tuplesort_gettupleslot(), and add valgrind suppression for logtape_write.</p>
<p>Dilip Kumar sent in a patch to implement parallel merge join.</p>
<p>Amit Kapila sent in a patch to fix some issues in hash indexes.</p>
<p>Tom Lane sent in a patch to back-patch use of unnamed POSIX semaphores for Linux.</p>
<p>Petr Jel&Atilde;&shy;nek sent in a patch to skip unnecessary snapshot builds.</p>
<p>Pavel St&Auml;&rsaquo;hule sent in a patch to add \gstore \gstore_binary to psql.</p>
<p>Mateusz Stefek sent in a patch to optimize index-only scans with filter conditions.</p></div>







<p class="date">
<a href="http://blog.postgresql.fr/index.php?post/2016/12/13/Nouvelles-hebdomadaires-de-PostgreSQL-11-d%C3%A9cembre-2016">par chl le mardi 13 décembre 2016 à 00h44</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>samedi 10 décembre 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.guillaume.lelarge.info/index.php/" title="gleu's blog - PostgreSQL">Guillaume Lelarge</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:e85edc2925549cc3251dde9eed273f82" lang="fr">
<h4><a href="http://blog.guillaume.lelarge.info/index.php/post/2016/12/10/Version-1.3-de-mon-livre-%3A-PostgreSQL-Architecture-et-notions-avanc%C3%A9es">Version 1.3 de mon livre : PostgreSQL - Architecture et notions avancées</a></h4>
<div class="entry">
<div class="content">
<p><a href="http://www.d-booker.fr/postgresql/187-architecture-et-notions-avancees.html">Mon livre, PostgreSQL - Architecture et notions avancées,</a> a été écrit pendant le développement de la version 9.5. Il est sorti en version finale un peu après la sortie de la version 9.5, donc en plein développement de la 9.6. À la sortie de la version beta de la 9.6, je me suis mis à travailler sur une mise à jour du livre, incluant des corrections suite à des commentaires qui m'étaient parvenus, ainsi que de nombreux ajouts pour traiter les nouveautés de la version 9.6. Le résultat final est disponible depuis hier. Comme il ne s'agit pas d'une nouvelle édition complète, il est disponible gratuitement en téléchargement aux personnes qui ont acheté une version électronique précédente. Ceux qui commanderaient maintenant la version papier aurait cette nouvelle version, intitulée 1.3.</p>


<p>Évidemment, nous allons continuer la mise à jour du livre pour qu'il ne perde pas en intérêt. Une (vraie) deuxième édition sera disponible en fin d'année prochaine, après la sortie de la version 10. Cette version promet de nombreuses nouveautés très intéressantes, comme tout dernièrement un partitionnement mieux intégré dans le cœur de PostgreSQL.</p></div>







<p class="date">
<a href="http://blog.guillaume.lelarge.info/index.php/post/2016/12/10/Version-1.3-de-mon-livre-%3A-PostgreSQL-Architecture-et-notions-avanc%C3%A9es">par Guillaume Lelarge le samedi 10 décembre 2016 à 15h36</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>vendredi 21 octobre 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.ng.pe/" title="postgresql - Nicolas GOLLET">Nicolas Gollet</a></h3>


<div class="entrygroup" id="http://blog.ng.pe/tag/postgresql/rss/828a52ca-0b63-427c-a7d9-32d3cbbe5e0d">
<h4><a href="http://blog.ng.pe/pg-session-8/">PG Session #8 les videos à télécharger</a></h4>
<div class="entry">
<div class="content">
<p>Les vidéos de la "PostgreSQL Session #8" organisée par <a href="http://www.dalibo.com">Dalibo</a> et <a href="http://www.oslandia.com">Oslandia</a> viennent d'être mise en ligne sur <a href="https://www.youtube.com/playlist?list=PLdz5EN2NV_7DrC_7ECox7Kjzw2GEf8P38">youtube</a> ! </p>

<p>Afin de vous permettre de visionner ces vidéos partout (dans le train, l'avions, aux fins font de l'Ardèche ;) ), je vous propose de pouvoir les télécharger au format "mp4" directement depuis <a href="https://1drv.ms/f/s!AmJRZooKXdikawe4S9FDFCCYtgM">ce partage one drive</a>.</p>

<p>Au programme 8 conférences : <br />
1. Paul Leroux - Postgres comme NoSql Db - le meilleur des deux mondes <br />
2. Nicolas Ribot - Traitements spatiaux parallélisés pour les gros volumes de données <br />
3. Ludovic Delauné - Point Clouds - modèles, chargement, stockage et manipulation de données <br />
4. Tom van Tilburg - From point clouds and vectordata to 3D models with the help of postgres <br />
5. Giuseppe Broccolo &amp; Julien Rouhaud - BRIN indexes on geospatial database <br />
6. Giulio Calacoci - Step up and face the disaster (pgbarman) <br />
7. Julien Tachoires - Temboard - supervision, administration, dashboard et bien plus <br />
8. Olivier Courtin - De l'analyse spatiale avancée à la GéoDataScience en environnement PostgreSQL - PostGIS</p>

<p>Ces vidéos ont été produites par Dalibo et sont sous licence Creative Commons BY-NC-SA n'hésitez donc pas à les partager!</p>

<p>Merci à <a href="https://telemillevaches.net">Télé Millevaches</a>  pour leur travail de captation vidéo et de montage ;)</p>

<p>Bon visionnage à toutes et à tous!</p></div>







<p class="date">
<a href="http://blog.ng.pe/pg-session-8/">par Nicolas GOLLET le vendredi 21 octobre 2016 à 10h34</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi 29 septembre 2016</h2>

<div class="channelgroup">







<h3><a href="http://sebastien.lardiere.net/blog/index.php/" title="~/sebl[og] - Postgresql">Sébastien Lardière</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:813122b4bfe1d2c060083afa6984f97c" lang="fr">
<h4><a href="http://sebastien.lardiere.net/blog/index.php/post/postgresql-9.6.0">PostgreSQL 9.6.0</a></h4>
<div class="entry">
<div class="content">
<p>La version 9.6.0 de PostgreSQL est publiée aujourd'hui. La fonctionnalité la plus notable de cette version majeure est la parallélisation des requêtes. De nombreuses autres fonctionnalités permettent de travailler sur des volumes de données toujours plus important. Quelques informations sur le site de Loxodata :... <a href="http://sebastien.lardiere.net/blog/index.php/post/postgresql-9.6.0"><em>Lire</em> PostgreSQL 9.6.0</a></p></div>







<p class="date">
<a href="http://sebastien.lardiere.net/blog/index.php/post/postgresql-9.6.0">par Sébastien Lardière le jeudi 29 septembre 2016 à 14h16</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>vendredi 20 mai 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.guillaume.lelarge.info/index.php/" title="gleu's blog - PostgreSQL">Guillaume Lelarge</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:41d773a2ba84d98fe37fd0ea9ebd991c" lang="fr">
<h4><a href="http://blog.guillaume.lelarge.info/index.php/post/2016/05/20/Quelques-nouvelles-sur-les-traductions-du-manuel">Quelques nouvelles sur les traductions du manuel</a></h4>
<div class="entry">
<div class="content">
<p>J'ai passé beaucoup de temps ces derniers temps sur la traduction du manuel de PostgreSQL.</p>
<ul>
<li>mise à jour pour les dernières versions mineures</li>
<li>corrections permettant de générer les PDF déjà disponibles (9.1, 9.2, 9.3 et 9.4) mais aussi le PDF de la 9.5</li>
<li>merge pour la traduction de la 9.6</li>
</ul>


<p>Elles sont toutes disponibles sur le site <a href="http://docs.postgresql.fr" hreflang="fr">docs.postgresql.fr</a>.</p>


<p>De ce fait, la traduction du manuel de la 9.6 peut commencer. Pour les intéressés, c'est par là : <a href="https://github.com/gleu/pgdocs_fr/wiki/Translation-9.6">https://github.com/gleu/pgdocs_fr/wiki/Translation-9.6</a></p>


<p>N'hésitez pas à m'envoyer toute question si vous êtes intéressé pour participer.</p></div>







<p class="date">
<a href="http://blog.guillaume.lelarge.info/index.php/post/2016/05/20/Quelques-nouvelles-sur-les-traductions-du-manuel">par Guillaume Lelarge le vendredi 20 mai 2016 à 20h35</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>dimanche 13 mars 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.guillaume.lelarge.info/index.php/" title="gleu's blog - PostgreSQL">Guillaume Lelarge</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:2367e3e979ebbcd770eb57fcbd70e66d" lang="fr">
<h4><a href="http://blog.guillaume.lelarge.info/index.php/post/2016/03/13/Fin-de-la-traduction-du-manuel-de-la-9.5">Fin de la traduction du manuel de la 9.5</a></h4>
<div class="entry">
<div class="content">
<p>Beaucoup de retard pour cette fois, mais malgré tout, on a fini la traduction du <a href="http://docs.postgresql.fr/9.5/" hreflang="fr">manuel 9.5 de PostgreSQL</a>. Évidemment, tous les manuels ont aussi été mis à jour avec les dernières versions mineures.</p>


<p>N'hésitez pas à me remonter tout problème sur la traduction.</p>


<p>De même, j'ai pratiquement terminé la traduction des applications. Elle devrait être disponible pour la version 9.5.2 (pas de date encore connue).</p></div>







<p class="date">
<a href="http://blog.guillaume.lelarge.info/index.php/post/2016/03/13/Fin-de-la-traduction-du-manuel-de-la-9.5">par Guillaume Lelarge le dimanche 13 mars 2016 à 10h41</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi  8 mars 2016</h2>

<div class="channelgroup">







<h3><a href="http://sebastien.lardiere.net/blog/index.php/" title="~/sebl[og] - Postgresql">Sébastien Lardière</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:6ae8e743aa51e7db2d827ec7a20e2082" lang="fr">
<h4><a href="http://sebastien.lardiere.net/blog/index.php/post/2016/03/08/Dates-%C3%A0-retenir">Dates à retenir</a></h4>
<div class="entry">
<div class="content">
<p>Trois dates à retenir autour de PostgreSQL :


	17 mars, à Nantes, un premier meetup, dans lequel j'évoquerai les nouveautés de PostgreSQL 9.5.
	31 mars, à Paris, où j'essayerai de remonter le fil du temps de bases de données.
	31 mai, à Lille, où je plongerai dans les structures du stockage de PostgreSQL.


Ces trois dates sont l'occasion... <a href="http://sebastien.lardiere.net/blog/index.php/post/2016/03/08/Dates-%C3%A0-retenir"><em>Lire</em> Dates à retenir</a></p></div>







<p class="date">
<a href="http://sebastien.lardiere.net/blog/index.php/post/2016/03/08/Dates-%C3%A0-retenir">par Sébastien Lardière le mardi  8 mars 2016 à 08h30</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>samedi  6 février 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.guillaume.lelarge.info/index.php/" title="gleu's blog - PostgreSQL">Guillaume Lelarge</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:1152698642833c6b15a72239bbbf35ac" lang="fr">
<h4><a href="http://blog.guillaume.lelarge.info/index.php/post/2016/02/06/D%C3%A9but-de-la-traduction-du-manuel-9.5">Début de la traduction du manuel 9.5</a></h4>
<div class="entry">
<div class="content">
<p>J'ai enfin fini le merge du manuel de la version 9.5. Très peu de temps avant la 9.5, le peu de temps que j'avais étant consacré à mon livre. Mais là, c'est bon, on peut bosser. D'ailleurs, Flavie a déjà commencé et a traduit un paquet de nouveaux fichiers. Mais il reste du boulot. Pour les intéressés, c'est par là : <a href="https://github.com/gleu/pgdocs_fr/wiki/Translation-9.5">https://github.com/gleu/pgdocs_fr/wiki/Translation-9.5</a></p>


<p>N'hésitez pas à m'envoyer toute question si vous êtes intéressé pour participer.</p></div>







<p class="date">
<a href="http://blog.guillaume.lelarge.info/index.php/post/2016/02/06/D%C3%A9but-de-la-traduction-du-manuel-9.5">par Guillaume Lelarge le samedi  6 février 2016 à 12h18</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>jeudi  4 février 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.rodolphe.quiedeville.org/index.php" title="One more geek - Mot-clé - postgresql">Rodolphe Quiédeville</a></h3>


<div class="entrygroup" id="urn:md5:f6e29ff67a84c0b7c48df486bb0ea89a" lang="fr">
<h4><a href="http://blog.rodolphe.quiedeville.org/index.php?post/2016/02/Indexer-rechercher-chaines-courtes-postgresql">Indexer pour rechercher des chaines courtes dans PostgreSQL</a></h4>
<div class="entry">
<div class="content">
<p>Les champs de recherche dans les applications web permettent de se voir propooser des résultats à chaque caractère saisies dans le formulaire, pour éviter de trop solliciter les systèmes de stockage de données, les modules standards permettent de définir une limite basse, la recherche n'étant effective qu'à partir du troisième caractères entrés. Cette limite de 3 caractères s'explique par la possibilité de simplement définir des index trigram dans les bases de données, pour PostgreSQL cela se fait avec l'extension standard  <a href="http://www.postgresql.org/docs/current/static/pgtrgm.html">pg_trgm</a>, (pour une étude détaillé des trigrams je conseille la lecture de cet <a href="http://tapoueh.org/blog/2013/09/06-pg_trgm-suggestions">article</a>).</p>


<p>Si cette technique a apporté beaucoup de confort dans l'utilisation des formulaires de recherche elle pose néanmoins le problème lorsque que l'on doit rechercher une chaîne de deux caractères, innoportun, contre-productif me direz-vous (je partage assez cet avis) mais imaginons le cas de madame ou monsieur Ba qui sont présent dans la base de données et dont on a oublié de saisir le prénom ou qui n'ont pas de prénom, ils ne pourront jamais remonter dans ces formulaires de recherche, c'est assez fâcheux pour eux.</p>


<p>Nous allons voir dans cet article comment résoudre ce problème, commençons par créer une table avec 50000 lignes de données text aléatoire&nbsp;:</p>

<pre>
CREATE TABLE blog AS SELECT s, md5(random()::text) as d 
   FROM generate_series(1,50000) s;
~# SELECT * from blog LIMIT 4;
 s |                 d                
---+----------------------------------
 1 | 8fa4044e22df3bb0672b4fe540dec997
 2 | 5be79f21e03e025f00dea9129dc96afa
 3 | 6b1ffca1425326bef7782865ad4a5c5e
 4 | 2bb3d7093dc0fffd5cebacd07581eef0
(4 rows)
</pre>


<p>Admettons que l'on soit un fan de musique des années 80 et que l'on recherche si il existe dans notre table du texte contenant la chaîne <strong>fff</strong>.</p>

<pre>
~# EXPLAIN ANALYZE SELECT * FROM blog WHERE d like '%fff%';

                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Seq Scan on blog  (cost=0.00..1042.00 rows=5 width=37) (actual time=0.473..24.130 rows=328 loops=1)
   Filter: (d ~~ '%fff%'::text)
   Rows Removed by Filter: 49672
 Planning time: 0.197 ms
 Execution time: 24.251 ms
(5 rows)
</pre>


<p>Sans index on s'en doute cela se traduit pas une lecture séquentielle de la table, ajoutons un index. Pour indexer cette colonne avec un index <strong>GIN</strong> nous allons utiliser l'opérateur <strong>gin_trgm_ops</strong> disponible dans l'extension <strong>pg_trgm</strong>.</p>

<pre>
~# CREATE EXTENSION pg_trgm;
CREATE EXTENSION
~# CREATE INDEX blog_trgm_idx ON blog USING GIN(d gin_trgm_ops);
CREATE INDEX
~# EXPLAIN ANALYZE SELECT * FROM blog WHERE d like '%fff%';
                                                       QUERY PLAN                                                        
-------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on blog  (cost=16.04..34.46 rows=5 width=37) (actual time=0.321..1.336 rows=328 loops=1)
   Recheck Cond: (d ~~ '%fff%'::text)
   Heap Blocks: exact=222
   -&gt;  Bitmap Index Scan on blog_trgm_idx  (cost=0.00..16.04 rows=5 width=0) (actual time=0.176..0.176 rows=328 loops=1)
         Index Cond: (d ~~ '%fff%'::text)
 Planning time: 0.218 ms
 Execution time: 1.451 ms
</pre>


<p>Cette fois l'index a pu être utilisé, on note au passage que le temps de requête est réduit d'un facteur 20, mais si l'on souhaite désormais rechercher une chaîne de seulement 2 caractères de nouveau une lecture séquentielle a lieu, notre index trigram devient inefficace pour cette nouvelle recherche.</p>

<pre>
~# EXPLAIN ANALYZE SELECT * FROM blog WHERE d like '%ff%';
                                               QUERY PLAN                                                
---------------------------------------------------------------------------------------------------------
 Seq Scan on blog  (cost=0.00..1042.00 rows=3030 width=37) (actual time=0.016..11.712 rows=5401 loops=1)
   Filter: (d ~~ '%ff%'::text)
   Rows Removed by Filter: 44599
 Planning time: 0.165 ms
 Execution time: 11.968 ms
</pre>


<p>C'est ici que vont intervenir les index bigram, qui comme leur nom l'index travaille sur des couples et non plus des triplets. En premier nous allons tester <a href="http://pgroonga.github.io/">pgroonga</a>, packagé pour Debian, Ubuntu, CentOS et d'autres systèmes exotiques vous trouverez toutes les explications pour le mettre en place sur la page d'<a href="http://pgroonga.github.io/install/">install</a> du projet.</p>


<p>Les versions packagées de la version 1.0.0 ne supportent actuellement que les versions 9.3 et 9.4, mais les <a href="https://github.com/pgroonga/pgroonga/">sources</a> viennent d'être taguées 1.0.1 avec le support de la 9.5.</p>

<pre>
CREATE EXTENSION pgroonga;
</pre>


<p>La création de l'index se fait ensuite en utilisant</p>

<pre>
~# CREATE INDEX blog_pgroonga_idx ON blog USING pgroonga(d);
CREATE INDEX
~# EXPLAIN ANALYZE SELECT * FROM blog WHERE d like '%ff%';
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on blog  (cost=27.63..482.51 rows=3030 width=37) (actual time=3.721..5.874 rows=2378 loops=1)
   Recheck Cond: (d ~~ '%ff%'::text)
   Heap Blocks: exact=416
   -&gt;  Bitmap Index Scan on blog_pgroonga_idx  (cost=0.00..26.88 rows=3030 width=0) (actual time=3.604..3.604 rows=2378 loops=1)
         Index Cond: (d ~~ '%ff%'::text)
 Planning time: 0.280 ms
 Execution time: 6.230 ms
</pre>


<p>On retrouve une utilisation de l'index, avec comme attendu un gain de performance.</p>


<p>Autre solution&nbsp;: <a href="http://pgbigm.osdn.jp/index_en.html">pg_bigm</a> qui est dédié plus précisément aux index bigram, l'installation se fait soit à partie de paquets RPM, soit directement depuis les sources avec une <a href="http://pgbigm.osdn.jp/pg_bigm_en-1-1.html">explication sur le site</a>, claire et détaillée. pg_bigm supporte toutes les versions depuis la 9.1 jusqu'à 9.5.</p>

<pre>
~# CREATE INDEX blog_bigm_idx ON blog USING GIN(d gin_bigm_ops);
CREATE INDEX
~# EXPLAIN ANALYZE SELECT * FROM blog WHERE d like '%ff%';
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on blog  (cost=35.48..490.36 rows=3030 width=37) (actual time=2.121..5.347 rows=5401 loops=1)
   Recheck Cond: (d ~~ '%ff%'::text)
   Heap Blocks: exact=417
   -&gt;  Bitmap Index Scan on blog_bigm_idx  (cost=0.00..34.73 rows=3030 width=0) (actual time=1.975..1.975 rows=5401 loops=1)
         Index Cond: (d ~~ '%ff%'::text)
 Planning time: 4.406 ms
 Execution time: 6.052 ms
</pre>



<p>Sur une table de 500k tuples la création de l'index prend 6,5 secondes pour bigm contre 4,8 pour pgroonga&nbsp;; en terme de lecture je n'ai pas trouvé de pattern avec de réelle différence, bien pgroonga s'annonce plus rapide que pg_bigm, ce premier étant plus récent que le second on peut s'attendre à ce qu'il ait profité de l'expérience du second.</p>


<p>Coté liberté les deux projets sont publiés sous licence <strong>PostgreSQL license</strong>.</p>


<p>La réelle différence entre les deux projets est que Pgroonga est une sous partie du projet global <a href="http://groonga.org/">Groonga</a> qui est dédié à la recherche fulltext, il existe par exemple Mgroonga dont vous devinerez aisément la cible, pg_bigm est lui un projet autonome qui n'implémente que les bigram dans PostgreSQL.</p>


<p>Vous avez désormais deux méthodes pour indexer des 2-gram, prenez garde toutefois de ne pas en abuser.</p>



<p>La version 9.4.5 de PostgreSQL a été utilisée pour la rédaction de cet article.</p></div>







<p class="date">
<a href="http://blog.rodolphe.quiedeville.org/index.php?post/2016/02/Indexer-rechercher-chaines-courtes-postgresql">par Rodolphe Quiédeville le jeudi  4 février 2016 à 08h38</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>lundi  1 février 2016</h2>

<div class="channelgroup">







<h3><a href="http://blog.guillaume.lelarge.info/index.php/" title="gleu's blog - PostgreSQL">Guillaume Lelarge</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:0fa0aa71cc967711697e4f22305c4d1f" lang="fr">
<h4><a href="http://blog.guillaume.lelarge.info/index.php/post/2016/02/01/Parution-de-mon-livre-%3A-PostgreSQL%2C-architecture-et-notions-avanc%C3%A9es">Parution de mon livre : "PostgreSQL, architecture et notions avancées"</a></h4>
<div class="entry">
<div class="content">
<p>Après pratiquement deux ans de travail, mon <a href="http://www.d-booker.fr/postgresql/187-architecture-et-notions-avancees.html" hreflang="fr">livre</a> est enfin paru. Pour être franc, c'est assez étonnant de l'avoir entre les mains : un vrai livre, avec une vraie reliure et une vraie couverture, écrit par soi. C'est à la fois beaucoup de fierté et pas mal de questionnements sur la façon dont il va être reçu.</p>


<p>Ceci étant dit, sans savoir si le livre sera un succès en soi, c'est déjà pour moi un succès personnel. Le challenge était de pouvoir écrire un livre de 300 pages sur PostgreSQL, le livre que j'aurais aimé avoir entre les mains quand j'ai commencé à utiliser ce SGBD il y a maintenant plus de 15 ans sous l'impulsion de mon ancien patron.</p>


<p>Le résultat est à la hauteur de mes espérances et les premiers retours sont très positifs. Ce livre apporte beaucoup d'explications sur le fonctionnement et le comportement de PostgreSQL qui, de ce fait, n'est plus cette espèce de boîte noire à exécuter des requêtes. La critique rédigée par Jean-Michel Armand dans le GNU/Linux Magazine France numéro 190 est vraiment très intéressante. Je suis d'accord avec son auteur sur le fait que le début est assez ardu : on plonge directement dans la technique, sans trop montrer comment c'est utilisé derrière, en production. Cette partie-là n'est abordée qu'après. C'est une question que je m'étais posée lors de la rédaction, mais cette question est l'éternel problème de l'oeuf et de la poule ... Il faut commencer par quelque chose : soit on explique la base technique (ce qui est un peu rude), puis on finit par montrer l'application de cette base, soit on fait l'inverse. Il n'y a certainement pas une solution meilleure que l'autre. Le choix que j'avais fait me semble toujours le bon, même maintenant. Mais en effet, on peut avoir deux façons de lire le livre : en commençant par le début ou en allant directement dans les chapitres thématiques.</p>


<p>Je suis déjà prêt à reprendre le travail pour proposer une deuxième édition encore meilleure. Cette nouvelle édition pourrait se baser sur la prochaine version majeure de PostgreSQL, actuellement numérotée 9.6, qui comprend déjà des nouveautés très excitantes. Mais cette édition ne sera réellement intéressante qu'avec la prise en compte du retour des lecteurs de la première édition, pour corriger et améliorer ce qui doit l'être. N'hésitez donc pas à m'envoyer tout commentaire sur le livre, ce sera très apprécié.</p></div>







<p class="date">
<a href="http://blog.guillaume.lelarge.info/index.php/post/2016/02/01/Parution-de-mon-livre-%3A-PostgreSQL%2C-architecture-et-notions-avanc%C3%A9es">par Guillaume Lelarge le lundi  1 février 2016 à 17h57</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mercredi 13 janvier 2016</h2>

<div class="channelgroup">







<h3><a href="http://sebastien.lardiere.net/blog/index.php/" title="~/sebl[og] - Postgresql">Sébastien Lardière</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:62d4468f6351fe282c47fbd3b990a2c9" lang="fr">
<h4><a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/13/Version-9.5-de-PostgreSQL-3">Version 9.5 de PostgreSQL - 3</a></h4>
<div class="entry">
<div class="content">
<p>Une nouvelle version majeure de <a href="http://sebastien.lardiere.net/blog/index.php/tag/PostgreSQL">PostgreSQL</a> est <a hreflang="fr" title="PostgreSQL 9.5.0" href="http://www.loxodata.com/postgresql-9.5.0-publiee">disponible depuis le 7 janvier</a>. Chacune des versions de <a href="http://sebastien.lardiere.net/blog/index.php/tag/PostgreSQL">PostgreSQL</a> ajoute son lot de fonctionnalités, à la fois pour le développeur et l'administrateur. Cette version apporte de nombreuses fonctionnalités visant à améliorer les performances lors du requêtage de gros volumes de données.</p><p>Cette présentation en trois billets introduit trois types de fonctionnalités :</p><ul><li>les <a hreflang="fr" title="Version-9.5-de-PostgreSQL" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/08/01-Version-9.5-de-PostgreSQL">nouveautés dans le langage</a> <a href="http://sebastien.lardiere.net/blog/index.php/tag/SQL">SQL</a></li><li>Les <a hreflang="fr" title="nouvelles méthodes internes du moteur" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/12/Version-9.5-de-PostgreSQL-2">nouvelles méthodes internes du moteur</a></li><li>De <a hreflang="fr" title="nouvelles directives de configurations" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/13/Version-9.5-de-PostgreSQL-3">nouvelles directives de configurations</a></li></ul>    <p>Ce dernier billet de la série liste quelques paramètres de configuration qui font leur apparition dans cette nouvelle version.Suivi de l'horodatage des COMMITLe paramètre track_commit_timestamp permet de marquer dans les journaux de transactions ("WAL") chaque validation ("COMMIT") avec la date et l'heure du serveur. Ce paramètre est un booléen, et... <a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/13/Version-9.5-de-PostgreSQL-3"><em>Lire</em> Version 9.5 de PostgreSQL - 3</a></p></div>







<p class="date">
<a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/13/Version-9.5-de-PostgreSQL-3">par Sébastien Lardière le mercredi 13 janvier 2016 à 15h12</a>
</p>
</div>
</div>



</div>
<div class="channelgroup">







<h3><a href="http://blog.rodolphe.quiedeville.org/index.php" title="One more geek - Mot-clé - postgresql">Rodolphe Quiédeville</a></h3>


<div class="entrygroup" id="urn:md5:27c1ce94a7b21f6eafcc5f9564caa7ea" lang="fr">
<h4><a href="http://blog.rodolphe.quiedeville.org/index.php?post/2016/01/Index-multi-colonnes-gin-gist">Index multi colonnes GIN, GIST</a></h4>
<div class="entry">
<div class="content">
<p>Ce billet intéressera tous les utilisateurs de colonnes de type <code>hstore</code> ou <code>json</code> avec PostgreSQL. Bien que celui-ci prenne pour exemple hstore il s'applique également aux colonnes <code>json</code> ou <code>jsonb</code>.</p>


<p>Commençons par créer une table et remplissons là avec 100 000 lignes de données aléatoires. Notre exemple représente des articles qui sont associés à un identifiant de langue (<code>lang_id</code>) et des tags catégorisés (<code>tags</code>), ici chaque article peut être associé à un pays qui sera la Turquie ou l'Islande.</p>

<pre>
~# CREATE TABLE article (id int4, lang_id int4, tags hstore);
CREATE TABLE
~# INSERT INTO article 
SELECT generate_series(1,10e4::int4), cast(random()*20 as int),
CASE WHEN random() &gt; 0.5 
THEN 'country=&gt;Turquie'::hstore 
WHEN random() &gt; 0.8 THEN 'country=&gt;Islande' ELSE NULL END AS x;
INSERT 0 100000
</pre>


<p>Pour une recherche efficace des articles dans une langue donnée nous ajountons un index de type B-tree sur la colonne <code>lang_id</code> et un index de type GIN sur la colonne <code>tags</code>.</p>

<pre>
~# CREATE INDEX ON article(lang_id);
CREATE INDEX
~# CREATE INDEX ON article USING GIN (tags);
CREATE INDEX
</pre>


<p>Nous avons  maintenant nos données et nos index, nous pouvons commencer les recherches.
Recherchons tous les articles écrit en français (on considère que l'id du français est le 17), qui sont associés à un pays (ils ont un tag <strong>country</strong>), et analysons le plan d'exécution.</p>

<pre>
~# EXPLAIN ANALYZE SELECT * FROM article WHERE lang_id=17 AND tags ? 'country';
                                                                QUERY PLAN                                                                
------------------------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on article  (cost=122.42..141.21 rows=5 width=35) (actual time=12.348..13.912 rows=3018 loops=1)
   Recheck Cond: ((tags ? 'country'::text) AND (lang_id = 17))
   Heap Blocks: exact=663
   -&gt;  BitmapAnd  (cost=122.42..122.42 rows=5 width=0) (actual time=12.168..12.168 rows=0 loops=1)
         -&gt;  Bitmap Index Scan on article_tags_idx  (cost=0.00..12.75 rows=100 width=0) (actual time=11.218..11.218 rows=60051 loops=1)
               Index Cond: (tags ? 'country'::text)
         -&gt;  Bitmap Index Scan on article_lang_id_idx  (cost=0.00..109.42 rows=4950 width=0) (actual time=0.847..0.847 rows=5016 loops=1)
               Index Cond: (lang_id = 17)
 Planning time: 0.150 ms
 Execution time: 14.111 ms
(10 rows)
</pre>



<p>On a logiquement 2 parcours d'index, suivis d'une opération de combinaison pour obtenir le résultat final. Pour gagner un peu en performance on penserait naturellement à créer un index multi colonnes qui contienne <code>lang_id</code> et <code>tags</code>, mais si vous avez déjà essayé de le faire vous avez eu ce message d'erreur&nbsp;:</p>

<pre>
~# CREATE INDEX ON article USING GIN (lang_id, tags);
ERROR:  42704: data type integer has no default operator class for access method &quot;gin&quot;
HINT:  You must specify an operator class for the index or define a default operator class for the data type.
LOCATION:  GetIndexOpClass, indexcmds.c:1246
</pre>


<p>Le HINT donnne une piste intéressante, en effet les index de type <code>GIN</code> ne peuvent pas s'appliquer sur les colonnes de type int4 (et bien d'autres).</p>


<p>La solution réside dans l'utilisation d'une extension standard, qui combine les opérateurs GIN et B-tree, <a href="http://www.postgresql.org/docs/current/static/btree-gin.html">btree-gin</a>, précisons tout de suite qu'il existe l'équivalent <a href="http://www.postgresql.org/docs/current/static/btree-gist.html">btree-gist</a>.</p>


<p>Comme toute extension elle s'installe aussi simplement que&nbsp;:</p>

<pre>
~# CREATE EXTENSION btree_gin;
CREATE EXTENSION
</pre>


<p>Désormais nous allons pouvoir créer notre index multi-colonne et rejouer notre requête pour voir la différence.</p>

<pre>
~# CREATE INDEX ON article USING GIN (lang_id, tags);
CREATE INDEX
</pre>

<pre>
~# EXPLAIN ANALYZE SELECT * FROM article WHERE lang_id=17 AND tags ? 'country';
                                                             QUERY PLAN                                                              
-------------------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on article  (cost=24.05..42.84 rows=5 width=35) (actual time=1.983..3.777 rows=3018 loops=1)
   Recheck Cond: ((lang_id = 17) AND (tags ? 'country'::text))
   Heap Blocks: exact=663
   -&gt;  Bitmap Index Scan on article_lang_id_tags_idx  (cost=0.00..24.05 rows=5 width=0) (actual time=1.875..1.875 rows=3018 loops=1)
         Index Cond: ((lang_id = 17) AND (tags ? 'country'::text))
 Planning time: 0.211 ms
 Execution time: 3.968 ms
(7 rows)
</pre>


<p>A la lecture de ce deuxième explain le gain est explicite, même avec un petit jeu de données le coût estimé est divisé par 3, l'on gagne une lecture d'index et une opération de composition. Maintenant nous pouvons supprimer les 2 autres index pour ne conserver que celui-ci.</p></div>







<p class="date">
<a href="http://blog.rodolphe.quiedeville.org/index.php?post/2016/01/Index-multi-colonnes-gin-gist">par Rodolphe Quiédeville le mercredi 13 janvier 2016 à 14h11</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>mardi 12 janvier 2016</h2>

<div class="channelgroup">







<h3><a href="http://sebastien.lardiere.net/blog/index.php/" title="~/sebl[og] - Postgresql">Sébastien Lardière</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:c1ed758d5a5aa45d7f2ab783ca092dc2" lang="fr">
<h4><a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/12/Version-9.5-de-PostgreSQL-2">Version 9.5 de PostgreSQL - 2</a></h4>
<div class="entry">
<div class="content">
<p>Une nouvelle version majeure de <a href="http://sebastien.lardiere.net/blog/index.php/tag/PostgreSQL">PostgreSQL</a> est <a hreflang="fr" title="PostgreSQL 9.5.0" href="http://www.loxodata.com/postgresql-9.5.0-publiee">disponible depuis le 7 janvier</a>. Chacune des versions de <a href="http://sebastien.lardiere.net/blog/index.php/tag/PostgreSQL">PostgreSQL</a> ajoute son lot de fonctionnalités, à la fois pour le développeur et l'administrateur. Cette version apporte de nombreuses fonctionnalités visant à améliorer les performances lors du requêtage de gros volumes de données.</p><p>Cette présentation en trois billets introduit trois types de fonctionnalités :</p><ul><li>les <a hreflang="fr" title="Version-9.5-de-PostgreSQL" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/08/01-Version-9.5-de-PostgreSQL">nouveautés dans le langage</a> <a href="http://sebastien.lardiere.net/blog/index.php/tag/SQL">SQL</a></li><li>Les <a hreflang="fr" title="nouvelles méthodes internes du moteur" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/12/Version-9.5-de-PostgreSQL-2">nouvelles méthodes internes du moteur</a></li><li>De <a hreflang="fr" title="nouvelles directives de configurations" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/13/Version-9.5-de-PostgreSQL-3">nouvelles directives de configurations</a></li></ul>    <p>Ce deuxième billet évoque donc les nouvelles méthodes internes du moteur, c'est-à-dire de nouveaux outils dont PostgreSQL dispose pour traiter les données.Index BRINIl s'agit d'un nouveau type d'index, créé pour résoudre des problèmes d'accès à de très gros volumes de données ; le cas d'usage est une table de log, dans laquelle les données sont... <a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/12/Version-9.5-de-PostgreSQL-2"><em>Lire</em> Version 9.5 de PostgreSQL - 2</a></p></div>







<p class="date">
<a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/12/Version-9.5-de-PostgreSQL-2">par Sébastien Lardière le mardi 12 janvier 2016 à 10h45</a>
</p>
</div>
</div>


</div>

</div>
<div class="daygroup">
<h2>vendredi  8 janvier 2016</h2>

<div class="channelgroup">







<h3><a href="http://sebastien.lardiere.net/blog/index.php/" title="~/sebl[og] - Postgresql">Sébastien Lardière</a></h3>
<img class="face" src="images/logo.80x80.png" width="80" height="80" alt="">


<div class="entrygroup" id="urn:md5:048fc0982b68bf7b6421570961858cbe" lang="fr">
<h4><a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/08/01-Version-9.5-de-PostgreSQL">Version 9.5 de PostgreSQL</a></h4>
<div class="entry">
<div class="content">
<p>Une nouvelle version majeure de <a href="http://sebastien.lardiere.net/blog/index.php/tag/PostgreSQL">PostgreSQL</a> est <a hreflang="fr" title="PostgreSQL 9.5.0" href="http://www.loxodata.com/postgresql-9.5.0-publiee">disponible depuis le 7 janvier</a>. Chacune des versions de <a href="http://sebastien.lardiere.net/blog/index.php/tag/PostgreSQL">PostgreSQL</a> ajoute son lot de fonctionnalités, à la fois pour le développeur et l'administrateur. Cette version apporte de nombreuses fonctionnalités visant à améliorer les performances lors du requêtage de gros volumes de données.</p><p>Cette présentation en trois billets introduit trois types de fonctionnalités :</p><ul><li>les <a hreflang="fr" title="Version-9.5-de-PostgreSQL" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/08/01-Version-9.5-de-PostgreSQL">nouveautés dans le langage</a> <a href="http://sebastien.lardiere.net/blog/index.php/tag/SQL">SQL</a></li><li>Les <a hreflang="fr" title="nouvelles méthodes internes du moteur" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/12/Version-9.5-de-PostgreSQL-2">nouvelles méthodes internes du moteur</a></li><li>De <a hreflang="fr" title="nouvelles directives de configurations" href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/13/Version-9.5-de-PostgreSQL-3">nouvelles directives de configurations</a></li></ul>    <p>Ce premier billet revient donc sur les ajouts au langage SQL de la version 9.5 de PostgreSQL.Ces ajouts portent sur de nombreux champs de fonctionnalités, de la sécurité aux gestions de performances en passant par la gestion des transactions.UPSERTCe mot clé désigne en réalité la possibilité d'intercepter une erreur de clé primaire sur un ordre... <a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/08/01-Version-9.5-de-PostgreSQL"><em>Lire</em> Version 9.5 de PostgreSQL</a></p></div>







<p class="date">
<a href="http://sebastien.lardiere.net/blog/index.php/post/2016/01/08/01-Version-9.5-de-PostgreSQL">par Sébastien Lardière le vendredi  8 janvier 2016 à 10h49</a>
</p>
</div>
</div>


</div>

</div>

</div>


<div class="sidebar">
<img src="images/logo.png" alt="">

<h2>Membres de la planète PGFR</h2>
<ul>
<li>
<a href="http://blog.postgresql.fr/index.php?feed/atom" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.postgresql.fr/index.php" title="PostgreSQLfr.org">Actualités PostgreSQL.fr</a>
</li>
<li>
<a href="https://blog.anayrat.info/category/linux/postgres/feed/" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a class="message" title="internal server error">Adrien Nayrat</a>
</li>
<li>
<a href="http://www.base-sql.fr/?feed=rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a title="">Base-sql.fr</a>
</li>
<li>
<a href="http://blog.kryskool.org/feeds/postgresql.rss.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.kryskool.org" title="KrysKool.browse(cr, uid, ids, context)">Christophe Chauvet</a>
</li>
<li>
<a href="http://blog.2ndquadrant.com/cedrics-fr-planetepostgresql/feed/" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a class="message" title="internal server error">Cédric Villemain</a>
</li>
<li>
<a href="http://blog.taadeem.net/feed.pgfr.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.taadeem.net/" title="- PGFR">Damien Clochard</a>
</li>
<li>
<a href="http://tapoueh.org/rss/postgresqlfr.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a class="message" title="404: not found">Dimitri Fontaine</a>
</li>
<li>
<a href="http://blog.guillaume.lelarge.info/index.php/feed/category/Postgresql/rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.guillaume.lelarge.info/index.php/" title="gleu's blog - PostgreSQL">Guillaume Lelarge</a>
</li>
<li>
<a href="http://www.argudo.org/index.php?feed/category/PostgreSQL/rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a class="message" title="internal server error">Jean-Paul Argudo</a>
</li>
<li>
<a href="http://rjuju.github.io/postgresqlfr/feed.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="https://rjuju.github.io" title="rjuju's home">Julien Rouhaud</a>
</li>
<li>
<a href="http://www.loxodata.com/post/index.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://www.loxodata.com/post/" title="Blog Loxodata">Loxodata</a>
</li>
<li>
<a href="http://blog.ng.pe/tag/postgresql/rss/" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.ng.pe/" title="postgresql - Nicolas GOLLET">Nicolas Gollet</a>
</li>
<li>
<a href="http://www.orgrim.net/postgresql/feed.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://www.orgrim.net" title="code. grind. sleep. - PostgreSQL">Nicolas Thauvin</a>
</li>
<li>
<a href="http://beaud76.blog.free.fr/index.php?feed/tag/PostgreSQL-fr/rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://beaud76.blog.free.fr/index.php" title="De Phil en aiguille - Tag - PostgreSQL-fr">Philippe Beaudoin</a>
</li>
<li>
<a href="http://pgphil.ovh/maj.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://pgphil.ovh" title="pgphil.ovh">Philippe Florent</a>
</li>
<li>
<a href="http://www.postgresqlfr.org/?q=rss.xml" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://www.postgresqlfr.org/_export/xhtml/Accueil" title="">PostgreSQL Fr</a>
</li>
<li>
<a href="http://blog.rodolphe.quiedeville.org/index.php?feed/tag/postgresql/rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.rodolphe.quiedeville.org/index.php" title="One more geek - Mot-clé - postgresql">Rodolphe Quiédeville</a>
</li>
<li>
<a href="http://re.rephrase.net/filter/?feed=http%3A%2F%2Fwww.bortzmeyer.org%2Ffeed.atom&amp;filter=title%3Apostgresql+OR+title%3ASQL" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://re.rephrase.net/" title="Blog de Stéphane Bortzmeyer">Stephane Bortzmeyer</a>
</li>
<li>
<a href="http://sebastien.lardiere.net/blog/index.php/feed/category/Postgresql/rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://sebastien.lardiere.net/blog/index.php/" title="~/sebl[og] - Postgresql">Sébastien Lardière</a>
</li>
<li>
<a href="http://blog.frosties.org/feed/category/PostgreSQL/rss2" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://blog.frosties.org/" title=".: live transmission :. - PostgreSQL">Thomas Reiss</a>
</li>
<li>
<a href="http://artisan.karma-lab.net/taxonomy/term/1366/feed" title="subscribe">
<img src="images/favicon.ico" alt="(feed)"></a> 
<a href="http://artisan.karma-lab.net" title="Artisan Numérique">ulhume</a>
</li>
</ul>
<p>
<h2>S'abonner</h2>
<ul>
<li>
<a href="http://planete.postgresql.fr/atom.xml" title="">Fil des billets</a>
</li>
</ul>
</p>

<p>
<h2>PostgreSQL en Français:</h2>
<ul>
<li><a href="http://www.postgresql.fr/">Association PostgreSQL Fr</a></li>
<li><a href="http://www.postgresql.fr/">Wiki de l'asso</a></li>
<li><a href="http://doc.postgresql.fr/">Documentation en français</a></li>
<li><a href="http://archives.postgresql.org/pgsql-fr-generale/">Liste de discussion principale</a></li>
<li><a href="http://listes.postgresql.fr">Les autres listes</a></li>
</ul>
</p>

<p>
<strong>Dernière mise à jour:</strong><br>
dimanche 28 mai 2017 à 19h12<br>
<br/>
<br/>
Propulsé par:
<a href="http://www.planetplanet.org/"><img src="images/planet.png" width="80" h
eight="15" alt="Planet" border="0"></a>
</p>

</div><!-- end of sidebar -->
</div><!-- end of pgContent -->
</div><!-- end of pgWrap -->
</body>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3921927-5");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</html>
